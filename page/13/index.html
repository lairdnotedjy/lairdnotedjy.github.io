<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2426182848439341"
     crossorigin="anonymous"></script>

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.sovdating.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Hello dev">
<meta property="og:type" content="website">
<meta property="og:title" content="Sovdating Linux">
<meta property="og:url" content="https://www.sovdating.com/page/13/index.html">
<meta property="og:site_name" content="Sovdating Linux">
<meta property="og:description" content="Hello dev">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="DJY">
<meta property="article:tag" content="golang python linux ubuntu centos rust">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.sovdating.com/page/13/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/13/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Sovdating Linux</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Sovdating Linux</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">some code for program</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">DJY</p>
  <div class="site-description" itemprop="description">Hello dev</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">469</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">82</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">330</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/23/%E8%85%BE%E8%AE%AF%E8%B4%A2%E4%BB%98%E9%80%9A%20%E7%A7%BB%E5%8A%A8QQ%E6%94%AF%E4%BB%98%20Cordova-plugin-qpay/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/23/%E8%85%BE%E8%AE%AF%E8%B4%A2%E4%BB%98%E9%80%9A%20%E7%A7%BB%E5%8A%A8QQ%E6%94%AF%E4%BB%98%20Cordova-plugin-qpay/" class="post-title-link" itemprop="url">腾讯财付通 移动QQ支付 Cordova-plugin-qpay</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-23T00:00:00+08:00">2016-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="腾讯财付通-移动QQ支付-Cordova-plugin-qpay"><a href="#腾讯财付通-移动QQ支付-Cordova-plugin-qpay" class="headerlink" title="腾讯财付通 移动QQ支付 Cordova-plugin-qpay"></a>腾讯财付通 移动QQ支付 Cordova-plugin-qpay</h1><ul>
<li><p>场景介绍<br><a target="_blank" rel="noopener" href="https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&docid=160">https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&amp;docid=160</a></p>
</li>
<li><p>支付流程<br><a target="_blank" rel="noopener" href="https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&docid=201">https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&amp;docid=201</a><br><img src="http://p.qpic.cn/qpaywikipic/0/qpaywikipic_582045e17a9263438/0">  </p>
</li>
<li><p>商户接入指引<br><a target="_blank" rel="noopener" href="http://kf.qq.com/faq/150107UZvUZB160405mumyaq.html">http://kf.qq.com/faq/150107UZvUZB160405mumyaq.html</a></p>
</li>
<li><p>普通商户如何接入APP支付？<code>★特别注意,如未填写将无法使用APP支付.且无法变更,只能重新申请</code><br><img src="http://file.service.qq.com/user-files/uploads/201611/1445a222fa15c23d2a688ee6041eea51.jpg"><br><a target="_blank" rel="noopener" href="http://kf.qq.com/faq/150107UZvUZB161117vyEBBR.html">http://kf.qq.com/faq/150107UZvUZB161117vyEBBR.html</a></p>
</li>
</ul>
<hr>
<h1 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin remove com.wosai.qpay</span><br></pre></td></tr></table></figure>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin add https://github.com/liuxiang/cordova-plugin-qpay.git --variable qpayappid=YOUR_QPAY_APPID</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="官方测试账号（快速验证qpay-plugin）"><a href="#官方测试账号（快速验证qpay-plugin）" class="headerlink" title="官方测试账号（快速验证qpay plugin）"></a>官方测试账号（快速验证qpay plugin）</h1><h2 id="注：ios可调试到支付。-android因为没有官方的签名文件导致服务正确匹配sha1，会提示商户中找不到appid。-1-安装插件-获取QQ支付订单（orderCode-or-tokenId）访问demo地址可获得-http-fun-svip-qq-com-mqqopenpay-demo-php-2-程序调用-3-更新ios应用名config-xml-4-编译，xcode运行"><a href="#注：ios可调试到支付。-android因为没有官方的签名文件导致服务正确匹配sha1，会提示商户中找不到appid。-1-安装插件-获取QQ支付订单（orderCode-or-tokenId）访问demo地址可获得-http-fun-svip-qq-com-mqqopenpay-demo-php-2-程序调用-3-更新ios应用名config-xml-4-编译，xcode运行" class="headerlink" title="注：ios可调试到支付。 android因为没有官方的签名文件导致服务正确匹配sha1，会提示商户中找不到appid。- 1.安装插件- 获取QQ支付订单（orderCode or tokenId）访问demo地址可获得 http://fun.svip.qq.com/mqqopenpay_demo.php- 2.程序调用- 3.更新ios应用名config.xml- 4.编译，xcode运行
 "></a>注：ios可调试到支付。 android因为没有官方的签名文件导致服务正确匹配sha1，会提示商户中找不到appid。<br>- 1.安装插件<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin add plugins-ws/com.wosai.qpay --variable qpayappid=100619284</span><br></pre></td></tr></table></figure><br><br>- 获取QQ支付订单（orderCode or tokenId）<br>访问demo地址可获得 <a target="_blank" rel="noopener" href="http://fun.svip.qq.com/mqqopenpay_demo.php">http://fun.svip.qq.com/mqqopenpay_demo.php</a><br><br>- 2.程序调用<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPay.mqqPay(&#123;tokenId:&#x27;1V39f4eaf286fe3718731871b4fe96dc&#x27;&#125; ,function(res)&#123;console.log(&quot;res&quot;,res)&#125;,function(res)&#123;console.log(&quot;error&quot;,res)&#125;);</span><br></pre></td></tr></table></figure><br><br>- 3.更新ios应用名<code>config.xml</code><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;widget id=&quot;com.tencent.qqwallet.example&quot;</span><br></pre></td></tr></table></figure><br><br>- 4.编译，xcode运行<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic build ios</span><br></pre></td></tr></table></figure>
 </h2><h1 id="能力"><a href="#能力" class="headerlink" title="能力"></a>能力</h1><ul>
<li>是否安装QQ(限：android)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPay.isMqqInstalled(function(res)&#123;console.log(res)&#125;);</span><br></pre></td></tr></table></figure></li>
<li>是否支持移动QQ支付(限：android)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPay.isMqqSupportPay(function(res)&#123;console.log(res)&#125;)</span><br></pre></td></tr></table></figure></li>
<li>获取订单（后端实现，插件留白）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPay.getOrderno(function(res)&#123;console.log(&quot;res&quot;,res)&#125;,function(res)&#123;console.log(&quot;error&quot;,res)&#125;)</span><br></pre></td></tr></table></figure></li>
<li>★移动QQ支付（android | ios）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">QPay.mqqPay(&#123;</span><br><span class="line">  tokenId: &#x27;1V39f4eaf286fe3718731871b4fe96dc&#x27;,// 订单号</span><br><span class="line">  nonce: &#x27;&#x27;,// 随机数</span><br><span class="line">  bargainorId: &#x27;1234567890&#x27;,// 商户号</span><br><span class="line">  appKey: &#x27;88888888888888&#x27;,// appkey</span><br><span class="line">  sig: &#x27;&#x27;</span><br><span class="line">&#125;, function (res) &#123;</span><br><span class="line">  alert(&quot;res:&quot; + res)</span><br><span class="line">&#125;, function (res) &#123;</span><br><span class="line">  alert(&quot;error:&quot; + res)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>建议先用官方测试账号验证（未填字段会在插件中补充-仅限测试）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPay.mqqPay_demo(&#123;tokenId:&#x27;1V39f4eaf286fe3718731871b4fe96dc&#x27;&#125; ,function(res)&#123;console.log(&quot;res&quot;,res)&#125;,function(res)&#123;console.log(&quot;error&quot;,res)&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="签名纠正功能-后端签名-也可参考此代码段"><a href="#签名纠正功能-后端签名-也可参考此代码段" class="headerlink" title="签名纠正功能(后端签名,也可参考此代码段)"></a>签名纠正功能(后端签名,也可参考此代码段)</h1><h2 id="注：签名依赖密钥等敏感信息，建议后台进行。插件提供此功能，仅用于后台签名校验。上线请关闭debug-false-android-见qpay-java注：APP-KEY默认填写了访问示例使用的app-key-调试自由app支付，请修改。-ios-见qpay-m注：APP-KEY默认填写了访问示例使用的app-key-调试自由app支付，请修改。"><a href="#注：签名依赖密钥等敏感信息，建议后台进行。插件提供此功能，仅用于后台签名校验。上线请关闭debug-false-android-见qpay-java注：APP-KEY默认填写了访问示例使用的app-key-调试自由app支付，请修改。-ios-见qpay-m注：APP-KEY默认填写了访问示例使用的app-key-调试自由app支付，请修改。" class="headerlink" title="注：签名依赖密钥等敏感信息，建议后台进行。插件提供此功能，仅用于后台签名校验。上线请关闭debug = false## android 见qpay.java注：APP_KEY默认填写了访问示例使用的app_key. 调试自由app支付，请修改。## ios 见qpay.m注：APP_KEY默认填写了访问示例使用的app_key. 调试自由app支付，请修改。
 "></a>注：签名依赖密钥等敏感信息，建议后台进行。插件提供此功能，仅用于后台签名校验。上线请关闭<code>debug = false</code><br>## android 见<code>qpay.java</code><br>注：APP_KEY默认填写了访问示例使用的app_key. 调试自由app支付，请修改。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">boolean debug = true;// 是否开启debug</span><br><span class="line">if (debug) &#123;</span><br><span class="line">  String sig_online = signApi(api);// 请手动更新APP_KEY</span><br><span class="line">  if (api.sig != sig_online) &#123;</span><br><span class="line">    System.out.println(&quot;签名错误-纠正&quot;);</span><br><span class="line">    api.sig = sig_online;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 签名步骤建议不要在app上执行，要放在服务器上执行.</span><br><span class="line">*/</span><br><span class="line">public String signApi(PayApi api) throws Exception &#123;</span><br><span class="line">  // 按key排序</span><br><span class="line">  StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">  stringBuilder.append(&quot;appId=&quot;).append(api.appId);</span><br><span class="line">  stringBuilder.append(&quot;&amp;bargainorId=&quot;).append(api.bargainorId);</span><br><span class="line">  stringBuilder.append(&quot;&amp;nonce=&quot;).append(api.nonce);</span><br><span class="line">  stringBuilder.append(&quot;&amp;pubAcc=&quot;).append(&quot;&quot;);</span><br><span class="line">  stringBuilder.append(&quot;&amp;tokenId=&quot;).append(api.tokenId);</span><br><span class="line"> </span><br><span class="line">  String APP_KEY = &quot;d139ae6fb0175e5659dce2a7c1fe84d5&quot;;// 调试使用,应该服务器保护</span><br><span class="line">  byte[] byteKey = (APP_KEY + &quot;&amp;&quot;).getBytes(&quot;UTF-8&quot;);</span><br><span class="line">  // 根据给定的字节数组构造一个密钥,第二参数指定一个密钥算法的名称</span><br><span class="line">  SecretKey secretKey = new SecretKeySpec(byteKey, &quot;HmacSHA1&quot;);</span><br><span class="line">  // 生成一个指定 Mac 算法 的 Mac 对象</span><br><span class="line">  Mac mac = Mac.getInstance(&quot;HmacSHA1&quot;);</span><br><span class="line">  // 用给定密钥初始化 Mac 对象</span><br><span class="line">  mac.init(secretKey);</span><br><span class="line">  byte[] byteSrc = stringBuilder.toString().getBytes(&quot;UTF-8&quot;);</span><br><span class="line">  // 完成 Mac 操作</span><br><span class="line">  byte[] dst = mac.doFinal(byteSrc);</span><br><span class="line"> </span><br><span class="line">  // Base64</span><br><span class="line">  // api.sig = Base64.encodeToString(dst, Base64.NO_WRAP);</span><br><span class="line">  // api.sigType = &quot;HMAC-SHA1&quot;;</span><br><span class="line">  return Base64.encodeToString(dst, Base64.NO_WRAP);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>## ios 见<code>qpay.m</code><br>注：APP_KEY默认填写了访问示例使用的app_key. 调试自由app支付，请修改。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">BOOL debug = true;// 调试</span><br><span class="line">if(debug)&#123;</span><br><span class="line">    // 获取签名串</span><br><span class="line">    NSString *appKey = @&quot;d139ae6fb0175e5659dce2a7c1fe84d5&quot;;// 测试使用，正式环境请删除</span><br><span class="line">    NSString *sig_online = [self getMySignatureWithAppId:appId</span><br><span class="line">                                             bargainorId:bargainorId</span><br><span class="line">                                                   nonce:nonce</span><br><span class="line">                                                 tokenId:tokenId</span><br><span class="line">                                              signingKey:appKey];</span><br><span class="line"> </span><br><span class="line">    if(sig != sig_online)&#123;</span><br><span class="line">        UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@&quot;签名错误－纠正&quot; message:nil delegate:nil cancelButtonTitle:@&quot;OK&quot; otherButtonTitles:nil, nil];</span><br><span class="line">        [alert show];</span><br><span class="line">        sig = sig_online;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 生成签名串</span><br><span class="line">- (NSString *)getMySignatureWithAppId:(NSString *)appId</span><br><span class="line">                          bargainorId:(NSString *)bargainorId</span><br><span class="line">                                nonce:(NSString *)nonce</span><br><span class="line">                              tokenId:(NSString *)tokenId</span><br><span class="line">                           signingKey:(NSString *)signingKey&#123;</span><br><span class="line"> </span><br><span class="line">    // 1. 将 appId,bargainorId,nonce,tokenId 拼成字符串</span><br><span class="line">    NSString *source = [NSString stringWithFormat:@&quot;appId=%@&amp;bargainorId=%@&amp;nonce=%@&amp;pubAcc=&amp;tokenId=%@&quot;,</span><br><span class="line">                        appId,bargainorId,nonce,tokenId];</span><br><span class="line"> </span><br><span class="line">    // 2. 将刚才拼好的字符串，用key来加密</span><br><span class="line">    NSData *signature = [source dataUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    NSData *signingData = [[signingKey stringByAppendingString:@&quot;&amp;&quot;] dataUsingEncoding:NSUTF8StringEncoding];  // 约定在key末尾拼一个‘&amp;’符号</span><br><span class="line">    NSData *digest = [self hmacSha1:signature key:signingData];</span><br><span class="line"> </span><br><span class="line">    // 3. 将加密后的data以base64形式输出</span><br><span class="line">    NSString *signatureBase64 = [digest base64Encoding];</span><br><span class="line">    return signatureBase64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 </h2><h1 id="后端指引"><a href="#后端指引" class="headerlink" title="后端指引"></a>后端指引</h1><h2 id="1-生成订单"><a href="#1-生成订单" class="headerlink" title="1.生成订单"></a>1.生成订单</h2><ul>
<li><p>参考统一下单接口<br><a target="_blank" rel="noopener" href="https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&docid=58">https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&amp;docid=58</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;xml&gt;</span><br><span class="line">  &lt;appid&gt;1111223451&lt;/appid&gt; &lt;!-- 应用ID --&gt;</span><br><span class="line">  &lt;body&gt;123&lt;/body&gt; &lt;!-- 商品描述  --&gt;</span><br><span class="line">  &lt;device_info&gt;1234567890abc&lt;/device_info&gt; &lt;!-- 设备信息 --&gt;</span><br><span class="line">  &lt;limit_pay&gt;&lt;/limit_pay&gt; &lt;!-- 支付方式限制  --&gt;</span><br><span class="line">  &lt;mch_id&gt;1301278501&lt;/mch_id&gt; &lt;!-- 商户ID --&gt;</span><br><span class="line">  &lt;nonce_str&gt;fecf31a13be2309093db5df934848583&lt;/nonce_str&gt; &lt;!-- 随机字符串 --&gt;</span><br><span class="line">  &lt;notify_url&gt;https://qpay.qq.com/cgi-bin/pay/qpay_unified_order.cgi&lt;/notify_url&gt;&lt;!-- 支付结果通知地址 --&gt;</span><br><span class="line">  &lt;out_trade_no&gt;2016061235213702&lt;/out_trade_no&gt; &lt;!-- 商户订单号  --&gt;</span><br><span class="line">  &lt;sign&gt;f0c328d362858713b66feafb802615d8&lt;/sign&gt;&lt;!-- 统一下单签名 --&gt;</span><br><span class="line">  &lt;spbill_create_ip&gt;10.123.9.102&lt;/spbill_create_ip&gt; &lt;!-- 终端ip --&gt;</span><br><span class="line">  &lt;total_fee&gt;1&lt;/total_fee&gt; &lt;!-- 价格  --&gt;</span><br><span class="line">  &lt;trade_type&gt;NATIVE&lt;/trade_type&gt; &lt;!-- 支付场景  --&gt;</span><br><span class="line">&lt;/xml&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>签名规范<br><a target="_blank" rel="noopener" href="https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&docid=57">https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&amp;docid=57</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">假设传送的参数如下：</span><br><span class="line">appid： d930ea5d5a258f4f</span><br><span class="line">mch_id： 10000100</span><br><span class="line">device_info： 1000</span><br><span class="line">body： test</span><br><span class="line">nonce_str： ibuaiVcKdpRxkhJA</span><br><span class="line"> </span><br><span class="line">第一步：对参数按照key=value的格式，并按照参数名ASCII字典序排序如下：</span><br><span class="line">stringA=&quot;appid=d930ea5d5a258f4f&amp;body=test&amp;device_info=1000&amp;mch_id=10000100&amp;nonce_str=ibuaiVcKdpRxkhJA&quot;;</span><br><span class="line"> </span><br><span class="line">第二步：拼接API密钥：</span><br><span class="line">stringSignTemp=&quot;stringA&amp;key=192006250b4c09247ec02edce69f6a2d&quot;</span><br><span class="line">sign=MD5(stringSignTemp).toUpperCase()=&quot;9A0A8659F005D6984697E2CA0A9CF3B7&quot;</span><br><span class="line"> </span><br><span class="line">最终得到最终发送的数据：</span><br><span class="line">&lt;xml&gt;</span><br><span class="line">&lt;appid&gt;d930ea5d5a258f4f&lt;/appid&gt;</span><br><span class="line">&lt;mch_id&gt;10000100&lt;/mch_id&gt;</span><br><span class="line">&lt;device_info&gt;1000&lt;device_info&gt;</span><br><span class="line">&lt;body&gt;test&lt;/body&gt;</span><br><span class="line">&lt;nonce_str&gt;ibuaiVcKdpRxkhJA&lt;/nonce_str&gt;</span><br><span class="line">&lt;sign&gt;9A0A8659F005D6984697E2CA0A9CF3B7&lt;/sign&gt;</span><br><span class="line">&lt;xml&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>API密钥<br><a target="_blank" rel="noopener" href="https://qpay.qq.com/account/api_cert.shtml">https://qpay.qq.com/account/api_cert.shtml</a></p>
<!--
-->
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-12-23/82075208-file_1482463058867_b57.png"></p>
</li>
</ul>
<h2 id="2-调起支付"><a href="#2-调起支付" class="headerlink" title="2.调起支付"></a>2.调起支付</h2><ul>
<li><p>android<br><a target="_blank" rel="noopener" href="https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&docid=165">https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&amp;docid=165</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">（1）初始化PayApi，并将数据填写完整：</span><br><span class="line">PayApi api = new PayApi();</span><br><span class="line">api.appId = APP_ID; // 在http://open.qq.com注册的AppId,参与支付签名，签名关键字key为appId</span><br><span class="line">api.serialNumber = ...; // 支付序号,用于标识此次支付</span><br><span class="line">api.callbackScheme = ...; // QQ钱包支付结果回调给urlscheme为callbackScheme的activity.，参看后续的“支付回调结果处理”</span><br><span class="line">api.tokenId = ...; // QQ钱包支付生成的token_id</span><br><span class="line">api.pubAcc = ...; // 手Q公众帐号id.参与支付签名，签名关键字key为pubAcc</span><br><span class="line">api.pubAccHint = ...; // 支付完成页面，展示给用户的提示语：提醒关注公众帐号</span><br><span class="line">api.nonce = ...; // 随机字段串，每次支付时都要不一样.参与支付签名，签名关键字key为nonce</span><br><span class="line">api.timeStamp = ...; // 时间戳，为1970年1月1日00:00到请求发起时间的秒数</span><br><span class="line">api.bargainorId = ...; // 商户号.参与支付签名，签名关键字key为bargainorId</span><br><span class="line">api.sig = ...; // 商户Server下发的数字签名，生成的签名串，参看“数字签名”</span><br><span class="line">api.sigType = &quot;HMAC-SHA1&quot;; // 签名时，使用的加密方式，默认为&quot;HMAC-SHA1&quot;</span><br><span class="line"> </span><br><span class="line">（2）在启动QQ钱包支付前，判断一下数据是否完整，再启动QQ钱包支付：</span><br><span class="line">if (api.checkParams()) &#123;</span><br><span class="line">    openApi.execApi(api);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>cordova plugin：com.wosai.qpay</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">QPay.mqqPay(&#123;</span><br><span class="line">  tokenId: &#x27;1V39f4eaf286fe3718731871b4fe96dc&#x27;,// 订单号</span><br><span class="line">  nonce: &#x27;&#x27;,// 随机数</span><br><span class="line">  bargainorId: &#x27;1424912901&#x27;,// 商户号</span><br><span class="line">  appKey: &#x27;CuWbc7F0XrTpnHBa&#x27;,// appkey</span><br><span class="line">  sig: &#x27;&#x27;</span><br><span class="line">&#125;, function (res) &#123;</span><br><span class="line">  alert(&quot;res:&quot; + res)</span><br><span class="line">&#125;, function (res) &#123;</span><br><span class="line">  alert(&quot;error:&quot; + res)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>APP调用QQ钱包支付-签名规范<br><a target="_blank" rel="noopener" href="https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&docid=165">https://qpay.qq.com/qpaywiki/showdocument.php?pid=38&amp;docid=165</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">数字签名</span><br><span class="line"> </span><br><span class="line">为了保障商户利益与安全，商户App调用QQ钱包支付时启用另一套签名机制。该签名机制与“商户后台与QQ钱包支付后台的签名机制”是不同的。</span><br><span class="line"> </span><br><span class="line">1、源串构造方法</span><br><span class="line">（1）将需要参与签名的所有参数按key进行字典升序排列。</span><br><span class="line">（2）将第1步中排序后的参数(key=value)用&amp;拼接起来；</span><br><span class="line">（3）key中存在大小写字母，保持大小写字母的存在。不要将key进行统一转换为大写或小写操作；</span><br><span class="line">（4）如果value为空, 生成格式为“key=”，这点与后台之间签名方法是不一样的；</span><br><span class="line">（5）签名原始串中，字段名和字段值都采用原始值，不进行URL Encode。</span><br><span class="line"> </span><br><span class="line">举例：</span><br><span class="line">调用某个接口，接口有如下字段：</span><br><span class="line">appId、nonce、tokenId、pubAcc、bargainorId</span><br><span class="line"> </span><br><span class="line">实际调用接口时，各字段的值：</span><br><span class="line">appId=100619284、nonce=ksjfwierwfjk、tokenId=1000000002、pubAcc=、bargainorId=1900000109</span><br><span class="line"> </span><br><span class="line">正确的签名原始串是：</span><br><span class="line">appId=100619284&amp;bargainorId=1900000109&amp;nonce=ksjfwierwfjk&amp;pubAcc=&amp;tokenId=1000000002</span><br><span class="line"> </span><br><span class="line">常见的错误有：</span><br><span class="line">appId=100619284&amp;bargainorId=1900000109&amp;nonce=ksjfwierwfjk&amp;tokenId=1000000002</span><br><span class="line">appid=100619284&amp;bargainorid=1900000109&amp;nonce=ksjfwierwfjk&amp;pubacc=&amp;tokenid=1000000002</span><br><span class="line">appId=100619284&amp;nonce=ksjfwierwfjk&amp;tokenId=1000000002&amp;pubAcc=&amp;bargainorId=1900000109</span><br><span class="line"> </span><br><span class="line">2、 密钥构造方法</span><br><span class="line">（1）在http://open.qq.com申请appId，并获得appKey；</span><br><span class="line">（2）构造到密钥的方式：在应用的appkey末尾加上一个字符的“&amp;”，即appkey&amp;。</span><br><span class="line"> </span><br><span class="line">示例：</span><br><span class="line">appkey 值为 d139ae6fb0175e5659dce2a7c1fe84d5</span><br><span class="line">正确的密钥为：d139ae6fb0175e5659dce2a7c1fe84d5&amp;</span><br><span class="line"> </span><br><span class="line">3、 生成签名值方法</span><br><span class="line">（1）使用HMAC-SHA1加密算法，使用”密钥构造方法“中得到的密钥对“源串构造方法”中得到的源串进行加密（注：一般程序语言中会内置HMAC-SHA1加密算法的函数，例如PHP5.1.2之后的版本可直接调用hash_hmac函数）；</span><br><span class="line">（2）然后将加密后的字符串进行Base64编码（注：一般程序语言中会内置Base64编码函数，例如PHP中可直接调用 base64_encode() 函数）；</span><br><span class="line">（3）最后得到的签名值sig结果如下：</span><br><span class="line">c6xXw0tNABhOMc869h1bfxTp9Mk=</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="2-1代码示例"><a href="#2-1代码示例" class="headerlink" title="2.1代码示例"></a>2.1代码示例</h1><ul>
<li>android<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 签名步骤建议不要在app上执行，要放在服务器上执行.</span><br><span class="line">*/</span><br><span class="line">public String signApi(PayApi api) throws Exception &#123;</span><br><span class="line">  // 按key排序</span><br><span class="line">  StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">  stringBuilder.append(&quot;appId=&quot;).append(api.appId);</span><br><span class="line">  stringBuilder.append(&quot;&amp;bargainorId=&quot;).append(api.bargainorId);</span><br><span class="line">  stringBuilder.append(&quot;&amp;nonce=&quot;).append(api.nonce);</span><br><span class="line">  stringBuilder.append(&quot;&amp;pubAcc=&quot;).append(&quot;&quot;);</span><br><span class="line">  stringBuilder.append(&quot;&amp;tokenId=&quot;).append(api.tokenId);</span><br><span class="line"> </span><br><span class="line">  String APP_KEY = &quot;d139ae6fb0175e5659dce2a7c1fe84d5&quot;;// 调试使用,应该服务器保护</span><br><span class="line">  byte[] byteKey = (APP_KEY + &quot;&amp;&quot;).getBytes(&quot;UTF-8&quot;);</span><br><span class="line">  // 根据给定的字节数组构造一个密钥,第二参数指定一个密钥算法的名称</span><br><span class="line">  SecretKey secretKey = new SecretKeySpec(byteKey, &quot;HmacSHA1&quot;);</span><br><span class="line">  // 生成一个指定 Mac 算法 的 Mac 对象</span><br><span class="line">  Mac mac = Mac.getInstance(&quot;HmacSHA1&quot;);</span><br><span class="line">  // 用给定密钥初始化 Mac 对象</span><br><span class="line">  mac.init(secretKey);</span><br><span class="line">  byte[] byteSrc = stringBuilder.toString().getBytes(&quot;UTF-8&quot;);</span><br><span class="line">  // 完成 Mac 操作</span><br><span class="line">  byte[] dst = mac.doFinal(byteSrc);</span><br><span class="line"> </span><br><span class="line">  // Base64</span><br><span class="line">  // api.sig = Base64.encodeToString(dst, Base64.NO_WRAP);</span><br><span class="line">  // api.sigType = &quot;HMAC-SHA1&quot;;</span><br><span class="line">  return Base64.encodeToString(dst, Base64.NO_WRAP);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>ios<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 生成签名串</span><br><span class="line">- (NSString *)getMySignatureWithAppId:(NSString *)appId</span><br><span class="line">                          bargainorId:(NSString *)bargainorId</span><br><span class="line">                                nonce:(NSString *)nonce</span><br><span class="line">                              tokenId:(NSString *)tokenId</span><br><span class="line">                           signingKey:(NSString *)signingKey&#123;</span><br><span class="line"> </span><br><span class="line">    // 1. 将 appId,bargainorId,nonce,tokenId 拼成字符串</span><br><span class="line">    NSString *source = [NSString stringWithFormat:@&quot;appId=%@&amp;bargainorId=%@&amp;nonce=%@&amp;pubAcc=&amp;tokenId=%@&quot;,</span><br><span class="line">                        appId,bargainorId,nonce,tokenId];</span><br><span class="line"> </span><br><span class="line">    // 2. 将刚才拼好的字符串，用key来加密</span><br><span class="line">    NSData *signature = [source dataUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    NSData *signingData = [[signingKey stringByAppendingString:@&quot;&amp;&quot;] dataUsingEncoding:NSUTF8StringEncoding];  // 约定在key末尾拼一个‘&amp;’符号</span><br><span class="line">    NSData *digest = [self hmacSha1:signature key:signingData];</span><br><span class="line"> </span><br><span class="line">    // 3. 将加密后的data以base64形式输出</span><br><span class="line">    NSString *signatureBase64 = [digest base64Encoding];</span><br><span class="line">    return signatureBase64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h1><h2 id="ios-build-error"><a href="#ios-build-error" class="headerlink" title="ios build error"></a>ios build error</h2><ul>
<li>错误<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Library not found for -lcrt1.3.1.o</span><br></pre></td></tr></table></figure></li>
<li>解决<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deployment target from ios5.0 then change it to ios6.0 or later</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="cordova-方法控制台需要在第二次调用时才会回调方法-可测试一下几个方法"><a href="#cordova-方法控制台需要在第二次调用时才会回调方法-可测试一下几个方法" class="headerlink" title="cordova 方法控制台需要在第二次调用时才会回调方法,可测试一下几个方法"></a>cordova 方法控制台需要在第二次调用时才会回调方法,可测试一下几个方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Wechat.isInstalled(function(res)&#123;console.log(&quot;res&quot;,res)&#125;,function(res)&#123;console.log(&quot;error&quot;,res)&#125;)</span><br><span class="line">YCQQ.checkClientInstalled(function(res)&#123;console.log(&quot;res&quot;,res)&#125;,function(res)&#123;console.log(&quot;error&quot;,res)&#125;)</span><br><span class="line"> </span><br><span class="line">QPay.getOrderno(function(res)&#123;console.log(&quot;res&quot;,res)&#125;,function(res)&#123;console.log(&quot;error&quot;,res)&#125;)</span><br><span class="line">QPay.mqqPay(&#123;tokenId:&#x27;1V39f4eaf286fe3718731871b4fe96dc&#x27;&#125; ,function(res)&#123;console.log(&quot;res&quot;,res)&#125;,function(res)&#123;console.log(&quot;error&quot;,res)&#125;);</span><br></pre></td></tr></table></figure>
<p>注:经测试,代码调用不会出现首次首次失效的情况</p>
<h2 id="xcode插件失效"><a href="#xcode插件失效" class="headerlink" title="xcode插件失效"></a>xcode插件失效</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2016-12-06 17:15:03.982 xcodebuild[9374:245800] [MT] PluginLoading: Required plug-in compatibility UUID 8A66E736-A720-4B3C-92F1-33D9962C69DF for plug-in at path &#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/Unity4XC.xcplugin&#x27; not present in DVTPlugInCompatibilityUUIDs</span><br><span class="line">Build settings from command line:</span><br><span class="line">    ARCHS = armv7 armv7s arm64</span><br><span class="line">    CONFIGURATION_BUILD_DIR = /Users/wosai/Desktop/work/hybrid Dev/sxb_physics/platforms/ios/build/device</span><br><span class="line">    SDKROOT = iphoneos10.0</span><br><span class="line">    SHARED_PRECOMPS_DIR = /Users/wosai/Desktop/work/hybrid Dev/sxb_physics/platforms/ios/build/sharedpch</span><br><span class="line">    VALID_ARCHS = armv7 armv7s arm64</span><br></pre></td></tr></table></figure>
<ul>
<li><p>处理办法1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://raw.githubusercontent.com/ForkPanda/RescueXcodePlug-ins/master/RescueXcode.sh | sh</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/35110910/xcode-7-pluginloading-required-plug-in-compatibility-uuid">http://stackoverflow.com/questions/35110910/xcode-7-pluginloading-required-plug-in-compatibility-uuid</a></p>
</li>
<li><p>处理办法2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/20732327/xcode-5-required-plug-in-not-present-in-dvtplugincompatibilityuuids">http://stackoverflow.com/questions/20732327/xcode-5-required-plug-in-not-present-in-dvtplugincompatibilityuuids</a></p>
</li>
<li><p>处理办法3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ~/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins -name Info.plist -maxdepth 3 | xargs -I&#123;&#125; defaults write &#123;&#125; DVTPlugInCompatibilityUUIDs -array-add `defaults read /Applications/Xcode.app/Contents/Info.plist DVTPlugInCompatibilityUUID`</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://joeshang.github.io/2015/04/10/fix-xcode-upgrade-plugin-invalid/">http://joeshang.github.io/2015/04/10/fix-xcode-upgrade-plugin-invalid/</a></p>
</li>
</ul>
<h2 id="SDK-‘iOS-10-0’问题"><a href="#SDK-‘iOS-10-0’问题" class="headerlink" title="SDK ‘iOS 10.0’问题"></a>SDK ‘iOS 10.0’问题</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Check dependencies</span><br><span class="line">Signing for &quot;赛学霸物理&quot; requires a development team. Select a development team in the project editor.</span><br><span class="line">Code signing is required for product type &#x27;Application&#x27; in SDK &#x27;iOS 10.0&#x27;</span><br><span class="line"> </span><br><span class="line">** BUILD FAILED **</span><br></pre></td></tr></table></figure>
<ul>
<li>解决办法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打开xcode,General中勾选:Automatically manage signing</span><br></pre></td></tr></table></figure>
<a target="_blank" rel="noopener" href="http://blog.csdn.net/h643342713/article/details/52728782">http://blog.csdn.net/h643342713/article/details/52728782</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/21/Read-tencent-biography/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/21/Read-tencent-biography/" class="post-title-link" itemprop="url">读《腾讯传》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-21 21:18:41" itemprop="dateCreated datePublished" datetime="2016-12-21T21:18:41+08:00">2016-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Life-Talk/" itemprop="url" rel="index"><span itemprop="name">Life-Talk</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote  class="blockquote-center">
**种一棵树最好的时机是十年前，其次，就是现在。**
</blockquote>

<p><strong>作者简介：</strong>吴晓波：著名财经作家，“吴晓波频道”、蓝狮子出版创始人，常年从事中国企业史和公司案例研究。著有《大败局》I和II、《激荡三十年》《跌荡一百年》《浩荡两千年》《历代经济变革得失》等广具影响力的财经书籍，著作两次入选《亚洲周刊》年度最佳图书。</p>
<p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/qq_reading_welfare.jpg"></p>
<ul>
<li>在马化腾14岁生日的时候，他向家里索要一台专业级、80mm口径的天文望远镜，那要花他父亲将近4个月的工资。虽然父母刚开始不同意，最终还是满足了他的愿望。为了培养儿子的科学兴趣，马家在马化腾很小的时候就订阅了《我们爱科学》等科普杂志。</li>
</ul>
<blockquote>
<p><strong>我</strong>：突然觉得任何事情好像在冥冥之中自有天定，试想在那个年代，能掏出那么多钱为孩子买玩具的家庭能有多少？又能有多少父母在那个年代就开始为孩子订阅科学杂志的？在86年马化腾就亲自观测了哈雷彗星，而我直到九几年也不知道哈雷彗星的存在，所以每个人能做多大的事，有一部分在你出生的时候就决定了，这部分人在当今的天朝占有很大的比例。另外剩下的一部分不是占了天时，就是占了地利，单单想靠自己的努力工作，循规蹈矩的去获得财富，在如今的中国是办不到的。你能看到的成功人士并没有向你展示他获得成功的全部因素，一部分是家庭因素，一部分是上一代人的先天优势，当然也有一部分灰色的产业。所以即便是你知道成功者的套路，你也很难成功，因为你不具备他成功的条件。<br>在小马如此年纪，家人就细心栽培，即便不创办腾讯，小马也能干出其它大事来。记得知乎上有个匿名回答，获得诸多好评，他说“孩子在真正接触社会之前，是站在父母的肩膀上看这个世界的，父母能够站多高，很大程度上决定了孩子的眼界、知识面。富贵人家的孩子，最宝贵的财富就在于，他们的父母比你的父母知道的更多，能够在人生的关键时刻给他们更多的指导，让他们少走弯路甚至走捷径，而穷人家的孩子，没有这些指导，只能自己慢慢扑腾，慢慢摸索，也许碰的头破血流之后成了，也许头破血流之后死了。”<br>国外也有诸多实验，论及父母的经济条件对孩子的影响，在BBC《人生七年》这部纪录片里，上流社会的John和Andrew，他们年仅7岁时，就已经明确知道自己会上顶级的私立高中，然后读牛津大学，再然后进入政坛，他们7岁时就已经养成了阅读《金融时报》、《观察家》的习惯。上流社会的孩子从小就具备精英意志，他们按照精英的方式生活和要求自己。49年之后，56岁的John成为了企业家并致力于慈善事业，Andrew成为了律所合伙人，他们的孩子继续接受着精英教育。而底层社会的孩子，从小就没什么梦想，长大后靠出卖劳动力为生，他们的儿女也重复着父辈的生活方式。</p>
</blockquote>
<ul>
<li>有两位出生于1973年的斯坦福校友上门找到杨致远，想要把自己的一个搜索技术以100万美元的价格卖给雅虎，杨致远优雅地拒绝了他们。9月7日，拉里·佩奇和谢尔盖·布林被迫在加州郊区的一个车库内孤独创业，他们把公司取名为Google。</li>
</ul>
<blockquote>
<p><strong>我</strong>：杨致远的这个失误，成为了他一生的梗，这个梗充分的证明了，即使你运气好，先行一步，但是远见却更加重要，看看如今的Google和雅虎，从当年的最受追捧和籍籍无名，到如今的角色互换，不得不说这是一个多么惨痛的教训。</p>
</blockquote>
<ul>
<li>在腾讯的历史上，乃至中国互联网史上，QQ秀都堪称一款革命性的收费产品，它可以被视为互联网产业的一次“东方式应用创新”。腾讯不是这一创新的发起者，可是它却凭借这一创新获得真正商业上的成功。</li>
</ul>
<blockquote>
<p><strong>我</strong>：可以说真正彻底解决了腾讯盈利能力的业务就是QQ秀，这比腾讯之前推出的任何一项收费服务所带来的利润都要高得多。这款从韩国sayclub借鉴而来的产品，不仅在异国他乡获得流行，更是彻底改变了中国互联网的格局。腾讯从一家互联网二线梯队中的公司，逐渐成长为中国互联网行业中的佼佼者。尽管后来有诸多大佬在IM领域对QQ发起围剿，但都以失败告终，其最终极的原因在于“当人们在一个世界——无论是现实的还是虚拟的——里完成了自我身份的认定后，迁徙将是一个非常困难的任务”。（注：移动梦网业务也带来大量利润，但该业务是由中国移动主导，不能归属于腾讯）</p>
</blockquote>
<ul>
<li>马化腾把腾讯的渐进式创新解释为“小步快跑，试错迭代”。在他看来，也许每一次产品的更新都不是完美的，但是如果坚持每天发现、修正一两个小问题，不到一年基本就把作品打磨出来了，自己也就很有产品的感觉了。</li>
</ul>
<blockquote>
<p><strong>我</strong>：读到这里一股熟悉的味道扑面而来，这不就是《精益创业》里面谈到的吗？原来小马哥早已把理论应用于实战了。</p>
</blockquote>
<ul>
<li>对于中国移动不断绞杀移动梦网的合作伙伴，就像：“一个地主圈了一块特别肥沃的地，一开始招募了一群佃农，自带耕牛和农具来开发。土地被耕耘出来了，地主不乐意再跟别人分享果实，就想办法把佃农们通通赶走，自己添置了大量的耕牛和农具，自得其利。后来发生的变化是，突然出现了拖拉机。那些被赶走的佃农们用新的机器和工具开出了更多的地，结出了更多的果实。</li>
</ul>
<blockquote>
<p><strong>我</strong>：我不能再表达更深一步的赞同了。对于中国这些可恶的国企和垄断公司，只会民脂民膏，在创新及为社会创造价值方面毫无建树，就日常生活而言，只有去国有银行要等几个小时，只有去国有电信营业厅要等几个小时，只有去国有医院要等几个小时，这种例子不胜枚举，如今中国的各种问题都能从这些懒惰的国企身上找到影子。</p>
</blockquote>
<ul>
<li>在北京腾讯会所，凯文·凯利对马化腾说，“失控”不是指混乱无序、低效率甚至自我毁灭的状态，蚂蚁群、蜜蜂群这样由巨量个体构成的组织体，能够呈现出高度的秩序和效率，不是因为蚁王、蜂王的控制，而是得自于一种自下而上的大规模协作，以及在协作中“涌现”的众愚成智、大智若愚的“集群智能”。</li>
</ul>
<blockquote>
<p><strong>我</strong>：感觉这个正是腾讯目前在践行的信条，例如微信在成立之初从没有一个人从上到下的去推动它，甚至计划它，在腾讯内部有两个微信项目在并行存在，都是自下而上的自发组织开发，只不过张小龙的微信早了一步，笑到了最后。我非常欣赏这种组织的公司，因为它能创造无限可能。而任何其它的公司只要是从上到下去运作的，可能也会有一些成功的项目，但是绝对不会创造出有无限愿景的产品。</p>
</blockquote>
<ul>
<li>在对话的最后，马化腾问凯文·凯利:“在您看来，谁将会成为腾讯未来的敌人？”“哎，这是一个至少价值1亿美元的问题。”KK笑了起来，他的回答仍然是经典的“失控式”的，“在互联网世界，即将消灭你的那个人，从来不会出现在一份既定的名单中”。</li>
</ul>
<blockquote>
<p><strong>我</strong>：虽然不希望腾讯倒闭，但是我真的很期待这么一个公司的出现，那将是一个绝对更加精彩的崭新的互联网世界。</p>
</blockquote>
<ul>
<li>在一次交流中，马化腾很感慨地讲过一段话，他说：“不管已经出现了多少大公司，人类依然处在互联网时代的黎明时分，微微的晨光还照不亮太远的路。互联网真是个神奇的东西，在它的推动下，整个人类社会都变成了一个妙趣无穷的实验室。我们这一代人，每个人都是这个伟大实验的设计师和参与者，这个实验值得我们屏气凝神，心怀敬畏，全情投入。”</li>
</ul>
<blockquote>
<p><strong>我</strong>：这也是我自始至终坚定地选择互联网公司的原因，从第一份工作开始，就决定只去互联网公司。虽然我默默无闻，籍籍无名，但是就像一头捕猎的猎豹一样，潜伏在草丛中，时刻警惕着，一旦时机成熟，纵身一跃……</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/21/Vue.js%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/21/Vue.js%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">Vue.js相关</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-21 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-21T00:00:00+08:00">2016-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><ul>
<li>前端 MVVM(Model-View-ViewModel)库</li>
<li>部分功能和Jquery是差不多的，Vuejs能做的，Jquery也能做</li>
<li>Jquery多简单啊，令人发指的是Vuejs在实现相同功能的时候更简单<br><a target="_blank" rel="noopener" href="http://larabase.com/collection/2/post/108">http://larabase.com/collection/2/post/108</a></li>
</ul>
<h1 id="脚手架"><a href="#脚手架" class="headerlink" title="脚手架"></a>脚手架</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/fountainjs/generator-fountain-vue#readme"> FountainJS&#x2F;generator-fountain-vue</a> <code>star 24</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/davidhellmann/generator-dhBoilerplate#readme"> davidhellmann&#x2F;generator-dhBoilerplate</a>     <code>star 18</code> </li>
<li><a target="_blank" rel="noopener" href="http://www.yowebapp.com/generators/">更多</a></li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><ul>
<li><p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script src=&quot;./lib/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">  &#123;&#123; message &#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">  new Vue(&#123;</span><br><span class="line">    el: &#x27;#app&#x27;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: &#x27;Hello Vue!&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

</li>
<li><p>API<br><a target="_blank" rel="noopener" href="http://devdocs.io/vue~2/">http://devdocs.io/vue~2/</a></p>
</li>
</ul>
<h1 id="组件库"><a href="#组件库" class="headerlink" title="组件库"></a>组件库</h1><p><a target="_blank" rel="noopener" href="http://element.eleme.io/#/zh-CN">Element</a><br>Element，一套为开发者、设计师和产品经理准备的基于 Vue 2.0 的组件库，提供了配套设计资源，帮助你的网站快速成型。</p>
<p><code>表格</code> <a target="_blank" rel="noopener" href="http://element.eleme.io/#/zh-CN/component/table">http://element.eleme.io/#/zh-CN/component/table</a><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/80850400-file_1484818139040_1757d.png">  </p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><ul>
<li><p><a target="_blank" rel="noopener" href="http://git.oschina.net/babaio/renren-security"><code>renren-security</code>是一个轻量级权限管理系统</a><br><img src="http://git.oschina.net/uploads/images/2016/1223/111503_3df60329_63154.png"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/vue-bulma/vue-admin">vue-bulma&#x2F;vue-admin</a>  <code>star 2,188</code><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/55408542-file_1484818151580_8c3c.png">  </p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/taylorchen709/vueAdmin">taylorchen709&#x2F;vueAdmin</a>  <code>star 184</code></p>
</li>
</ul>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/40671054-file_1484818165497_12ade.png"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/misterGF/CoPilot">misterGF&#x2F;CoPilot</a>   <code>star 470</code><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/11652390-file_1484818178174_26d1.png"></li>
</ul>
<h1 id="浏览器devtools工具"><a href="#浏览器devtools工具" class="headerlink" title="浏览器devtools工具"></a>浏览器devtools工具</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-devtools">vue-devtools</a><br><img src="https://raw.githubusercontent.com/vuejs/vue-devtools/master/media/screenshot.png"></li>
</ul>
<h1 id="design-设计"><a href="#design-设计" class="headerlink" title="design(设计)"></a>design(设计)</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/marcosmoura/vue-material">vue-material</a><br>Material design for Vue.js <a target="_blank" rel="noopener" href="https://vuematerial.github.io/">https://vuematerial.github.io</a><br><img src="https://vuematerial.github.io/assets/vue-material-example.png"></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/20/React%20native%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/20/React%20native%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">React native相关</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-20 00:00:02" itemprop="dateCreated datePublished" datetime="2016-12-20T00:00:02+08:00">2016-12-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="React-Native简介"><a href="#React-Native简介" class="headerlink" title="React Native简介"></a>React Native简介</h1><p>React Native使你能够在Javascript和React的基础上获得完全一致的开发体验，构建世界一流的原生APP。</p>
<p>支持系统：Android 4.1 (API 16) 以及 &gt;&#x3D; iOS 7.0</p>
<p><code>github</code>  <a target="_blank" rel="noopener" href="https://facebook.github.io/react-native/docs/getting-started.html">https://facebook.github.io/react-native/docs/getting-started.html</a></p>
<p><code>React Native 中文网</code><br><a target="_blank" rel="noopener" href="http://reactnative.cn/">http://reactnative.cn/</a></p>
<p><code>从零开始的Android新项目10 - React Native &amp; Redux - 马克宅只是个码农 - 博客频道 - CSDN.NET</code><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/marktheone/article/details/52238413">http://blog.csdn.net/marktheone/article/details/52238413</a></p>
<hr>
<h2 id="github-React-Native-资料"><a href="#github-React-Native-资料" class="headerlink" title="github React Native 资料"></a><code>github</code> React Native 资料</h2><p><code>React-Native学习指南</code> <code>star 7074</code></p>
<p><a target="_blank" rel="noopener" href="https://github.com/reactnativecn/react-native-guide">https://github.com/reactnativecn/react-native-guide</a></p>
<p><code>教程和处理React Native的资源的列表</code>   <code>star 9094</code><br><a target="_blank" rel="noopener" href="https://github.com/jondot/awesome-react-native">https://github.com/jondot/awesome-react-native</a></p>
<p><code>React资料整理，基于个人书签收集导出</code><br><a target="_blank" rel="noopener" href="https://github.com/OXOYO/F2E-Tutorial-Collect/blob/master/React.md">https://github.com/OXOYO/F2E-Tutorial-Collect/blob/master/React.md</a><br><code>React-Native入门指南</code><br><a target="_blank" rel="noopener" href="https://github.com/vczero/react-native-lesson">https://github.com/vczero/react-native-lesson</a></p>
<hr>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><ul>
<li>IDE</li>
</ul>
<p><code>atom</code>  <a target="_blank" rel="noopener" href="https://atom.io/">https://atom.io/</a></p>
<p><code>WebStorm</code><br><code>Sublime</code></p>
<ul>
<li>代码提示</li>
</ul>
<p><code>React Native研发代码编辑工具之WebStorm配置</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/fQ3IriM">http://www.tuicool.com/articles/fQ3IriM</a></p>
<p><code>ReactNative-LiveTemplate</code><br><a target="_blank" rel="noopener" href="https://github.com/virtoolswebplayer/ReactNative-LiveTemplate">https://github.com/virtoolswebplayer/ReactNative-LiveTemplate</a></p>
<hr>
<h1 id="几类移动应用开发方式区别"><a href="#几类移动应用开发方式区别" class="headerlink" title="几类移动应用开发方式区别"></a>几类移动应用开发方式区别</h1><p>类型 | 技术 | 特点 | 性能 | 技术手段<br>-|-|-|<br>web | weiui等(响应式mobile库) | 运行环境限制在手机浏览器中（含微信） | 一般 | 纯前端<br>hybrid app | ionic （angular+cordova）| 同时支持手机浏览器和独立APP | 还行 | UI用前端,本地设备用cordova plugin<br>native app | React native（RN），ionic2 | 仅支持独立APP | 优秀 | ui和设备全用前端语言映射，不完成支持前端特性（html，css）<br>native | android、ios | 仅支持独立APP | 极限方案 | 多平台独立编写</p>
<hr>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><ul>
<li>搭建开发环境 &amp; 安装<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">react-native init AwesomeProject</span><br><span class="line">cd AwesomeProject</span><br><span class="line">react-native run-android</span><br></pre></td></tr></table></figure></li>
<li>仅启动服务(调试)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native start</span><br></pre></td></tr></table></figure>
<a target="_blank" rel="noopener" href="http://reactnative.cn/docs/0.39/getting-started.html">http://reactnative.cn/docs/0.39/getting-started.html</a></li>
</ul>
<h2 id="编写Hello-World-注：没有DIV"><a href="#编写Hello-World-注：没有DIV" class="headerlink" title="编写Hello World (注：没有DIV)"></a>编写Hello World (注：没有DIV)</h2><p><code>index.ios.js</code>或是<code>index.android.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123; AppRegistry, Text &#125; from &#x27;react-native&#x27;;</span><br><span class="line"> </span><br><span class="line">class HelloWorldApp extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;Text&gt;Hello world!&lt;/Text&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// 注意，这里用引号括起来的&#x27;HelloWorldApp&#x27;必须和你init创建的项目名一致</span><br><span class="line">AppRegistry.registerComponent(&#x27;HelloWorldApp&#x27;, () =&gt; HelloWorldApp);</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="详解-index-android-js"><a href="#详解-index-android-js" class="headerlink" title="详解 index.android.js"></a>详解 <code>index.android.js</code></h1><ul>
<li>引入依赖<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123;</span><br><span class="line">    AppRegistry,</span><br><span class="line">    StyleSheet,</span><br><span class="line">    Text,</span><br><span class="line">    View</span><br><span class="line">&#125; from &#x27;react-native&#x27;;</span><br></pre></td></tr></table></figure></li>
<li>注册组件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AppRegistry.registerComponent(&#x27;AwesomeProject&#x27;, () =&gt; AwesomeProject);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>类定义<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">export default class AwesomeProject extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">                &lt;Text style=&#123;styles.hello&#125;&gt;</span><br><span class="line">                    hello world</span><br><span class="line">                &lt;/Text&gt;</span><br><span class="line">                &lt;Text style=&#123;styles.welcome&#125;&gt;</span><br><span class="line">                    Welcome to React Native!</span><br><span class="line">                &lt;/Text&gt;</span><br><span class="line">                &lt;Text style=&#123;styles.instructions&#125;&gt;</span><br><span class="line">                    To get started, edit index.android.js</span><br><span class="line">                &lt;/Text&gt;</span><br><span class="line">                &lt;Text style=&#123;styles.instructions&#125;&gt;</span><br><span class="line">                    Double tap R on your keyboard to reload,&#123;&#x27;\n&#x27;&#125;</span><br><span class="line">                    Shake or press menu button for dev menu</span><br><span class="line">                &lt;/Text&gt;</span><br><span class="line">            &lt;/View&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export default class AwesomeProject extends Component</span><br><span class="line"></span><br><span class="line">export的带default关键字的组件，即默认组件,将其命名为 AwesomeProject (可以自定义命名)</span><br></pre></td></tr></table></figure></li>
<li>样式(命名方式的变化如<code> fontSize</code> )<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">    container: &#123;</span><br><span class="line">        flex: 1,</span><br><span class="line">        justifyContent: &#x27;center&#x27;,</span><br><span class="line">        alignItems: &#x27;center&#x27;,</span><br><span class="line">        backgroundColor: &#x27;#F5FCFF&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    hello:&#123;</span><br><span class="line">        color:&#x27;red&#x27;,</span><br><span class="line">        fontSize: 20,</span><br><span class="line">        textAlign: &#x27;center&#x27;,</span><br><span class="line">        margin: 10,</span><br><span class="line">    &#125;,</span><br><span class="line">    welcome: &#123;</span><br><span class="line">        fontSize: 20,</span><br><span class="line">        textAlign: &#x27;center&#x27;,</span><br><span class="line">        margin: 10,</span><br><span class="line">    &#125;,</span><br><span class="line">    instructions: &#123;</span><br><span class="line">        textAlign: &#x27;center&#x27;,</span><br><span class="line">        color: &#x27;#333333&#x27;,</span><br><span class="line">        marginBottom: 5,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="初始页模块化"><a href="#初始页模块化" class="headerlink" title="初始页模块化"></a>初始页模块化</h1><ul>
<li><code>index.android.js</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123;AppRegistry&#125; from &#x27;react-native&#x27;;</span><br><span class="line">import setup from &#x27;./src/setup&#x27;;</span><br><span class="line"> </span><br><span class="line">// AppRegistry.registerComponent(&#x27;AwesomeProject&#x27;, setup);// function (问题:Hot不同步)</span><br><span class="line">AppRegistry.registerComponent(&#x27;AwesomeProject&#x27;, () =&gt; setup);// module</span><br></pre></td></tr></table></figure></li>
<li><code>/src/setup.js</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"> </span><br><span class="line">import React, &#123;Component&#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123;StyleSheet, Text, View, Navigator&#125; from &#x27;react-native&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export default class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">           ...</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<p><code>RN----导入组件，import from &#39;xxxx&#39;的用法详解</code><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/chevins/article/details/51523770">http://blog.csdn.net/chevins/article/details/51523770</a></p>
<hr>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><ul>
<li><p>依赖sdk<code>23.0.1 </code>,安装即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Starting JS server...                                                                    </span><br><span class="line">Building and installing the app on the device (cd android &amp;&amp; gradlew.bat installDebug)...</span><br><span class="line"> </span><br><span class="line">FAILURE: Build failed with an exception.                                                 </span><br><span class="line"> </span><br><span class="line">* What went wrong:                                                                       </span><br><span class="line">A problem occurred configuring project &#x27;:app&#x27;.                                           </span><br><span class="line">&gt; failed to find Build Tools revision 23.0.1   </span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/33155087/react-native-on-android-failed-to-find-build-tools">http://stackoverflow.com/questions/33155087/react-native-on-android-failed-to-find-build-tools</a></p>
</li>
<li><p>react-native Fetching JS Bundle<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/66720886-file_1484816673101_12b00.png"></p>
</li>
</ul>
<p>处理办法：删除node_modules,重新<code>npm install</code> (建议使用国内镜像)</p>
<ul>
<li>启动后，无法正常打开，是因为<code>调试工具</code>依赖<code>悬浮窗</code>权限，需要手动赋予。<br><code>react-native在Anroid真机运行时可能会遇到白屏的情况解决办法</code><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/itpinpai/article/details/50845625">http://blog.csdn.net/itpinpai/article/details/50845625</a></li>
</ul>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/80604699-file_1484818079208_893f.png"><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/65728024-file_1484818103275_f82a.png"></p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/50668486-file_1484818111205_13b48.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/20/React%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/20/React%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">React相关</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-20 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-20T00:00:00+08:00">2016-12-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="React简介"><a href="#React简介" class="headerlink" title="React简介"></a>React简介</h1><ul>
<li>不是一个 MVC 框架,仅仅是 UI</li>
<li>虚拟 DOM</li>
<li>单向响应的数据流</li>
<li>使用JSX语法</li>
</ul>
<p><code>github</code> <a target="_blank" rel="noopener" href="https://github.com/facebook/react">https://github.com/facebook/react</a></p>
<h2 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h2><p>JSX (Javascript XML syntax transform) 是使用XML语法编写Javascript的一套解析工具；<br>X代表XML；也可以理解为扩展(eXtension)，因为实现JSX功能本身就是使用Javascript；</p>
<p><code>React入门：关于JSX语法 – WEB前端开发</code><br><a target="_blank" rel="noopener" href="http://www.css88.com/archives/5632?utm_source=tuicool&utm_medium=referral">http://www.css88.com/archives/5632?utm_source=tuicool&amp;utm_medium=referral</a></p>
<ul>
<li>新的替代<code>babel</code><br>JSX是什么JSX其实是JavaScript的扩展，React为了代码的可读性更方便地创建虚拟DOM等原因，加入了一些类似XML的语法的扩展。<br>第二代编译器——babel<br>React官方博客发布了一篇文章，声明其自身用于JSX语法解析的编译器JSTransform已经过期，不再维护，React JS和React Native已经全部采用第三方Babel的JSX编译器实现。原因是两者在功能上已经完全重复，而Babel作为专门的JavaScript语法编译工具，提供了更为强大的功能。而browser.js是babel编译器的浏览器版本。<br><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000003877594?_ea=505400">https://segmentfault.com/q/1010000003877594?_ea=505400</a></li>
</ul>
<hr>
<h1 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h1><p><code>React 教程 | 菜鸟教程</code><br><a target="_blank" rel="noopener" href="http://www.runoob.com/react/react-tutorial.html">http://www.runoob.com/react/react-tutorial.html</a></p>
<p><code>[课程]React入门</code> -视频课<br><a target="_blank" rel="noopener" href="http://www.imooc.com/learn/504">http://www.imooc.com/learn/504</a></p>
<p><code>React 入门实例 - 阮一峰</code><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/03/react.html">http://www.ruanyifeng.com/blog/2015/03/react.html</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ruanyf/react-demos">https://github.com/ruanyf/react-demos</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/20/react%20Webpack%20ES6%E7%BB%84%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/20/react%20Webpack%20ES6%E7%BB%84%E5%90%88/" class="post-title-link" itemprop="url">react Webpack ES6组合</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-20 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-20T00:00:00+08:00">2016-12-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h1><p><code>介紹 | Webpack 中文指南</code><br><a target="_blank" rel="noopener" href="http://webpackdoc.com/">http://webpackdoc.com/</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Webpack 是当下最热门的前端资源模块化管理和打包工具。它可以将许多松散的模块按照依赖和规则打包成符合生产环境部署的前端资源。还可以将按需加载的模块进行代码分隔，等到实际需要的时候再异步加载。通过 loader 的转换，任何形式的资源都可以视作模块，比如 CommonJs 模块、 AMD 模块、 ES6 模块、CSS、图片、 JSON、Coffeescript、 LESS 等。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p><code>使用示例</code> <a target="_blank" rel="noopener" href="http://webpackdoc.com/usage.html">http://webpackdoc.com/usage.html</a></p>
<ul>
<li><p>index.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.html --&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>entry.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.write(&#x27;It works.&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>编译 entry.js 并打包到 bundle.js：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ webpack entry.js bundle.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>用浏览器打开 index.html 将会看到 It works.</p>
</blockquote>
</li>
<li><p>接下来添加一个模块 module.js 并修改入口 entry.js</p>
</li>
<li><p>module.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#x27;It works from module.js.&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>entry.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.write(&#x27;It works.&#x27;)</span><br><span class="line">document.write(require(&#x27;./module.js&#x27;)) // 添加模块</span><br></pre></td></tr></table></figure>
<blockquote>
<p>重新打包 <code>webpack entry.js bundle.js</code>后刷新页面看到变化 It works.It works from module.js.</p>
</blockquote>
</li>
</ul>
<hr>
<h2 id="webpack简单点来说就就是一个配置文件，所有的魔力都是在这一个文件中发生的。-这个配置文件主要分为三大块"><a href="#webpack简单点来说就就是一个配置文件，所有的魔力都是在这一个文件中发生的。-这个配置文件主要分为三大块" class="headerlink" title="webpack简单点来说就就是一个配置文件，所有的魔力都是在这一个文件中发生的。 这个配置文件主要分为三大块"></a>webpack简单点来说就就是一个配置文件，所有的魔力都是在这一个文件中发生的。 这个配置文件主要分为三大块</h2><ul>
<li>entry 入口文件 让webpack用哪个文件作为项目的入口</li>
<li>output 出口 让webpack把处理完成的文件放在哪里</li>
<li>module 模块 要用什么不同的模块来处理各种类型的文件</li>
</ul>
<p><code>Webpack傻瓜式指南（一） - 前端外刊评论 - 知乎专栏</code><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/20367175?columnSlug=FrontendMagazine">https://zhuanlan.zhihu.com/p/20367175?columnSlug=FrontendMagazine</a></p>
<p><code>Webpack傻瓜指南（二）开发和部署技巧 - 前端外刊评论 - 知乎专栏</code><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/20397902">https://zhuanlan.zhihu.com/p/20397902</a></p>
<hr>
<p><code>React+Webpack快速上手指南 - 简书</code><br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/418e48e0cef1">http://www.jianshu.com/p/418e48e0cef1</a></p>
<p><code>Webpack 入门指迷 - 题叶, JiyinYiyong - SegmentFault</code><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002551952">https://segmentfault.com/a/1190000002551952</a></p>
<p><code>轻松入门React和Webpack - 说学逗唱 - SegmentFault</code><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002767365">https://segmentfault.com/a/1190000002767365</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">执行打包</span><br><span class="line">如果通过npm install -g webpack方式安装webpack的话，可以通过命令行直接执行打包命令，比如这样：</span><br><span class="line"> </span><br><span class="line">$webpack --config webpack.config.js</span><br><span class="line">这样就会读取当前目录下的webpack.config.js作为配置文件执行打包操作</span><br><span class="line"> </span><br><span class="line">如果是通过gulp插件gulp-webpack，则可以在gulpfile中写上gulp任务：</span><br><span class="line"> </span><br><span class="line">var gulp = require(&#x27;gulp&#x27;);</span><br><span class="line">var webpack = require(&#x27;gulp-webpack&#x27;);</span><br><span class="line">var webpackConfig = require(&#x27;./webpack.config&#x27;);</span><br><span class="line">gulp.task(&quot;webpack&quot;, function() &#123;</span><br><span class="line">    return gulp</span><br><span class="line">        .src(&#x27;./&#x27;)</span><br><span class="line">        .pipe(webpack(webpackConfig))</span><br><span class="line">        .pipe(gulp.dest(&#x27;./build&#x27;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="generator-react-webpack项目运行过程"><a href="#generator-react-webpack项目运行过程" class="headerlink" title="generator-react-webpack项目运行过程"></a><code>generator-react-webpack</code>项目运行过程</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>package.json</code> - <code>scripts</code> - <code>start</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node server.js --env=dev&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;karma start&quot;,</span><br><span class="line">    &quot;serve&quot;: &quot;node server.js --env=dev&quot;,</span><br><span class="line">    &quot;serve:dist&quot;: &quot;node server.js --env=dist&quot;,</span><br><span class="line">    &quot;dist&quot;: &quot;npm run copy &amp; webpack --env=dist&quot;,</span><br><span class="line">    &quot;copy&quot;: &quot;copyfiles -f ./src/index.html ./src/favicon.ico ./dist&quot;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></li>
<li><p><code>server.js --env=dev</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">require(&#x27;core-js/fn/object/assign&#x27;);</span><br><span class="line">const webpack = require(&#x27;webpack&#x27;);</span><br><span class="line">const WebpackDevServer = require(&#x27;webpack-dev-server&#x27;);</span><br><span class="line">const config = require(&#x27;./webpack.config&#x27;);</span><br><span class="line">const open = require(&#x27;open&#x27;);</span><br><span class="line"> </span><br><span class="line">const compiler = webpack(config); // 实例化webpack</span><br><span class="line">new WebpackDevServer(compiler, config.devServer) // 启动服务</span><br></pre></td></tr></table></figure></li>
<li><p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const args = require(&#x27;minimist&#x27;)(process.argv.slice(2)); //  获取输入`dev`</span><br><span class="line">let config = require(path.join(__dirname, &#x27;cfg/&#x27; + validEnv));// 获取cfg模块 `cfg/dev`</span><br><span class="line"> </span><br><span class="line">module.exports = buildConfig(env);// 导出配置</span><br></pre></td></tr></table></figure></li>
<li><p><code>cfg/dev.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">let baseConfig = require(&#x27;./base&#x27;);</span><br><span class="line">let defaultSettings = require(&#x27;./defaults&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 配置初始化(继承`baseConfig`)</span><br><span class="line">let config = Object.assign(&#123;&#125;, baseConfig, &#123;</span><br><span class="line">  entry: [  // 项目 入口</span><br><span class="line">    &#x27;webpack-dev-server/client?http://127.0.0.1:&#x27; + defaultSettings.port,</span><br><span class="line">    &#x27;webpack/hot/only-dev-server&#x27;,</span><br><span class="line">    &#x27;./src/index&#x27;</span><br><span class="line">  ],</span><br><span class="line">  cache: true,</span><br><span class="line">  devtool: &#x27;eval-source-map&#x27;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    new webpack.NoErrorsPlugin(),</span><br><span class="line">    new BowerWebpackPlugin(&#123;</span><br><span class="line">      searchResolveModulesDirectories: false</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  module: defaultSettings.getDefaultModules() // 项目module 模块</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Add needed loaders to the defaults here</span><br><span class="line">config.module.loaders.push(&#123;</span><br><span class="line">  test: /\.(js|jsx)$/,</span><br><span class="line">  loader: &#x27;react-hot!babel-loader&#x27;, // hot热加载 &amp;  Babel能够将ES6代码转换成ES5</span><br><span class="line">  include: [].concat(</span><br><span class="line">    config.additionalPaths,</span><br><span class="line">    [ path.join(__dirname, &#x27;/../src&#x27;) ]</span><br><span class="line">  )</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = config; // 导出配置</span><br></pre></td></tr></table></figure>

</li>
<li><p><code>cfg/ defaults.js </code>  项目module 模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  srcPath: srcPath,</span><br><span class="line">  publicPath: &#x27;/assets/&#x27;,</span><br><span class="line">  port: dfltPort,</span><br><span class="line">  getDefaultModules: getDefaultModules // function</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>cfg/base.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  additionalPaths: additionalPaths,</span><br><span class="line">  port: defaultSettings.port,</span><br><span class="line">  debug: true, // 是否启用debug</span><br><span class="line">  devtool: &#x27;eval&#x27;,</span><br><span class="line">  output: &#123; // 项目出口</span><br><span class="line">    path: path.join(__dirname, &#x27;/../dist/assets&#x27;),</span><br><span class="line">    filename: &#x27;app.js&#x27;,</span><br><span class="line">    publicPath: defaultSettings.publicPath</span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: &#x27;./src/&#x27;,</span><br><span class="line">    historyApiFallback: true,</span><br><span class="line">    hot: true,// 是否支持热加载</span><br><span class="line">    port: defaultSettings.port,</span><br><span class="line">    publicPath: defaultSettings.publicPath,</span><br><span class="line">    noInfo: false</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [&#x27;&#x27;, &#x27;.js&#x27;, &#x27;.jsx&#x27;],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      actions: `$&#123;defaultSettings.srcPath&#125;/actions/`,</span><br><span class="line">      components: `$&#123;defaultSettings.srcPath&#125;/components/`,</span><br><span class="line">      sources: `$&#123;defaultSettings.srcPath&#125;/sources/`,</span><br><span class="line">      stores: `$&#123;defaultSettings.srcPath&#125;/stores/`,</span><br><span class="line">      styles: `$&#123;defaultSettings.srcPath&#125;/styles/`,</span><br><span class="line">      config: `$&#123;defaultSettings.srcPath&#125;/config/` + process.env.REACT_WEBPACK_ENV,</span><br><span class="line">      &#x27;react/lib/ReactMount&#x27;: &#x27;react-dom/lib/ReactMount&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="Gulp和webpack的区别"><a href="#Gulp和webpack的区别" class="headerlink" title="Gulp和webpack的区别"></a>Gulp和webpack的区别</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">背景： 最近收到很多童鞋的问题：gulp和webpack 什么关系，是一种东西吗？可以只用gulp，不用webpack吗 或者反过来？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">基于此问： 我简单归结了一下区别和概念，让需要的同学阅读理解，从而不把时间浪费到这种模糊不清的选择问题上！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">gulp是工具链、构建工具，可以配合各种插件做js压缩，css压缩，less编译 替代手工实现自动化工作</span><br><span class="line">1.构建工具</span><br><span class="line">2.自动化</span><br><span class="line">3.提高效率用</span><br><span class="line">webpack是文件打包工具，可以把项目的各种js文、css文件等打包合并成一个或多个文件，主要用于模块化方案，预编译模块的方案</span><br><span class="line">1.打包工具</span><br><span class="line">2.模块化识别</span><br><span class="line">3.编译模块代码方案用</span><br><span class="line">所以定义和用法上来说 都不是一种东西，无可比性 ，更不冲突！【当然，也有相似的功能，比如合并，区分，但各有各的优势】</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">基于此问： 来自知乎的一篇回答！够白话文了：</span><br><span class="line">怎么解释呢？因为 Gulp 和 browserify / webpack 不是一回事</span><br><span class="line">Gulp应该和Grunt比较，他们的区别我就不说了，说说用处吧。Gulp / Grunt 是一种工具，能够优化前端工作流程。比如自动刷新页面、combo、压缩css、js、编译less等等。简单来说，就是使用Gulp/Grunt，然后配置你需要的插件，就可以把以前需要手工做的事情让它帮你做了。</span><br><span class="line">说到 browserify / webpack ，那还要说到 seajs / requirejs 。这四个都是JS模块化的方案。其中seajs / require 是一种类型，browserify / webpack 是另一种类型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">seajs / require : 是一种在线&quot;编译&quot; 模块的方案，相当于在页面上加载一个 CMD/AMD 解释器。这样浏览器就认识了 define、exports、module 这些东西。也就实现了模块化。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">browserify / webpack : 是一个预编译模块的方案，相比于上面 ，这个方案更加智能。没用过browserify，这里以webpack为例。首先，它是预编译的，不需要在浏览器中加载解释器。另外，你在本地直接写JS，不管是 AMD / CMD / ES6 风格的模块化，它都能认识，并且编译成浏览器认识的JS。这样就知道，Gulp是一个工具，而webpack等等是模块化方案。Gulp也可以配置seajs、requirejs甚至webpack的插件。</span><br></pre></td></tr></table></figure>
<p><code>Gulp和webpack的区别，是一种工具吗？</code></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/xllily_11/article/details/51782005">http://blog.csdn.net/xllily_11/article/details/51782005</a></p>
<hr>
<h1 id="gulp-webpack-demo"><a href="#gulp-webpack-demo" class="headerlink" title="gulp-webpack-demo"></a>gulp-webpack-demo</h1><p><code>gulp+webpack构建配置 - mask_天俊 - 博客园</code><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/maskmtj/archive/2016/07/21/5597307.html">http://www.cnblogs.com/maskmtj/archive/2016/07/21/5597307.html</a><br>项目github地址： <a target="_blank" rel="noopener" href="https://github.com/jokermask/gulp_webpack_demo">https://github.com/jokermask/gulp_webpack_demo</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">基本的需求：</span><br><span class="line">css：要能编译sass，要压缩，要能自己补前缀</span><br><span class="line"></span><br><span class="line">js：要压缩，要丑化（就是把变量名换成简单的字母，即省空间又不容易被看懂），要合并</span><br><span class="line"></span><br><span class="line">img： 要压缩</span><br><span class="line"></span><br><span class="line">html：可以引入文件（就解决一开始说的问题，多页面下共同的组件）</span><br><span class="line"></span><br><span class="line">gulp中的watch功能可以监听文件，通过livereload和gulp的监听来实现保存后自动构建并刷新页面十分带感</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">感觉gulp这些功能都蛮不错，但我其实还有一些需求没说，是关于js的</span><br><span class="line">1.模块化（避免命名冲突）</span><br><span class="line">2.要用es6（跟上潮流嘛）</span><br><span class="line">3.js能不能按需加载？比如说我有页面A和页面B，他们都依赖一个base.js，然后又分别各自依赖a.js和b.js，这种情况我用刚才的gulpfile打包以后合并出来的一个公共的js是将三个js都包括了，但显然页面B不需要a.js，所以当用户单独访问页面B的时候加载的js就显得多余了，就多费了流量啊，速度也会慢。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">上述的前两个gulp还是能解决，但是第三个问题好像并不好解决。。。在查找各方资料后我决定用webpack，所以就是其他css，html的部分还是gulp来处理，但是把js交给webpack来处理</span><br></pre></td></tr></table></figure>


<hr>
<p><code>gulp + webpack 构建多页面前端项目</code></p>
<p><a target="_blank" rel="noopener" href="https://github.com/fwon/blog/issues/17">https://github.com/fwon/blog/issues/17</a><br>github: <a target="_blank" rel="noopener" href="https://github.com/fwon/gulp-webpack-demo">https://github.com/fwon/gulp-webpack-demo</a></p>
<hr>
<h1 id="ES6-——-gulp-Babel"><a href="#ES6-——-gulp-Babel" class="headerlink" title="ES6 —— gulp+Babel"></a>ES6 —— gulp+Babel</h1><ul>
<li><code>package.json</code>中的devDependencies<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;babel-preset-es2015&quot;: &quot;^6.5.0&quot;,</span><br><span class="line">    &quot;gulp-load-plugins&quot;: &quot;^1.1.0&quot;,</span><br><span class="line">    &quot;gulp-babel&quot;: &quot;^6.1.2&quot;,</span><br><span class="line">    &quot;gulp-plumber&quot;: &quot;^1.0.1&quot;,</span><br><span class="line">    &quot;gulp-rename&quot;: &quot;^1.2.2&quot;,</span><br><span class="line">    &quot;gulp&quot;: &quot;^3.9.1&quot;,</span><br><span class="line">    &quot;gulp-jshint&quot;: &quot;^2.0.0&quot;,</span><br><span class="line">    &quot;gulp-concat&quot;: &quot;^2.6.0&quot;,</span><br><span class="line">    &quot;gulp-uglify&quot;: &quot;^1.4.1&quot;,</span><br><span class="line">    &quot;gulp-util&quot;: &quot;^3.0.1&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li>gulpfile.js<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var gulp = require(&#x27;gulp&#x27;),</span><br><span class="line">  concat = require(&#x27;gulp-concat&#x27;),</span><br><span class="line">  rename = require(&#x27;gulp-rename&#x27;),</span><br><span class="line">  jshint = require(&#x27;gulp-jshint&#x27;),</span><br><span class="line">  uglify = require(&#x27;gulp-uglify&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Load plugins</span><br><span class="line">var $ = require(&#x27;gulp-load-plugins&#x27;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* es6 */</span><br><span class="line">gulp.task(&#x27;es6&#x27;, function() &#123;</span><br><span class="line">  </span><br><span class="line">  return gulp.src(&#x27;src/es6js/*.js&#x27;)</span><br><span class="line">    .pipe($.plumber())</span><br><span class="line">    .pipe($.babel(&#123;</span><br><span class="line">      presets: [&#x27;es2015&#x27;]</span><br><span class="line">    &#125;))</span><br><span class="line">    .pipe(gulp.dest(&#x27;dist/ztimages/&#x27;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
我们有了任务，但是怎么执行任务呢？ 在命令行工程目录下输入gulp es6 就可以执行这个任务了。但是我们不能每写一行代码就手动“执行”一下。这样也太麻烦了。我们可以配置一个监听任务。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//监听文件修改</span><br><span class="line">gulp.task(&#x27;watch&#x27;, [&#x27;es6&#x27;], function() &#123;</span><br><span class="line">  gulp.watch([&#x27;src/js/earth.js&#x27;], [&#x27;es6&#x27;]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在命令行工程目录下输入gulp watch就可以执行这个监听任务了。</p>
</blockquote>
</li>
</ul>
<p><code>ES6 初体验 —— gulp+Babel 搭建ES6环境</code><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/webARM/p/5305644.html">http://www.cnblogs.com/webARM/p/5305644.html</a></p>
<hr>
<h1 id="ES6-——-webpack-Babel"><a href="#ES6-——-webpack-Babel" class="headerlink" title="ES6 —— webpack+Babel"></a>ES6 —— webpack+Babel</h1><p><code>webpack配置文件ES6写法？ - xxxxxxxxx的回答 - SegmentFault</code></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000004241222/a-1020000004241336">https://segmentfault.com/q/1010000004241222/a-1020000004241336</a></p>
<p><code>使用webpack 进行ES6开发 - OPEN 开发经验库</code><br><a target="_blank" rel="noopener" href="http://www.open-open.com/lib/view/open1455887871526.html">http://www.open-open.com/lib/view/open1455887871526.html</a></p>
<hr>
<h1 id="常见组合方式"><a href="#常见组合方式" class="headerlink" title="常见组合方式"></a>常见组合方式</h1><ul>
<li>仅使用gulp,解决代码压缩等预编译构建问题。但缺少预编译的模块化能力（webpack）</li>
<li>仅使用webpack,提供js模块化方案。但缺少代码压缩等预编译能力(gulp)</li>
<li>gulp + webpack: <a target="_blank" rel="noopener" href="https://github.com/fwon/gulp-webpack-demo">https://github.com/fwon/gulp-webpack-demo</a></li>
<li>npm script + webpack:  <a target="_blank" rel="noopener" href="https://github.com/react-webpack-generators/generator-react-webpack">https://github.com/react-webpack-generators/generator-react-webpack</a></li>
</ul>
<hr>
<h1 id="附：ES6（babel）常见组合"><a href="#附：ES6（babel）常见组合" class="headerlink" title="附：ES6（babel）常见组合"></a>附：ES6（babel）常见组合</h1><h2 id="一、在线”编译”-模块的方案（-浏览器环境-）"><a href="#一、在线”编译”-模块的方案（-浏览器环境-）" class="headerlink" title="一、在线”编译” 模块的方案（ 浏览器环境 ）"></a>一、在线”编译” 模块的方案（ 浏览器环境 ）</h2><p>1.<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/01/babel.html">babel-polyfill</a> <code>六、babel-polyfill</code></p>
<blockquote>
<p>举例来说，ES6在Array对象上新增了Array.from方法。Babel就不会转码这个方法。如果想让这个方法运行，必须使用babel-polyfill，为当前环境提供一个垫片</p>
</blockquote>
<p>2.<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/01/babel.html">babel-core&#x2F;browser</a> <code> 七、浏览器环境</code></p>
<blockquote>
<p>browser.js是Babel提供的转换器脚本，可以在浏览器运行。用户的ES6脚本放在script标签之中，但是要注明type&#x3D;”text&#x2F;babel”</p>
</blockquote>
<p>3.<a target="_blank" rel="noopener" href="https://github.com/babel/babel-standalone">babel-standalone</a></p>
<blockquote>
<p>给那些非Node.js环境中使用最新的JavaScript而服务的。<br>注意，网页中实时将ES6代码转为ES5，对性能会有影响。生产环境需要加载已经转码完成的脚本。</p>
</blockquote>
<p><code>详见：</code>ES6兼容低版本浏览器.md&#96;</p>
<h2 id="二、预编译模块的方案"><a href="#二、预编译模块的方案" class="headerlink" title="二、预编译模块的方案"></a>二、预编译模块的方案</h2><ul>
<li>Babel-cli</li>
<li>npm script + Babel</li>
<li>gulp + Babel</li>
<li>webpack + Babel</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/19/Read-shoe-dog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/19/Read-shoe-dog/" class="post-title-link" itemprop="url">读《鞋狗》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-19 22:25:58" itemprop="dateCreated datePublished" datetime="2016-12-19T22:25:58+08:00">2016-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Life-Talk/" itemprop="url" rel="index"><span itemprop="name">Life-Talk</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>作者简介：</strong>菲尔·奈特(Phil Knight)</p>
<ul>
<li>耐克创始人，全球最具影响力的企业家之一；毕业于俄勒冈大学，在斯坦福大学获得MBA学位；</li>
<li>1964—2004年担任耐克公司总裁，2004—2016年担任耐克公司董事长；</li>
<li>源于24岁时的一个疯狂想法，他用向父亲借来的50美元创业，一手将耐克打造成一个年收益超过300亿美元的企业帝国；</li>
<li>他所缔造的耐克标志，已经不仅仅是一个商标，更是一个优雅和伟大的文化标志，是在全世界每个角落都能被立即认出的为数不多的标志之一。</li>
</ul>
<blockquote  class="blockquote-center">
**Let everyone else call your idea crazy......just keep going. Don't stop. Don't even think about stopping until you get there, and don't give much thought to where "there" is.
——菲儿·奈特2014年于斯坦福大学商学院**
</blockquote>

<h3 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h3><p>之所以读这本书，是因为看了比尔·盖茨的荐书单，作为世界首富，盖茨每年都会向人们推荐他这一年来读过，且认为相当不错的书。目前，盖茨在《2016年，我推荐这些书给你》中写道</p>
<blockquote  class="blockquote-center">
**直到现在，阅读依然是我最喜欢用来了解一个新课题的方法。从儿童时代开始，我就平均一周读一本书。即使忙到不可开交，我也尽量挤出多一些时间阅读。
——比尔·盖茨**
</blockquote>

<p>我想，作为世界首富，你应该没有盖茨忙吧？即使这样他依然保持着一周一本书的习惯，请问我们这些屌丝还有什么理由不读书呢？都说人丑就要多读书，我说，人穷更要多读书。在今年他推荐的五本书中，另外四本是《弦理论》、《基因》、《强势领袖的神话》和《电网》。</p>
<p>该书获得多方赞誉，其中写推荐语的就有：联想集团创始人柳传志、创新工场董事长兼首席执行官李开复、真格基金创始人徐小平、真格基金联合创始人王强、信中利资本集团董事长汪潮涌、秦朔朋友圈新媒体平台及中国商业文明中心发起人秦朔、第一财经CEO周健工、《李翔商业内参》出品人李翔、和同资本合伙人张涛、新浪高级副总裁魏江雷、跑哪儿科技联合创始人田同生等等诸多大腕联合推荐。</p>
<h3 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h3><blockquote  class="blockquote-center">
**你瞧，
在我们这里，得拼命奔跑才能保持在原地。
要是想到别的地方，
那就得再快一倍才行。

<p>——刘易斯·卡罗尔，《爱丽丝梦游仙境》**</p>
</blockquote>

<p>在剑道中，只有在心中不再被我和你，不再被对手和他的剑，不再被自己的剑和使剑的方法所困扰时，才能达到最完美的状态……一切都是空虚：你自己、挥舞的剑和舞剑的胳膊，即便是空虚的想法都不再存在。</p>
<p>奈特在提到他的启蒙教练鲍尔曼同时也是他的合伙人的时候，有段话说的非常好，鲍尔曼说“人们有种错误的想法，那就是只有杰出的奥运会运动员才称得上是运动员，但他觉得每个人都是运动员。只要你身体无碍，就可以运动”。是的，身体是我们唯一容易改变并且会跟随我们一生的东西，有一个好身体非常的重要，不管你是打算做一番伟业还是平淡一生。这就像是一笔回报丰厚的投资，只要每天适量的运动，就能保持你拥有一个健康的体魄，在你以后的生活和事业上，给你提供不断的动力与支持，还有比这更合算的买卖吗？</p>
<h3 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h3><p>从代销鬼冢虎到推出自己的品牌NIKE，这中间经历的困难重重，但是都没有打垮这个年轻的朝气蓬勃的NIKE公司，直至一个里程碑式的产品出现，彻底奠定了NIKE的王者风范——“气垫鞋”。在年轻的NIKE创办之前，如今依然耳熟能详的品牌都早已存在，例如阿迪达斯、匡威、彪马等，所以与它们相比，NIKE是一个绝对的后来者，而如何从一个后来者到不断超越前辈，进而成为世界之冠，才是一个绝佳的精彩的学习典范。</p>
<p>有一个非常精彩的片段是，开始有人仿制NIKE鞋了，也就是常说的高仿品。在没有任何技术人员的指导下，这个仿制品的细节和做工都堪称完美。于是奈特果断的写信给仿制品老板谋求合作，让他们成为了NIKE的代工商。这不失为一个处理仿制品的方法。命运总是青睐勇者，以及诸如此类的事物。</p>
<p>在年近古稀的时候，奈特的长子因为潜水而意外身亡，使得耐克公司的接班人问题变得更加迫在眉睫，挑选合适的继任者一直是大公司掌门人的共同挑战，岂止是公司，上升到国家亦然如此。历史的轨迹总是惊人的巧合，当毛爷爷在锻炼他的接班人的时候发生了意外，当奈特在想或许可以传位于儿子的时候也发生了意外，虽然要为逝者悲伤，但是这也为世界的多元提供了更加多样性的选择。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/19/%E6%9F%A5%E7%9C%8BAndroid%E7%AD%BE%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/19/%E6%9F%A5%E7%9C%8BAndroid%E7%AD%BE%E5%90%8D/" class="post-title-link" itemprop="url">查看Android签名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-19 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-19T00:00:00+08:00">2016-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="方式一：通过签名文件-app-keystore-中获取"><a href="#方式一：通过签名文件-app-keystore-中获取" class="headerlink" title="方式一：通过签名文件 app.keystore 中获取"></a>方式一：通过签名文件 <code>app.keystore</code> 中获取</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -v -keystore app.keystore</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">F:\work\android_sign&gt;keytool -list -v -keystore app.keystore</span><br><span class="line">输入密钥库口令:</span><br><span class="line"> </span><br><span class="line">密钥库类型: JKS</span><br><span class="line">密钥库提供方: SUN</span><br><span class="line"> </span><br><span class="line">您的密钥库包含 1 个条目</span><br><span class="line"> </span><br><span class="line">别名: app.keystore</span><br><span class="line">创建日期: 2015-6-29</span><br><span class="line">条目类型: PrivateKeyEntry</span><br><span class="line">证书链长度: 1</span><br><span class="line">证书[1]:</span><br><span class="line">所有者: CN=wosaitech, OU=wosaitech, O=wosaitech, L=杭州, ST=浙江, C=cn</span><br><span class="line">发布者: CN=wosaitech, OU=wosaitech, O=wosaitech, L=杭州, ST=浙江, C=cn</span><br><span class="line">序列号: 61f0b791</span><br><span class="line">有效期开始日期: Mon Jun 29 10:31:31 CST 2015, 截止日期: Fri May 12 10:31:31 CST 2215</span><br><span class="line">证书指纹:</span><br><span class="line">         MD5: FD:A1:F4:B4:FD:B7:85:1C:34:77:7E:BB:B7:F0:40:70</span><br><span class="line">         SHA1: 2D:57:FB:81:F3:43:62:81:2E:50:63:46:42:BA:0A:8B:1F:92:BC:39</span><br><span class="line">         SHA256: 27:EE:91:AE:B3:BF:6D:49:36:8B:AB:0F:7E:B6:83:C1:9A:B3:91:34:AA:43:62:63:AE:04:38:EC:25:25:2B:31</span><br><span class="line">         签名算法名称: SHA256withRSA</span><br><span class="line">         版本: 3</span><br><span class="line"> </span><br><span class="line">扩展:</span><br><span class="line"> </span><br><span class="line">#1: ObjectId: 2.5.29.14 Criticality=false</span><br><span class="line">SubjectKeyIdentifier [</span><br><span class="line">KeyIdentifier [</span><br><span class="line">0000: B9 5C 2F EC 1D 02 67 02   54 19 03 10 32 10 7C C9  .\/...g.T...2...</span><br></pre></td></tr></table></figure>
<ul>
<li>结果<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHA1: 2D:57:FB:81:F3:43:62:81:2E:50:63:46:42:BA:0A:8B:1F:92:BC:39</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="方式二：通过程序包app-apk中获取"><a href="#方式二：通过程序包app-apk中获取" class="headerlink" title="方式二：通过程序包app.apk中获取"></a>方式二：通过程序包<code>app.apk</code>中获取</h1><ul>
<li>先解压<code>app.apk</code></li>
<li>再到解压目录中使用<code>keytool  -printcert </code> （ -printcert          打印证书内容）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keytool -printcert -file .\META-INF\APP_KEYS.RSA</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">F:\work\android_sign\android-release-signed&gt;keytool -printcert -file .\META-INF\APP_KEYS.RSA</span><br><span class="line">所有者: CN=wosaitech, OU=wosaitech, O=wosaitech, L=杭州, ST=浙江, C=cn</span><br><span class="line">发布者: CN=wosaitech, OU=wosaitech, O=wosaitech, L=杭州, ST=浙江, C=cn</span><br><span class="line">序列号: 61f0b791</span><br><span class="line">有效期开始日期: Mon Jun 29 10:31:31 CST 2015, 截止日期: Fri May 12 10:31:31 CST 2215</span><br><span class="line">证书指纹:</span><br><span class="line">         MD5: FD:A1:F4:B4:FD:B7:85:1C:34:77:7E:BB:B7:F0:40:70</span><br><span class="line">         SHA1: 2D:57:FB:81:F3:43:62:81:2E:50:63:46:42:BA:0A:8B:1F:92:BC:39</span><br><span class="line">         SHA256: 27:EE:91:AE:B3:BF:6D:49:36:8B:AB:0F:7E:B6:83:C1:9A:B3:91:34:AA:43:62:63:AE:04:38:EC:25:25:2B:31</span><br><span class="line">         签名算法名称: SHA256withRSA</span><br><span class="line">         版本: 3</span><br><span class="line"> </span><br><span class="line">扩展:</span><br><span class="line"> </span><br><span class="line">#1: ObjectId: 2.5.29.14 Criticality=false</span><br><span class="line">SubjectKeyIdentifier [</span><br><span class="line">KeyIdentifier [</span><br><span class="line">0000: B9 5C 2F EC 1D 02 67 02   54 19 03 10 32 10 7C C9  .\/...g.T...2...</span><br><span class="line">0010: 7A EE B3 E1                                        z...</span><br><span class="line">]</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li>结果<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHA1: 2D:57:FB:81:F3:43:62:81:2E:50:63:46:42:BA:0A:8B:1F:92:BC:39</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/18/Log4j2-to-achieve-different-levels-of-different-threads-log-output-to-a-different-file/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/18/Log4j2-to-achieve-different-levels-of-different-threads-log-output-to-a-different-file/" class="post-title-link" itemprop="url">Log4j2实现不同线程不同级别日志输出到不同的文件中</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-18 20:00:16" itemprop="dateCreated datePublished" datetime="2016-12-18T20:00:16+08:00">2016-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Java日志框架"><a href="#Java日志框架" class="headerlink" title="Java日志框架"></a>Java日志框架</h3><p>作为一个Java程序员，肯定离不开日志框架，现在最优秀的Java日志框架是Log4j2，没有之一。根据官方的测试表明，在多线程环境下，Log4j2的异步日志表现更加优秀。在异步日志中，Log4j2使用独立的线程去执行I&#x2F;O操作，可以极大地提升应用程序的性能。</p>
<p>在官方的测试中，下图比较了<code>Sync</code>、<code>Async Appenders</code>和<code>Loggers all async</code>三者的性能。其中<code>Loggers all async</code>表现最为出色，而且线程数越多，<code>Loggers all async</code>性能越好。</p>
<p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/log4j2_async_vs_sync_throughput.png"></p>
<p>除了对Log4j2自身的不同模式做对比以外，官方还做了<strong>Log4j2&#x2F;Log4j1&#x2F;Logback</strong>的对比，如下图所示</p>
<p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/log4j_async_throughput_comparison.png"></p>
<p>其中，<code>Loggers all async</code>是基于<a target="_blank" rel="noopener" href="http://lmax-exchange.github.com/disruptor/">LMAX Disruptor</a>实现的。</p>
<h3 id="使用Log4j2"><a href="#使用Log4j2" class="headerlink" title="使用Log4j2"></a>使用Log4j2</h3><h4 id="需要哪些JAR"><a href="#需要哪些JAR" class="headerlink" title="需要哪些JAR"></a>需要哪些JAR</h4><p>使用Log4j2最少需要两个JAR，分别是<code>log4j-api-2.x</code>和<code>log4j-core-2.x</code>，其它JAR包根据应用程序需要添加。</p>
<h4 id="配置文件位置"><a href="#配置文件位置" class="headerlink" title="配置文件位置"></a>配置文件位置</h4><p>默认的，Log4j2在<strong>classpath</strong>下寻找名为<code>log4j2.xml</code>的配置文件。也可以使用<code>system property</code>指定配置文件的全路径。<code>-Dlog4j.configurationFile=path/to/log4j2.xml</code>，在Java代码中指定路径如下所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LoggerContext</span> <span class="variable">loggerContext</span> <span class="operator">=</span> (LoggerContext) LogManager.getContext(<span class="literal">false</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/a/different/log4j2.xml&quot;</span>);</span><br><span class="line">        loggerContext.setConfigLocation(file.toURI());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一般的，不需要手动关闭Log4j2，如果想手动在代码中关闭Log4j2如下所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.Configurator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Configurator.shutdown((LoggerContext) LogManager.getContext());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有关Log4j2的内容很多，不能一一列出，如果在开发中遇到任何问题，推荐去<a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/2.x/">官方文档</a>中寻找解决方案。</p>
<h4 id="不同的线程输出日志到不同的文件中"><a href="#不同的线程输出日志到不同的文件中" class="headerlink" title="不同的线程输出日志到不同的文件中"></a>不同的线程输出日志到不同的文件中</h4><h5 id="方法一使用ThreadContext"><a href="#方法一使用ThreadContext" class="headerlink" title="方法一使用ThreadContext"></a>方法一使用ThreadContext</h5><p>在多线程编程中，如果不做特殊的设置，那么多个线程的日志会输出到同一个日志文件中，这样在查阅日志的时候，会带来诸多不便。很自然地，我们想到了让不同的线程输出日志到不同的文件中，这样不是更好吗？在翻阅官方文档过程中，找到了<strong>FAQ</strong>（Frequently Asked Questions），其中有个问题**<a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/2.x/faq.html#separate_log_files">How do I dynamically write to separate log files?</a><strong>正是我们所需要的。根据提示步步推进可以顺利解决该问题。其中</strong>log4j2.xml**配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;OFF&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Routing</span> <span class="attr">name</span>=<span class="string">&quot;Routing&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Routes</span> <span class="attr">pattern</span>=<span class="string">&quot;$$&#123;ctx:ROUTINGKEY&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- This route is chosen if ThreadContext has value &#x27;special&#x27; for key ROUTINGKEY. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&quot;special&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;Rolling-$&#123;ctx:ROUTINGKEY&#125;&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/special-$&#123;ctx:ROUTINGKEY&#125;.log&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">&quot;./logs/$&#123;date:yyyy-MM&#125;/$&#123;ctx:ROUTINGKEY&#125;-special-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d&#123;ISO8601&#125; [%t] %p %c&#123;3&#125; - %m%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;6&quot;</span> <span class="attr">modulate</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10 MB&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- This route is chosen if ThreadContext has no value for key ROUTINGKEY. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&quot;$$&#123;ctx:ROUTINGKEY&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;Rolling-default&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/default.log&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">&quot;./logs/$&#123;date:yyyy-MM&#125;/default-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;ISO8601&#125; [%t] %p %c&#123;3&#125; - %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;6&quot;</span> <span class="attr">modulate</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10 MB&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- This route is chosen if ThreadContext has a value for ROUTINGKEY</span></span><br><span class="line"><span class="comment">                     (other than the value &#x27;special&#x27; which had its own route above).</span></span><br><span class="line"><span class="comment">                     The value dynamically determines the name of the log file. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Route</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;Rolling-$&#123;ctx:ROUTINGKEY&#125;&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/other-$&#123;ctx:ROUTINGKEY&#125;.log&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">&quot;./logs/$&#123;date:yyyy-MM&#125;/$&#123;ctx:ROUTINGKEY&#125;-other-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;ISO8601&#125; [%t] %p %c&#123;3&#125; - %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;6&quot;</span> <span class="attr">modulate</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10 MB&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Routing</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--很直白，Console指定了结果输出到控制台--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;ConsolePrint&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %t %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 级别顺序（低到高）：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--AppenderRef中的ref值必须是在前面定义的appenders--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Routing&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;ConsolePrint&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试类如下所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.ThreadContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            ThreadContext.put(<span class="string">&quot;ROUTINGKEY&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">            ThreadContext.remove(<span class="string">&quot;ROUTINGKEY&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            ThreadContext.put(<span class="string">&quot;ROUTINGKEY&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">            ThreadContext.remove(<span class="string">&quot;ROUTINGKEY&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行测试类，会得到如下两个日志文件，<code>other-Thread-1.log</code>和<code>other-Thread-2.log</code>，每个日志文件对应着一个线程。该程序使用Gradle构建，依赖的JAR包如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.projectlombok:lombok:1.16.10&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;org.apache.logging.log4j:log4j-core:2.6&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;org.apache.logging.log4j:log4j-api:2.6&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的一点是，每次在使用<strong>log</strong>对象之前，需要先设置<code>ThreadContext.put(&quot;ROUTINGKEY&quot;, Thread.currentThread().getName());</code>，设置的<strong>key</strong>和<code>log4j2.xml</code>配置文件中的<strong>key</strong>要一致，而<strong>value</strong>可以是任意值，参考配置文件即可理解。</p>
<p>有没有发现，每次使用log对象，还需要添加额外的代码，这不是恶心他妈给恶心开门——恶心到家了吗？有没有更加优雅地解决办法呢？且看下节。</p>
<h5 id="方法二实现StrLookup"><a href="#方法二实现StrLookup" class="headerlink" title="方法二实现StrLookup"></a>方法二实现StrLookup</h5><p>修改<code>log4j2.xml</code>配置文件如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;OFF&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Routing</span> <span class="attr">name</span>=<span class="string">&quot;Routing&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Routes</span> <span class="attr">pattern</span>=<span class="string">&quot;$$&#123;thread:threadName&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Route</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;logFile-$&#123;thread:threadName&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">fileName</span>=<span class="string">&quot;logs/concurrent-$&#123;thread:threadName&#125;.log&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">&quot;logs/concurrent-$&#123;thread:threadName&#125;-%d&#123;MM-dd-yyyy&#125;-%i.log&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d %-5p [%t] %C&#123;2&#125; - %m%n&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;50 MB&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Routing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Async</span> <span class="attr">name</span>=<span class="string">&quot;async&quot;</span> <span class="attr">bufferSize</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Routing&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Async</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--很直白，Console指定了结果输出到控制台--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;ConsolePrint&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %t %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;async&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;ConsolePrint&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>实现StrLookup中的lookup方法，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.LogEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.plugins.Plugin;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.lookup.StrLookup;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Plugin(name = &quot;thread&quot;, category = StrLookup.CATEGORY)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLookup</span> <span class="keyword">implements</span> <span class="title class_">StrLookup</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">lookup</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread().getName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">lookup</span><span class="params">(LogEvent event, String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> event.getThreadName() == <span class="literal">null</span> ? Thread.currentThread().getName()</span><br><span class="line">                : event.getThreadName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写测试类，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该测试类同样会得到两个日志文件，每个线程分别对应一个，但是在使用<strong>log</strong>对象之前不再需要设置<code>ThreadContext.put(&quot;ROUTINGKEY&quot;, Thread.currentThread().getName());</code>，是不是清爽多了。</p>
<p>根据官方的性能测试我们知道，<code>Loggers all async</code>的性能最高，但是方法一使用的是<code>Sync</code>模式（因为Appender默认是synchronous的），方法二使用的是<code>Async Appender</code>模式，那么如何更进一步让所有的<strong>Loggers</strong>都是<strong>Asynchronous</strong>的，让我们的配置更完美呢？想要使用<code>Loggers all async</code>还需要做一步设置，如果是Maven或Gradle项目，需要在<code>src/main/resources</code>目录下添加<strong>log4j2.component.properties</strong>配置文件，根据<a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/2.x/manual/async.html">官网说明</a>，其中内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span><br></pre></td></tr></table></figure>

<p>同时还需要在<strong>classpath</strong>下添加依赖的<strong>disruptor</strong> JAR包<code>com.lmax:disruptor:3.3.6</code>。当配置使用了<code>AsyncLoggerContextSelector</code>之后，所有的<strong>Loggers</strong>就都是异步的了。有方法证明使用了<code>Loggers all async</code>吗，答案是有，默认的<strong>location</strong>不会传递给<code>Loggers all async</code>的I&#x2F;O线程，所以如果不设置<code>includeLocation=true</code>的话，打印出来的日志中<strong>location</strong>信息是“?”，例如“2016-12-16 16:38:47,285 INFO  [Thread-3] ? - info”，如果设置includeLocation&#x3D;”true”之后，打印出“2016-12-16 16:39:14,899 INFO  [Thread-3] TestLog - info”，Gradle构建依赖如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.projectlombok:lombok:1.16.10&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;org.apache.logging.log4j:log4j-core:2.6&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;org.apache.logging.log4j:log4j-api:2.6&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.lmax:disruptor:3.3.6&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="不同级别的日志输出到不同的文件中"><a href="#不同级别的日志输出到不同的文件中" class="headerlink" title="不同级别的日志输出到不同的文件中"></a>不同级别的日志输出到不同的文件中</h4><p>通常情况下，用到的日志级别主要是info&#x2F;debug&#x2F;error三个，而如果不做特殊配置，这三者信息是写到一个日志文件中的，当我们需要不同级别的日志输出到不同的文件中时，需要如何做呢？<code>log4j2.xml</code>配置信息如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;OFF&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;logFilePath&quot;</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;logFileName&quot;</span>&gt;</span>testLog<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--很直白，Console指定了结果输出到控制台--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;ConsolePrint&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %t %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;File&gt;输出结果到指定文件&lt;/File&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;RollingFile&gt;同样输出结果到指定文件，但是使用buffer，速度会快点&lt;/RollingFile&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--filePattern：表示当日志到达指定的大小或者时间，产生新日志时，旧日志的命名路径。--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--PatternLayout：和log4j一样，指定输出日志的格式，append表示是否追加内容，值默认为true--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileDebug&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$&#123;logFileName&#125;-debug.log&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;logFileName&#125;-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--注意，如果有多个ThresholdFilter，那么Filters标签是必须的--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--首先需要过滤不符合的日志级别，把不需要的首先DENY掉，然后在ACCEPT需要的日志级别，次序不能颠倒--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--INFO及以上级别拒绝输出--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;DENY&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;NEUTRAL&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--只输出DEBUG级别信息--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--时间策略，每隔24小时产生新的日志文件--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--大小策略，每到30M时产生新的日志文件--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;30MB&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileInfo&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$&#123;logFileName&#125;-info.log&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;logFileName&#125;-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--onMatch:Action to take when the filter matches. The default value is NEUTRAL--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--onMismatch:    Action to take when the filter does not match. The default value is DENY--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--级别在ERROR之上的都拒绝输出--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--在组合过滤器中，接受使用NEUTRAL（中立），被第一个过滤器接受的日志信息，会继续用后面的过滤器进行过滤，只有符合所有过滤器条件的日志信息，才会被最终写入日志文件--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;DENY&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;NEUTRAL&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;30MB&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileError&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$&#123;logFileName&#125;-error.log&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;logFileName&#125;-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;30MB&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--logger用于定义log的level以及所采用的appender，如果无需自定义，可以使用root解决，root标签是log的默认输出形式--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 级别顺序（低到高）：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 只要是级别比ERROR高的，包括ERROR就输出到控制台 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--appender-ref中的值必须是在前面定义的appenders--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Appender-ref</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;ConsolePrint&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileDebug&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileInfo&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileError&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>src\main\resources\log4j2.component.properties</code>内容不变，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span><br></pre></td></tr></table></figure>

<p>测试代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该程序会生成三份日志文件【testLog-debug.log，testLog-error.log，testLog-info.log】，如果你足够细心的话，就会发现线程1和线程2的<strong>info|debug|error</strong>信息都输出到一个<strong>info|debug|error</strong>日志文件中了。如何解决这个问题呢？换句话说，我想得到</p>
<blockquote>
<p>Thread 1</p>
<blockquote>
<p>Thread 1的info日志<br>  Thread 1的debug日志<br>  Thread 1的error日志</p>
</blockquote>
</blockquote>
<blockquote>
<p>Thread 2</p>
<blockquote>
<p>Thread 2的info日志<br>  Thread 2的debug日志<br>  Thread 2的error日志</p>
</blockquote>
</blockquote>
<p>六个日志文件，要如何实现呢？这正是下一节要讲述的内容。</p>
<h4 id="不同线程不同级别的日志输出到不同的文件中"><a href="#不同线程不同级别的日志输出到不同的文件中" class="headerlink" title="不同线程不同级别的日志输出到不同的文件中"></a>不同线程不同级别的日志输出到不同的文件中</h4><p>要实现该功能，还要从<strong>RoutingAppender</strong>身上做文章。<strong>RoutingAppender</strong>主要用来评估LogEvents，然后将它们路由到下级Appender。目标Appender可以是先前配置的并且可以由其名称引用的Appender，或者可以根据需要动态地创建Appender。<strong>RoutingAppender</strong>应该在其引用的任何Appenders之后配置，以确保它可以正确关闭。</p>
<p><strong>RoutingAppender</strong>中的name属性用来指定该Appender的名字，它可以包含多个Routes子节点，用来标识选择Appender的条件，而Routes只有一个属性“pattern”，该pattern用来评估所有注册的<strong>Lookups</strong>，并且其结果用于选择路由。在Routes下可以有多个Route，每个Route都必须配置一个key，如果这个key匹配“pattern”的评估结果，那么这个Route就被选中。同时每个Route都必须引用一个Appender，如果这个Route包含一个ref属性，那么这个Route将引用一个在配置中定义的Appender，如果这个Route包含一个Appender的定义，那么这个Appender将会根据RoutingAppender的上下文创建并被重用。</p>
<p>废话说多了，直接上配置才简洁明了。log4j2.xml配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--status的含义为是否记录log4j2本身的event信息，默认是OFF--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;OFF&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--自定义一些常量，之后使用$&#123;变量名&#125;引用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;logFilePath&quot;</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;logFileName&quot;</span>&gt;</span>testLog<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--很直白，Console指定了结果输出到控制台--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;ConsolePrint&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %t %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;File&gt;输出结果到指定文件&lt;/File&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;RollingFile&gt;同样输出结果到指定文件，但是使用buffer，速度会快点&lt;/RollingFile&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--filePattern：表示当日志到达指定的大小或者时间，产生新日志时，旧日志的命名路径。--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--PatternLayout：和log4j一样，指定输出日志的格式，append表示是否追加内容，值默认为true--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Routing</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileDebug_$&#123;thread:threadName&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Routes</span> <span class="attr">pattern</span>=<span class="string">&quot;$$&#123;thread:threadName&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Route</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileDebug_$&#123;thread:threadName&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$&#123;logFileName&#125;_$&#123;thread:threadName&#125;_debug.log&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;logFileName&#125;-%d&#123;yyyy-MM-dd&#125;-$&#123;thread:threadName&#125;-debug_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--注意，如果有多个ThresholdFilter，那么Filters标签是必须的--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--首先需要过滤不符合的日志级别，把不需要的首先DENY掉，然后在ACCEPT需要的日志级别，次序不能颠倒--&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--INFO及以上级别拒绝输出--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;DENY&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;NEUTRAL&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--只输出DEBUG级别信息--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--时间策略，每隔24小时产生新的日志文件--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--大小策略，每到30M时产生新的日志文件--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;30MB&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Routing</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Routing</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileInfo_$&#123;thread:threadName&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Routes</span> <span class="attr">pattern</span>=<span class="string">&quot;$$&#123;thread:threadName&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Route</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileInfo_$&#123;thread:threadName&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$&#123;logFileName&#125;_$&#123;thread:threadName&#125;_info.log&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;logFileName&#125;-%d&#123;yyyy-MM-dd&#125;-$&#123;thread:threadName&#125;-info_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--onMatch: Action to take when the filter matches. The default value is NEUTRAL--&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--onMismatch:    Action to take when the filter does not match. The default value is DENY--&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--级别在ERROR之上的都拒绝输出--&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--在组合过滤器中，接受使用NEUTRAL（中立），被第一个过滤器接受的日志信息，会继续用后面的过滤器进行过滤，只有符合所有过滤器条件的日志信息，才会被最终写入日志文件--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;DENY&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;NEUTRAL&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;30MB&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Routing</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Routing</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileError_$&#123;thread:threadName&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Routes</span> <span class="attr">pattern</span>=<span class="string">&quot;$$&#123;thread:threadName&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Route</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileError_$&#123;thread:threadName&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$&#123;logFileName&#125;_$&#123;thread:threadName&#125;_error.log&quot;</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logFilePath&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;logFileName&#125;-%d&#123;yyyy-MM-dd&#125;-$&#123;thread:threadName&#125;-error_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy.MM.dd HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;30MB&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Routing</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--bufferSize整数，指定可以排队的events最大数量，如果使用BlockingQueue，这个数字必须是2的幂次--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--includeLocation默认值是FALSE，如果指定为TRUE，会降低性能，但是推荐设置为TRUE，否则不打印位置行信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Async</span> <span class="attr">name</span>=<span class="string">&quot;async&quot;</span> <span class="attr">bufferSize</span>=<span class="string">&quot;262144&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileDebug_$&#123;thread:threadName&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileInfo_$&#123;thread:threadName&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileError_$&#123;thread:threadName&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 只要是级别比ERROR高的，包括ERROR就输出到控制台 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;ConsolePrint&quot;</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Async</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Logger用于定义log的level以及所采用的appender，如果无需自定义，可以使用root解决，root标签是log的默认输出形式--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 级别顺序（低到高）：TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--AppenderRef中的ref值必须是在前面定义的appenders--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;async&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>log4j2.component.properties</code>和<code>ThreadLookup</code>类不变，依赖的JAR包和上一节一样。测试类如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该程序会输出六个日志文件，分别是</p>
<blockquote>
<p>testLog_Thread-2_debug.log<br> testLog_Thread-2_error.log<br> testLog_Thread-2_info.log<br> testLog_Thread-3_debug.log<br> testLog_Thread-3_error.log<br> testLog_Thread-3_info.log</p>
</blockquote>
<p>至此，就实现了不同线程不同级别的日志输出到不同文件中的功能。</p>
<h3 id="如何启用All-Loggers-Asynchronous"><a href="#如何启用All-Loggers-Asynchronous" class="headerlink" title="如何启用All Loggers Asynchronous"></a>如何启用All Loggers Asynchronous</h3><p>为了使得所有的<strong>Loggers</strong>都是异步的，除了添加一个新的配置文件，就是<code>log4j2.component.properties</code>外，还有其它方式吗？有的，仅列举如下</p>
<ul>
<li>例如【IntelliJ IDEA】中使用Gradle构建项目，那么可以在Settings | Build, Execution, Deployment | Build Tools | Gradle | Gradle VM options中填入<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-DLog4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span><br></pre></td></tr></table></figure></li>
<li>另一种就是在前面提到的<strong>ThreadLookup</strong>类中，添加静态代码块<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    System.setProperty(<span class="string">&quot;Log4jContextSelector&quot;</span>, <span class="string">&quot;org.apache.logging.log4j.core.async.AsyncLoggerContextSelector&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
根据参考手册，有一点需要注意的就是，要使用<code>&lt;Root&gt;</code>或<code>&lt;Logger&gt;</code>标签，而不是<code>&lt;asyncRoot&gt;</code>和<code>&lt;asyncLogger&gt;</code>，原文如下：<blockquote>
<p>When AsyncLoggerContextSelector is used to make all loggers asynchronous, make sure to use normal <code>&lt;root&gt;</code> and <code>&lt;logger&gt;</code> elements in the configuration. The AsyncLoggerContextSelector will ensure that all loggers are asynchronous, using a mechanism that is different from what happens when you configure <code>&lt;asyncRoot&gt;</code> or <code>&lt;asyncLogger&gt;</code>. The latter elements are intended for mixing async with sync loggers.</p>
</blockquote>
</li>
</ul>
<h3 id="混合使用Synchronous和Asynchronous-Loggers"><a href="#混合使用Synchronous和Asynchronous-Loggers" class="headerlink" title="混合使用Synchronous和Asynchronous Loggers"></a>混合使用Synchronous和Asynchronous Loggers</h3><p>需要<code>disruptor-3.0.0.jar</code>或更高版本的jar包，不需要设置系统属性<code>Log4jContextSelector</code>，在配置中可以混合使用<code>Synchronous</code>和<code>asynchronous loggers</code>，使用<code>&lt;AsyncRoot&gt;</code>或者<code>&lt;AsyncLogger&gt;</code>去指定需要异步的Loggers，<code>&lt;AsyncLogger&gt;</code>元素还可以包含<code>&lt;Root&gt;</code>和<code>&lt;Logger&gt;</code>用于同步的Loggers。注意如果使用的是<code>&lt;AsyncRoot&gt;</code>或者<code>&lt;AsyncLogger&gt;</code>，那么就无需设置系统属性<code>Log4jContextSelector</code>了。</p>
<p>一个混合了同步和异步的Loggers配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- No need to set system property &quot;Log4jContextSelector&quot; to any value</span></span><br><span class="line"><span class="comment">     when using &lt;asyncLogger&gt; or &lt;asyncRoot&gt;. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Async Loggers will auto-flush in batches, so switch off immediateFlush. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RandomAccessFile</span> <span class="attr">name</span>=<span class="string">&quot;RandomAccessFile&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;asyncWithLocation.log&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">immediateFlush</span>=<span class="string">&quot;false&quot;</span> <span class="attr">append</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d %p %class&#123;1.&#125; [%t] %location %m %ex%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RandomAccessFile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- pattern layout actually uses location, so we need to include it --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AsyncLogger</span> <span class="attr">name</span>=<span class="string">&quot;com.foo.Bar&quot;</span> <span class="attr">level</span>=<span class="string">&quot;trace&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RandomAccessFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">AsyncLogger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RandomAccessFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/19976211/different-log-files-for-multiple-threads-using-log4j2">Different log files for multiple threads using log4j2</a><br>[2] <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/27154558/log4j2-location-for-setting-log4jcontextselector-system-property-for-asynchrono">log4j2: Location for setting Log4jContextSelector system property for asynchronous logging</a><br>[3] <a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/async.html#AllAsync">Making All Loggers Asynchronous</a><br>[4] <a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/appenders.html#AsyncAppender">AsyncAppender</a><br>[5] <a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/async.html#MixedSync-Async">Mixing Synchronous and Asynchronous Loggers</a><br>[6] <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/33293059/how-to-verify-log4j2-is-logging-asynchronously-via-lmax-disruptor">How to verify log4j2 is logging asynchronously via LMAX disruptor?</a><br>[7] <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/38043488/log4j2-synchronous-logging">Log4j2 synchronous logging</a><br>[8] <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/30338034/log4j2-sync-loggers-faster-than-mixed-async-sync-loggers">Log4J2 sync loggers faster than mixed async&#x2F;sync loggers</a><br>[9] <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/24177601/difference-between-asynclogger-and-asyncappender-in-log4j2">Difference between Asynclogger and AsyncAppender in Log4j2</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2016/12/16/https,%E7%BD%91%E7%BB%9C%E5%88%86%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/16/https,%E7%BD%91%E7%BB%9C%E5%88%86%E5%B1%82/" class="post-title-link" itemprop="url">https , 网络分层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-12-16 00:00:04" itemprop="dateCreated datePublished" datetime="2016-12-16T00:00:04+08:00">2016-12-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网络分层"><a href="#网络分层" class="headerlink" title="网络分层"></a>网络分层</h1><p>网络层次可划分为五层因特网协议栈和七层因特网协议栈<br><code>系统分析师教程 2010.pdf-第四章  数据通信与计算机网络 -网络体系结构与协议</code></p>
<table>
<thead>
<tr>
<th>5层</th>
<th>7层(OSI&#x2F;RM )</th>
<th></th>
<th>4层(TCP&#x2F;IP)</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>应用层</td>
<td>应用</td>
<td>面向用户，机器与用户间的界面</td>
<td>应用层</td>
<td>同[应用+表示+会话]</td>
</tr>
<tr>
<td></td>
<td>表示</td>
<td>语义化内容和含义</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>会话</td>
<td>一个终端用户与交互系统进行通讯的过程</td>
<td></td>
<td></td>
</tr>
<tr>
<td>传输层</td>
<td>传输层</td>
<td>数据通信最高层&#x2F;两台计算机通信可靠传输层</td>
<td>传输层</td>
<td>同[传输层]</td>
</tr>
<tr>
<td>网络层</td>
<td>网络层</td>
<td>通信子网最高层&#x2F;路由选择</td>
<td>网络互联层</td>
<td>同[网络层]</td>
</tr>
<tr>
<td>链路层</td>
<td>数据链路层</td>
<td>数据通道</td>
<td>网络接口层</td>
<td>同[链路层+物理]</td>
</tr>
<tr>
<td>物理层</td>
<td>物理层</td>
<td>bit流传输</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>协议栈（Protocol Stack）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">应用层（HTTP，FTP，TFTP，TELNET，DNS，EMAIL等）</span><br><span class="line">表示层（VTP）</span><br><span class="line">会话层</span><br><span class="line">传输层（TCP，UDP）</span><br><span class="line">网络层（IP）</span><br><span class="line">数据链路层（WI-FI，以太网，令牌环，FDDI，MAC等）</span><br><span class="line">物理层[2] </span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>网络分层_百度百科</code><br><a target="_blank" rel="noopener" href="http://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%88%86%E5%B1%82">http://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%88%86%E5%B1%82</a></p>
<hr>
<h1 id="Https简介"><a href="#Https简介" class="headerlink" title="Https简介"></a>Https简介</h1><p>HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL</p>
<h1 id="HTTPS和HTTP的区别"><a href="#HTTPS和HTTP的区别" class="headerlink" title="HTTPS和HTTP的区别"></a>HTTPS和HTTP的区别</h1><p>场景 | http | https<br>-|-|<br>传输 | 明文 | 密文<br>证书 | 不需要 | ca申请证书(免费&#x2F;收费)<br>协议 | http是超文本传输协议 | https 则是具有安全性的ssl加密传输协议<br>端口 | 80 | 443<br>状态 | 无状态 | 由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议</p>
<p><code>https_百度百科</code><br><a target="_blank" rel="noopener" href="http://baike.baidu.com/item/https">http://baike.baidu.com/item/https</a></p>
<hr>
<h1 id="https通信过程"><a href="#https通信过程" class="headerlink" title="https通信过程"></a>https通信过程</h1><ul>
<li><p>https的实现原理<br>有两种基本的加解密算法类型：<br>1）对称加密：密钥只有一个，加密解密为同一个密码，且加解密速度快，典型的对称加密算法有DES、AES等；<br>2）非对称加密：密钥成对出现（且根据公钥无法推知私钥，根据私钥也无法推知公钥），加密解密使用不同密钥（公钥加密需要私钥解密，私钥加密需要公钥解密），相对对称加密速度较慢，典型的非对称加密算法有RSA、DSA等。</p>
</li>
<li><p>https通信的优点<br>1）客户端产生的密钥只有客户端和服务器端能得到；<br>2）加密的数据只有客户端和服务器端才能得到明文；<br>3）客户端到服务端的通信是安全的。</p>
</li>
</ul>
<p><code>深入理解http/https协议</code><br><a target="_blank" rel="noopener" href="http://www.mamicode.com/info-detail-1631526.html">http://www.mamicode.com/info-detail-1631526.html</a></p>
<p><code>openssl基本原理 + 生成证书 + 使用实例 - oldmtn的专栏 - 博客频道 - CSDN.NET</code><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/oldmtn/article/details/52208747">http://blog.csdn.net/oldmtn/article/details/52208747</a></p>
<p><code>Https单向认证和双向认证 - duanbokan的专栏 - 博客频道 - CSDN.NET</code><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/duanbokan/article/details/50847612">http://blog.csdn.net/duanbokan/article/details/50847612</a></p>
<hr>
<p>openssl、x509、crt、cer、key、csr、ssl、tls 这些都是什么鬼?</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/yjmyzz/p/openssl-tutorial.html">http://www.cnblogs.com/yjmyzz/p/openssl-tutorial.html</a></p>
<p><code>那些证书相关的玩意儿(SSL,X.509,PEM,DER,CRT,CER,KEY,CSR,P12等)</code><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/guogangj/p/4118605.html">http://www.cnblogs.com/guogangj/p/4118605.html</a></p>
<hr>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/448896-file_1484817404992_914a.png"><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/46324672-file_1484817412376_123a9.png"><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/14880190-file_1484817424981_12d7f.png"></p>
<p><code>苹果强制使用HTTPS传输了怎么办？——关于HTTPS，APP开发者必须知道的事 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/nya6BbM">http://www.tuicool.com/articles/nya6BbM</a></p>
<hr>
<p><code>记录启用https的全过程 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/ZVjMZ3Y">http://www.tuicool.com/articles/ZVjMZ3Y</a></p>
<h1 id="密钥，CA证书"><a href="#密钥，CA证书" class="headerlink" title="密钥，CA证书"></a>密钥，CA证书</h1><ul>
<li>SSL证书分为四大类<ul>
<li>DV证书:DV证书即Domain Validation Certificate</li>
<li>OV证书:OV证书即Organization Validation CErtificate</li>
<li>EV证书:EV证书即Extended Validation Certificate </li>
<li>自签名证书: 自签名证书很少被部署到正式的网站上，一般是被用在内部的测试环境中. (工具openssl)<br><a target="_blank" rel="noopener" href="https://github.com/michaelliao/itranswarp.js/blob/master/conf/ssl/gencert.sh">https://github.com/michaelliao/itranswarp.js/blob/master/conf/ssl/gencert.sh</a></li>
</ul>
</li>
</ul>
<p><code>给Nginx配置一个自签名的SSL证书 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/VNj2um">http://www.tuicool.com/articles/VNj2um</a></p>
<p><code>更多：自动shell脚本 gencert.sh</code><br><a target="_blank" rel="noopener" href="https://github.com/search?utf8=%E2%9C%93&q=Enter+your+domain+filename:gencert.sh&type=Code&ref=searchresults">https://github.com/search?utf8=%E2%9C%93&amp;q=Enter+your+domain+filename%3Agencert.sh&amp;type=Code&amp;ref=searchresults</a></p>
<p><code>为满足微信小程序 HTTPS 的要求，我们在部署 HTTPS 网站时，该如何选择 SSL 证书？ - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/3yaqqiN">http://www.tuicool.com/articles/3yaqqiN</a></p>
<p><code>利用腾讯云免费证书打造全https站 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/rMNRVrr">http://www.tuicool.com/articles/rMNRVrr</a></p>
<p><code>https 免费证书获取指引 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/z2m2auZ">http://www.tuicool.com/articles/z2m2auZ</a></p>
<ul>
<li><p>1, 通过 let’s encrypt</p>
</li>
<li><p>2, 腾讯云免费 ssl 证书申请</p>
</li>
<li><p>3, CDN 服务商一键提供</p>
</li>
<li><p>证书校验的几种方式：</p>
<ul>
<li>1, 邮箱验证 <a href="mailto:&#x61;&#x64;&#x6d;&#105;&#110;&#x40;&#99;&#110;&#111;&#100;&#101;&#x6a;&#115;&#x2e;&#111;&#114;&#103;">&#x61;&#x64;&#x6d;&#105;&#110;&#x40;&#99;&#110;&#111;&#100;&#101;&#x6a;&#115;&#x2e;&#111;&#114;&#103;</a></li>
<li>2, 文件校验 http:&#x2F;&#x2F; cnodejs.org&#x2F;5d41402abc4 b2a76b9719d911017c592.html</li>
<li>3, dns 校验 http:&#x2F;&#x2F; 5d41402abc4b2a76b9719d911017c592.cnodejs.org 的域名 cname 到某个地址</li>
</ul>
</li>
</ul>
<p><code>七牛云推出SSL证书免费服务 并宣布HTTPS调价 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/M73EvqA">http://www.tuicool.com/articles/M73EvqA</a></p>
<hr>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-1-19/64482030-file_1484817437675_9d43.png"><br><code>如何快速上线全站 HTTPS - 推酷</code><br> <a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/MneaAbj">http://www.tuicool.com/articles/MneaAbj</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/47/">47</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DJY</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
