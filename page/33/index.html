<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="baidu-site-verification" content="codeva-6wmKWl5hmx" />
<meta name="bytedance-verification-code" content="GcOf/MpQ8shZ5Hh/2hvr" />
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2426182848439341"
     crossorigin="anonymous"></script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-33RJLY0818"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-33RJLY0818');
</script>

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.sovdating.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Hello dev">
<meta property="og:type" content="website">
<meta property="og:title" content="Sovdating Linux">
<meta property="og:url" content="https://www.sovdating.com/page/33/index.html">
<meta property="og:site_name" content="Sovdating Linux">
<meta property="og:description" content="Hello dev">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="DJY">
<meta property="article:tag" content="golang python linux ubuntu centos rust">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.sovdating.com/page/33/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/33/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Sovdating Linux - some code for program</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Sovdating Linux</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">some code for program</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">DJY</p>
  <div class="site-description" itemprop="description">Hello dev</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">546</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">93</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">381</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-%E5%88%86%E6%9E%90%EF%BC%88%E9%98%BF%E9%87%8C%E4%BA%91%20PTS,Lite%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-%E5%88%86%E6%9E%90%EF%BC%88%E9%98%BF%E9%87%8C%E4%BA%91%20PTS,Lite%EF%BC%89/" class="post-title-link" itemprop="url">压力测试-分析（阿里云PTS,Lite）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-24 00:00:01" itemprop="dateCreated datePublished" datetime="2016-05-24T00:00:01+00:00">2016-05-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:25" itemprop="dateModified" datetime="2024-01-26T12:42:25+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">压力测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>并发用户数 - 成功TPS - 响应时间 - 失败TPS</p>
<ul>
<li><p>并发用户数：人数慢慢增加过程（预热时间），关注长时间打压后，后端是否出现内存溢出，或延迟逐渐升高</p>
</li>
<li><p>成功TPS：每秒可处理的事务数量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">公式： 成功并发人数/正常处理完的平均时间= 每秒可处理的事务数量（TPS）/1</span><br><span class="line">?( 成功并发人数 )/0.7=30/1    ，0.7s内成功事务数是21个，1s可处理30 个</span><br><span class="line">?/0.1 = 30/1                             ，0.1s中成功事务数是3个，1s可处理30个</span><br></pre></td></tr></table></figure>

</li>
<li><p>响应时间：<br>正常情况为 业务接口响应时间。当系统超出承受出现的线程等待，此等待时间也将计入响应时间。<br>施压机的步调如果为2s，2s后重新请求会关闭上一个未结束（等待状态）的线程，所以等待的最大值为2s，由此可知道，响应时间在超出承受后时间一般接近步调值2s。</p>
</li>
<li><p>失败TPS：系统出现瓶颈，请求不能正常处理。出现的节点，可推算出系统的承载人数。</p>
</li>
<li><p>步调2s：一个用户请求接口的间隔时间，等同用户使用同一个功能的频率。（秒杀，摇一摇步调较短2~5）</p>
</li>
</ul>
<p>【TPS-50,步调-2】  可得出承受用户数量&#x3D;tps50* 步调2&#x3D;100人<br>当用户超过100人，则超出系统正常处理负荷，此时即将出现失败请求。（考虑是否可使用队列解决失败请求？）<br>如果步调放大为10,则系统将可承受50 * 10&#x3D;500人<br>结论：系统的具体承受取决于<br>（系统基础TPS - 业务接口损耗TPS&#x3D;业务接口实际TPS）* 步调（取决实际业务）&#x3D;业务接口的承受用户量</p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-26/69801525.jpg"></p>
<ul>
<li><p>步调0s：<br>接口 TPS50 * 步调0 &#x3D; 极限支持用户量就是0，所以可以看出，从系统一开始就出现了失败请求。<br>随着人数的增加，50人并发*[0.1~1.0s ]的极限步调&#x3D;承受的人数<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-26/37569248.jpg"></p>
</li>
<li><p>步调1s：<br>明显超过50人后，系统才出现失败请求<br>公式: 接口TPS50*步调1s &#x3D; 系统承受人数50（超过50人则超出承受，异常请求就会出现）<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-26/7420070.jpg"></p>
</li>
<li><p>反推：系统如需支持200人在线，在 接口 现状的TPS50下，步调多少可以正常处理所有请求呢。<br>公式：200承受人数 &#x2F; 接口TPS50 &#x3D; 步调4s</p>
</li>
<li><p>步调4s：意外了，结果并不是正常处理完所有请求，为什么？<br>原因：步调也可能<code>齐步走</code>，所以并发人数同时请求，时刻的压力&#x3D;人数200&#x2F;步调(1<del>4) &#x3D; 200</del>50之间</p>
</li>
</ul>
<p>如果50内，系统可以承受，超过则出现异常（200时为最大值）<br>波动的幅度就是步调（1~4）中的<code>齐步走</code>线程数量<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-26/56769532.jpg"></p>
<ul>
<li><p>再推算: 在正常处理所有请求的情况下，应该配置多少人并发。【50人并发】- TPS失控了，不是预想的50<br>步调1S （解决<code>齐步走</code>并发人数同时请求）<br>接口TPS50 * 步调1S &#x3D; 50并发人数<br>实际数据确认，TPS在36时，用户人数也是36时，系统刚好处理完所有请求。这，其实已经可以证明TPS数(36)在1s的步调下只能承受等同的人数(36)<br>为什么TPS只达到（35~40)？这是新的思考问题，猜测：因为TPS不是个常量而是变量，所以在系统负载一段时间后可能会发生变化（降低）<br>而承受的在线人数（1s的步调下）是与TPS数同步的。<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-26/18846153.jpg"></p>
</li>
<li><p>配合当前的TPS数(30)，配置并发人数(30)，步调1s<br>结果和想的一样，所有请求全部成功。<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-26/29558051.jpg"></p>
</li>
<li><p>最终结论：<br>系统的<code>同时刻承载用户数</code>应该就是<code>业务接口的时刻TPS数</code>。在实际的场景中因为单用户的步调不一致，或同时刻请求的用户不一致，系统可承载的用户量也是无限大的。</p>
</li>
</ul>
<p>但是依然可以通过系统的基本参数，推断系统可承受的活跃用户。</p>
<p>如： 任意接口的平均TPS（50） * 单用户请求 任意 接口的步调为10s  &#x3D; 系统承受500活跃用户同时在线</p>
<p>对具体的接口推算将更准确，因为TPS更明确。步调也相对明确。<br>（如，评估一次秒杀活动，摇一摇活动，抽奖活动，就能相对准确的推算出系统承受的同时在线人数）</p>
<p>如果想提高在线用户人数，因为步调由业务决定不方便改变，TPS值可通过软件优化，硬件扩容，集群部署等多方法提高，从而达到预算支撑的同时在线人数。</p>
<hr>
<h1 id="TPS-与-并发人数-（步调为1s）的关系"><a href="#TPS-与-并发人数-（步调为1s）的关系" class="headerlink" title="TPS 与 并发人数 （步调为1s）的关系"></a>TPS 与 并发人数 （步调为1s）的关系</h1><p>依据上文中结论，应该是并发人数超过DPS数就会出现失败请求（即，在无失败请求的情况下，并发人数 &#x3D; TPS数。- 前提步调是1s）</p>
<p>有时会看到并发人数超过了TPS数？ -步调1s基础<br><code>出现了失败TPS</code> 或<code>步调&gt;1s</code> 或<code>响应时间边长?</code><br><code>提示</code> 在允许小量的失败率情况下，支撑的并发人数会超过一定量的TPS数。</p>
<h1 id="下面看看数据"><a href="#下面看看数据" class="headerlink" title="下面看看数据"></a>下面看看数据</h1><p><code>机器配置</code> 阿里云 ECS 2核 4G<br><code>注意</code> 曲线观察时，注意左右两侧的<code>参考线</code>.<br>如：成功TPS与失败TPS的参考线不一致时，低数值的曲线可能在高数值的上面。这不能直接代表什么，需要认真看具体数值（依据参考线）</p>
<ul>
<li>1.nginx性能：<br>http:&#x2F;&#x2F;**.43&#x2F;ng-test.html<br>在此场景下，TPS可达到1663左右（每秒并发数）<br><code>失败率是0,说明还没打压到性能瓶颈，而lite版最高并发只能配置2000</code><br><code>可以使用企业版TPS或使用自己的机器做施压机+ad， loadrunner </code><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/64724641.jpg"></li>
</ul>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/8272035.jpg"></p>
<p>66.98(处理事物数量)&#x2F;0.034 &#x3D; 1970&#x2F;1 ≈ 2000用户数</p>
<ul>
<li>2.Tomcat性能：</li>
</ul>
<p>http:&#x2F;&#x2F;**.43&#x2F;test&#x2F;test.html</p>
<p>在此场景下，TPS可达到1596左右（每秒并发数）</p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/32091008.jpg"></p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/77166171.jpg"></p>
<ul>
<li>3.访问框架空接口（tomcat + Spring MVC）的性能：</li>
</ul>
<p>http:&#x2F;&#x2F;<br>**<br>.43&#x2F;k12platform&#x2F;service&#x2F;helloWorld</p>
<p>在此场景下，TPS可达到585左右（每秒并发数）</p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/62976709.jpg"></p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/21983895.jpg"></p>
<ul>
<li>4.访问框架单次数据库查询的最佳性能（获取市下学校-一次单表交互）：<br>http:&#x2F;&#x2F;**.43&#x2F;k12platform&#x2F;service&#x2F;school&#x2F;330110<br>在此场景下，TPS可达到240左右（每秒并发数）<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/24325406.jpg"></li>
</ul>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/34913036.jpg"></p>
<ul>
<li>5<br>.访问一键登录接口的性能：</li>
</ul>
<p>http:&#x2F;&#x2F;**.43&#x2F;k12platform&#x2F;service&#x2F;login&#x2F;oneLogin&#x2F;student&#x2F;15158136199&#x2F;88 </p>
<p>在此场景下，TPS可达到130左右（每秒并发数）</p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/97025281.jpg"></p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-27/71592669.jpg"></p>
<hr>
<h1 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h1><ul>
<li>tomcat  <code> Catalina.sh</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CATALINA_OPTS=&quot;$CATALINA_OPTS -Xloggc:/usr/local/apache-tomcat-7.0.59/webapps/sys/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="优化手段"><a href="#优化手段" class="headerlink" title="优化手段"></a>优化手段</h1><ul>
<li><p>jvm  <code> Catalina.sh</code> -&gt; 4G内存为例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">JAVA_OPTS=&quot;-server&quot;</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Xms2500m&quot;</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Xmx2500m&quot;</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -XX:PermSize=512m&quot;</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -XX:MaxPermSize=1024m&quot;</span><br></pre></td></tr></table></figure>

</li>
<li><p>应用服务器 tomcat <code> http连接数</code> <code>conf/ server.xml</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">           connectionTimeout=&quot;20000&quot;</span><br><span class="line">           redirectPort=&quot;8443&quot;</span><br><span class="line">           minProcessors=&quot;10&quot; </span><br><span class="line">               maxThreads=&quot;3000&quot; maxProcessors=&quot;3000&quot; enableLookups=&quot;false&quot; acceptCount=&quot;3000&quot; debug=&quot;0&quot;</span><br><span class="line">           /&gt;</span><br></pre></td></tr></table></figure>


<ul>
<li><p>应用连接数据库连接数  <code>工程数据库连接池配置 如:config.properties</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">` maxActivity` 连接池的最大数据库连接数(建议值：*)</span><br><span class="line"></span><br><span class="line">`maxIdea` 最大空闲数，数据库连接的最大空闲时间 (建议值：*)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
<li><p>数据库连接数  mysql <code> max_connections</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1000~5000 并行连接</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-%E5%88%86%E6%9E%90%EF%BC%88%E9%98%BF%E9%87%8C%E4%BA%91%20PTS,Lite%EF%BC%89/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-%E5%B7%A5%E5%85%B7%E7%AE%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-%E5%B7%A5%E5%85%B7%E7%AE%B1/" class="post-title-link" itemprop="url">压力测试-工具箱</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-24 00:00:00" itemprop="dateCreated datePublished" datetime="2016-05-24T00:00:00+00:00">2016-05-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:28" itemprop="dateModified" datetime="2024-01-26T12:42:28+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">压力测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="linux服务器"><a href="#linux服务器" class="headerlink" title="linux服务器"></a>linux服务器</h1><ul>
<li><p>ab<br>ab全称为apache benchmark是apache自带的一个性能测试工具，位于apache安装目录下的bin目录下<br>注意事项:<br>不支持参数化<br>url必须在引号内，否则只识别url?后的第一个参数</p>
</li>
<li><p>http_load<br>http_load是基于linux平台的性能测试工具，它体积非常小，仅100KB。它以并行复用的方式运行，可以测试web服务器的吞吐量与负载。<br>httpd_load的官方站是： <a target="_blank" rel="noopener" href="http://www.acme.com/software/http_load/">http://www.acme.com/software/http_load/</a></p>
</li>
<li><p>webbench<br>webbench是Linux下的一个网站压力测试工具,最多可以模拟3万个并发连接去</p>
</li>
<li><p>siege<br>siege包含了一组压力测试工具：<br>SIEGE (1) Siege是一个HTTP压力测试和评测工具.</p>
</li>
<li><p>httperf<br>httperf是个web 服务器的性能测试工具</p>
</li>
<li><p>Pylot<br>Windows平台使用的Web压力测试工具：Pylot</p>
</li>
<li><p>更多  siege,tcpcopy,Apache JMeter</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/buger/gor">https://github.com/buger/gor</a><br><a target="_blank" rel="noopener" href="https://github.com/wg/wrk">https://github.com/wg/wrk</a></p>
<h1 id="web服务"><a href="#web服务" class="headerlink" title="web服务"></a>web服务</h1><ul>
<li>阿里云 PTS (Performance Testing)<br>包括提供简单易用的性能测试脚本模板模式和代码模式、测试场景配置、测试执行及执行数据实时展示，还有提供完善的性能结果报表和强大的性能分析图形展示<br>版本： <code>企业版</code>  <code>lite版</code><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/93270732.jpg"></li>
</ul>
<p><code>PTS和Lite版有什么区别</code><br><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/7598814.html?pos=2">https://help.aliyun.com/knowledge_detail/7598814.html?pos=2</a></p>
<ul>
<li><p>腾讯wetest<br>这个压测工具  <a target="_blank" rel="noopener" href="http://wetest.qq.com/gaps/">http://wetest.qq.com/gaps/</a></p>
</li>
<li><p>Load Impact、loader.io</p>
</li>
</ul>
<p><strong>参考</strong><br><code>网站压力性能免费在线测试：阿里云PTS,Load Impact,loader.io服务器负载能力测试 | 免费资源部落</code><br><a target="_blank" rel="noopener" href="http://www.freehao123.com/pts-loader-io/">http://www.freehao123.com/pts-loader-io/</a></p>
<ul>
<li>压测宝<br><a target="_blank" rel="noopener" href="http://yacebao.com/">http://yacebao.com/</a></li>
</ul>
<h1 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h1><ul>
<li><p>LoadRunner（商业软件）<br>LoadRunner 是一种预测系统行为和性能的工业标准级负载测试工具。通过以模拟上千万用户实施并发负载及实时性能监测的方式来确认和查找问题，LoadRunner 能够对整个企业架构进行测试。通过使用LoadRunner ， 企业能最大限度地缩短测试时间， 优化性能和加速应用系统的发布周期。企业的网络应用环境都必须支持大量用户，网络体系架构中含各类应用环境且由不同供应商提供软件和硬件产品。难以预知的用户负载和愈来愈复杂的应用环境使公司时时担心会发生用户响应速度过慢， 系统崩溃等问题。这些都不可避免地导致公司收益的损失。Mercury Interactive 的 LoadRunner 能让企业保护自己的收入来源， 无需购置额外硬件而最大限度地利用现有的IT 资源， 并确保终端用户在应用系统的各个环节中对其测试应用的质量， 可靠性和可扩展性都有良好的评价。LoadRunner 是一种适用于各种体系架构的自动负载测试工具， 它能预测系统行为并优化系统性能。LoadRunner 的测试对象是整个企业的系统， 它通过模拟实际用户的操作行为和实行实时性能监测， 来帮助您更快的查找和发现问题。此外，LoadRunner 能支持广范的协议和技术， 为您的特殊环境提供特殊的解决方案。</p>
</li>
<li><p>SoapUI</p>
</li>
</ul>
<p>专业接口测试</p>
<ul>
<li><p>Pylot (基于 python )<br>适合在Windows电脑上运行的服务器压力测试程序</p>
</li>
<li><p>JMeter<br>Apache JMeter是Apache组织开发的基于Java的压力测试工具</p>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95-%E5%B7%A5%E5%85%B7%E7%AE%B1/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Lucene-6-0-in-action-4-The-text-analyzer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Lucene-6-0-in-action-4-The-text-analyzer/" class="post-title-link" itemprop="url">Lucene 6.0 实战（4）-文本分析器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-23 23:30:05" itemprop="dateCreated datePublished" datetime="2016-05-23T23:30:05+00:00">2016-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:18" itemprop="dateModified" datetime="2024-01-26T12:42:18+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Analyzer简介"><a href="#Analyzer简介" class="headerlink" title="Analyzer简介"></a>Analyzer简介</h3><p>在Lucene的org.apache.lucene.analysis模块中提供了顶层的抽象类Analyzer，Analyzer主要是用来构建TokenStreams，如果想实现自定义的Analyzer，必须覆写createComponents(String)方法，并定义自己的TokenStreamComponents。</p>
<p>为什么要有Analyzer呢？对于Lucene而言，不管是索引还是检索，都是针对纯文本而言，对于纯文本的来源可以是PDF，Word，Excel，PPT，HTML等，Lucene对此并不关心，只要保证传递给Lucene的是纯文本即可。</p>
<p>而通常情况下，对于大量的文本，用户在检索的时候不可能全部输入，例如有文本“Hello World，I’am javaer!”，用户在检索的时候可能只是输入了“Hello”，这里就需要Lucene索引该文本的时候预先对文本进行切分，这样在检索的时候才能将词源和文本对应起来。</p>
<p>Lucene常用分析器整理如下</p>
<table>
<thead>
<tr>
<th>分析器</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>WhitespaceAnalyzer</td>
<td>根据空格拆分语汇单元</td>
</tr>
<tr>
<td>SimpleAnalyzer</td>
<td>根据非字母拆分文本，并将其转换为小写形式</td>
</tr>
<tr>
<td>StopAnalyzer</td>
<td>根据非字母拆分文本，然后小写化，再移除停用词</td>
</tr>
<tr>
<td>KeywordAnalyzer</td>
<td>将整个文本作为一个单一语汇单元处理</td>
</tr>
<tr>
<td>StandardAnalyzer</td>
<td>根据Unicode文本分割算法，具体算法参考<a target="_blank" rel="noopener" href="http://unicode.org/reports/tr29/">Unicode Standard Annex #29</a>，然后将文本转化为小写，并移除英文停用词</td>
</tr>
<tr>
<td>SmartChineseAnalyzer</td>
<td>SmartChineseAnalyzer 是一个智能中文分词模块，能够利用概率对汉语句子进行最优切分，并内嵌英文 tokenizer，能有效处理中英文混合的文本内容。它的原理基于自然语言处理领域的隐马尔科夫模型（HMM），利用大量语料库的训练来统计汉语词汇的词频和跳转概率，从而根据这些统计结果对整个汉语句子计算最似然（likelihood）的切分。因为智能分词需要词典来保存词汇的统计值，SmartChineseAnalyzer 的运行需要指定词典位置，如何指定词典位置请参考org.apache.lucene.analysis.cn.smart.AnalyzerProfile。SmartChineseAnalyzer 的算法和语料库词典来自于<a target="_blank" rel="noopener" href="http://ictclas.nlpir.org/downloads">ICTCLAS</a></td>
</tr>
<tr>
<td>CJKAnalyzer</td>
<td>CJK表示中日韩，目的是要把分别来自中文、日文、韩文、越文中，本质、意义相同、形状一样或稍异的表意文字（主要为汉字，但也有仿汉字如日本国字、韩国独有汉字、越南的喃字）在ISO 10646 及 Unicode 标准内赋予相同编码。对于中文是交叉双字分割，二元分词法</td>
</tr>
</tbody></table>
<h3 id="Analyzer部分子类分词示例"><a href="#Analyzer部分子类分词示例" class="headerlink" title="Analyzer部分子类分词示例"></a>Analyzer部分子类分词示例</h3><p>选取了六个实现类，并分别输出它们对英文、中文、特殊符号及邮箱等的切分效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnalyzerDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] examples = &#123;<span class="string">&quot;The quick brown 1234 fox jumped over the lazy dog!&quot;</span>, <span class="string">&quot;XY&amp;Z 15.6 Corporation - xyz@example.com&quot;</span>,</span><br><span class="line">            <span class="string">&quot;北京市北京大学&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Analyzer[] ANALYZERS = <span class="keyword">new</span> <span class="title class_">Analyzer</span>[]&#123;<span class="keyword">new</span> <span class="title class_">WhitespaceAnalyzer</span>(), <span class="keyword">new</span> <span class="title class_">SimpleAnalyzer</span>(), <span class="keyword">new</span> <span class="title class_">StopAnalyzer</span>(), <span class="keyword">new</span></span><br><span class="line">            <span class="title class_">StandardAnalyzer</span>(), <span class="keyword">new</span> <span class="title class_">CJKAnalyzer</span>(), <span class="keyword">new</span> <span class="title class_">SmartChineseAnalyzer</span>()&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnalyzer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ANALYZERS.length; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">simpleName</span> <span class="operator">=</span> ANALYZERS[i].getClass().getSimpleName();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; examples.length; j++) &#123;</span><br><span class="line">                <span class="type">TokenStream</span> <span class="variable">contents</span> <span class="operator">=</span> ANALYZERS[i].tokenStream(<span class="string">&quot;contents&quot;</span>, examples[j]);</span><br><span class="line">                <span class="comment">//TokenStream contents = ANALYZERS[i].tokenStream(&quot;contents&quot;, new StringReader(examples[j]));</span></span><br><span class="line">                <span class="type">OffsetAttribute</span> <span class="variable">offsetAttribute</span> <span class="operator">=</span> contents.addAttribute(OffsetAttribute.class);</span><br><span class="line">                <span class="type">TypeAttribute</span> <span class="variable">typeAttribute</span> <span class="operator">=</span> contents.addAttribute(TypeAttribute.class);</span><br><span class="line">                contents.reset();</span><br><span class="line">                System.out.println(simpleName + <span class="string">&quot; analyzing : &quot;</span> + examples[j]);</span><br><span class="line">                <span class="keyword">while</span> (contents.incrementToken()) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> offsetAttribute.toString();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> offsetAttribute.startOffset();<span class="comment">//起始偏移量</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> offsetAttribute.endOffset();<span class="comment">//结束偏移量</span></span><br><span class="line">                    System.out.print(s1 + <span class="string">&quot;[&quot;</span> + i1 + <span class="string">&quot;,&quot;</span> + i2 + <span class="string">&quot;:&quot;</span> + typeAttribute.type() + <span class="string">&quot;]&quot;</span> + <span class="string">&quot; &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                contents.end();</span><br><span class="line">                contents.close();</span><br><span class="line">                System.out.println();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">WhitespaceAnalyzer analyzing : The quick brown <span class="number">1234</span> fox jumped over the lazy dog!</span><br><span class="line">The[<span class="number">0</span>,<span class="number">3</span>:word] quick[<span class="number">4</span>,<span class="number">9</span>:word] brown[<span class="number">10</span>,<span class="number">15</span>:word] <span class="number">1234</span>[<span class="number">16</span>,<span class="number">20</span>:word] fox[<span class="number">21</span>,<span class="number">24</span>:word] jumped[<span class="number">25</span>,<span class="number">31</span>:word] over[<span class="number">32</span>,<span class="number">36</span>:word] the[<span class="number">37</span>,<span class="number">40</span>:word] lazy[<span class="number">41</span>,<span class="number">45</span>:word] dog![<span class="number">46</span>,<span class="number">50</span>:word] </span><br><span class="line">WhitespaceAnalyzer analyzing : XY&amp;Z <span class="number">15.6</span> Corporation - xyz<span class="meta">@example</span>.com</span><br><span class="line">XY&amp;Z[<span class="number">0</span>,<span class="number">4</span>:word] <span class="number">15.6</span>[<span class="number">5</span>,<span class="number">9</span>:word] Corporation[<span class="number">10</span>,<span class="number">21</span>:word] -[<span class="number">22</span>,<span class="number">23</span>:word] xyz<span class="meta">@example</span>.com[<span class="number">24</span>,<span class="number">39</span>:word] </span><br><span class="line">WhitespaceAnalyzer analyzing : 北京市北京大学</span><br><span class="line">北京市北京大学[<span class="number">0</span>,<span class="number">7</span>:word] </span><br><span class="line">SimpleAnalyzer analyzing : The quick brown <span class="number">1234</span> fox jumped over the lazy dog!</span><br><span class="line">the[<span class="number">0</span>,<span class="number">3</span>:word] quick[<span class="number">4</span>,<span class="number">9</span>:word] brown[<span class="number">10</span>,<span class="number">15</span>:word] fox[<span class="number">21</span>,<span class="number">24</span>:word] jumped[<span class="number">25</span>,<span class="number">31</span>:word] over[<span class="number">32</span>,<span class="number">36</span>:word] the[<span class="number">37</span>,<span class="number">40</span>:word] lazy[<span class="number">41</span>,<span class="number">45</span>:word] dog[<span class="number">46</span>,<span class="number">49</span>:word] </span><br><span class="line">SimpleAnalyzer analyzing : XY&amp;Z <span class="number">15.6</span> Corporation - xyz<span class="meta">@example</span>.com</span><br><span class="line">xy[<span class="number">0</span>,<span class="number">2</span>:word] z[<span class="number">3</span>,<span class="number">4</span>:word] corporation[<span class="number">10</span>,<span class="number">21</span>:word] xyz[<span class="number">24</span>,<span class="number">27</span>:word] example[<span class="number">28</span>,<span class="number">35</span>:word] com[<span class="number">36</span>,<span class="number">39</span>:word] </span><br><span class="line">SimpleAnalyzer analyzing : 北京市北京大学</span><br><span class="line">北京市北京大学[<span class="number">0</span>,<span class="number">7</span>:word] </span><br><span class="line">StopAnalyzer analyzing : The quick brown <span class="number">1234</span> fox jumped over the lazy dog!</span><br><span class="line">quick[<span class="number">4</span>,<span class="number">9</span>:word] brown[<span class="number">10</span>,<span class="number">15</span>:word] fox[<span class="number">21</span>,<span class="number">24</span>:word] jumped[<span class="number">25</span>,<span class="number">31</span>:word] over[<span class="number">32</span>,<span class="number">36</span>:word] lazy[<span class="number">41</span>,<span class="number">45</span>:word] dog[<span class="number">46</span>,<span class="number">49</span>:word] </span><br><span class="line">StopAnalyzer analyzing : XY&amp;Z <span class="number">15.6</span> Corporation - xyz<span class="meta">@example</span>.com</span><br><span class="line">xy[<span class="number">0</span>,<span class="number">2</span>:word] z[<span class="number">3</span>,<span class="number">4</span>:word] corporation[<span class="number">10</span>,<span class="number">21</span>:word] xyz[<span class="number">24</span>,<span class="number">27</span>:word] example[<span class="number">28</span>,<span class="number">35</span>:word] com[<span class="number">36</span>,<span class="number">39</span>:word] </span><br><span class="line">StopAnalyzer analyzing : 北京市北京大学</span><br><span class="line">北京市北京大学[<span class="number">0</span>,<span class="number">7</span>:word] </span><br><span class="line">StandardAnalyzer analyzing : The quick brown <span class="number">1234</span> fox jumped over the lazy dog!</span><br><span class="line">quick[<span class="number">4</span>,<span class="number">9</span>:&lt;ALPHANUM&gt;] brown[<span class="number">10</span>,<span class="number">15</span>:&lt;ALPHANUM&gt;] <span class="number">1234</span>[<span class="number">16</span>,<span class="number">20</span>:&lt;NUM&gt;] fox[<span class="number">21</span>,<span class="number">24</span>:&lt;ALPHANUM&gt;] jumped[<span class="number">25</span>,<span class="number">31</span>:&lt;ALPHANUM&gt;] over[<span class="number">32</span>,<span class="number">36</span>:&lt;ALPHANUM&gt;] lazy[<span class="number">41</span>,<span class="number">45</span>:&lt;ALPHANUM&gt;] dog[<span class="number">46</span>,<span class="number">49</span>:&lt;ALPHANUM&gt;] </span><br><span class="line">StandardAnalyzer analyzing : XY&amp;Z <span class="number">15.6</span> Corporation - xyz<span class="meta">@example</span>.com</span><br><span class="line">xy[<span class="number">0</span>,<span class="number">2</span>:&lt;ALPHANUM&gt;] z[<span class="number">3</span>,<span class="number">4</span>:&lt;ALPHANUM&gt;] <span class="number">15.6</span>[<span class="number">5</span>,<span class="number">9</span>:&lt;NUM&gt;] corporation[<span class="number">10</span>,<span class="number">21</span>:&lt;ALPHANUM&gt;] xyz[<span class="number">24</span>,<span class="number">27</span>:&lt;ALPHANUM&gt;] example.com[<span class="number">28</span>,<span class="number">39</span>:&lt;ALPHANUM&gt;] </span><br><span class="line">StandardAnalyzer analyzing : 北京市北京大学</span><br><span class="line">北[<span class="number">0</span>,<span class="number">1</span>:&lt;IDEOGRAPHIC&gt;] 京[<span class="number">1</span>,<span class="number">2</span>:&lt;IDEOGRAPHIC&gt;] 市[<span class="number">2</span>,<span class="number">3</span>:&lt;IDEOGRAPHIC&gt;] 北[<span class="number">3</span>,<span class="number">4</span>:&lt;IDEOGRAPHIC&gt;] 京[<span class="number">4</span>,<span class="number">5</span>:&lt;IDEOGRAPHIC&gt;] 大[<span class="number">5</span>,<span class="number">6</span>:&lt;IDEOGRAPHIC&gt;] 学[<span class="number">6</span>,<span class="number">7</span>:&lt;IDEOGRAPHIC&gt;] </span><br><span class="line">CJKAnalyzer analyzing : The quick brown <span class="number">1234</span> fox jumped over the lazy dog!</span><br><span class="line">quick[<span class="number">4</span>,<span class="number">9</span>:&lt;ALPHANUM&gt;] brown[<span class="number">10</span>,<span class="number">15</span>:&lt;ALPHANUM&gt;] <span class="number">1234</span>[<span class="number">16</span>,<span class="number">20</span>:&lt;NUM&gt;] fox[<span class="number">21</span>,<span class="number">24</span>:&lt;ALPHANUM&gt;] jumped[<span class="number">25</span>,<span class="number">31</span>:&lt;ALPHANUM&gt;] over[<span class="number">32</span>,<span class="number">36</span>:&lt;ALPHANUM&gt;] lazy[<span class="number">41</span>,<span class="number">45</span>:&lt;ALPHANUM&gt;] dog[<span class="number">46</span>,<span class="number">49</span>:&lt;ALPHANUM&gt;] </span><br><span class="line">CJKAnalyzer analyzing : XY&amp;Z <span class="number">15.6</span> Corporation - xyz<span class="meta">@example</span>.com</span><br><span class="line">xy[<span class="number">0</span>,<span class="number">2</span>:&lt;ALPHANUM&gt;] z[<span class="number">3</span>,<span class="number">4</span>:&lt;ALPHANUM&gt;] <span class="number">15.6</span>[<span class="number">5</span>,<span class="number">9</span>:&lt;NUM&gt;] corporation[<span class="number">10</span>,<span class="number">21</span>:&lt;ALPHANUM&gt;] xyz[<span class="number">24</span>,<span class="number">27</span>:&lt;ALPHANUM&gt;] example.com[<span class="number">28</span>,<span class="number">39</span>:&lt;ALPHANUM&gt;] </span><br><span class="line">CJKAnalyzer analyzing : 北京市北京大学</span><br><span class="line">北京[<span class="number">0</span>,<span class="number">2</span>:&lt;DOUBLE&gt;] 京市[<span class="number">1</span>,<span class="number">3</span>:&lt;DOUBLE&gt;] 市北[<span class="number">2</span>,<span class="number">4</span>:&lt;DOUBLE&gt;] 北京[<span class="number">3</span>,<span class="number">5</span>:&lt;DOUBLE&gt;] 京大[<span class="number">4</span>,<span class="number">6</span>:&lt;DOUBLE&gt;] 大学[<span class="number">5</span>,<span class="number">7</span>:&lt;DOUBLE&gt;] </span><br><span class="line">SmartChineseAnalyzer analyzing : The quick brown <span class="number">1234</span> fox jumped over the lazy dog!</span><br><span class="line">the[<span class="number">0</span>,<span class="number">3</span>:word] quick[<span class="number">4</span>,<span class="number">9</span>:word] brown[<span class="number">10</span>,<span class="number">15</span>:word] <span class="number">1234</span>[<span class="number">16</span>,<span class="number">20</span>:word] fox[<span class="number">21</span>,<span class="number">24</span>:word] jump[<span class="number">25</span>,<span class="number">31</span>:word] over[<span class="number">32</span>,<span class="number">36</span>:word] the[<span class="number">37</span>,<span class="number">40</span>:word] lazi[<span class="number">41</span>,<span class="number">45</span>:word] dog[<span class="number">46</span>,<span class="number">49</span>:word] </span><br><span class="line">SmartChineseAnalyzer analyzing : XY&amp;Z <span class="number">15.6</span> Corporation - xyz<span class="meta">@example</span>.com</span><br><span class="line">xy[<span class="number">0</span>,<span class="number">2</span>:word] z[<span class="number">3</span>,<span class="number">4</span>:word] <span class="number">15</span>[<span class="number">5</span>,<span class="number">7</span>:word] <span class="number">6</span>[<span class="number">8</span>,<span class="number">9</span>:word] corpor[<span class="number">10</span>,<span class="number">21</span>:word] xyz[<span class="number">24</span>,<span class="number">27</span>:word] exampl[<span class="number">28</span>,<span class="number">35</span>:word] com[<span class="number">36</span>,<span class="number">39</span>:word] </span><br><span class="line">SmartChineseAnalyzer analyzing : 北京市北京大学</span><br><span class="line">北京市[<span class="number">0</span>,<span class="number">3</span>:word] 北京大学[<span class="number">3</span>,<span class="number">7</span>:word]</span><br></pre></td></tr></table></figure>

<h3 id="Analyzer之TokenStream"><a href="#Analyzer之TokenStream" class="headerlink" title="Analyzer之TokenStream"></a>Analyzer之TokenStream</h3><p>TokenStream是分析处理组件中的一种中间数据格式，它从一个reader中获取文本，并以TokenStream作为输出结果。在所有的过滤器中，TokenStream同时充当着输入和输出格式。Tokenizer和TokenFilter继承自TokenStream，Tokenizer是一个TokenStream，其输入源是一个Reader；TokenFilter也是一个TokenStream，其输入源是另一个TokenStream。而TokenStream简单点说就是生成器的输出结果。TokenStream是一个分词后的Token结果组成的流，通过流能够不断的得到下一个Token。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTokenStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Analyzer</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WhitespaceAnalyzer</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">inputText</span> <span class="operator">=</span> <span class="string">&quot;This is a test text for token!&quot;</span>;</span><br><span class="line">    <span class="type">TokenStream</span> <span class="variable">tokenStream</span> <span class="operator">=</span> analyzer.tokenStream(<span class="string">&quot;text&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringReader</span>(inputText));</span><br><span class="line">    <span class="comment">//保存token字符串</span></span><br><span class="line">    <span class="type">CharTermAttribute</span> <span class="variable">charTermAttribute</span> <span class="operator">=</span> tokenStream.addAttribute(CharTermAttribute.class);</span><br><span class="line">    <span class="comment">//在调用incrementToken()开始消费token之前需要重置stream到一个干净的状态</span></span><br><span class="line">    tokenStream.reset();</span><br><span class="line">    <span class="keyword">while</span> (tokenStream.incrementToken()) &#123;</span><br><span class="line">        <span class="comment">//打印分词结果</span></span><br><span class="line">        System.out.print(<span class="string">&quot;[&quot;</span> + charTermAttribute + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<blockquote>
<p>[This][is][a][test][text][for][token!]</p>
</blockquote>
<h3 id="Analyzer之TokenAttribute"><a href="#Analyzer之TokenAttribute" class="headerlink" title="Analyzer之TokenAttribute"></a>Analyzer之TokenAttribute</h3><p>在调用tokenStream()方法之后，我们可以通过为之添加多个Attribute，从而可以了解到分词之后详细的词元信息，比如CharTermAttribute用于保存词元的内容，TypeAttribute用于保存词元的类型。</p>
<p>在Lucene中提供了几种类型的Attribute，每种类型的Attribute提供一个不同的方面或者token的元数据，罗列如下</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>CharTermAttribute</td>
<td>表示token本身的内容</td>
</tr>
<tr>
<td>PositionIncrementAttribute</td>
<td>表示当前token相对于前一个token的相对位置，也就是相隔的词语数量（例如“text for attribute”，text和attribute之间的getPositionIncrement为2），如果两者之间没有停用词，那么该值被置为默认值1</td>
</tr>
<tr>
<td>OffsetAttribute</td>
<td>表示token的首字母和尾字母在原文本中的位置</td>
</tr>
<tr>
<td>TypeAttribute</td>
<td>表示token的词汇类型信息，默认值为word，其它值有&lt;ALPHANUM&gt; &lt;APOSTROPHE&gt; &lt;ACRONYM&gt; &lt;COMPANY&gt; &lt;EMAIL&gt; &lt;HOST&gt; &lt;NUM&gt; &lt;CJ&gt; &lt;ACRONYM_DEP&gt;</td>
</tr>
<tr>
<td>FlagsAttribute</td>
<td>与TypeAttribute类似，假设你需要给token添加额外的信息，而且希望该信息可以通过分析链，那么就可以通过flags去传递</td>
</tr>
<tr>
<td>PayloadAttribute</td>
<td>在每个索引位置都存储了payload（关键信息），当使用基于Payload的查询时，该信息在评分中非常有用</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAttribute</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Analyzer</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">&quot;This is a test text for attribute! Just add-some word.&quot;</span>;</span><br><span class="line">    <span class="type">TokenStream</span> <span class="variable">tokenStream</span> <span class="operator">=</span> analyzer.tokenStream(<span class="string">&quot;text&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringReader</span>(input));</span><br><span class="line">    <span class="type">CharTermAttribute</span> <span class="variable">charTermAttribute</span> <span class="operator">=</span> tokenStream.addAttribute(CharTermAttribute.class);</span><br><span class="line">    <span class="type">PositionIncrementAttribute</span> <span class="variable">positionIncrementAttribute</span> <span class="operator">=</span> tokenStream.addAttribute(PositionIncrementAttribute.class);</span><br><span class="line">    <span class="type">OffsetAttribute</span> <span class="variable">offsetAttribute</span> <span class="operator">=</span> tokenStream.addAttribute(OffsetAttribute.class);</span><br><span class="line">    <span class="type">TypeAttribute</span> <span class="variable">typeAttribute</span> <span class="operator">=</span> tokenStream.addAttribute(TypeAttribute.class);</span><br><span class="line">    <span class="type">PayloadAttribute</span> <span class="variable">payloadAttribute</span> <span class="operator">=</span> tokenStream.addAttribute(PayloadAttribute.class);</span><br><span class="line">    payloadAttribute.setPayload(<span class="keyword">new</span> <span class="title class_">BytesRef</span>(<span class="string">&quot;Just&quot;</span>));</span><br><span class="line">    tokenStream.reset();</span><br><span class="line">    <span class="keyword">while</span> (tokenStream.incrementToken()) &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;[&quot;</span> + charTermAttribute + <span class="string">&quot; increment:&quot;</span> + positionIncrementAttribute.getPositionIncrement() +</span><br><span class="line">                <span class="string">&quot; start:&quot;</span> + offsetAttribute</span><br><span class="line">                .startOffset() + <span class="string">&quot; end:&quot;</span> +</span><br><span class="line">                offsetAttribute</span><br><span class="line">                        .endOffset() + <span class="string">&quot; type:&quot;</span> + typeAttribute.type() + <span class="string">&quot; payload:&quot;</span> + payloadAttribute.getPayload() +</span><br><span class="line">                <span class="string">&quot;]\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tokenStream.end();</span><br><span class="line">    tokenStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在调用incrementToken()结束迭代之后，调用end()和close()方法，其中end()可以唤醒当前TokenStream的处理器去做一些收尾工作，close()可以关闭TokenStream和Analyzer去释放在分析过程中使用的资源。</p>
<p>输出结果如下，其中停用词被分词器过滤掉了</p>
<blockquote>
<p>[test increment:4 start:10 end:14 type:<ALPHANUM> payload:null]<br>[text increment:1 start:15 end:19 type:<ALPHANUM> payload:null]<br>[attribute increment:2 start:24 end:33 type:<ALPHANUM> payload:null]<br>[just increment:1 start:35 end:39 type:<ALPHANUM> payload:null]<br>[add increment:1 start:40 end:43 type:<ALPHANUM> payload:null]<br>[some increment:1 start:44 end:48 type:<ALPHANUM> payload:null]<br>[word increment:1 start:49 end:53 type:<ALPHANUM> payload:null]</p>
</blockquote>
<h3 id="Analyzer之TokenFilter"><a href="#Analyzer之TokenFilter" class="headerlink" title="Analyzer之TokenFilter"></a>Analyzer之TokenFilter</h3><p>TokenFilter主要用于TokenStream的过滤操作，用来处理Tokenizer或者上一个TokenFilter处理后的结果，如果是对现有分词器进行扩展或修改，推荐使用自定义TokenFilter方式。自定义TokenFilter需要实现incrementToken()抽象函数，并且该方法需要声明为final的，在此函数中对过滤Term的CharTermAttribute和PositionIncrementAttribute等属性进行操作，就能实现过滤功能，例如一个简单的词扩展过滤器如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.Analyzer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.TokenStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.core.WhitespaceAnalyzer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.tokenattributes.CharTermAttribute;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTokenFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> <span class="string">&quot;Hi, Dr Wang, Mr Liu asks if you stay with Mrs Liu yesterday!&quot;</span>;</span><br><span class="line">        <span class="type">Analyzer</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WhitespaceAnalyzer</span>();</span><br><span class="line">        <span class="type">CourtesyTitleFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CourtesyTitleFilter</span>(analyzer.tokenStream(<span class="string">&quot;text&quot;</span>, text));</span><br><span class="line">        <span class="type">CharTermAttribute</span> <span class="variable">charTermAttribute</span> <span class="operator">=</span> filter.addAttribute(CharTermAttribute.class);</span><br><span class="line">        filter.reset();</span><br><span class="line">        <span class="keyword">while</span> (filter.incrementToken()) &#123;</span><br><span class="line">            System.out.print(charTermAttribute + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义词扩展过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CourtesyTitleFilter</span> <span class="keyword">extends</span> <span class="title class_">TokenFilter</span> &#123;</span><br><span class="line">    Map&lt;String, String&gt; courtesyTitleMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> CharTermAttribute termAttribute;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Construct a token stream filtering the given input.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> input</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">CourtesyTitleFilter</span><span class="params">(TokenStream input)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(input);</span><br><span class="line">        termAttribute = addAttribute(CharTermAttribute.class);</span><br><span class="line">        courtesyTitleMap.put(<span class="string">&quot;Dr&quot;</span>, <span class="string">&quot;doctor&quot;</span>);</span><br><span class="line">        courtesyTitleMap.put(<span class="string">&quot;Mr&quot;</span>, <span class="string">&quot;mister&quot;</span>);</span><br><span class="line">        courtesyTitleMap.put(<span class="string">&quot;Mrs&quot;</span>, <span class="string">&quot;miss&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">incrementToken</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!input.incrementToken()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">small</span> <span class="operator">=</span> termAttribute.toString();</span><br><span class="line">        <span class="keyword">if</span> (courtesyTitleMap.containsKey(small)) &#123;</span><br><span class="line">            termAttribute.setEmpty().append(courtesyTitleMap.get(small));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<blockquote>
<p>Hi, doctor Wang, mister Liu asks if you stay with miss Liu yesterday!</p>
</blockquote>
<h3 id="自定义Analyzer实现扩展停用词"><a href="#自定义Analyzer实现扩展停用词" class="headerlink" title="自定义Analyzer实现扩展停用词"></a>自定义Analyzer实现扩展停用词</h3><ol>
<li>继承自Analyzer并覆写createComponents(String)方法</li>
<li>维护自己的停用词词典</li>
<li>重写TokenStreamComponents，选择合适的过滤策略</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StopAnalyzerExtend</span> <span class="keyword">extends</span> <span class="title class_">Analyzer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CharArraySet stopWordSet;<span class="comment">//停止词词典</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CharArraySet <span class="title function_">getStopWordSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.stopWordSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStopWordSet</span><span class="params">(CharArraySet stopWordSet)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stopWordSet = stopWordSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StopAnalyzerExtend</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        setStopWordSet(StopAnalyzer.ENGLISH_STOP_WORDS_SET);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stops 需要扩展的停止词</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StopAnalyzerExtend</span><span class="params">(List&lt;String&gt; stops)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>();</span><br><span class="line">        <span class="comment">/**如果直接为stopWordSet赋值的话，会报如下异常，这是因为在StopAnalyzer中有ENGLISH_STOP_WORDS_SET = CharArraySet.unmodifiableSet(stopSet);</span></span><br><span class="line"><span class="comment">         * ENGLISH_STOP_WORDS_SET 被设置为不可更改的set集合</span></span><br><span class="line"><span class="comment">         * Exception in thread &quot;main&quot; java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">         * at org.apache.lucene.analysis.util.CharArrayMap$UnmodifiableCharArrayMap.put(CharArrayMap.java:592)</span></span><br><span class="line"><span class="comment">         * at org.apache.lucene.analysis.util.CharArraySet.add(CharArraySet.java:105)</span></span><br><span class="line"><span class="comment">         * at java.util.AbstractCollection.addAll(AbstractCollection.java:344)</span></span><br><span class="line"><span class="comment">         * at MyAnalyzer.&lt;init&gt;(AnalyzerDemo.java:146)</span></span><br><span class="line"><span class="comment">         * at MyAnalyzer.main(AnalyzerDemo.java:162)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//stopWordSet = getStopWordSet();</span></span><br><span class="line">        stopWordSet = CharArraySet.copy(getStopWordSet());</span><br><span class="line">        stopWordSet.addAll(StopFilter.makeStopSet(stops));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> TokenStreamComponents <span class="title function_">createComponents</span><span class="params">(String fieldName)</span> &#123;</span><br><span class="line">        <span class="type">Tokenizer</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LowerCaseTokenizer</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TokenStreamComponents</span>(source, <span class="keyword">new</span> <span class="title class_">StopFilter</span>(source, stopWordSet));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        ArrayList&lt;String&gt; strings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;() &#123;&#123;</span><br><span class="line">            add(<span class="string">&quot;小鬼子&quot;</span>);</span><br><span class="line">            add(<span class="string">&quot;美国佬&quot;</span>);</span><br><span class="line">        &#125;&#125;;</span><br><span class="line">        <span class="type">Analyzer</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopAnalyzerExtend</span>(strings);</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;小鬼子 and 美国佬 are playing together!&quot;</span>;</span><br><span class="line">        <span class="type">TokenStream</span> <span class="variable">tokenStream</span> <span class="operator">=</span> analyzer.tokenStream(<span class="string">&quot;myfield&quot;</span>, content);</span><br><span class="line">        tokenStream.reset();</span><br><span class="line">        <span class="type">CharTermAttribute</span> <span class="variable">charTermAttribute</span> <span class="operator">=</span> tokenStream.addAttribute(CharTermAttribute.class);</span><br><span class="line">        <span class="keyword">while</span> (tokenStream.incrementToken()) &#123;</span><br><span class="line">            <span class="comment">// 已经过滤掉自定义停用词</span></span><br><span class="line">            <span class="comment">// 输出：playing   together</span></span><br><span class="line">            System.out.println(charTermAttribute.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        tokenStream.end();</span><br><span class="line">        tokenStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义Analyzer实现字长过滤"><a href="#自定义Analyzer实现字长过滤" class="headerlink" title="自定义Analyzer实现字长过滤"></a>自定义Analyzer实现字长过滤</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LongFilterAnalyzer</span> <span class="keyword">extends</span> <span class="title class_">Analyzer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.len;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLen</span><span class="params">(<span class="type">int</span> len)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.len = len;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LongFilterAnalyzer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LongFilterAnalyzer</span><span class="params">(<span class="type">int</span> len)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        setLen(len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> TokenStreamComponents <span class="title function_">createComponents</span><span class="params">(String fieldName)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Tokenizer</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WhitespaceTokenizer</span>();</span><br><span class="line">        <span class="comment">//过滤掉长度&lt;len，并且&gt;20的token</span></span><br><span class="line">        <span class="type">TokenStream</span> <span class="variable">tokenStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LengthFilter</span>(source, len, <span class="number">20</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TokenStreamComponents</span>(source, tokenStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//把长度小于2的过滤掉，开区间</span></span><br><span class="line">        <span class="type">Analyzer</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongFilterAnalyzer</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">words</span> <span class="operator">=</span> <span class="string">&quot;I am a java coder! Testingtestingtesting!&quot;</span>;</span><br><span class="line">        <span class="type">TokenStream</span> <span class="variable">stream</span> <span class="operator">=</span> analyzer.tokenStream(<span class="string">&quot;myfield&quot;</span>, words);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stream.reset();</span><br><span class="line">            <span class="type">CharTermAttribute</span> <span class="variable">offsetAtt</span> <span class="operator">=</span> stream.addAttribute(CharTermAttribute.class);</span><br><span class="line">            <span class="keyword">while</span> (stream.incrementToken()) &#123;</span><br><span class="line">                System.out.println(offsetAtt.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            stream.end();</span><br><span class="line">            stream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">am</span><br><span class="line">java</span><br><span class="line">coder!</span><br></pre></td></tr></table></figure>
<p>可以看到，长度小于两个字符的文本都被过滤掉了。</p>
<h3 id="Analyzer之PerFieldAnalyzerWrapper"><a href="#Analyzer之PerFieldAnalyzerWrapper" class="headerlink" title="Analyzer之PerFieldAnalyzerWrapper"></a>Analyzer之PerFieldAnalyzerWrapper</h3><p>PerFieldAnalyzerWrapper的doc注释中提供了详细的说明，该类提供处理不同的Field使用不同的Analyzer的技术方案。PerFieldAnalyzerWrapper可以像其它的Analyzer一样使用，包括索引和查询分析。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPerFieldAnalyzerWrapper</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ParseException &#123;</span><br><span class="line">    Map&lt;String, Analyzer&gt; fields = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    fields.put(<span class="string">&quot;partnum&quot;</span>, <span class="keyword">new</span> <span class="title class_">KeywordAnalyzer</span>());</span><br><span class="line">    <span class="comment">//对于其他的域，默认使用SimpleAnalyzer分析器，对于指定的域partnum使用KeywordAnalyzer</span></span><br><span class="line">    <span class="type">PerFieldAnalyzerWrapper</span> <span class="variable">perFieldAnalyzerWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PerFieldAnalyzerWrapper</span>(<span class="keyword">new</span> <span class="title class_">SimpleAnalyzer</span>(), fields);</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriterConfig</span> <span class="variable">indexWriterConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(perFieldAnalyzerWrapper);</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, indexWriterConfig);</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">FieldType</span> <span class="variable">fieldType</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FieldType</span>();</span><br><span class="line">    fieldType.setStored(<span class="literal">true</span>);</span><br><span class="line">    fieldType.setIndexOptions(IndexOptions.DOCS_AND_FREQS);</span><br><span class="line">    document.add(<span class="keyword">new</span> <span class="title class_">Field</span>(<span class="string">&quot;partnum&quot;</span>, <span class="string">&quot;Q36&quot;</span>, fieldType));</span><br><span class="line">    document.add(<span class="keyword">new</span> <span class="title class_">Field</span>(<span class="string">&quot;description&quot;</span>, <span class="string">&quot;Illidium Space Modulator&quot;</span>, fieldType));</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="comment">//直接使用TermQuery是可以检索到的</span></span><br><span class="line">    <span class="type">TopDocs</span> <span class="variable">search</span> <span class="operator">=</span> indexSearcher.search(<span class="keyword">new</span> <span class="title class_">TermQuery</span>(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">&quot;partnum&quot;</span>, <span class="string">&quot;Q36&quot;</span>)), <span class="number">10</span>);</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, search.totalHits);</span><br><span class="line">    <span class="comment">//如果使用QueryParser，那么必须要使用PerFieldAnalyzerWrapper，否则如下所示，是检索不到的</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">description</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryParser</span>(<span class="string">&quot;description&quot;</span>, <span class="keyword">new</span> <span class="title class_">SimpleAnalyzer</span>()).parse(<span class="string">&quot;partnum:Q36 AND SPACE&quot;</span>);</span><br><span class="line">    search = indexSearcher.search(description, <span class="number">10</span>);</span><br><span class="line">    Assert.assertEquals(<span class="number">0</span>, search.totalHits);</span><br><span class="line">    System.out.println(<span class="string">&quot;SimpleAnalyzer :&quot;</span> + description.toString());<span class="comment">//+partnum:q +description:space，原因是SimpleAnalyzer会剥离非字母字符并将字母小写化</span></span><br><span class="line">    <span class="comment">//使用PerFieldAnalyzerWrapper可以检索到</span></span><br><span class="line">    <span class="comment">//partnum:Q36 AND SPACE表示在partnum中出现Q36，在description中出现SPACE</span></span><br><span class="line">    description = <span class="keyword">new</span> <span class="title class_">QueryParser</span>(<span class="string">&quot;description&quot;</span>, perFieldAnalyzerWrapper).parse(<span class="string">&quot;partnum:Q36 AND SPACE&quot;</span>);</span><br><span class="line">    search = indexSearcher.search(description, <span class="number">10</span>);</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, search.totalHits);</span><br><span class="line">    System.out.println(<span class="string">&quot;(SimpleAnalyzer,KeywordAnalyzer) :&quot;</span> + description.toString());<span class="comment">//+partnum:Q36 +description:space</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SimpleAnalyzer :+partnum:q +description:space</span><br><span class="line">(SimpleAnalyzer,KeywordAnalyzer) :+partnum:Q36 +description:space</span><br></pre></td></tr></table></figure>
<p>由结果可以看出，在索引阶段，使用KeywordAnalyzer作为partnum域的分词器，使用SimpleAnalyzer作为其它域的分词器，同样的在检索阶段，也必须这样处理，否则无法检索到结果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Lucene-6-0-in-action-3-A-variety-of-Field-query-operation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Lucene-6-0-in-action-3-A-variety-of-Field-query-operation/" class="post-title-link" itemprop="url">Lucene 6.0 实战（3）-各种Field查询操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-20 21:33:32" itemprop="dateCreated datePublished" datetime="2016-05-20T21:33:32+00:00">2016-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:18" itemprop="dateModified" datetime="2024-01-26T12:42:18+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="IntPoint查询"><a href="#IntPoint查询" class="headerlink" title="IntPoint查询"></a>IntPoint查询</h3><p>XXXPoint类中提供了一些常用的静态工厂查询方法，可以直接用来构建查询语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIntPointQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">intPoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntPoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>);</span><br><span class="line">    document.add(intPoint);</span><br><span class="line">    intPoint = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>);</span><br><span class="line">    document.add(intPoint);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    <span class="type">Field</span> <span class="variable">intPoint1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntPoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22</span>);</span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    document.add(intPoint1);</span><br><span class="line">    intPoint1 = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22</span>);</span><br><span class="line">    document.add(intPoint1);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="comment">//精确查询</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> IntPoint.newExactQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>);</span><br><span class="line">    ScoreDoc[] scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;精确查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，不包含边界</span></span><br><span class="line">    query = IntPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, Math.addExact(<span class="number">11</span>, <span class="number">1</span>), Math.addExact(<span class="number">22</span>, -<span class="number">1</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;不包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，包含边界</span></span><br><span class="line">    query = IntPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>, <span class="number">22</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，左包含，右不包含</span></span><br><span class="line">    query = IntPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>, Math.addExact(<span class="number">22</span>, -<span class="number">1</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;左包含右不包含：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//集合查询</span></span><br><span class="line">    query = IntPoint.newSetQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;集合查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">精确查询：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">22</span>&gt;&gt;</span><br><span class="line">左包含右不包含：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">22</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="LongPoint查询"><a href="#LongPoint查询" class="headerlink" title="LongPoint查询"></a>LongPoint查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLongPointQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">longPoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongPoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>);</span><br><span class="line">    document.add(longPoint);</span><br><span class="line">    longPoint = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>);</span><br><span class="line">    document.add(longPoint);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    longPoint = <span class="keyword">new</span> <span class="title class_">LongPoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22</span>);</span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    document.add(longPoint);</span><br><span class="line">    longPoint = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22</span>);</span><br><span class="line">    document.add(longPoint);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="comment">//精确查询</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> LongPoint.newExactQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>);</span><br><span class="line">    ScoreDoc[] scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;精确查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，不包含边界</span></span><br><span class="line">    query = LongPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, Math.addExact(<span class="number">11</span>, <span class="number">1</span>), Math.addExact(<span class="number">22</span>, -<span class="number">1</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;不包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，包含边界</span></span><br><span class="line">    query = LongPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>, <span class="number">22</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，左包含，右不包含</span></span><br><span class="line">    query = LongPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>, Math.addExact(<span class="number">22</span>, -<span class="number">1</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;左包含右不包含：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//集合查询</span></span><br><span class="line">    query = LongPoint.newSetQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;集合查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">精确查询：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">22</span>&gt;&gt;</span><br><span class="line">左包含右不包含：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">11</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">22</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="FloatPoint查询"><a href="#FloatPoint查询" class="headerlink" title="FloatPoint查询"></a>FloatPoint查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFloatPointQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">floatPoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FloatPoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11.1f</span>);</span><br><span class="line">    document.add(floatPoint);</span><br><span class="line">    floatPoint = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11.1f</span>);</span><br><span class="line">    document.add(floatPoint);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    floatPoint = <span class="keyword">new</span> <span class="title class_">FloatPoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22.2f</span>);</span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    document.add(floatPoint);</span><br><span class="line">    floatPoint = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22.2f</span>);</span><br><span class="line">    document.add(floatPoint);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="comment">//精确查询</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> FloatPoint.newExactQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1f</span>);</span><br><span class="line">    ScoreDoc[] scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;精确查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，不包含边界</span></span><br><span class="line">    query = FloatPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, Math.nextUp(<span class="number">11.1f</span>), Math.nextDown(<span class="number">22.2f</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;不包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，包含边界</span></span><br><span class="line">    query = FloatPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1f</span>, <span class="number">22.2f</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，左包含，右不包含</span></span><br><span class="line">    query = FloatPoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1f</span>, Math.nextDown(<span class="number">22.2f</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;左包含右不包含：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//集合查询</span></span><br><span class="line">    query = FloatPoint.newSetQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1f</span>, <span class="number">22.2f</span>, <span class="number">33.3f</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;集合查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">精确查询：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">22.2</span>&gt;&gt;</span><br><span class="line">左包含右不包含：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">22.2</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="DoublePoint查询"><a href="#DoublePoint查询" class="headerlink" title="DoublePoint查询"></a>DoublePoint查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDoublePointQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">doublePoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoublePoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11.1</span>);</span><br><span class="line">    document.add(doublePoint);</span><br><span class="line">    doublePoint = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">11.1</span>);</span><br><span class="line">    document.add(doublePoint);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    doublePoint = <span class="keyword">new</span> <span class="title class_">DoublePoint</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22.2</span>);</span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    document.add(doublePoint);</span><br><span class="line">    doublePoint = <span class="keyword">new</span> <span class="title class_">StoredField</span>(<span class="string">&quot;age&quot;</span>, <span class="number">22.2</span>);</span><br><span class="line">    document.add(doublePoint);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="comment">//精确查询</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> DoublePoint.newExactQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1</span>);</span><br><span class="line">    ScoreDoc[] scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;精确查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，不包含边界</span></span><br><span class="line">    query = DoublePoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, Math.nextUp(<span class="number">11.1</span>), Math.nextDown(<span class="number">22.2</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;不包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，包含边界</span></span><br><span class="line">    query = DoublePoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1</span>, <span class="number">22.2</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;包含边界：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//范围查询，左包含，右不包含</span></span><br><span class="line">    query = DoublePoint.newRangeQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1</span>, Math.nextDown(<span class="number">22.2</span>));</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;左包含右不包含：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//集合查询</span></span><br><span class="line">    query = DoublePoint.newSetQuery(<span class="string">&quot;age&quot;</span>, <span class="number">11.1</span>, <span class="number">22.2</span>, <span class="number">33.3</span>);</span><br><span class="line">    scoreDocs = indexSearcher.search(query, <span class="number">10</span>).scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;集合查询：&quot;</span> + indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">精确查询：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">包含边界：Document&lt;stored&lt;age:<span class="number">22.2</span>&gt;&gt;</span><br><span class="line">左包含右不包含：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">11.1</span>&gt;&gt;</span><br><span class="line">集合查询：Document&lt;stored&lt;age:<span class="number">22.2</span>&gt;&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Lucene-6-0-in-action-2-All-kinds-of-Field-and-sort-operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Lucene-6-0-in-action-2-All-kinds-of-Field-and-sort-operations/" class="post-title-link" itemprop="url">Lucene 6.0 实战（2）-各种Field及排序操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-20 21:31:45" itemprop="dateCreated datePublished" datetime="2016-05-20T21:31:45+00:00">2016-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:26" itemprop="dateModified" datetime="2024-01-26T12:42:26+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Field简述"><a href="#Field简述" class="headerlink" title="Field简述"></a>Field简述</h3><p>在Lucene中，各种Field都是IndexableField接口的实现，该接口中提供了一些通用的方法，用于获取Field相关的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IndexableField</span> &#123;</span><br><span class="line">  <span class="comment">//获取名称</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">//获取Field的类型</span></span><br><span class="line">  <span class="keyword">public</span> IndexableFieldType <span class="title function_">fieldType</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">//获取Field的权重</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">boost</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">/** Non-null if this field has a binary value */</span></span><br><span class="line">  <span class="keyword">public</span> BytesRef <span class="title function_">binaryValue</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">/** Non-null if this field has a string value */</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">stringValue</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">/** Non-null if this field has a Reader value */</span></span><br><span class="line">  <span class="keyword">public</span> Reader <span class="title function_">readerValue</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">/** Non-null if this field has a numeric value */</span></span><br><span class="line">  <span class="keyword">public</span> Number <span class="title function_">numericValue</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>NOTES：</strong>一般通过fieldType()方法获取到该Field对应的FieldType类型，但是却并不能去调用FieldType一系列的set方法，例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntPoint</span>(name, value);</span><br><span class="line">field.fieldType().setStored(<span class="literal">true</span>);</span><br><span class="line">field.fieldType().setTokenized(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>否则会报</p>
<blockquote>
<p>java.lang.IllegalStateException: this FieldType is already frozen and cannot be changed</p>
</blockquote>
<p>这是因为各Field的子类中，都调用了type.freeze()方法，而该方法就可以阻止对fieldType做更改。</p>
<p>在Lucene 6.0中，IntField替换为IntPoint，FloatField替换为FloatPoint，LongField替换为LongPoint，DoubleField替换为DoublePoint。对Lucene常见Field总结如下</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>IntPoint</td>
<td>对int型字段索引，只索引不存储，提供了一些静态工厂方法用于创建一般的查询，提供了不同于文本的数值类型存储方式，使用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/K-d_tree">KD-trees</a>索引</td>
</tr>
<tr>
<td>FloatPoint</td>
<td>对float型字段索引，其它同上</td>
</tr>
<tr>
<td>LongPoint</td>
<td>对long型字段索引，其它同上</td>
</tr>
<tr>
<td>DoublePoint</td>
<td>对double型字段索引，其它同上</td>
</tr>
<tr>
<td>BinaryDocValuesField</td>
<td>只存储不共享，例如标题类字段，如果需要共享并排序，推荐使用SortedDocValuesField</td>
</tr>
<tr>
<td>NumericDocValuesField</td>
<td>存储long型字段，用于评分、排序和值检索，如果需要存储值，还需要添加一个单独的StoredField实例</td>
</tr>
<tr>
<td>SortedDocValuesField</td>
<td>索引并存储，用于String类型的Field排序，需要在StringField后添加同名的SortedDocValuesField</td>
</tr>
<tr>
<td>StringField</td>
<td>只索引但不分词，所有的字符串会作为一个整体进行索引，例如通常用于country或id等</td>
</tr>
<tr>
<td>TextField</td>
<td>索引并分词，不包括term vectors，例如通常用于一个body Field</td>
</tr>
<tr>
<td>StoredField</td>
<td>存储Field的值，可以用 IndexSearcher.doc和IndexReader.document来获取存储的Field和存储的值</td>
</tr>
</tbody></table>
<h3 id="IntPoint的使用"><a href="#IntPoint的使用" class="headerlink" title="IntPoint的使用"></a>IntPoint的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addIntPoint</span><span class="params">(Document document, String name, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntPoint</span>(name, value);</span><br><span class="line">    document.add(field);</span><br><span class="line">    <span class="comment">//要排序，必须添加一个同名的NumericDocValuesField</span></span><br><span class="line">    field = <span class="keyword">new</span> <span class="title class_">NumericDocValuesField</span>(name, value);</span><br><span class="line">    document.add(field);</span><br><span class="line">    <span class="comment">//要存储值，必须添加一个同名的StoredField</span></span><br><span class="line">    field = <span class="keyword">new</span> <span class="title class_">StoredField</span>(name, value);</span><br><span class="line">    document.add(field);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIntPointSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    addIntPoint(document, <span class="string">&quot;intValue&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addIntPoint(document, <span class="string">&quot;intValue&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addIntPoint(document, <span class="string">&quot;intValue&quot;</span>, <span class="number">30</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="comment">//第三个参数为true，表示从大到小</span></span><br><span class="line">    <span class="type">SortField</span> <span class="variable">intValues</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SortField</span>(<span class="string">&quot;intValue&quot;</span>, SortField.Type.INT, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">TopFieldDocs</span> <span class="variable">search</span> <span class="operator">=</span> indexSearcher.search(<span class="keyword">new</span> <span class="title class_">MatchAllDocsQuery</span>(), <span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">Sort</span>(intValues));</span><br><span class="line">    ScoreDoc[] scoreDocs = search.scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Document&lt;stored&lt;intValue:<span class="number">30</span>&gt;&gt;</span><br><span class="line">Document&lt;stored&lt;intValue:<span class="number">20</span>&gt;&gt;</span><br><span class="line">Document&lt;stored&lt;intValue:<span class="number">10</span>&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>FloatPoint，LongPoint，DoublePoint使用方法类似，不再赘述。</p>
<h3 id="BinaryDocValuesField的使用"><a href="#BinaryDocValuesField的使用" class="headerlink" title="BinaryDocValuesField的使用"></a>BinaryDocValuesField的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBinaryDocValuesField</span><span class="params">(Document document, String name, String value)</span> &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinaryDocValuesField</span>(name, <span class="keyword">new</span> <span class="title class_">BytesRef</span>(value));</span><br><span class="line">    document.add(field);</span><br><span class="line">    <span class="comment">//如果需要存储，加此句</span></span><br><span class="line">    field = <span class="keyword">new</span> <span class="title class_">StoredField</span>(name, value);</span><br><span class="line">    document.add(field);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBinaryDocValuesFieldSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    addBinaryDocValuesField(document, <span class="string">&quot;binaryValue&quot;</span>, <span class="string">&quot;1234&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addBinaryDocValuesField(document, <span class="string">&quot;binaryValue&quot;</span>, <span class="string">&quot;2345&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addBinaryDocValuesField(document, <span class="string">&quot;binaryValue&quot;</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="type">SortField</span> <span class="variable">binaryValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SortField</span>(<span class="string">&quot;binaryValue&quot;</span>, SortField.Type.STRING_VAL, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">TopFieldDocs</span> <span class="variable">search</span> <span class="operator">=</span> indexSearcher.search(<span class="keyword">new</span> <span class="title class_">MatchAllDocsQuery</span>(), <span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">Sort</span>(binaryValue));</span><br><span class="line">    ScoreDoc[] scoreDocs = search.scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Document&lt;stored&lt;intValue:<span class="number">2345</span>&gt;&gt;</span><br><span class="line">Document&lt;stored&lt;intValue:<span class="number">12345</span>&gt;&gt;</span><br><span class="line">Document&lt;stored&lt;binaryValue:<span class="number">1234</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="StringField的使用"><a href="#StringField的使用" class="headerlink" title="StringField的使用"></a>StringField的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStringField</span><span class="params">(Document document, String name, String value)</span> &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringField</span>(name, value, Field.Store.YES);</span><br><span class="line">    document.add(field);</span><br><span class="line">    field = <span class="keyword">new</span> <span class="title class_">SortedDocValuesField</span>(name, <span class="keyword">new</span> <span class="title class_">BytesRef</span>(value));</span><br><span class="line">    document.add(field);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStringFieldSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    addStringField(document, <span class="string">&quot;stringValue&quot;</span>, <span class="string">&quot;1234&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addStringField(document, <span class="string">&quot;stringValue&quot;</span>, <span class="string">&quot;2345&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addStringField(document, <span class="string">&quot;stringValue&quot;</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="type">SortField</span> <span class="variable">stringValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SortField</span>(<span class="string">&quot;stringValue&quot;</span>, SortField.Type.STRING, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">TopFieldDocs</span> <span class="variable">search</span> <span class="operator">=</span> indexSearcher.search(<span class="keyword">new</span> <span class="title class_">MatchAllDocsQuery</span>(), <span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">Sort</span>(stringValue));</span><br><span class="line">    ScoreDoc[] scoreDocs = search.scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Document&lt;stored,indexed,tokenized,omitNorms,indexOptions=DOCS&lt;stringValue:<span class="number">2345</span>&gt;&gt;</span><br><span class="line">Document&lt;stored,indexed,tokenized,omitNorms,indexOptions=DOCS&lt;stringValue:<span class="number">12345</span>&gt;&gt;</span><br><span class="line">Document&lt;stored,indexed,tokenized,omitNorms,indexOptions=DOCS&lt;stringValue:<span class="number">1234</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="TextField的使用"><a href="#TextField的使用" class="headerlink" title="TextField的使用"></a>TextField的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTextField</span><span class="params">(Document document, String name, String value)</span> &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextField</span>(name, value, Field.Store.YES);</span><br><span class="line">    document.add(field);</span><br><span class="line">    field = <span class="keyword">new</span> <span class="title class_">SortedDocValuesField</span>(name, <span class="keyword">new</span> <span class="title class_">BytesRef</span>(value));</span><br><span class="line">    document.add(field);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTextFieldSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    addTextField(document, <span class="string">&quot;textValue&quot;</span>, <span class="string">&quot;1234&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addTextField(document, <span class="string">&quot;textValue&quot;</span>, <span class="string">&quot;2345&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    document = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    addTextField(document, <span class="string">&quot;textValue&quot;</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line"></span><br><span class="line">    indexWriter.close();</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.open(directory));</span><br><span class="line">    <span class="type">SortField</span> <span class="variable">textValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SortField</span>(<span class="string">&quot;textValue&quot;</span>, SortField.Type.STRING, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">TopFieldDocs</span> <span class="variable">search</span> <span class="operator">=</span> indexSearcher.search(<span class="keyword">new</span> <span class="title class_">MatchAllDocsQuery</span>(), <span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">Sort</span>(textValue));</span><br><span class="line">    ScoreDoc[] scoreDocs = search.scoreDocs;</span><br><span class="line">    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">        System.out.println(indexSearcher.doc(scoreDoc.doc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Document&lt;stored,indexed,tokenized&lt;textValue:<span class="number">2345</span>&gt;&gt;</span><br><span class="line">Document&lt;stored,indexed,tokenized&lt;textValue:<span class="number">12345</span>&gt;&gt;</span><br><span class="line">Document&lt;stored,indexed,tokenized&lt;textValue:<span class="number">1234</span>&gt;&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Lucene-6-0-in-action-1-Index-creation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Lucene-6-0-in-action-1-Index-creation/" class="post-title-link" itemprop="url">Lucene 6.0 实战（1）-创建索引</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-20 21:25:37" itemprop="dateCreated datePublished" datetime="2016-05-20T21:25:37+00:00">2016-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:23" itemprop="dateModified" datetime="2024-01-26T12:42:23+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p><strong>Lucene6.0</strong>于<strong>2016年4月8日</strong>发布，要求最低Java版本是<strong>Java 8</strong>。</p>
<p>相信大多数公司的数据库都需要采用分库分表等一些策略，而对于某些特定的业务需求，分别从不同的库不同的表中去检索特定的数据显得比较繁琐，而Lucene正好可以解决某些特殊需求，对于不同库不同表中的数据先建立全量索引，然后将需要检索的数据写入某个单独的表中，供其它业务需求方查询，以后的每天只需要做增量索引并写入数据表即可。</p>
<p>鉴于最近一直在做Lucene相关方面的工作，而本人一向又比较喜欢使用最新发布的版本，而网络上这类资源极少，故将一些要点及示例整理出来，本文主要从实战角度来介绍Lucene 6.0的使用，不涉及过多原理方面的东西，但是对于一些核心点也会有所提及。</p>
<h3 id="Lucene为什么这么流行"><a href="#Lucene为什么这么流行" class="headerlink" title="Lucene为什么这么流行"></a>Lucene为什么这么流行</h3><p>Lucene是一个高效的，基于Java的全文检索库，生活中数据主要分为两种：结构化数据和非结构化数据。一般使用的XML、JSON、数据库等都是结构化数据，非结构化数据也叫全文数据，而这种全文数据正是Lucene的用武之地。全文检索主要有两个过程，索引创建（Indexing）和搜索索引（Search）。</p>
<p>Lucene是很多搜索引擎的一个基础实现，被很多大公司所采用，例如Netflix，MySpace，LinkedIn，Twitter，IBM等。可以通过如下几点特性对Lucene有个大概的认识</p>
<ul>
<li>在现代的硬件上一小时可以索引150GB的数据</li>
<li>索引20GB的文本文件，产生的索引文件大概是4-6GB</li>
<li>只需要1MB的堆内存</li>
<li>可定制的排序模型</li>
<li>支持多种查询类型</li>
<li>通过特定的字段搜索</li>
<li>通过特定的字段排序</li>
<li>近实时的索引和搜索</li>
<li>Faceting，Grouping，Highlighting，Suggestions等</li>
</ul>
<p>鉴于Lucene这么多强大的特性以及流行度，有很多种基于Lucene的搜索技术，其中最流行的两个是<strong>Apache Solr</strong>和<strong>Elastic search</strong>，当然还有许多其它不同语言的Lucene实现：</p>
<ul>
<li><strong>CLucene</strong>: Lucene implementation in C++ (<a target="_blank" rel="noopener" href="http://sourceforge.net/projects/clucene/">http://sourceforge.net/projects/clucene/</a>)</li>
<li><strong>Lucene.Net</strong>: Lucene implementation in Microsoft.NET (<a target="_blank" rel="noopener" href="http://incubator.apache.org/lucene.net/">http://incubator.apache.org/lucene.net/</a>)</li>
<li><strong>Lucene4c</strong>: Lucene implementation in C (<a target="_blank" rel="noopener" href="http://incubator.apache.org/lucene4c/">http://incubator.apache.org/lucene4c/</a>)</li>
<li><strong>LuceneKit</strong>: Lucene implementation in Objective-C, Cocoa&#x2F;GNUstep support (<a target="_blank" rel="noopener" href="https://github.com/tcurdt/lucenekit">https://github.com/tcurdt/lucenekit</a>)</li>
<li><strong>Lupy</strong>: Lucene implementation in Python (RETIRED) (<a target="_blank" rel="noopener" href="http://www.divmod.org/projects/lupy">http://www.divmod.org/projects/lupy</a>)</li>
<li><strong>NLucene</strong>: This is another Lucene implementation in .NET (out of date) (<a target="_blank" rel="noopener" href="http://sourceforge.net/projects/nlucene/">http://sourceforge.net/projects/nlucene/</a>)</li>
<li><strong>Zend Search</strong>: Lucene implementation in the Zend Framework for PHP 5 (<a target="_blank" rel="noopener" href="http://framework.zend.com/manual/en/zend.search.html">http://framework.zend.com/manual/en/zend.search.html</a>)</li>
<li><strong>Plucene</strong>: Lucene implementation in Perl (<a target="_blank" rel="noopener" href="http://search.cpan.org/search?query=plucene&mode=all">http://search.cpan.org/search?query=plucene&amp;mode=all</a>)</li>
<li><strong>KinoSearch</strong>: This is a new Lucene implementation in Perl (<a target="_blank" rel="noopener" href="http://www.rectangular.com/kinosearch/">http://www.rectangular.com/kinosearch/</a>)</li>
<li><strong>PyLucene</strong>: This is GCJ-compiled version of Java Lucene integrated with Python (<a target="_blank" rel="noopener" href="http://pylucene.osafoundation.org/">http://pylucene.osafoundation.org/</a>)</li>
<li><strong>MUTIS</strong>: Lucene implementation in Delphi (<a target="_blank" rel="noopener" href="http://mutis.sourceforge.net/">http://mutis.sourceforge.net/</a>)</li>
<li><strong>Ferret</strong>: Lucene implementation in Ruby (<a target="_blank" rel="noopener" href="http://ferret.davebalmain.com/trac/">http://ferret.davebalmain.com/trac/</a>)</li>
<li><strong>Montezuma</strong>: Lucene implementation in Common Lisp (<a target="_blank" rel="noopener" href="http://www.cliki.net/Montezuma">http://www.cliki.net/Montezuma</a>)</li>
</ul>
<h3 id="存储索引"><a href="#存储索引" class="headerlink" title="存储索引"></a>存储索引</h3><p>索引由Lucene按照特定的格式创建，而创建出来的索引必然要存储在文件系统之上，Lucene在文件系统中存储索引的最基本的抽象实现类是BaseDirectory，该类继承自Directory，BaseDirectory有两个主要的实现类：</p>
<ul>
<li>FSDirectory：在文件系统上存储索引文件，有六个子类，如下是三个常用的子类<ul>
<li>SimpleFSDirectory：使用Files.newByteChannel实现，对并发支持不好，它会在多线程读取同一份文件时进行同步操作</li>
<li>NIOFSDirectory：使用Java NIO中的FileChannel去读取同一份文件，可以避免同步操作，但是由于Windows平台上存在<a target="_blank" rel="noopener" href="http://bugs.java.com/bugdatabase/view_bug.do?bug_id=6265734">Sun JRE bug</a>，所以在Windows平台上不推荐使用</li>
<li>MMapDirectory：在读取的时候使用内存映射IO，如果你的虚拟内存足够容纳索引文件大小的话，这是一个很棒的选择</li>
</ul>
</li>
<li>RAMDirectory：在内存中暂存索引文件，只对小索引好，大索引会出现频繁GC</li>
</ul>
<p>通常情况下，如果索引文件存储在文件系统之上，我们无需自己选择使用FSDirectory的某个实现子类，只要使用FSDirectory中的open(Path path)方法即可，英文doc如下：</p>
<blockquote>
<p>Creates an FSDirectory instance, trying to pick the best implementation given the current environment. The directory returned uses the NativeFSLockFactory. The directory is created at the named location if it does not yet exist.</p>
</blockquote>
<p>该方法可以自动根据当前使用的系统环境而选择一个最佳的实现子类，其选择策略是</p>
<ul>
<li>对于Linux，MacOSX，Solaris，Windows 64-bit JREs返回MMapDirectory</li>
<li>对于其它非Windows上的JREs，返回NIOFSDirectory</li>
<li>对于其它Windows上的JREs，返回SimpleFSDirectory</li>
</ul>
<p><strong>MMapDirectory</strong>就目前来说，是比较好的实现。它使用virtual memory和mmap来访问磁盘文件。一般的方法都是依赖系统调用在文件系统cache以及Java heap之间拷贝数据。那么怎么才能直接访问文件系统cache呢？这就是mmap的作用！</p>
<p>简单说MMapDirectory就是把lucene的索引当作swap file来处理。mmap()系统调用让OS把整个索引文件映射到虚拟地址空间，这样Lucene就会觉得索引在内存中。然后Lucene就可以像访问一个超大的byte[]数据（在Java中这个数据被封装在ByteBuffer接口里）一样访问磁盘上的索引文件。Lucene在访问虚拟空间中的索引时，不需要任何的系统调用，CPU里的MMU（memory management unit）和TLB（translation lookaside buffers, 它cache了频繁被访问的page）会处理所有的映射工作。如果数据还在磁盘上，那么MMU会发起一个中断，OS将会把数据加载进文件系统Cache。如果数据已经在cache里了，MMU&#x2F;TLB会直接把数据映射到内存，这只需要访问内存，速度很快。程序员不需要关心paging in&#x2F;out，所有的这些都交给OS。而且，这种情况下没有并发的干扰，唯一的问题就是Java的ByteBuffer封装后的byte[]稍微慢一些，但是Java里要想用mmap就只能用这个接口。还有一个很大的优点就是所有的内存issue都由OS来负责，这样没有GC的问题。</p>
<h3 id="索引核心类"><a href="#索引核心类" class="headerlink" title="索引核心类"></a>索引核心类</h3><p>执行简单的索引过程需要用到以下几个类：</p>
<ul>
<li><strong>IndexWriter</strong>：负责创建索引或打开已有索引</li>
<li><strong>IndexWriterConfig</strong>：持有创建IndexWriter的所有配置项</li>
<li><strong>Directory</strong>：描述了Lucene索引的存放位置，它的子类负责具体指定索引的存储路径</li>
<li><strong>Analyzer</strong>：负责文本分析，从被索引文本文件中提取出语汇单元。对于文本分析器Analyzer，需要注意一点，就是使用哪种Analyzer进行索引创建，查询的时候也要使用哪种Analyzer查询，否则查询结果不正确。</li>
<li><strong>Document</strong>：代表一些域（Field）的集合，你可以将Document对象理解为虚拟文档-例如Web页面、E-mail信息或者文本文件</li>
<li><strong>Field</strong>：索引中的每个文档都包含一个或多个不同命名的域，每个域都有一个域名和对应的域值</li>
<li><strong>FieldType</strong>：描述了Field的各种属性，在不使用某种具体的Field类型（例如StringField，TextField）时需要用到此类</li>
</ul>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>索引的创建方式有三种，通过IndexWriterConfig.OpenMode进行指定，分别是</p>
<ul>
<li>CREATE：创建一个新的索引或者覆写已经存在的索引</li>
<li>APPEND：打开一个已经存在的索引</li>
<li>CREATE_OR_APPEND：如果不存在则创建新的索引，如果存在则追加索引</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建索引写入器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> indexPath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> create</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> IndexWriter <span class="title function_">getIndexWriter</span><span class="params">(String indexPath, <span class="type">boolean</span> create)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">IndexWriterConfig</span> <span class="variable">indexWriterConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>());</span><br><span class="line">    <span class="keyword">if</span> (create) &#123;</span><br><span class="line">        indexWriterConfig.setOpenMode(IndexWriterConfig.OpenMode.CREATE);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        indexWriterConfig.setOpenMode(IndexWriterConfig.OpenMode.CREATE_OR_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Directory</span> <span class="variable">directory</span> <span class="operator">=</span> FSDirectory.open(Paths.get(indexPath));</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, indexWriterConfig);</span><br><span class="line">    <span class="keyword">return</span> indexWriter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果仅仅做测试用，还可以将索引文件存储在内存之中，此时需要使用RAMDirectory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LuceneDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Directory directory;</span><br><span class="line">    <span class="keyword">private</span> String[] ids = &#123;<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> String[] unIndex = &#123;<span class="string">&quot;Netherlands&quot;</span>, <span class="string">&quot;Italy&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> String[] unStored = &#123;<span class="string">&quot;Amsterdam has lots of bridges&quot;</span>, <span class="string">&quot;Venice has lots of canals&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> String[] text = &#123;<span class="string">&quot;Amsterdam&quot;</span>, <span class="string">&quot;Venice&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> IndexWriter indexWriter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IndexWriterConfig</span> <span class="variable">indexWriterConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        directory = <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">        <span class="comment">//指定将索引创建信息打印到控制台</span></span><br><span class="line">        indexWriterConfig.setInfoStream(System.out);</span><br><span class="line">        indexWriter = <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(directory, indexWriterConfig);</span><br><span class="line">        indexWriterConfig = (IndexWriterConfig) indexWriter.getConfig();</span><br><span class="line">        <span class="type">FieldType</span> <span class="variable">fieldType</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FieldType</span>();</span><br><span class="line">        fieldType.setIndexOptions(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS);</span><br><span class="line">        fieldType.setStored(<span class="literal">true</span>);<span class="comment">//存储</span></span><br><span class="line">        fieldType.setTokenized(<span class="literal">true</span>);<span class="comment">//分词</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ids.length; i++) &#123;</span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">Field</span>(<span class="string">&quot;id&quot;</span>, ids[i], fieldType));</span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">Field</span>(<span class="string">&quot;country&quot;</span>, unIndex[i], fieldType));</span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">Field</span>(<span class="string">&quot;contents&quot;</span>, unStored[i], fieldType));</span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">Field</span>(<span class="string">&quot;city&quot;</span>, text[i], fieldType));</span><br><span class="line">            indexWriter.addDocument(document);</span><br><span class="line">        &#125;</span><br><span class="line">        indexWriter.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NOTES</strong>：在调用IndexWriter的close()方法时会自动调用commit()方法，在调用commit()方法时会自动调用flush()方法。所以一般无需这样操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">indexWriter.flush();</span><br><span class="line">indexWriter.commit();</span><br><span class="line">indexWriter.close();</span><br></pre></td></tr></table></figure>

<p>控制台输出索引创建信息如下：</p>
<blockquote>
<p>IFD 0 [2016-05-19T07:10:21.127Z; main]: init: current segments file is “segments”; deletionPolicy&#x3D;org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@691a7f8f<br>IFD 0 [2016-05-19T07:10:21.167Z; main]: delete []<br>IFD 0 [2016-05-19T07:10:21.167Z; main]: now checkpoint “” [0 segments ; isCommit &#x3D; false]<br>IFD 0 [2016-05-19T07:10:21.167Z; main]: delete []<br>IFD 0 [2016-05-19T07:10:21.167Z; main]: 0 msec to checkpoint<br>IW 0 [2016-05-19T07:10:21.167Z; main]: init: create&#x3D;true<br>IW 0 [2016-05-19T07:10:21.168Z; main]:<br>…<br>…<br>DW 0 [2016-05-19T07:10:21.271Z; main]: main finishFullFlush success&#x3D;true<br>IW 0 [2016-05-19T07:10:21.271Z; main]: startCommit(): start<br>IW 0 [2016-05-19T07:10:21.271Z; main]:   skip startCommit(): no changes pending<br>IFD 0 [2016-05-19T07:10:21.271Z; main]: delete []<br>IW 0 [2016-05-19T07:10:21.271Z; main]: commit: pendingCommit &#x3D;&#x3D; null; skip<br>IW 0 [2016-05-19T07:10:21.271Z; main]: commit: took 0.4 msec<br>IW 0 [2016-05-19T07:10:21.271Z; main]: commit: done<br>IW 0 [2016-05-19T07:10:21.271Z; main]: rollback<br>IW 0 [2016-05-19T07:10:21.271Z; main]: all running merges have aborted<br>IW 0 [2016-05-19T07:10:21.271Z; main]: rollback: done finish merges<br>DW 0 [2016-05-19T07:10:21.271Z; main]: abort<br>DW 0 [2016-05-19T07:10:21.271Z; main]: done abort success&#x3D;true<br>IW 0 [2016-05-19T07:10:21.271Z; main]: rollback: infos&#x3D;_0(6.0.0):c2<br>IFD 0 [2016-05-19T07:10:21.271Z; main]: now checkpoint “_0(6.0.0):c2” [1 segments ; isCommit &#x3D; false]<br>IFD 0 [2016-05-19T07:10:21.272Z; main]: delete []<br>IFD 0 [2016-05-19T07:10:21.272Z; main]: 0 msec to checkpoint<br>IFD 0 [2016-05-19T07:10:21.272Z; main]: delete []<br>IFD 0 [2016-05-19T07:10:21.272Z; main]: delete []</p>
</blockquote>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p>在IndexWriter中提供了从索引中删除Document的接口，分别是</p>
<ul>
<li>deleteDocuments(Query… queries)：删除所有匹配到查询语句的Document</li>
<li>deleteDocuments(Term… terms)：删除所有包含有terms的Document</li>
<li>deleteAll()：删除索引中所有的Document</li>
</ul>
<p>NOTES: deleteDocuments(Term… terms)方法，只接受Term参数，而Term只提供如下四个构造函数</p>
<ul>
<li>Term(String fld, BytesRef bytes)</li>
<li>Term(String fld, BytesRefBuilder bytesBuilder)</li>
<li>Term(String fld, String text)</li>
<li>Term(String fld)</li>
</ul>
<p>所以我们无法使用deleteDocuments(Term… terms)去删除一些非String值的Field，例如IntPoint，LongPoint，FloatPoint，DoublePoint等。这时候就需要借助传递Query实例的方法去删除包含某些特定类型Field的Document。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RAMDirectory</span> <span class="variable">ramDirectory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RAMDirectory</span>();</span><br><span class="line">    <span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(ramDirectory, <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>()));</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">    document.add(<span class="keyword">new</span> <span class="title class_">IntPoint</span>(<span class="string">&quot;ID&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    indexWriter.addDocument(document);</span><br><span class="line">    indexWriter.commit();</span><br><span class="line">    <span class="comment">//无法删除ID为1的</span></span><br><span class="line">    indexWriter.deleteDocuments(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">&quot;ID&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">    indexWriter.commit();</span><br><span class="line">    <span class="type">DirectoryReader</span> <span class="variable">open</span> <span class="operator">=</span> DirectoryReader.open(ramDirectory);</span><br><span class="line">    <span class="type">IndexSearcher</span> <span class="variable">indexSearcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(open);</span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> IntPoint.newExactQuery(<span class="string">&quot;ID&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="type">TopDocs</span> <span class="variable">search</span> <span class="operator">=</span> indexSearcher.search(query, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">//命中，1，说明并未删除</span></span><br><span class="line">    System.out.println(search.totalHits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用Query删除</span></span><br><span class="line">    indexWriter.deleteDocuments(query);</span><br><span class="line">    indexWriter.commit();</span><br><span class="line">    indexSearcher = <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(DirectoryReader.openIfChanged(open));</span><br><span class="line">    search = indexSearcher.search(query, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">//未命中，0，说明已经删除</span></span><br><span class="line">    System.out.println(search.totalHits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://www.cnblogs.com/huangfox/p/3616298.html">http://www.cnblogs.com/huangfox/p/3616298.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/javaScript%20tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/javaScript%20tips/" class="post-title-link" itemprop="url">javaScript t ips</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-20 00:00:00" itemprop="dateCreated datePublished" datetime="2016-05-20T00:00:00+00:00">2016-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:25" itemprop="dateModified" datetime="2024-01-26T12:42:25+00:00">2024-01-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="光标焦点总在最后"><a href="#光标焦点总在最后" class="headerlink" title="光标焦点总在最后"></a>光标焦点总在最后</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onclick=&quot;var $Val = $.trim($(this).val());$(this).val(&#x27;&#x27;).focus().val($Val)&quot;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000003843756/a-1020000003847663">https://segmentfault.com/q/1010000003843756/a-1020000003847663</a></p>
<h2 id="随机数取整"><a href="#随机数取整" class="headerlink" title="随机数取整"></a>随机数取整</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(1.2,1.6);    //  1.2 1.6</span><br><span class="line">console.log(0|1.2,0|1.6); //  1 1</span><br><span class="line">console.log(~~1.2,~~1.6); //  1 1</span><br></pre></td></tr></table></figure>



<h1 id="input输入替换"><a href="#input输入替换" class="headerlink" title="input输入替换"></a>input输入替换</h1><p>onkeyup&#x3D;”value&#x3D;value.replace(&#x2F;[^\d]&#x2F;g,&#39;&#39;).substring(0,5)”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input class=&quot;form-control input-sm-pages&quot; onkeyup=&quot;value=value.replace(/[^\d]/g,&#x27;&#x27;).substring(0,5)&quot; type=&quot;text&quot; size=&quot;2.6&quot; value=&quot;1&quot; title=&quot;输入跳转页码，回车确认&quot;&gt;</span><br></pre></td></tr></table></figure>






<h1 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var fn = (param) =&gt; &#123;console.log(&#x27;hello &#x27;+ param)&#125;;</span><br><span class="line">fn(&#x27;world&#x27;);</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="柯里化-Currying"><a href="#柯里化-Currying" class="headerlink" title="柯里化 ( Currying )"></a>柯里化 ( Currying )</h1><ul>
<li>柯里化有3个常见作用：1. 参数复用；2. 提前返回；3. 延迟计算&#x2F;运行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function add(a, b) &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function curryingAdd(a) &#123;</span><br><span class="line">    return function(b) &#123;</span><br><span class="line">        return a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(1, 2); // 3</span><br><span class="line">curryingAdd(1)(2); // 3</span><br></pre></td></tr></table></figure>


<h2 id="IIFE的Currying实现"><a href="#IIFE的Currying实现" class="headerlink" title="IIFE的Currying实现"></a><code>IIFE</code>的<code>Currying</code>实现</h2><p><code>IIFE </code> javascript立即执行函数表达式<br>语法：<code>(function()&#123; /* code */ &#125;)();</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(function(param)&#123;</span><br><span class="line">  console.log(param);</span><br><span class="line">&#125;)(&#x27;hello&#x27;)</span><br></pre></td></tr></table></figure>
<p><code>Currying</code>实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function currying(fn)&#123;</span><br><span class="line">  return function(param)&#123;</span><br><span class="line">    fn(param);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">currying(function(param)&#123;</span><br><span class="line">  console.log(param);</span><br><span class="line">&#125;)(&#x27;hello&#x27;);</span><br></pre></td></tr></table></figure>


<h2 id="柯里化-Currying-减少参数"><a href="#柯里化-Currying-减少参数" class="headerlink" title="柯里化(Currying)减少参数"></a>柯里化(Currying)减少参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function currying(fn, n) &#123;</span><br><span class="line">  return function (m) &#123;</span><br><span class="line">    return fn.call(this, m, n);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function tailFactorial(n, total) &#123;</span><br><span class="line">  if (n === 1) return total;</span><br><span class="line">  return tailFactorial(n - 1, n * total);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">const factorial = currying(tailFactorial, 1);</span><br><span class="line"> </span><br><span class="line">factorial(5) // 120</span><br></pre></td></tr></table></figure>


<h2 id="柯里化还能循环中闭包使用timeout"><a href="#柯里化还能循环中闭包使用timeout" class="headerlink" title="柯里化还能循环中闭包使用timeout"></a>柯里化还能循环中闭包使用timeout</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">   * 异步执行函数,目的:页面同步刷新(柯里化)</span><br><span class="line">   * @param func</span><br><span class="line">   * @param time</span><br><span class="line">   * @returns &#123;Function&#125;</span><br><span class="line">   */</span><br><span class="line">  function asyn(func, time = 1000) &#123;</span><br><span class="line">    return function (prom) &#123;</span><br><span class="line">      setTimeout(function () &#123;</span><br><span class="line">        return func.call(this, prom);</span><br><span class="line">      &#125;, time)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function _forEach(start, end) &#123;</span><br><span class="line">  asyn(function (prom) &#123;</span><br><span class="line">    // console.log(&#x27;dd&#x27;, prom);</span><br><span class="line">    el(&#x27;.nav-bar-title.ng-binding&#x27;).triggerHandler(&#x27;click&#x27;);</span><br><span class="line">    asyn(function (prom) &#123;</span><br><span class="line">      // console.log(&#x27;dd2&#x27;, prom);</span><br><span class="line">      el(&#x27;.bookname_content&gt;.bookname&#x27;, prom).triggerHandler(&#x27;click&#x27;);</span><br><span class="line">      ++start &lt;= end &amp;&amp; dd(start, end);// 递归调用自己,相比for没有了时间计算</span><br><span class="line">    &#125;)(prom);</span><br><span class="line">  &#125;)(start);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_forEach(0, 2);// 启动</span><br></pre></td></tr></table></figure>


<h2 id="反柯里化"><a href="#反柯里化" class="headerlink" title="反柯里化"></a>反柯里化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.uncurry = function () &#123;</span><br><span class="line">  return this.call.bind(this);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p><code>掌握JavaScript函数的柯里化 - angular - SegmentFault</code><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000006096034">https://segmentfault.com/a/1190000006096034</a></p>
<p><code>浅析 JavaScript 中的 函数 currying 柯里化 - Tong Zeng - 博客园</code><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/zztt/p/4142891.html">http://www.cnblogs.com/zztt/p/4142891.html</a></p>
<p><code>JS中的柯里化(currying) « 张鑫旭-鑫空间-鑫生活</code><br><a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/2013/02/js-currying/">http://www.zhangxinxu.com/wordpress/2013/02/js-currying/</a>  </p>
<p><code>由浅入深，深入详解 JavaScript 柯里化 - 推酷 </code> -  柯里化与bind<br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/y6BVvqq">http://www.tuicool.com/articles/y6BVvqq</a></p>
<hr>
<h1 id="尾递归"><a href="#尾递归" class="headerlink" title="尾递归"></a>尾递归</h1><ul>
<li>尾调用是指某个函数的最后一步是调用另一个函数</li>
<li>函数调用自身，称为递归</li>
<li>如果尾调用自身，就称为尾递归</li>
</ul>
<p>递归很容易发生”栈溢出”错误（stack overflow）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function factorial(n) &#123;</span><br><span class="line">  if (n === 1) return 1;</span><br><span class="line">  return n * factorial(n - 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">factorial(5) // 120</span><br></pre></td></tr></table></figure>

<p><code>5*4*3*2*1</code></p>
<p>但对于尾递归来说，由于只存在一个调用记录，所以永远不会发生”栈溢出”错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function factorial(n, total) &#123;</span><br><span class="line">  if (n === 1) return total;</span><br><span class="line">  return factorial(n - 1, n * total);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">factorial(5, 1) // 120</span><br></pre></td></tr></table></figure>
<p><code>(5,1)&lt;=(4,5)&lt;=(3,4*5)&lt;=(2,3*4*5)&lt;=(1,2*3*4*5)==1*2*3*4*5</code></p>
<h1 id="JavaScript中匿名函数的递归调用"><a href="#JavaScript中匿名函数的递归调用" class="headerlink" title="JavaScript中匿名函数的递归调用"></a>JavaScript中匿名函数的递归调用</h1><p>callee 是 arguments 对象的一个属性，其值是当前正在执行的 function 对象。 它的作用是使得匿名 function 可以被递归调用。 下面以一段计算斐波那契序列（Fibonacci sequence）中第 N 个数的值的代码来演示 arguments.callee 的使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function fibonacci(num) &#123;</span><br><span class="line">    return (function(num) &#123;</span><br><span class="line">        if (typeof num !== &quot;number&quot;) return -1;</span><br><span class="line">        num = parseInt(num);</span><br><span class="line">        if (num &lt; 1) return -1;</span><br><span class="line">        if (num == 1 || num == 2) return 1;</span><br><span class="line">        return arguments.callee(num - 1) + arguments.callee(num - 2);</span><br><span class="line">    &#125;)(num);</span><br><span class="line">&#125;</span><br><span class="line">fibonacci(100);</span><br></pre></td></tr></table></figure>


<h1 id="JS-写函数类时加NEW与不加NEW的区别"><a href="#JS-写函数类时加NEW与不加NEW的区别" class="headerlink" title="JS 写函数类时加NEW与不加NEW的区别"></a>JS 写函数类时加NEW与不加NEW的区别</h1><p>定义一个类，如下，然后NEW一个，调用他里面的方法与属性，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function showa(s)</span><br><span class="line">&#123;</span><br><span class="line">        this.color=&quot;red&quot;;//公有变量</span><br><span class="line">        this.size=&quot;9&quot;;</span><br><span class="line">        this.txt=s;</span><br><span class="line">        this.show=function() //类的方法</span><br><span class="line">        &#123;</span><br><span class="line">               alert(this.color);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后NEW一个调用，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var sa=new showa(&quot;abc&quot;);</span><br><span class="line">alert(sa.size);</span><br><span class="line">sa.show();</span><br></pre></td></tr></table></figure>
<p>弹出“9”，　和“red”,<br>改成以下这样的没有NEW的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var sa=showa(&quot;abc&quot;);</span><br><span class="line">alert(sa.size);</span><br><span class="line">sa.show();</span><br></pre></td></tr></table></figure>
<p>提示 sa  没的定义<br>JS有些函数不加NEW和加NEW，执行都是一样的，在网上查下看了些概念太理解，可以通俗地说下吗？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new声明的是一个对象，而不是函数</span><br><span class="line">而直接写函数，那就不是对象，是无法调用对象的属性的！</span><br></pre></td></tr></table></figure>


<h1 id="隐性参数列表-arguments"><a href="#隐性参数列表-arguments" class="headerlink" title="隐性参数列表 arguments"></a>隐性参数列表 arguments</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function fn(a,b,c)&#123;</span><br><span class="line">    console.log(&quot;arguments&quot;,arguments);// arguments [&quot;hello&quot;, &quot;world&quot;]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">fn(&quot;hello&quot;,&quot;world&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  function fn(func, b, c) &#123;</span><br><span class="line">    var _arguments = arguments;</span><br><span class="line">    return function (src) &#123;</span><br><span class="line">      func.apply(null, _arguments);// 传递参数</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var func =  fn(alert, 2,3);</span><br><span class="line">func (&quot;world&quot;);</span><br></pre></td></tr></table></figure>




<h1 id="call-apply"><a href="#call-apply" class="headerlink" title="call &amp; apply"></a>call &amp; apply</h1><p>call，apply都是改变函数执行时的上下文，即this的环境。常结合<code>call &amp; inherits</code>实现对象继承</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function inherits(child, parent) &#123;</span><br><span class="line">  var _proptotype = Object.create(parent.prototype); // 父级原型</span><br><span class="line">  _proptotype.constructor = child.prototype.constructor;// 子集构造,覆盖父级构造</span><br><span class="line">  child.prototype = _proptotype; // 父级原型覆盖子集原型</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>JavaScript 精粹 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/Mv6zUr">http://www.tuicool.com/articles/Mv6zUr</a></p>
<p><code>区别</code> 参数使用方式不同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fn.call(context, arg1, arg2, …, argn)</span><br><span class="line">fn.apply(context, [arg1, arg2, …, argn])</span><br></pre></td></tr></table></figure>
<p>独立的<code>call</code>会使上下文覆盖。如需继承需结合<code>inherits(child, parent)</code>拷贝属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function Animal()&#123;   </span><br><span class="line">    this.name = &quot;Animal&quot;;   </span><br><span class="line">this.name2 = &quot;Animal2&quot;;   </span><br><span class="line">    this.showName = function()&#123;   </span><br><span class="line">        console.log(this.name,this.name2);   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;   </span><br><span class="line"> </span><br><span class="line">function Cat()&#123;   </span><br><span class="line">    this.name = &quot;Cat&quot;;   </span><br><span class="line">&#125;   </span><br><span class="line"> </span><br><span class="line">var animal = new Animal();   </span><br><span class="line">var cat = new Cat();   </span><br><span class="line"> </span><br><span class="line">//通过call或apply方法，将原本属于Animal对象的showName()方法交给对象cat来使用了。   </span><br><span class="line">//输入结果为&quot;Cat&quot;   </span><br><span class="line">animal.showName();// Animal Animal2</span><br><span class="line">animal.showName.call(cat,&quot;,&quot;);// Cat undefined</span><br></pre></td></tr></table></figure>
<p><code>JS中的call()和apply()方法 - 每天进步一点点！</code><br><a target="_blank" rel="noopener" href="http://uule.iteye.com/blog/1158829">http://uule.iteye.com/blog/1158829</a></p>
<h1 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h1><p>fn2对象载入fn对象（this）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn.bind(fn2);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">altwrite.bind(document)(&quot;hello&quot;); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var altwrite = function()&#123;this.name=&#x27;aaa&#x27;&#125;</span><br><span class="line">altwrite.bind(document).name;// aaa</span><br><span class="line">altwrite.bind(document).write(&#x27;hello&#x27;)// is not a function</span><br><span class="line">---</span><br><span class="line">var altwrite = document.write;</span><br><span class="line">altwrite(&#x27;hello&#x27;);// Uncaught TypeError: Illegal invocation （this指向被改变为了window）</span><br><span class="line">altwrite.bind(document)(&#x27;hello&#x27;); // altwrite改变this的指向为document(即:原this内容无法访问)</span><br><span class="line">altwrite.call(document, &quot;hello&quot;);  // altwrite对象上下文由document对象上下文取代(即:原this内容无法访问)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">this.num = 9;</span><br><span class="line">var mymodule = &#123;</span><br><span class="line">  num: 81,</span><br><span class="line">  getNum: function() &#123; return this.num; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">module.getNum(); // 81</span><br><span class="line"> </span><br><span class="line">var getNum = module.getNum;</span><br><span class="line">getNum(); // 9, 因为在这个例子中，&quot;this&quot;指向全局对象</span><br><span class="line"> </span><br><span class="line">// 创建一个&#x27;this&#x27;绑定到module的函数</span><br><span class="line">var boundGetNum = getNum.bind(module);</span><br><span class="line">boundGetNum(); // 81</span><br></pre></td></tr></table></figure>
<p><code>Javascript中bind()方法的使用与实现 - Superlin&#39;s Blog </code><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002662251">https://segmentfault.com/a/1190000002662251</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var obj = &#123;</span><br><span class="line">    x: 81,</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">// var x=&#x27;88&#x27;,xx=&#x27;99&#x27;;</span><br><span class="line">var foo = &#123;</span><br><span class="line">    x :&#x27;88&#x27;,</span><br><span class="line">    xx : &#x27;99&#x27;,</span><br><span class="line">    getX : function() &#123;</span><br><span class="line">        console.log(this.x,this.xx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">console.log(foo.getX());            // 88,99</span><br><span class="line">console.log(foo.getX.bind(obj)());  // 81,undefined</span><br><span class="line">console.log(foo.getX.call(obj));    // 81,undefined</span><br><span class="line">console.log(foo.getX.apply(obj));   // 81,undefined</span><br></pre></td></tr></table></figure>
<p><code>chokcoco/apply-call-bind: 深入浅出妙用Javascript中apply、call、bind</code><br><a target="_blank" rel="noopener" href="https://github.com/chokcoco/apply-call-bind/tree/master">https://github.com/chokcoco/apply-call-bind/tree/master</a></p>
<h1 id="bind-捷径"><a href="#bind-捷径" class="headerlink" title="bind()捷径"></a>bind()捷径</h1><p>bind()也可以为需要特定this值的函数创造捷径。</p>
<p>例如要将一个类数组对象转换为真正的数组，可能的例子如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var slice = Array.prototype.slice;</span><br><span class="line"> </span><br><span class="line">// ...</span><br><span class="line"> </span><br><span class="line">slice.call(arguments);</span><br></pre></td></tr></table></figure>
<p>如果使用bind()的话，情况变得更简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var unboundSlice = Array.prototype.slice;</span><br><span class="line">var slice = Function.prototype.call.bind(unboundSlice);</span><br><span class="line"> </span><br><span class="line">// ...</span><br><span class="line"> </span><br><span class="line">slice(arguments);</span><br></pre></td></tr></table></figure>


<h1 id="在javascript中有三种声明变量的方式：var、let、const"><a href="#在javascript中有三种声明变量的方式：var、let、const" class="headerlink" title="在javascript中有三种声明变量的方式：var、let、const"></a>在javascript中有三种声明变量的方式：var、let、const</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var：声明全局变量</span><br><span class="line"></span><br><span class="line">let：声明块级变量，即局部变量.</span><br><span class="line">   - (注意：必须声明&#x27;use strict&#x27;;后才能使用let声明变量否则浏览并不能显示结果)</span><br><span class="line">const：用于声明常量，也具有块级作用域 </span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/u012786716/article/details/50740710">http://blog.csdn.net/u012786716/article/details/50740710</a></p>
<h1 id="快捷逻辑"><a href="#快捷逻辑" class="headerlink" title="快捷逻辑"></a>快捷逻辑</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">true  &amp;&amp; console.log(&#x27;1&#x27;);// 1</span><br><span class="line">false &amp;&amp; console.log(&#x27;2&#x27;); </span><br><span class="line"> </span><br><span class="line">true  || console.log(&#x27;3&#x27;);</span><br><span class="line">false || console.log(&#x27;4&#x27;);// 4</span><br></pre></td></tr></table></figure>


<h1 id="延展操作符-Spread-operator"><a href="#延展操作符-Spread-operator" class="headerlink" title="延展操作符(Spread operator)"></a>延展操作符(Spread operator)</h1><blockquote>
<p>（类似知识点： 隐性参数列表 arguments）</p>
</blockquote>
<p>这个 … 操作符（也被叫做延展操作符 － spread operator）已经被 ES6 数组 支持。它允许传递数组或者类数组直接做为函数的参数而不用通过apply。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function a(...args)&#123;</span><br><span class="line">    console.log(&#x27;a&#x27;,args); // a [1, 2, 3]</span><br><span class="line">    b(args); // b [1, 2, 3] undefined undefined</span><br><span class="line">    b(...args); // b 1 2 3</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function b(a,b,c)&#123;</span><br><span class="line">    console.log(&quot;b&quot;,a,b,c);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">a(1,2,3);</span><br></pre></td></tr></table></figure>


<h1 id="ES6字符串模板-Template-Literals（模板对象）-in-ES6"><a href="#ES6字符串模板-Template-Literals（模板对象）-in-ES6" class="headerlink" title="ES6字符串模板 Template Literals（模板对象） in ES6"></a>ES6字符串模板 Template Literals（模板对象） in ES6</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function ss() &#123;</span><br><span class="line">  var service = &#123;</span><br><span class="line">    _kingRank: `/acticity/question/kingRank/$&#123;userId&#125;/?pageSize=:pageSize&amp;currentPage=:currentPage`,</span><br><span class="line">    _friendsHelp: &#x27;/acticity/question/friendsHelp/:userId/?pageSize=:pageSize&amp;currentPage=:currentPage&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">  return service;</span><br><span class="line">&#125;</span><br><span class="line">var userId = 2; // 变量提升了</span><br><span class="line">console.log(ss()._kingRank);// /acticity/question/kingRank/2/?pageSize=:pageSize&amp;currentPage=:currentPage</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function ss() &#123;</span><br><span class="line">  var service = &#123;</span><br><span class="line">    _kingRank: `/acticity/question/kingRank/$&#123;userId&#125;/?pageSize=:pageSize&amp;currentPage=:currentPage`,</span><br><span class="line">    _friendsHelp: &#x27;/acticity/question/friendsHelp/:userId/?pageSize=:pageSize&amp;currentPage=:currentPage&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">  return service;</span><br><span class="line">&#125;</span><br><span class="line">function ff()&#123;</span><br><span class="line">  var userId = 2;</span><br><span class="line">  console.log(ss()._kingRank);// error 找不到 userId</span><br><span class="line">&#125;</span><br><span class="line">ff();</span><br></pre></td></tr></table></figure>


<h1 id="程序断点"><a href="#程序断点" class="headerlink" title="程序断点"></a>程序断点</h1><p>Chrome会自动在插入它的地方停止</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (thisThing) &#123;</span><br><span class="line">    debugger;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="快速定位调试函数-debug-funcName"><a href="#快速定位调试函数-debug-funcName" class="headerlink" title="快速定位调试函数 debug(funcName)"></a>快速定位调试函数 <code>debug(funcName)</code></h1><p>当我们想在函数里加个断点的时候，一般会选择这么做：<br>  1.在Inspector中找到指定行，然后添加一个断点<br>  2.在脚本中添加一个debugger调用</p>
<p>不过这两种方法都存在一个小问题就是都要到对应的脚本文件中然后再找到对应的行，这样会比较麻烦。这边介绍一个相对快捷点的方法，就是在console中使用debug(funcName)然后脚本会在指定到对应函数的地方自动停止。这种方法有个缺陷就是无法在私有函数或者匿名函数处停止，所以还是要因时而异：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var func1 = function() &#123;</span><br><span class="line">func2();</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">var Car = function() &#123;</span><br><span class="line">this.funcX = function() &#123;</span><br><span class="line">this.funcY();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">this.funcY = function() &#123;</span><br><span class="line">this.funcZ();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var car = new Car();</span><br></pre></td></tr></table></figure>

<h1 id="JavaScript截取字符串的Slice、Substring、Substr函数详解和比较"><a href="#JavaScript截取字符串的Slice、Substring、Substr函数详解和比较" class="headerlink" title="JavaScript截取字符串的Slice、Substring、Substr函数详解和比较"></a>JavaScript截取字符串的Slice、Substring、Substr函数详解和比较</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x27;第七章力&#x27;.slice(0,-1);// 第七章</span><br><span class="line">&#x27;第七章力&#x27;.substr(0,-1);// &quot;&quot;</span><br><span class="line">&#x27;第七章力&#x27;.substring(0,-1); // &quot;&quot;</span><br><span class="line"> </span><br><span class="line">&#x27;第七章力&#x27;.slice(0,&#x27;第七章力&#x27;.indexOf(&#x27;章&#x27;)+1);//  第七章</span><br><span class="line">&#x27;第七章力&#x27;.substr(0,&#x27;第七章力&#x27;.indexOf(&#x27;章&#x27;)+1);//  第七章</span><br></pre></td></tr></table></figure>
<p><code>JavaScript截取字符串的Slice、Substring、Substr函数详解和比较_javascript技巧_脚本之家</code><br><a target="_blank" rel="noopener" href="http://www.jb51.net/article/48257.htm">http://www.jb51.net/article/48257.htm</a></p>
<p><code>JavaScript 数组：对比 slice 与 splice - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/MZ77Nvz">http://www.tuicool.com/articles/MZ77Nvz</a></p>
<h1 id="除自己-选择姐妹标签-siblings"><a href="#除自己-选择姐妹标签-siblings" class="headerlink" title="除自己,选择姐妹标签(siblings)"></a>除自己,选择姐妹标签(siblings)</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$(&#x27;.navbar_rank&#x27;).on(&#x27;click&#x27;, &#x27;.switch&#x27;, function () &#123;</span><br><span class="line">     $(this).addClass(&#x27;activity&#x27;).siblings(&#x27;.activity&#x27;).removeClass(&#x27;activity&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>weiui css<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$(&#x27;.shrink-items&#x27;).on(&#x27;click&#x27;, &#x27;.shrink-item&#x27;, function () &#123;</span><br><span class="line">  if ($(this).hasClass(&#x27;active&#x27;)) &#123;</span><br><span class="line">    $(this).removeClass(&#x27;active&#x27;);// 已展开,收起来</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    $(this).addClass(&#x27;active&#x27;).siblings(&#x27;.active&#x27;).removeClass(&#x27;active&#x27;);// 切换展开</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>等效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$(&#x27;.shrink-item&#x27;).on(&#x27;click&#x27;, function () &#123;</span><br><span class="line">  if ($(this).hasClass(&#x27;active&#x27;)) &#123;</span><br><span class="line">    $(this).removeClass(&#x27;active&#x27;);// 已展开,收起来</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    $(this).addClass(&#x27;active&#x27;).siblings(&#x27;.active&#x27;).removeClass(&#x27;active&#x27;);// 切换展开</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h1 id="prototype原型扩展-与方法内预定义"><a href="#prototype原型扩展-与方法内预定义" class="headerlink" title="prototype原型扩展,与方法内预定义"></a>prototype原型扩展,与方法内预定义</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function People(name, age) &#123;</span><br><span class="line">  this.u_name = name;</span><br><span class="line">  this.u_age = age;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">People.prototype.getName = function () &#123;</span><br><span class="line">  return this.u_name;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">dir(People);</span><br><span class="line">dir(new People(2));</span><br><span class="line">console.log(new People(3).getName());// 3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function People(name, age) &#123;</span><br><span class="line">    this.u_name = name;</span><br><span class="line">    this.u_age = age;</span><br><span class="line"> </span><br><span class="line">    function getName() &#123;</span><br><span class="line">        return this.u_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">dir(People);</span><br><span class="line">dir(new People(2));</span><br><span class="line">console.log(new People(3).getName());// Uncaught TypeError: (intermediate value).getName is not a function</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function People(name, age) &#123;</span><br><span class="line">    this.u_name = name;</span><br><span class="line">    this.u_age = age;</span><br><span class="line"> </span><br><span class="line">    this.getName = function() &#123;</span><br><span class="line">        return this.u_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var p = new People(4)</span><br><span class="line">console.log(p.getName());// 4</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function People(name, age) &#123;</span><br><span class="line"> </span><br><span class="line">    function getName() &#123;</span><br><span class="line">        return this.u_name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    return &#123;</span><br><span class="line">        u_name: name,</span><br><span class="line">        u_age: age,</span><br><span class="line">        getName: getName</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var p = new People(4)</span><br><span class="line">console.log(p.getName()); // 4</span><br></pre></td></tr></table></figure>


<h1 id="强制重排-重绘"><a href="#强制重排-重绘" class="headerlink" title="强制重排,重绘"></a>强制重排,重绘</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 对面板强行重绘（解决文字重叠问题）</span><br><span class="line">$(&quot;ion-content&quot;).css(&#x27;display&#x27;, &#x27;none&#x27;);</span><br><span class="line">document.body.offsetWidth;// 在样式变化间加入计算,可强制提交之前的样式变化。否则浏览器会进行事务优化，事务前后无变化的不再重绘</span><br><span class="line">$(&quot;ion-content&quot;).css(&#x27;display&#x27;, &#x27;&#x27;);</span><br></pre></td></tr></table></figure>


<h1 id="删除数组"><a href="#删除数组" class="headerlink" title="删除数组"></a>删除数组</h1><ul>
<li>使用<code>delete</code></li>
</ul>
<p>【非gangular(ng-repeat)环境,不能动态更新已展示元素的index下标】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a=[&#x27;a&#x27;,&#x27;b&#x27;,&#x27; c &#x27;];</span><br><span class="line">delete a[0];</span><br><span class="line">a;// [undefined × 1, &quot;b&quot;, &quot;c&quot;]</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>splice</code> (推荐)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var a=[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;];</span><br><span class="line">a.splice(0,1);// 参数一：位置，参数二：删除数量</span><br><span class="line">a;//  [&quot;b&quot;, &quot;c&quot;]</span><br></pre></td></tr></table></figure></li>
<li>使用过滤器<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var arr = [2, 3, 5, 7];</span><br><span class="line">arr = arr.filter(item =&gt; item !== 5);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="循环中删除数组"><a href="#循环中删除数组" class="headerlink" title="循环中删除数组"></a>循环中删除数组</h1><ul>
<li>循环中删除<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var a=[1,2,3,4,5,6];</span><br><span class="line">a.forEach(function(item,index)&#123;</span><br><span class="line">    // console.log(item,index);</span><br><span class="line">    if(item == 2 || item == 3)&#123;</span><br><span class="line">        console.log(&#x27;remove&#x27;,index);</span><br><span class="line">        // a.splice(index,1);// 存在实时移位造成数据跳过的问题</span><br><span class="line">        delete a[index];// 保留位置删除，避免实时移位问题</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(a);// [1, undefined × 2, 4, 5, 6]</span><br><span class="line">a = a.filter(item =&gt; item !== &#x27;undefined&#x27;);// 清楚null值</span><br><span class="line">console.log(a);// [1, 4, 5, 6]</span><br></pre></td></tr></table></figure></li>
<li>逆向遍历<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var arr = [2, 3, 5, 7];</span><br><span class="line">for (let i = arr.length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">    if (arr[i] === 5) &#123;</span><br><span class="line">        arr.splice(i, 1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>js 如何一次性删除数组中的多个元素？</code><br><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000006956973?_ea=1190266">https://segmentfault.com/q/1010000006956973?_ea=1190266</a></p>
<p><code>JavaScript splice() 方法</code><br><a target="_blank" rel="noopener" href="http://www.w3school.com.cn/jsref/jsref_splice.asp">http://www.w3school.com.cn/jsref/jsref_splice.asp</a></p>
<hr>
<p><code>JavaScript 精粹 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/Mv6zUr">http://www.tuicool.com/articles/Mv6zUr</a></p>
<p><code>50 tips of JavaScript，这些坑你都知道吗？</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/MZfuA3r">http://www.tuicool.com/articles/MZfuA3r</a></p>
<p><code>12个JavaScript技巧 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/uyMNraF">http://www.tuicool.com/articles/uyMNraF</a></p>
<p><code>JavaScript调试十个小Tips - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/RnmA3mR">http://www.tuicool.com/articles/RnmA3mR</a></p>
<p><code>搜索 JavaScript Tips - 推酷</code></p>
<p><a target="_blank" rel="noopener" href="http://www.tuicool.com/search?kw=JavaScript+Tips">http://www.tuicool.com/search?kw=JavaScript+Tips</a></p>
<p><code>console 让 js 调试更简单 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/ymm6nan">http://www.tuicool.com/articles/ymm6nan</a></p>
<p><code>Web程序员必须知道的 Console 对象里的九个方法 - 推酷</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/bANryqF">http://www.tuicool.com/articles/bANryqF</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/javaScript%20tips/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/linux%20Tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/linux%20Tips/" class="post-title-link" itemprop="url">linux Tips</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-17 00:00:00" itemprop="dateCreated datePublished" datetime="2016-05-17T00:00:00+00:00">2016-05-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:21" itemprop="dateModified" datetime="2024-01-26T12:42:21+00:00">2024-01-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><p>查找进程<br>ps -ef|grep wiki</p>
</li>
<li><p>查看<code>进程/服务</code>，具体的安装路径 （方法一）<br>ps -ef | grep java<br>ps -ef | grep nginx<br>ps -ef | grep tomcat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root      1573     1  0 Jul15 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx</span><br><span class="line">nobody    1574  1573  0 Jul15 ?        00:19:25 nginx: worker process    </span><br><span class="line">root     31106 28615  0 14:27 pts/0    00:00:00 grep nginx</span><br></pre></td></tr></table></figure>

</li>
<li><p>查看<code>进程/服务</code>，具体的安装路径（方法二）<br><code>ls -l /proc/$PID/exe</code> ($PID为对应的pid号)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[sysadmin@iZ23j23f6aaZ ~]$ ps -ef|grep tomcat</span><br><span class="line">root      7420     1  5 11:08 pts/0  ...</span><br><span class="line">[sysadmin@iZ23j23f6aaZ ~]$ sudo ls -l /proc/7420/exe</span><br><span class="line">lrwxrwxrwx 1 root root 0 Jul 25 11:08 /proc/7420/exe -&gt; /usr/lib/jvm/java-1.7.0-openjdk-1.7.0.75.x86_64/jre/bin/java</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[sysadmin@iZ23j23f6aaZ ~]$ ps -ef|grep nginx</span><br><span class="line">root      4824     1  0 Jul22 ?       ...</span><br><span class="line">[sysadmin@iZ23j23f6aaZ ~]$ sudo ls -l /proc/4824/exe</span><br><span class="line">lrwxrwxrwx 1 root root 0 Jul 22 18:23 /proc/4824/exe -&gt; /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>

</li>
<li><p>停止进程<br>kill -7 xxx</p>
</li>
<li><p>查看那个进程占用了xxx端口<br>lsof -i:xxx</p>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/linux%20Tips/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/chrome%20Emulated%20Devices/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/chrome%20Emulated%20Devices/" class="post-title-link" itemprop="url">chrome Emulated Devices</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-14 00:00:02" itemprop="dateCreated datePublished" datetime="2016-05-14T00:00:02+00:00">2016-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:21" itemprop="dateModified" datetime="2024-01-26T12:42:21+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/chrome-Emulated-Devices/" itemprop="url" rel="index"><span itemprop="name">chrome Emulated Devices</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="设备信息"><a href="#设备信息" class="headerlink" title="设备信息"></a>设备信息</h1><p><code>xiaomi note</code>  393 *  699 （-25）&#x3D; 393 * 674</p>
<p>Mozilla&#x2F;5.0 (Linux; U; Android 6.0.1; zh-cn; MI NOTE LTE Build&#x2F;MMB29M) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Version&#x2F;4.0 Chrome&#x2F;46.0.2490.85 Mobile Safari&#x2F;537.36 XiaoMi&#x2F;MiuiBrowser&#x2F;2.1.1 </p>
<p><code>华为Pad T1</code> 601 * 962 （-60）&#x3D; 601 * 902</p>
<p><code>iPad</code> 768*1024   （电池条如果设置浮动透明，则会与浏览器中调试接近）</p>
<p><code>诺基亚pad n1s</code> 768 * 976  （-25）  &#x3D; 768 * 951</p>
<h1 id="获取方式"><a href="#获取方式" class="headerlink" title="获取方式"></a>获取方式</h1><p><code>访问</code> <a target="_blank" rel="noopener" href="http://liuxiang.github.io/online-web-tools">http://liuxiang.github.io/online-web-tools</a></p>
<p><code>短地址</code> <a target="_blank" rel="noopener" href="http://t.im/142vg">http://t.im/142vg</a></p>
<ul>
<li>有效分辨率：</li>
</ul>
<hr>
<ul>
<li>手机分辨率比例</li>
</ul>
<p>1536&#x2F;2048&#x3D;0.75</p>
<p>720&#x2F;1280&#x3D;0.56</p>
<p>1242&#x2F;2208&#x3D;0.56</p>
<p>1080&#x2F;1920&#x3D;0.56</p>
<p>1440&#x2F;2560&#x3D;0.56</p>
<hr>
<p>ipad &amp; ipad mini：768&#x2F;1024&#x3D;0.75</p>
<p>华为pad：601&#x2F;962&#x3D;0.62</p>
<p>华为pad：601&#x2F;(962-60)&#x3D;0.66</p>
<p>诺基亚pad：768&#x2F;976&#x3D;0.78</p>
<p>华为荣耀6：360&#x2F;592&#x3D;0.60</p>
<p>华为荣耀6：360&#x2F;(592-?)&#x3D;0.60</p>
<p>xiaomi note:392&#x2F;699&#x3D;0.56</p>
<p>xiaomi note:392&#x2F;(699-20)&#x3D;0.58</p>
<hr>
<p>分辨率：<br>Android：主流机型主要为 480x800, 480x854, 540x960, 720x1280, 800x1280 这五种。<br>（非主流机型还包括：240x320, 320x480, 640x960 这三种，其中两种都与 iPhone 一致。）<br>iOS: 主流机型主要为 320x480, 640x960, 640x1136, 1024x768, 2048x1536, 这五种。<br>WP：主流机型主要为 480x800，720x1280, 768x1280 这三种<br>其他：不清楚，请别人回答。</p>
<p>屏幕尺寸：<br>android：一般在4寸-4.8寸之间，也有小到 3.2寸的，也有5寸，7寸，10寸的。<br>iOS：3.5寸，9.8寸，4.0 寸，7.8 寸。</p>
<p>作者：pansz<br>链接：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20440405/answer/15140879">https://www.zhihu.com/question/20440405/answer/15140879</a></p>
<p><code>【友盟+】全域指数 </code> <a target="_blank" rel="noopener" href="http://www.umindex.com/devices/android_resolutions">http://www.umindex.com/devices/android_resolutions</a></p>
<hr>
<p>20&#x2F;1280&#x3D;0.56<br>720&#x2F;1184&#x3D;0.60<br>960&#x2F;1440&#x3D;0.66<br>1536&#x2F;2048&#x3D;0.75</p>
<p>0.56-0.62&#x3D;-0.05<br>0.60-0.62&#x3D;-0.02  </p>
<p>0.66-0.62&#x3D;0.04   (0.66&gt;0.62意味着0.66相比0.62更接近1即越“方or宽”，而0.62则相比0.66越”长or高”)<br>0.75-0.62&#x3D;0.13</p>
<hr>
<p>(以下使用 xiaomi note 进行测试)</p>
<p><code>xiaomi note</code>  393 * 699  （-25）&#x3D;  393 * 674</p>
<p>浏览器调试：                                                                                                                                                                                                手机上实际效果：</p>
<p>减去电池条高度（-25），更接近</p>
<p> 手机浏览器                                                                                                                   微信浏览器</p>
<hr>
<p><code>华为Pad T1</code> 601 * 962  （-60）&#x3D; 601 * 902</p>
<p>华为Pad T1,测试结果需要将高度（-60）才与真实的接近（原因是华为的软件底条和电池条占用了高度）  902&#x2F;962&#x3D;0.93</p>
<hr>
<p><code>诺基亚pad n1s</code> 768 * 976  （-25）  &#x3D; 768 * 951</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/chrome%20Emulated%20Devices/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/online-web-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/online-web-tools/" class="post-title-link" itemprop="url">online-web-tools</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-05-14 00:00:00" itemprop="dateCreated datePublished" datetime="2016-05-14T00:00:00+00:00">2016-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:17" itemprop="dateModified" datetime="2024-01-26T12:42:17+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/online-web-tools/" itemprop="url" rel="index"><span itemprop="name">online-web-tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="online-web-tools"><a href="#online-web-tools" class="headerlink" title="online-web-tools"></a>online-web-tools</h1><p>在线web工具  </p>
<p><code>访问</code> <a target="_blank" rel="noopener" href="http://liuxiang.github.io/online-web-tools">http://liuxiang.github.io/online-web-tools</a></p>
<p><code>短地址</code>  <a target="_blank" rel="noopener" href="http://t.im/142vg">http://t.im/142vg</a></p>
<h1 id="展示"><a href="#展示" class="headerlink" title="展示"></a>展示</h1><p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/16-5-14/53885268.jpg"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/online-web-tools/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/32/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><span class="page-number current">33</span><a class="page-number" href="/page/34/">34</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/34/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DJY</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
