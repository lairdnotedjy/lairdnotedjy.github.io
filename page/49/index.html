<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="baidu-site-verification" content="codeva-6wmKWl5hmx" />
<meta name="bytedance-verification-code" content="GcOf/MpQ8shZ5Hh/2hvr" />
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4522670236044605"
     crossorigin="anonymous"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-33RJLY0818"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-33RJLY0818');
</script>

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.sovdating.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Hello dev">
<meta property="og:type" content="website">
<meta property="og:title" content="Sovdating Linux">
<meta property="og:url" content="https://www.sovdating.com/page/49/index.html">
<meta property="og:site_name" content="Sovdating Linux">
<meta property="og:description" content="Hello dev">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="DJY">
<meta property="article:tag" content="golang python linux ubuntu centos rust">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.sovdating.com/page/49/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/49/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Sovdating Linux - some code for program</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Sovdating Linux</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">some code for program</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">DJY</p>
  <div class="site-description" itemprop="description">Hello dev</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">554</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">94</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">389</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Selenium-simulated-user-login-alipay-account-query-transaction-details/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Selenium-simulated-user-login-alipay-account-query-transaction-details/" class="post-title-link" itemprop="url">使用Selenium模拟用户登录支付宝账户查询交易详情</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-08-29 21:39:00" itemprop="dateCreated datePublished" datetime="2015-08-29T21:39:00+00:00">2015-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:27" itemprop="dateModified" datetime="2024-01-26T12:42:27+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Selenium简介"><a href="#Selenium简介" class="headerlink" title="Selenium简介"></a>Selenium简介</h3><p><code>Selenium</code>是一个用于Web应用程序测试的工具。<code>Selenium</code>测试直接运行在浏览器中，就像真正的用户在操作一样。支持的浏览器包括IE、Mozilla Firefox、Chrome等。这个工具的主要功能包括：测试与浏览器的兼容性——测试你的应用程序看是否能够很好得工作在不同浏览器和操作系统之上。测试系统功能——创建回归测试检验软件功能和用户需求。支持自动录制动作和自动生成<code>.Net</code>、<code>Java</code>、<code>Perl</code>等不同语言的测试脚本。<code>Selenium</code>是<code>ThoughtWorks</code>专门为Web应用程序编写的一个验收测试工具。</p>
<h3 id="Selenium的优势"><a href="#Selenium的优势" class="headerlink" title="Selenium的优势"></a>Selenium的优势</h3><p>据<code>Selenium</code>主页所说，与其他测试工具相比，使用<code>Selenium</code>的最大好处是：<code>Selenium</code>测试直接在浏览器中运行，就像真实用户所做的一样。<code>Selenium</code>测试可以在<code>Windows</code>、<code>Linux</code>和<code>Macintosh</code>上的<code>Internet Explorer</code>、<code>Mozilla</code>和<code>Firefox</code>中运行。其他测试工具都不能覆盖如此多的平台。使用<code>Selenium</code>和在浏览器中运行测试还有很多其他好处。下面是主要的两大好处：</p>
<ul>
<li>通过编写模仿用户操作的<code>Selenium</code>测试脚本，可以从终端用户的角度来测试应用程序</li>
<li>通过在不同浏览器中运行测试，更容易发现浏览器的不兼容性</li>
</ul>
<p><code>Selenium</code>的核心，也称<code>browser bot</code>，是用<code>JavaScript</code>编写的。这使得测试脚本可以在受支持的浏览器中运行。<code>browser bot</code>负责执行从测试脚本接收到的命令，测试脚本要么是用<code>HTML</code>的表布局编写的，要么是使用一种受支持的编程语言编写的。</p>
<h3 id="Selenium-WebDriver"><a href="#Selenium-WebDriver" class="headerlink" title="Selenium-WebDriver"></a>Selenium-WebDriver</h3><p><code>Selenium-WebDriver</code>支持如下浏览器，在所有支持这些浏览器的操作系统中能都运行良好。</p>
<ul>
<li>Google Chrome 12.0.712.0+</li>
<li>Internet Explorer 6, 7, 8, 9 - 32 and 64-bit where applicable</li>
<li>Firefox 3.0, 3.5, 3.6, 4.0, 5.0, 6, 7</li>
<li>Opera 11.5+</li>
<li>HtmlUnit 2.9</li>
<li>Android – 2.3+ for phones and tablets (devices &amp; emulators)</li>
<li>iOS 3+ for phones (devices &amp; emulators) and 3.2+ for tablets (devices &amp; emulators)</li>
</ul>
<h3 id="Selenium开发环境"><a href="#Selenium开发环境" class="headerlink" title="Selenium开发环境"></a>Selenium开发环境</h3><p>如欲使用Java语言，那么JDK的环境是必备的。使用<code>Selenium</code>来驱动浏览器，那么必须要有<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1o6quY5G">浏览器驱动包</a>，同样还需要<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1o6vKGh8">Selenium的Jar包</a>，点击下载即可。</p>
<h3 id="Selenium启动浏览器"><a href="#Selenium启动浏览器" class="headerlink" title="Selenium启动浏览器"></a>Selenium启动浏览器</h3><h4 id="启动Firefox"><a href="#启动Firefox" class="headerlink" title="启动Firefox"></a>启动Firefox</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//后一个参数是Firefox的安装路径</span></span><br><span class="line">System.setProperty(<span class="string">&quot;webdriver.firefox.bin&quot;</span>, <span class="string">&quot;C:/Program Files (x86)/Mozilla Firefox/firefox.exe&quot;</span>);</span><br><span class="line"><span class="type">WebDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FirefoxDriver</span>();</span><br><span class="line">driver.get(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="启动Chrome"><a href="#启动Chrome" class="headerlink" title="启动Chrome"></a>启动Chrome</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//后一个参数是Chrome浏览器的驱动，需要下载</span></span><br><span class="line">System.setProperty(<span class="string">&quot;webdriver.chrome.driver&quot;</span>, <span class="string">&quot;D:/chromedriver.exe&quot;</span>);</span><br><span class="line"><span class="type">WebDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChromeDriver</span>();</span><br><span class="line">driver.get(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="启动IE"><a href="#启动IE" class="headerlink" title="启动IE"></a>启动IE</h4><p>作为开发人员，建议您应该远离IE，虽然我不太愿意提供IE的启动方式给您！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">&quot;webdriver.ie.driver&quot;</span>, <span class="string">&quot;D:/IEDriverServer.exe&quot;</span>);</span><br><span class="line"><span class="type">WebDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InternetExplorerDriver</span>();</span><br><span class="line">driver.get(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="常见问题的处理方法"><a href="#常见问题的处理方法" class="headerlink" title="常见问题的处理方法"></a>常见问题的处理方法</h3><blockquote>
<p>How to select any element from the web element with “display: none” attribute using Selenium ?<br>特别是在处理因为<code>&lt;select&gt;</code>标签中带有<code>style=&#39;display:none&#39;</code>而无法设置option的情况时很有效！</p>
</blockquote>
<p>方法：</p>
<blockquote>
<p>Use execute_script() to set the display property of that element and then use the Selenium Select for selecting a required value.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JavascriptExecutor</span> <span class="variable">js</span> <span class="operator">=</span> (JavascriptExecutor) driver;<span class="comment">//将driver对象强转成JavascriptExecutor</span></span><br><span class="line">js.executeScript(<span class="string">&quot;document.getElementById(&#x27;J-select-range&#x27;).style.display=&#x27;inline&#x27;;&quot;</span>);<span class="comment">//修改display的值，也可以修改为display=&#x27;list-item&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Element is not currently visible and may not be manipulated</p>
</blockquote>
<p>一般这种错误是因为父元素有<code>style=&#39;display:none&#39;</code>属性或者是页面还没有加载完全，最简单的就是使用<code>Thread.sleep(1000);</code>休息一秒之后再操作。当然也可以使用until方法直到其出现再对其进行操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WebDriverWait</span> <span class="variable">wait</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebDriverWait</span>(driver, <span class="number">300</span>);</span><br><span class="line"><span class="type">WebElement</span> <span class="variable">selectElement</span> <span class="operator">=</span> wait.until(ExpectedConditions.visibilityOfElementLocated(By.id(<span class="string">&quot;formLevel:levels_input&quot;</span>)));</span><br><span class="line"><span class="type">Select</span> <span class="variable">select</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Select</span>(selectElement);</span><br><span class="line">select.selectByVisibleText(<span class="string">&quot;SECURITY&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="模拟用户登录支付宝查询交易信息的程序"><a href="#模拟用户登录支付宝查询交易信息的程序" class="headerlink" title="模拟用户登录支付宝查询交易信息的程序"></a>模拟用户登录支付宝查询交易信息的程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.openqa.selenium.By;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.JavascriptExecutor;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebElement;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.chrome.ChromeDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.support.ui.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注意此流程适应于旧版支付宝，新版支付宝页面未测试</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu 2015/8/29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeleniumAlipay</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> WebDriver driver;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    定义自己的休眠方法，精简代码量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">long</span> time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(time);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    登录操作，负责将界面跳转到交易记录界面</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//        启动火狐浏览器</span></span><br><span class="line"><span class="comment">//        System.setProperty(&quot;webdriver.firefox.bin&quot;, &quot;C:/Program Files (x86)/Mozilla Firefox/firefox.exe&quot;);</span></span><br><span class="line"><span class="comment">//        WebDriver driver = new FirefoxDriver();</span></span><br><span class="line"><span class="comment">//        启动Chrome浏览器</span></span><br><span class="line">        System.setProperty(<span class="string">&quot;webdriver.chrome.driver&quot;</span>, <span class="string">&quot;D:/chromedriver.exe&quot;</span>);</span><br><span class="line">        driver = <span class="keyword">new</span> <span class="title class_">ChromeDriver</span>();</span><br><span class="line"><span class="comment">//        获取登录页面</span></span><br><span class="line">        driver.get(<span class="string">&quot;https://auth.alipay.com/login/index.htm?goto=https%3A%2F%2Fwww.alipay.com%2F&quot;</span>);</span><br><span class="line"><span class="comment">//        获取用户名输入框</span></span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;J-input-user&quot;</span>)).clear();</span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;J-input-user&quot;</span>)).sendKeys(<span class="string">&quot;支付宝账户&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        休息500ms，否则，速度太快，会将密码内容填充到用户名输入框中</span></span><br><span class="line">        sleep(<span class="number">500</span>);</span><br><span class="line"><span class="comment">//        获取密码输入框</span></span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;password_rsainput&quot;</span>)).clear();</span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;password_rsainput&quot;</span>)).sendKeys(<span class="string">&quot;密码&quot;</span>);</span><br><span class="line"><span class="comment">//        休息8秒等待用户输入验证码</span></span><br><span class="line">        sleep(<span class="number">8000</span>);</span><br><span class="line"><span class="comment">//        当前URL 0 ：https://authsu18.alipay.com/login/certCheck.htm?goto=https%3A%2F%2Fwww.alipay.com%2F</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 0 ：&quot;</span> + driver.getCurrentUrl());</span><br><span class="line">        driver.get(<span class="string">&quot;https://www.alipay.com/&quot;</span>);</span><br><span class="line"><span class="comment">//        点击个人用户登录</span></span><br><span class="line">        driver.findElement(By.className(<span class="string">&quot;personal-login&quot;</span>)).click();</span><br><span class="line"><span class="comment">//        当前URL 1 ：https://www.alipay.com/</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 1 ：&quot;</span> + driver.getCurrentUrl());</span><br><span class="line">        sleep(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">myAlipay</span> <span class="operator">=</span> driver.findElement(By.className(<span class="string">&quot;am-button-innerNav,button-myalipay&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;myAlipay isSelected ：&quot;</span> + myAlipay.isSelected());<span class="comment">//false</span></span><br><span class="line">        System.out.println(<span class="string">&quot;myAlipay isEnabled ：&quot;</span> + myAlipay.isEnabled());<span class="comment">//true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;myAlipay isDisplayed ：&quot;</span> + myAlipay.isDisplayed());<span class="comment">//true</span></span><br><span class="line"><span class="comment">//        点击进入我的支付宝按钮</span></span><br><span class="line">        driver.findElement(By.className(<span class="string">&quot;am-button-innerNav,button-myalipay&quot;</span>)).click();</span><br><span class="line"><span class="comment">//        当前URL 2 ：https://my.alipay.com/portal/i.htm</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 2 ：&quot;</span> + driver.getCurrentUrl());</span><br><span class="line"><span class="comment">//        boolean selected1 = driver.findElement(By.className(&quot;fn-ml10&quot;)).isSelected();</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;收支明细是否选中：&quot; + selected1);</span></span><br><span class="line"><span class="comment">//        org.openqa.selenium.NoSuchElementException: no such keyword: Element was not in a form, so could not submit.</span></span><br><span class="line"><span class="comment">//        driver.findElement(By.className(&quot;fn-ml10&quot;)).submit();//跳转收支明细</span></span><br><span class="line"><span class="comment">//        Exception in thread &quot;main&quot; org.openqa.selenium.WebDriverException: unknown error: Element is not clickable at point</span></span><br><span class="line"><span class="comment">//        driver.findElement(By.xpath(&quot;//*[@id=\&quot;J-trend-consume\&quot;]/div/div[1]/div/a[1]&quot;)).click();</span></span><br><span class="line"><span class="comment">//        driver.findElement(By.className(&quot;fn-ml10&quot;)).click();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        无反应，看样子一直不会让你点的了</span></span><br><span class="line"><span class="comment">//        WebDriverWait webDriverWait = new WebDriverWait(driver, 3);</span></span><br><span class="line"><span class="comment">//        webDriverWait.until(ExpectedConditions.elementToBeClickable(By.xpath(&quot;//*[@id=\&quot;J-trend-consume\&quot;]/div/div[1]/div/a[1]&quot;)));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        跳转到收支明细界面</span></span><br><span class="line"><span class="comment">//        driver.get(&quot;https://xlab.alipay.com/consume/record/items.htm&quot;);</span></span><br><span class="line">        <span class="comment">//跳转到交易记录界面</span></span><br><span class="line">        driver.get(<span class="string">&quot;https://consumeprod.alipay.com/record/index.htm&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">currentUrl</span> <span class="operator">=</span> driver.getCurrentUrl();</span><br><span class="line"><span class="comment">//        当前URL 3 ：https://consumeprod.alipay.com/record/advanced.htm</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 3 ：&quot;</span> + currentUrl);</span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        login();</span><br><span class="line">        <span class="type">String</span> <span class="variable">oppositeUser</span> <span class="operator">=</span> getOppositeUser(<span class="string">&quot;20150826110500100010740029003925&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交易方对方信息：&quot;</span> + oppositeUser);</span><br><span class="line">        oppositeUser = getOppositeUser(<span class="string">&quot;20150720110500100010740025980311&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交易方对方信息：&quot;</span> + oppositeUser);</span><br><span class="line">        oppositeUser = getOppositeUser(<span class="string">&quot;2015081521001004740064396260&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交易方对方信息：&quot;</span> + oppositeUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    获取交易对方信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getOppositeUser</span><span class="params">(String transactionNo)</span> &#123;</span><br><span class="line">        <span class="comment">//获取关键字对应的下拉框</span></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">keywordInput</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;J-keyword&quot;</span>));</span><br><span class="line">        keywordInput.clear();</span><br><span class="line">        keywordInput.sendKeys(transactionNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">keywordSelect</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;keyword&quot;</span>));</span><br><span class="line">        List&lt;WebElement&gt; options = keywordSelect.findElements(By.tagName(<span class="string">&quot;option&quot;</span>));</span><br><span class="line">        <span class="comment">//until方法表示直到可点再点</span></span><br><span class="line"><span class="comment">//        WebElement selectElement = wait.until(ExpectedConditions</span></span><br><span class="line"><span class="comment">//                .visibilityOfElementLocated(By.id(&quot;keyword&quot;)));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        需要执行JavaScript语句，所以强转driver</span></span><br><span class="line">        <span class="type">JavascriptExecutor</span> <span class="variable">js</span> <span class="operator">=</span> (JavascriptExecutor) driver;</span><br><span class="line"><span class="comment">//        也可以这么用setAttribute(&quot;style&quot;,&quot;&quot;);</span></span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;keyword&#x27;).style.display=&#x27;list-item&#x27;;&quot;</span>);</span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;keyword&#x27;).removeAttribute(&#x27;smartracker&#x27;);&quot;</span>);</span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;keyword&#x27;).options[1].selected = true;&quot;</span>);</span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;J-select-range&#x27;).style.display=&#x27;list-item&#x27;;&quot;</span>);</span><br><span class="line"><span class="comment">//        设置交易时间选项</span></span><br><span class="line">        <span class="type">Select</span> <span class="variable">selectTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Select</span>(driver.findElement(By.id(<span class="string">&quot;J-select-range&quot;</span>)));</span><br><span class="line">        selectTime.selectByIndex(<span class="number">3</span>);<span class="comment">//选中的是最近三个月</span></span><br><span class="line">        System.out.println(<span class="string">&quot;selectTime.isMultiple() : &quot;</span> + selectTime.isMultiple());</span><br><span class="line"><span class="comment">//        设置关键字选项</span></span><br><span class="line">        <span class="type">Select</span> <span class="variable">selectKeyword</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Select</span>(driver.findElement(By.id(<span class="string">&quot;keyword&quot;</span>)));</span><br><span class="line">        <span class="comment">//        selectKeyword.selectByValue(&quot;bizInNo&quot;);//此处的value填写&lt;option&gt;标签中的value值</span></span><br><span class="line">        selectKeyword.selectByIndex(<span class="number">1</span>);<span class="comment">//选中的是交易号</span></span><br><span class="line">        System.out.println(<span class="string">&quot;selectKeyword.isMultiple() : &quot;</span> + selectKeyword.isMultiple());</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">queryButton</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;J-set-query-form&quot;</span>));<span class="comment">//拿到搜索按钮</span></span><br><span class="line"><span class="comment">//        点击搜索按钮</span></span><br><span class="line">        queryButton.submit();</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">tr</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;J-item-1&quot;</span>));<span class="comment">//先获取tr</span></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">td</span> <span class="operator">=</span> tr.findElement(By.xpath(<span class="string">&quot;//*[@id=\&quot;J-item-1\&quot;]/td[5]/p[1]&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> td.getText();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/automatic_query_alipay_treasure_transaction_information.gif"></p>
<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://baike.baidu.com/subview/478050/6464537.htm">http://baike.baidu.com/subview/478050/6464537.htm</a><br>[2] <a target="_blank" rel="noopener" href="http://blog.csdn.net/wanglha/article/details/39755613">http://blog.csdn.net/wanglha/article/details/39755613</a><br>[3] <a target="_blank" rel="noopener" href="http://webdriver.blog.51cto.com/10517592/1673920">http://webdriver.blog.51cto.com/10517592/1673920</a><br>[4] <a target="_blank" rel="noopener" href="http://blog.csdn.net/pf20050904/article/details/20052485">http://blog.csdn.net/pf20050904/article/details/20052485</a><br>[5] <a target="_blank" rel="noopener" href="http://www.open-open.com/doc/view/9f52277e5d9c4dd3b851ae54011e733a">http://www.open-open.com/doc/view/9f52277e5d9c4dd3b851ae54011e733a</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Based-on-the-extended-version-of-synonyms-Cilin-word-similarity-computing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Based-on-the-extended-version-of-synonyms-Cilin-word-similarity-computing/" class="post-title-link" itemprop="url">基于同义词词林扩展版的词语相似度计算</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-08-04 22:06:36" itemprop="dateCreated datePublished" datetime="2015-08-04T22:06:36+00:00">2015-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:26" itemprop="dateModified" datetime="2024-01-26T12:42:26+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithms/" itemprop="url" rel="index"><span itemprop="name">Algorithms</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="词语相似度计算"><a href="#词语相似度计算" class="headerlink" title="词语相似度计算"></a>词语相似度计算</h4><p>词义相似度计算在很多领域中都有广泛的应用，例如信息检索、信息抽取、文本分类、词义排歧、基于实例的机器翻译等等。国内目前主要是使用知网和同义词词林来进行词语的相似度计算。</p>
<p>本文主要是根据《基于同义词词林的词语相似度计算方法–田久乐》论文中所提出的分层算法实现相似度计算，程序采用Java语言编写。</p>
<h4 id="同义词词林扩展版"><a href="#同义词词林扩展版" class="headerlink" title="同义词词林扩展版"></a>同义词词林扩展版</h4><p>《同义词词林》是梅家驹等人于1983年编纂而成，这本词典中不仅包括了一个词语的同义词，也包含了一定数量的同类词，即广义的相关词。《同义词词林扩展版》是由哈尔滨工业大学信息检索实验室所重新修订所得。该版收录词语近7万条，全部按意义进行编排，是一部同义类词典。</p>
<p>同义词词林按照树状的层次结构把所有收录的词条组织到一起，把词汇分成大、中、小三类，大类有12个，中类有97个，小类有1400个。每个小类里都有很多的词，这些词又根据词义的远近和相关性分成了若干个词群（段落）。每个段落中的词语又进一步分成了若干个行，同一行的词语要么词义相同，要么词义有很强的相关性。</p>
<p>《同义词词林》提供了5层编码，第1级用大写英文字母表示；第2级用小写英文字母表示；第3级用二位十进制整数表示；第4级用大写英文字母表示；第5级用二位十进制整数表示。例如：<br>Cb30A01&#x3D; 这里 这边 此地 此间 此处 此<br>Cb30A02# 该地 该镇 该乡 该站 该区 该市 该村<br>Cb30A03@ 这方</p>
<p>分层及编码表如下所示<br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/tongyici_cilin_structure.jpg"><br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/tongyici_cilin_encode.jpg"></p>
<p>由于第5级有的行是同义词，有的行是相关词，有的行只有一个词，分类结果需要特别说明，可以分出具体的3种情况。使用特殊符号对这3种情况进行区别对待，所以第8位的标记有3种，分别是“&#x3D;”代表“相等”、“同义”；“#”代表“不等”、“同类”，属于相关词语；“@”代表“自我封闭”、“独立”，它在词典中既没有同义词，也没有相关词。</p>
<p>在对文本内容进行相似度计算中，采用该论文中给出的计算公式，两个义项的相似度用<code>Sim</code>表示<br>若两个义项不在同一棵树上，<code>Sim(A,B)=f</code><br>若两个义项在同一棵树上：<br>若在第2层分支，系数为a <code>Sim(A,B)=1*a*cos*(n*π/180)((n-k+1)/n)</code><br>若在第3层分支，系数为b <code>Sim(A,B)=1*1*b*cos*(n*π/180)((n-k+1)/n)</code><br>若在第4层分支，系数为c <code>Sim(A,B)=1*1*1*c×cos*(n*π/180)((n-k+1)/n)</code><br>若在第5层分支，系数为d <code>Sim(A,B)=1*1*1*1*d*cos*(n*π/180)((n-k+1)/n)</code></p>
<p>当编码相同，而只有末尾是“#”时，那么认为其相似度为e。<br>例如<code>Ad02B04# 非洲人 亚洲人</code>  则其相似度为e。</p>
<p>其中n是分支层的节点分支总数，k是两个分支间的距离。<br>如：人 <code>Aa01A01=</code> 和 少儿 <code>Ab04B01=</code><br>以A开头的子分支只有14个，分别是<code>Aa...，Ab...，Ac... ——— An...</code>，而不是以A开头的所有结点的个数，所以<code>n=14</code>；在第2层分支上，人的编码是<code>a</code>，少儿的编码是<code>b</code>，a和b之间差1，所以<code>k=1</code>。</p>
<p>该文献中给出的参数值为<code>a=0.65</code>，<code>b=0.8</code>，<code>c=0.9</code>，<code>d=0.96</code>，<code>e=0.5</code>，<code>f=0.1</code>。</p>
<h4 id="Java代码实现"><a href="#Java代码实现" class="headerlink" title="Java代码实现"></a>Java代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.codepub.algorithms.similarity.cilin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Preconditions;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.PI;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.cos;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/8/2 21:54</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:WordSimilarity 同义词词林扩展版计算词语相似度</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Description:&lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &quot;=&quot; 代表 相等 同义 &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &quot;#&quot; 代表 不等 同类 属于相关词语 &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &quot;@&quot; 代表 自我封闭 独立 它在词典中既没有同义词, 也没有相关词 &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="comment">//注意使用Log4j2的注解，那么在pom中必须引入2.x版本的log4j，如果使用Log4j注解，pom中引入1.x版本的log4j</span></span><br><span class="line"><span class="comment">//相应的配置文件也要一致，2.x版本配置文件为log4j2.xml，1.x版本配置文件为log4j.xml</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordSimilarity</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * when we use Lombok&#x27;s Annotation, such as <span class="doctag">@Log</span>4j</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Log</span>4j &lt;br/&gt;</span></span><br><span class="line"><span class="comment">     * public class LogExample &#123;</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * will generate:</span></span><br><span class="line"><span class="comment">     * public class LogExample &#123;</span></span><br><span class="line"><span class="comment">     * private static final org.apache.logging.log4j.Logger log = org.apache.logging.log4j.Logger.getLogger(LogExample.class);</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//定义一些常数先</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0.65</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0.8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0.9</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">0.96</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">e</span> <span class="operator">=</span> <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">f</span> <span class="operator">=</span> <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">degrees</span> <span class="operator">=</span> <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//存放的是以词为key，以该词的编码为values的List集合，其中一个词可能会有多个编码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, ArrayList&lt;String&gt;&gt; wordsEncode = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, ArrayList&lt;String&gt;&gt;();</span><br><span class="line">    <span class="comment">//存放的是以编码为key，以该编码多对应的词为values的List集合，其中一个编码可能会有多个词</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, ArrayList&lt;String&gt;&gt; encodeWords = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, ArrayList&lt;String&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取同义词词林并将其注入wordsEncode和encodeWords</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readCiLin</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> WordSimilarity.class.getClass().getResourceAsStream(<span class="string">&quot;/cilin.txt&quot;</span>);</span><br><span class="line">        List&lt;String&gt; contents = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            contents = IOUtils.readLines(input);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String content : contents) &#123;</span><br><span class="line">                content = Preconditions.checkNotNull(content);</span><br><span class="line">                String[] strsArr = content.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                String[] strs = Preconditions.checkNotNull(strsArr);</span><br><span class="line">                <span class="type">String</span> <span class="variable">encode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> strs.length;</span><br><span class="line">                <span class="keyword">if</span> (length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                    encode = strs[<span class="number">0</span>];<span class="comment">//获取编码</span></span><br><span class="line">                &#125;</span><br><span class="line">                ArrayList&lt;String&gt; encodeWords_values = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">                    encodeWords_values.add(strs[i]);</span><br><span class="line">                &#125;</span><br><span class="line">                encodeWords.put(encode, encodeWords_values);<span class="comment">//以编码为key，其后所有值为value</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> strs[i];</span><br><span class="line">                    <span class="keyword">if</span> (wordsEncode.containsKey(strs[i])) &#123;</span><br><span class="line">                        ArrayList&lt;String&gt; values = wordsEncode.get(key);</span><br><span class="line">                        values.add(encode);</span><br><span class="line">                        <span class="comment">//重新放置回去</span></span><br><span class="line">                        wordsEncode.put(key, values);<span class="comment">//以某个value为key，其可能的所有编码为value</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        ArrayList&lt;String&gt; temp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">                        temp.add(encode);</span><br><span class="line">                        wordsEncode.put(key, temp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.err.println(<span class="string">&quot;load dictionary failed！&quot;</span>);</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对外暴露的接口，返回两个词的相似度的计算结果</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> word1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> word2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 相似度值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">getSimilarity</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">        <span class="comment">//在计算时候再加载，实现懒加载</span></span><br><span class="line">        readCiLin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果比较词没有出现在同义词词林中，则相似度为0</span></span><br><span class="line">        <span class="keyword">if</span> (!wordsEncode.containsKey(word1) || !wordsEncode.containsKey(word2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取第一个词的编码</span></span><br><span class="line">        ArrayList&lt;String&gt; encode1 = getEncode(word1);</span><br><span class="line">        <span class="comment">//获取第二个词的编码</span></span><br><span class="line">        ArrayList&lt;String&gt; encode2 = getEncode(word2);</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> <span class="variable">maxValue</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//最终的计算结果值，取所有相似度里面结果最大的那个</span></span><br><span class="line">        <span class="keyword">for</span> (String e1 : encode1) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String e2 : encode2) &#123;</span><br><span class="line">                log.info(e1);</span><br><span class="line">                log.info(e2);</span><br><span class="line">                <span class="type">String</span> <span class="variable">commonStr</span> <span class="operator">=</span> getCommonStr(e1, e2);</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> StringUtils.length(commonStr);</span><br><span class="line">                <span class="type">double</span> <span class="variable">k</span> <span class="operator">=</span> getK(e1, e2);</span><br><span class="line">                <span class="type">double</span> <span class="variable">n</span> <span class="operator">=</span> getN(commonStr);</span><br><span class="line">                log.info(<span class="string">&quot;k--&gt;&quot;</span> + k);</span><br><span class="line">                log.info(<span class="string">&quot;n--&gt;&quot;</span> + n);</span><br><span class="line">                log.info(<span class="string">&quot;encode length--&gt;&quot;</span> + length);</span><br><span class="line">                <span class="type">double</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="comment">//如果有一个以“@”那么表示自我封闭，肯定不在一棵树上，直接返回f</span></span><br><span class="line">                <span class="keyword">if</span> (e1.endsWith(<span class="string">&quot;@&quot;</span>) || e2.endsWith(<span class="string">&quot;@&quot;</span>) || <span class="number">0</span> == length) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (f &gt; maxValue) &#123;</span><br><span class="line">                        maxValue = f;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">1</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第二层上计算</span></span><br><span class="line">                    res = a * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">2</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第三层上计算</span></span><br><span class="line">                    res = b * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">4</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第四层上计算</span></span><br><span class="line">                    res = c * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">5</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第五层上计算</span></span><br><span class="line">                    res = d * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//注意不存在前面七个字符相同，而结尾不同的情况，所以这个分支一定是8个字符都相同，那么只需比较结尾即可</span></span><br><span class="line">                    <span class="keyword">if</span> (e1.endsWith(<span class="string">&quot;=&quot;</span>) &amp;&amp; e2.endsWith(<span class="string">&quot;=&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">//说明两个完全相同</span></span><br><span class="line">                        res = <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e1.endsWith(<span class="string">&quot;#&quot;</span>) &amp;&amp; e2.endsWith(<span class="string">&quot;#&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">//只有结尾不同，说明结尾是“#”</span></span><br><span class="line">                        res = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                log.info(<span class="string">&quot;res: &quot;</span> + res);</span><br><span class="line">                <span class="keyword">if</span> (res &gt; maxValue) &#123;</span><br><span class="line">                    maxValue = res;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断一个词在同义词词林中是否是自我封闭的，是否是独立的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isIndependent</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        Iterator&lt;String&gt; iter = wordsEncode.keySet().iterator();</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> iter.next();</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(key, source)) &#123;</span><br><span class="line">                ArrayList&lt;String&gt; values = wordsEncode.get(key);</span><br><span class="line">                <span class="keyword">for</span> (String value : values) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (value.endsWith(<span class="string">&quot;@&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据word的内容，返回其对应的编码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> word</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">getEncode</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> wordsEncode.get(word);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算N的值，N表示所在分支层分支数，如：人 Aa01A01= 和 少儿 Ab04B01=，以A开头的子分支只有14个</span></span><br><span class="line"><span class="comment">     * 这一点在论文中说的非常不清晰，所以以国人的文章进行编码真是痛苦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encodeHead 输入两个字符串的公共开头</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 经过计算之后得到N的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getN</span><span class="params">(String encodeHead)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> StringUtils.length(encodeHead);</span><br><span class="line">        <span class="keyword">switch</span> (length) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">4</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">(String encodeHead, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">        Iterator&lt;String&gt; iter = encodeWords.keySet().iterator();</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">curr</span> <span class="operator">=</span> iter.next();</span><br><span class="line">            <span class="keyword">if</span> (curr.startsWith(encodeHead)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">temp</span> <span class="operator">=</span> curr.substring(<span class="number">0</span>, end);</span><br><span class="line">                <span class="keyword">if</span> (res.contains(temp)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    res.add(temp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode1 第一个编码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode2 第二个编码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 这两个编码对应的分支间的距离，用k表示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getK</span><span class="params">(String encode1, String encode2)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">temp1</span> <span class="operator">=</span> encode1.substring(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">temp2</span> <span class="operator">=</span> encode2.substring(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(temp1.charAt(<span class="number">0</span>) - temp2.charAt(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(temp1.charAt(<span class="number">0</span>) - temp2.charAt(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(Integer.valueOf(temp1) - Integer.valueOf(temp2));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">5</span>, <span class="number">7</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">5</span>, <span class="number">7</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(temp1.charAt(<span class="number">0</span>) - temp2.charAt(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(Integer.valueOf(temp1) - Integer.valueOf(temp2));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取编码的公共部分字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> String <span class="title function_">getCommonStr</span><span class="params">(String encode1, String encode2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> StringUtils.length(encode1);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (encode1.charAt(i) == encode2.charAt(i)) &#123;</span><br><span class="line">                sb.append(encode1.charAt(i));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sbLen</span> <span class="operator">=</span> StringUtils.length(sb);</span><br><span class="line">        <span class="comment">//注意第三层和第五层均有两个字符，所以长度不可能出现3和6的情况</span></span><br><span class="line">        <span class="keyword">if</span> (sbLen == <span class="number">3</span> || sbLen == <span class="number">6</span>) &#123;</span><br><span class="line">            sb.deleteCharAt(sbLen - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> String.valueOf(sb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetN</span><span class="params">()</span> &#123;</span><br><span class="line">        readCiLin();</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getN(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetK</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> getK(<span class="string">&quot;Aa01A01=&quot;</span>, <span class="string">&quot;Aa01A01=&quot;</span>);</span><br><span class="line">        System.out.println(k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCommonStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">commonStr</span> <span class="operator">=</span> getCommonStr(<span class="string">&quot;Aa01A01=&quot;</span>, <span class="string">&quot;Aa01A03=&quot;</span>);</span><br><span class="line">        System.out.println(commonStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetSimilarity</span><span class="params">()</span> &#123;</span><br><span class="line">        readCiLin();</span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;国民&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;国民:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;群众&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;群众:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;党群&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;党群:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;良民&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;良民:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;同志&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;同志:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;成年人&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;成年人:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;市民&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;市民:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;亲属&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;亲属:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;志愿者&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;志愿者:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;先锋&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;先锋:&quot;</span> + similarity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetSimilarity2</span><span class="params">()</span> &#123;</span><br><span class="line">        readCiLin();</span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> getSimilarity(<span class="string">&quot;非洲人&quot;</span>, <span class="string">&quot;亚洲人&quot;</span>);</span><br><span class="line">        System.out.println(similarity);</span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity1</span> <span class="operator">=</span> getSimilarity(<span class="string">&quot;骄傲&quot;</span>, <span class="string">&quot;仔细&quot;</span>);</span><br><span class="line">        System.out.println(similarity1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明，词语相似度是个数值，一般取值范围在[0，1]之间，在原论文中，使用cos函数计算主要是将值归一化到[0，1]之间，可以将cos函数看作是一个调节因子。</p>
<p>testGetSimilarity的测试结果如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">人民--国民:<span class="number">1.0</span></span><br><span class="line">人民--群众:<span class="number">0.9576614882494312</span></span><br><span class="line">人民--党群:<span class="number">0.8978076452338418</span></span><br><span class="line">人民--良民:<span class="number">0.7182461161870735</span></span><br><span class="line">人民--同志:<span class="number">0.6630145969121822</span></span><br><span class="line">人民--成年人:<span class="number">0.6306922220793977</span></span><br><span class="line">人民--市民:<span class="number">0.5405933332109123</span></span><br><span class="line">人民--亲属:<span class="number">0.36039555547394153</span></span><br><span class="line">人民--志愿者:<span class="number">0.22524722217121346</span></span><br><span class="line">人民--先锋:<span class="number">0.18019777773697077</span></span><br></pre></td></tr></table></figure>

<p>本文使用的是同义词词林的扩展版，而原论文使用的是同义词词林，由于两者存在微小差距，所以本文计算结果与论文中的计算结果存在稍许误差，如果算法没错，这是可以理解的！</p>
<p>以上仅为个人理解，如若发现错误，欢迎大家积极留言指正！</p>
<p>代码已经推送到GitHub上了，地址<a target="_blank" rel="noopener" href="https://github.com/shijiebei2009/Algorithms/blob/master/src%2Fmain%2Fjava%2Fcn%2Fcodepub%2Falgorithms%2Fsimilarity%2Fcilin%2FWordSimilarity.java">点我</a>。注意在文章末尾所注的参考资料中的链接里面的计算方法在求n的时候存在错误，希望莫要受其误导！</p>
<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://www.cnblogs.com/einyboy/archive/2012/09/09/2677265.html">http://www.cnblogs.com/einyboy/archive/2012/09/09/2677265.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Lombok-development-guidelines/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Lombok-development-guidelines/" class="post-title-link" itemprop="url">Lombok开发指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-30 21:33:11" itemprop="dateCreated datePublished" datetime="2015-07-30T21:33:11+00:00">2015-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:27" itemprop="dateModified" datetime="2024-01-26T12:42:27+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Lombok简介"><a href="#Lombok简介" class="headerlink" title="Lombok简介"></a>Lombok简介</h2><p><code>Lombok</code>是一款好用顺手的工具，就像<code>Google Guava</code>一样，在此予以强烈推荐，每一个Java工程师都应该使用它。Lombok是一种Java™实用工具，可用来帮助开发人员消除Java的冗长代码，尤其是对于简单的Java对象（POJO）。它通过注释实现这一目的。通过在开发环境中实现Lombok，开发人员可以节省构建诸如<code>hashCode()</code>和<code>equals()</code>这样的方法以及以往用来分类各种<code>accessor</code>和<code>mutator</code>的大量时间。</p>
<p>Lombok官网地址：<a target="_blank" rel="noopener" href="https://projectlombok.org/">https://projectlombok.org/</a> 里面还提供了一个简短的学习视频。</p>
<h2 id="安装Lombok"><a href="#安装Lombok" class="headerlink" title="安装Lombok"></a>安装Lombok</h2><h3 id="Eclipse安装Lombok"><a href="#Eclipse安装Lombok" class="headerlink" title="Eclipse安装Lombok"></a>Eclipse安装Lombok</h3><h4 id="双击Jar安装"><a href="#双击Jar安装" class="headerlink" title="双击Jar安装"></a>双击Jar安装</h4><p>首先下载Jar包，下载地址：<a target="_blank" rel="noopener" href="http://projectlombok.org/download.html">http://projectlombok.org/download.html</a><br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/eclipse_lombok.png"><br>注意如果eclipse没有安装到默认目录，那么需要点击Specify选择eclipse.exe所在的路径，然后Install即可完成安装。</p>
<p>在新建项目之后，使用Lombok如果程序还报错，那么点击eclipse菜单的Project选项的clean，清理一下即可。</p>
<h4 id="Eclipse手动安装Lombok步骤"><a href="#Eclipse手动安装Lombok步骤" class="headerlink" title="Eclipse手动安装Lombok步骤"></a>Eclipse手动安装Lombok步骤</h4><ul>
<li>将<strong>lombok.jar</strong>复制到<strong>myeclipse.ini&#x2F;eclipse.ini</strong>所在的文件夹目录下</li>
<li>打开<strong>eclipse.ini&#x2F;myeclipse.ini</strong>，在最后面插入以下两行并保存：<br><strong>-Xbootclasspath&#x2F;a:lombok.jar</strong><br><strong>-javaagent:lombok.jar</strong></li>
<li>重启<strong>eclipse&#x2F;myeclipse</strong></li>
</ul>
<p>最后需要注意的是，在使用<code>lombok</code>注解的时候记得要导入<code>lombok.jar</code>包到工程，如果使用的是<code>Maven Project</code>，要在<code>pom.xml</code>中添加依赖，并设置<code>Maven</code>为自动导入，参见IntelliJ部分。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="IntelliJ安装Lombok"><a href="#IntelliJ安装Lombok" class="headerlink" title="IntelliJ安装Lombok"></a>IntelliJ安装Lombok</h3><h4 id="通过IntelliJ的插件中心安装"><a href="#通过IntelliJ的插件中心安装" class="headerlink" title="通过IntelliJ的插件中心安装"></a>通过IntelliJ的插件中心安装</h4><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_plugin_lombok.png"><br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_lombok.png"><br>注意一点，在IntelliJ中如果创建的是Maven项目，那么在pom.xml文件中添加依赖后，需要设置Maven为自动导入。<br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_maven_auto_import.png"></p>
<h4 id="IntelliJ手动安装Lombok"><a href="#IntelliJ手动安装Lombok" class="headerlink" title="IntelliJ手动安装Lombok"></a>IntelliJ手动安装Lombok</h4><p>如果不想通过IntelliJ的插件中心安装的话，也可以手动安装，详细步骤参见Github上的说明：<a target="_blank" rel="noopener" href="https://github.com/mplushnikov/lombok-intellij-plugin">https://github.com/mplushnikov/lombok-intellij-plugin</a></p>
<p>简单点说手动安装步骤如下：<br>Download the <a target="_blank" rel="noopener" href="https://github.com/mplushnikov/lombok-intellij-plugin/releases/tag/releasebuild_0.11">latest release</a> and install it manually using Preferences &gt; Plugins &gt; Install plugin from disk…</p>
<h2 id="Lombok用法"><a href="#Lombok用法" class="headerlink" title="Lombok用法"></a>Lombok用法</h2><h3 id="Lombok注解说明"><a href="#Lombok注解说明" class="headerlink" title="Lombok注解说明"></a>Lombok注解说明</h3><ul>
<li><code>val</code>：用在局部变量前面，相当于将变量声明为final</li>
<li><code>@NonNull</code>：给方法参数增加这个注解会自动在方法内对该参数进行是否为空的校验，如果为空，则抛出NPE（NullPointerException）</li>
<li><code>@Cleanup</code>：自动管理资源，用在局部变量之前，在当前变量范围内即将执行完毕退出之前会自动清理资源，自动生成try-finally这样的代码来关闭流</li>
<li><code>@Getter/@Setter</code>：用在属性上，再也不用自己手写setter和getter方法了，还可以指定访问范围</li>
<li><code>@ToString</code>：用在类上，可以自动覆写toString方法，当然还可以加其他参数，例如@ToString(exclude&#x3D;”id”)排除id属性，或者@ToString(callSuper&#x3D;true, includeFieldNames&#x3D;true)调用父类的toString方法，包含所有属性</li>
<li><code>@EqualsAndHashCode</code>：用在类上，自动生成equals方法和hashCode方法</li>
<li><code>@NoArgsConstructor, @RequiredArgsConstructor and @AllArgsConstructor</code>：用在类上，自动生成无参构造和使用所有参数的构造函数以及把所有@NonNull属性作为参数的构造函数，如果指定staticName &#x3D; “of”参数，同时还会生成一个返回类对象的静态工厂方法，比使用构造函数方便很多</li>
<li><code>@Data</code>：注解在类上，相当于同时使用了<code>@ToString</code>、<code>@EqualsAndHashCode</code>、<code>@Getter</code>、<code>@Setter</code>和<code>@RequiredArgsConstrutor</code>这些注解，对于<code>POJO类</code>十分有用</li>
<li><code>@Value</code>：用在类上，是@Data的不可变形式，相当于为属性添加final声明，只提供getter方法，而不提供setter方法</li>
<li><code>@Builder</code>：用在类、构造器、方法上，为你提供复杂的builder APIs，让你可以像如下方式一样调用<code>Person.builder().name(&quot;Adam Savage&quot;).city(&quot;San Francisco&quot;).job(&quot;Mythbusters&quot;).job(&quot;Unchained Reaction&quot;).build();</code>更多说明参考<a target="_blank" rel="noopener" href="https://projectlombok.org/features/Builder.html">Builder</a></li>
<li><code>@SneakyThrows</code>：自动抛受检异常，而无需显式在方法上使用throws语句</li>
<li><code>@Synchronized</code>：用在方法上，将方法声明为同步的，并自动加锁，而锁对象是一个私有的属性<code>$lock</code>或<code>$LOCK</code>，而java中的synchronized关键字锁对象是this，锁在this或者自己的类对象上存在副作用，就是你不能阻止非受控代码去锁this或者类对象，这可能会导致竞争条件或者其它线程错误</li>
<li><code>@Getter(lazy=true)</code>：可以替代经典的Double Check Lock样板代码</li>
<li><code>@Log</code>：根据不同的注解生成不同类型的log对象，但是实例名称都是log，有六种可选实现类<ul>
<li><code>@CommonsLog</code> Creates log &#x3D; org.apache.commons.logging.LogFactory.getLog(LogExample.class);</li>
<li><code>@Log</code> Creates log &#x3D; java.util.logging.Logger.getLogger(LogExample.class.getName());</li>
<li><code>@Log4j</code> Creates log &#x3D; org.apache.log4j.Logger.getLogger(LogExample.class);</li>
<li><code>@Log4j2</code> Creates log &#x3D; org.apache.logging.log4j.LogManager.getLogger(LogExample.class);</li>
<li><code>@Slf4j</code> Creates log &#x3D; org.slf4j.LoggerFactory.getLogger(LogExample.class);</li>
<li><code>@XSlf4j</code> Creates log &#x3D; org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class);</li>
</ul>
</li>
</ul>
<h3 id="Lombok使用示例"><a href="#Lombok使用示例" class="headerlink" title="Lombok使用示例"></a>Lombok使用示例</h3><ul>
<li>val示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">val</span> <span class="variable">sets</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">    <span class="type">val</span> <span class="variable">lists</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">    <span class="type">val</span> <span class="variable">maps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">    <span class="comment">//=&gt;相当于如下</span></span><br><span class="line">    <span class="keyword">final</span> Set&lt;String&gt; sets2 = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> List&lt;String&gt; lists2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> Map&lt;String, String&gt; maps2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@NonNull示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notNullExample</span><span class="params">(<span class="meta">@NonNull</span> String string)</span> &#123;</span><br><span class="line">    string.length();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=&gt;相当于</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notNullExample</span><span class="params">(String string)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (string != <span class="literal">null</span>) &#123;</span><br><span class="line">        string.length();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;null&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Cleanup示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="meta">@Cleanup</span> <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(args[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//=&gt;相当于</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        inputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(args[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Getter&#x2F;@Setter示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter(AccessLevel.PUBLIC)</span></span><br><span class="line"><span class="meta">@Getter(AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"><span class="keyword">private</span> String shap;</span><br></pre></td></tr></table></figure></li>
<li>@ToString示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString(exclude = &quot;id&quot;, callSuper = true, includeFieldNames = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//输出LombokDemo(super=LombokDemo@48524010, name=null, age=0)</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">LombokDemo</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@EqualsAndHashCode示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(exclude = &#123;&quot;id&quot;, &quot;shape&quot;&#125;, callSuper = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String shap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@NoArgsConstructor, @RequiredArgsConstructor and @AllArgsConstructor示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor(staticName = &quot;of&quot;)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String shap;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LombokDemo</span>(<span class="number">1</span>, <span class="string">&quot;circle&quot;</span>);</span><br><span class="line">        <span class="comment">//使用静态工厂方法</span></span><br><span class="line">        LombokDemo.of(<span class="number">2</span>, <span class="string">&quot;circle&quot;</span>);</span><br><span class="line">        <span class="comment">//无参构造</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LombokDemo</span>();</span><br><span class="line">        <span class="comment">//包含所有参数</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LombokDemo</span>(<span class="number">1</span>, <span class="string">&quot;circle&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Data示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menu</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String shopId;</span><br><span class="line">    <span class="keyword">private</span> String skuMenuId;</span><br><span class="line">    <span class="keyword">private</span> String skuName;</span><br><span class="line">    <span class="keyword">private</span> String normalizeSkuName;</span><br><span class="line">    <span class="keyword">private</span> String dishMenuId;</span><br><span class="line">    <span class="keyword">private</span> String dishName;</span><br><span class="line">    <span class="keyword">private</span> String dishNum;</span><br><span class="line">    <span class="comment">//默认阈值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">thresHold</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//新阈值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">newThresHold</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//总得分</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">totalScore</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在IntelliJ中按下Ctrl+F12就可以看到Lombok已经为我们自动生成了一系列的方法。<br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_lombok_java_demo.jpg"></li>
<li>@Value示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String shap;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="comment">//相当于</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Builder示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="meta">@Singular</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; occupations;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BuilderExample</span> <span class="variable">test</span> <span class="operator">=</span> BuilderExample.builder().age(<span class="number">11</span>).name(<span class="string">&quot;test&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@SneakyThrows示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="meta">@SneakyThrows()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedEncodingException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//相当于</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedEncodingException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Synchronized示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedDemo</span> &#123;</span><br><span class="line">    <span class="meta">@Synchronized</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//相当于</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">$LOCK</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> ($LOCK) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Getter(lazy &#x3D; true)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetterLazyExample</span> &#123;</span><br><span class="line">    <span class="meta">@Getter(lazy = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span>[] cached = expensive();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span>[] expensive() &#123;</span><br><span class="line">        <span class="type">double</span>[] result = <span class="keyword">new</span> <span class="title class_">double</span>[<span class="number">1000000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">            result[i] = Math.asin(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
相当于如下所示<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetterLazyExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicReference&lt;java.lang.Object&gt; cached = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span>[] getCached() &#123;</span><br><span class="line">        java.lang.<span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">this</span>.cached.get();</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>.cached) &#123;</span><br><span class="line">                value = <span class="built_in">this</span>.cached.get();</span><br><span class="line">                <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">double</span>[] actualValue = expensive();</span><br><span class="line">                    value = actualValue == <span class="literal">null</span> ? <span class="built_in">this</span>.cached : actualValue;</span><br><span class="line">                    <span class="built_in">this</span>.cached.set(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>[]) (value == <span class="built_in">this</span>.cached ? <span class="literal">null</span> : value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span>[] expensive() &#123;</span><br><span class="line">        <span class="type">double</span>[] result = <span class="keyword">new</span> <span class="title class_">double</span>[<span class="number">1000000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">            result[i] = Math.asin(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Python3-beginner-s-handbook-four/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python3-beginner-s-handbook-four/" class="post-title-link" itemprop="url">Python3入门手册之四</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-13 23:02:03" itemprop="dateCreated datePublished" datetime="2015-07-13T23:02:03+00:00">2015-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:23" itemprop="dateModified" datetime="2024-01-26T12:42:23+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>Version：Python 3.4.3 (v3.4.3:9b73f1c3e601, Feb 24 2015, 22:44:40) [MSC v.1600 64 bit (AMD64)] on win32</em></p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="可接受任意数量参数的函数"><a href="#可接受任意数量参数的函数" class="headerlink" title="可接受任意数量参数的函数"></a>可接受任意数量参数的函数</h4><p>为了能让一个函数接受任意数量的位置参数，可以使用一个<code>*参数</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">avg</span>(<span class="params">first, *rest</span>):</span><br><span class="line">    <span class="keyword">return</span> (first + <span class="built_in">sum</span>(rest)) / (<span class="number">1</span> + <span class="built_in">len</span>(rest))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample use</span></span><br><span class="line">avg(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># 1.5</span></span><br><span class="line">avg(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) <span class="comment"># 2.5</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>rest</code>是由所有其他位置参数组成的元组。然后我们在代码中把它当成了一个序列来进行后续的计算。</p>
<p>使用一个以<code>**开头的参数</code>来表示接受任意数量的关键字参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_element</span>(<span class="params">name, value, **attrs</span>):</span><br><span class="line">    keyvals = [<span class="string">&#x27; %s=&quot;%s&quot;&#x27;</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> attrs.items()]</span><br><span class="line">    attr_str = <span class="string">&#x27;&#x27;</span>.join(keyvals)</span><br><span class="line">    element = <span class="string">&#x27;&lt;&#123;name&#125;&#123;attrs&#125;&gt;&#123;value&#125;&lt;/&#123;name&#125;&gt;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        name=name,</span><br><span class="line">        attrs=attr_str,</span><br><span class="line">        value=html.escape(value))</span><br><span class="line">    <span class="keyword">return</span> element</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="comment"># Creates &#x27;&lt;item size=&quot;large&quot; quantity=&quot;6&quot;&gt;Albatross&lt;/item&gt;&#x27;</span></span><br><span class="line">res = make_element(<span class="string">&#x27;item&#x27;</span>, <span class="string">&#x27;Albatross&#x27;</span>, size=<span class="string">&#x27;large&#x27;</span>, quantity=<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creates &#x27;&lt;p&gt;&lt;spam&gt;&lt;/p&gt;&#x27;</span></span><br><span class="line">res = make_element(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;&lt;spam&gt;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>
<p>在这里，<code>attrs</code>是一个包含所有被传入进来的关键字参数的字典。</p>
<p>如果你还希望某个函数能同时接受任意数量的位置参数和关键字参数，可以同时使用<code>*和**</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">anyargs</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(args)  <span class="comment"># A tuple  Prints (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;)</span></span><br><span class="line">    <span class="built_in">print</span>(kwargs)  <span class="comment"># A dict  Prints&#123;&#x27;key1&#x27;: &#x27;1&#x27;, &#x27;key2&#x27;: &#x27;2&#x27;&#125;</span></span><br><span class="line">anyargs(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, key1=<span class="string">&#x27;1&#x27;</span>, key2=<span class="string">&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>使用这个函数时，所有位置参数会被放到<code>args元组</code>中，所有关键字参数会被放到<code>字典kwargs</code>中。<br>一个<code>*参数</code>只能出现在函数定义中最后一个位置参数后面，而 <code>**参数</code>只能出现在最后一个参数。 有一点要注意的是，在<code>*参数</code>后面仍然可以定义其他参数。</p>
<h4 id="只接受关键字参数的函数"><a href="#只接受关键字参数的函数" class="headerlink" title="只接受关键字参数的函数"></a>只接受关键字参数的函数</h4><p>利用这种技术，我们还能在接受任意多个位置参数的函数中指定关键字参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mininum</span>(<span class="params">*values, clip=<span class="literal">None</span></span>):</span><br><span class="line">    m = <span class="built_in">min</span>(values)</span><br><span class="line">    <span class="keyword">if</span> clip <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        m = clip <span class="keyword">if</span> clip &gt; m <span class="keyword">else</span> m</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">minimum(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, -<span class="number">5</span>, <span class="number">10</span>) <span class="comment"># Returns -5</span></span><br><span class="line">minimum(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, -<span class="number">5</span>, <span class="number">10</span>, clip=<span class="number">0</span>) <span class="comment"># Returns 0&lt;/pre&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="返回多个值的函数"><a href="#返回多个值的函数" class="headerlink" title="返回多个值的函数"></a>返回多个值的函数</h4><p>为了能返回多个值，函数直接return一个元组就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">myfun</span>():</span><br><span class="line"><span class="meta">... </span><span class="keyword">return</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, c = myfun()</span><br><span class="line">````</span><br><span class="line">尽管`myfun()`看上去返回了多个值，实际上是先创建了一个元组然后返回的。这个语法看上去比较奇怪，实际上我们使用的是逗号来生成一个元组，而不是用括号。</span><br><span class="line">```python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = (<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># With parentheses</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">1</span>, <span class="number">2</span> <span class="comment"># Without parentheses</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h4 id="定义有默认参数的函数"><a href="#定义有默认参数的函数" class="headerlink" title="定义有默认参数的函数"></a>定义有默认参数的函数</h4><p>定义一个有可选参数的函数是非常简单的，直接在函数定义中给参数指定一个默认值，并放到参数列表最后就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=<span class="number">42</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b)</span><br><span class="line"></span><br><span class="line">spam(<span class="number">1</span>) <span class="comment"># Ok. a=1, b=42</span></span><br><span class="line">spam(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># Ok. a=1, b=2</span></span><br></pre></td></tr></table></figure>
<p>如果默认参数是一个可修改的容器比如一个列表、集合或者字典，可以使用None作为默认值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Using a list as a default value</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> b <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        b = []</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>有一点是值得注意的，默认参数的值仅仅在函数定义的时候赋值一次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">42</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=x</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(a, b)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam(<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">42</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">23</span> <span class="comment"># Has no effect</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam(<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">42</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>注意到当我们改变<code>x</code>的值的时候对默认参数值并没有影响，这是因为在函数定义的时候就已经确定了它的默认值了。</p>
<p>其次，默认参数的值应该是不可变的对象，比如<code>None、True、False、</code>数字或字符串。 特别的，千万不要像下面这样写代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=[]</span>): <span class="comment"># NO!</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>如果你这么做了，当默认值在其他地方被修改后你将会遇到各种麻烦。这些修改会影响到下次调用这个函数时的默认值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=[]</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(b)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> b</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = spam(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x.append(<span class="number">99</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x.append(<span class="string">&#x27;Yow!&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line">[<span class="number">99</span>, <span class="string">&#x27;Yow!&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam(<span class="number">1</span>) <span class="comment"># Modified list gets returned!</span></span><br><span class="line">[<span class="number">99</span>, <span class="string">&#x27;Yow!&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>这种结果应该不是你想要的。为了避免这种情况的发生，最好是将默认值设为<code>None</code>， 然后在函数里面检查它，前面的例子就是这样做的。</p>
<p>在测试<code>None</code>值时使用<code>is</code>操作符是很重要的，也是这种方案的关键点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> b: <span class="comment"># NO! Use &#x27;b is None&#x27; instead</span></span><br><span class="line">        b = []</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="定义匿名或内联函数"><a href="#定义匿名或内联函数" class="headerlink" title="定义匿名或内联函数"></a>定义匿名或内联函数</h4><p>当一些函数很简单，仅仅只是计算一个表达式的值的时候，就可以使用<code>lambda</code>表达式来代替了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>add = <span class="keyword">lambda</span> x, y: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>lambda</code>表达式典型的使用场景是排序或数据<code>reduce</code>等：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>names = [<span class="string">&#x27;David Beazley&#x27;</span>, <span class="string">&#x27;Brian Jones&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>        <span class="string">&#x27;Raymond Hettinger&#x27;</span>, <span class="string">&#x27;Ned Batchelder&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>(names, key=<span class="keyword">lambda</span> name: name.split()[-<span class="number">1</span>].lower())</span><br><span class="line">[<span class="string">&#x27;Ned Batchelder&#x27;</span>, <span class="string">&#x27;David Beazley&#x27;</span>, <span class="string">&#x27;Raymond Hettinger&#x27;</span>, <span class="string">&#x27;Brian Jones&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>有一点要注意的是，<code>lambda</code>表达式中的变量x是自由变量，在运行时绑定值，而不是定义时就绑定，这跟函数的默认值参数定义是不同的。而如果你想让某个匿名函数在定义时就捕获到值，可以将那个参数值定义成默认参数即可，类似如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="keyword">lambda</span> y, x=x: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="keyword">lambda</span> y, x=x: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a(<span class="number">10</span>)</span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>如果你不设定为默认参数的话，运行如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="keyword">lambda</span> y: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="keyword">lambda</span> y: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<p><strong>Notes</strong><br>在这里列出来的问题是新手很容易犯的错误，有些新手可能会不恰当的<code>lambda</code>表达式。 比如，通过在一个循环或列表推导中创建一个<code>lambda</code>表达式列表，并期望函数能在定义时就记住每次的迭代值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>funcs = [<span class="keyword">lambda</span> x: x+n <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> f <span class="keyword">in</span> funcs:</span><br><span class="line"><span class="meta">... </span><span class="built_in">print</span>(f(<span class="number">0</span>))</span><br><span class="line">...</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>但是实际效果是运行是n的值为迭代的最后一个值。现在我们用另一种方式修改一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>funcs = [<span class="keyword">lambda</span> x, n=n: x+n <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> f <span class="keyword">in</span> funcs:</span><br><span class="line"><span class="meta">... </span><span class="built_in">print</span>(f(<span class="number">0</span>))</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>通过使用函数默认值参数形式，<code>lambda</code>函数在定义时就能绑定到值。</p>
<h4 id="减少可调用对象的参数个数"><a href="#减少可调用对象的参数个数" class="headerlink" title="减少可调用对象的参数个数"></a>减少可调用对象的参数个数</h4><p>如果需要减少某个函数的参数个数，你可以使用<code>functools.partial()</code>。<code>partial()</code>允许你给一个或多个参数设置固定的值，减少接下来被调用时的参数个数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b, c, d</span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b, c, d)</span><br><span class="line">spam(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  <span class="comment"># Prints 1 2 3 4</span></span><br><span class="line">s1 = partial(spam, <span class="number">1</span>)  <span class="comment"># a = 1</span></span><br><span class="line">s1(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br><span class="line">s2 = partial(spam, <span class="number">3</span>, <span class="number">4</span>, d=<span class="number">12</span>)  <span class="comment"># a=3,b=4,d=12</span></span><br><span class="line">s2(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以看出<code>partial()</code>固定某些参数并返回一个新的<code>callable</code>对象。这个新的<code>callable</code>接受未赋值的参数，然后跟之前已经赋值过的参数合并起来，最后将所有参数传递给原始函数。</p>
<p>假设你有一个点的列表来表示<code>(x,y)</code>坐标元组。你可以使用下面的函数来计算两点之间的距离：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">points = [ (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">5</span>, <span class="number">6</span>), (<span class="number">7</span>, <span class="number">8</span>) ]</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">distance</span>(<span class="params">p1, p2</span>):</span><br><span class="line">    x1, y1 = p1</span><br><span class="line">    x2, y2 = p2</span><br><span class="line">    <span class="keyword">return</span> math.hypot(x2 - x1, y2 - y1)</span><br></pre></td></tr></table></figure>
<p>现在假设你想以某个点为基点，根据点和基点之间的距离来排序所有的这些点。列表的<code>sort()</code>方法接受一个关键字参数来自定义排序逻辑，但是它只能接受一个单个参数的函数(<code>distance()</code>很明显是不符合条件的)。现在我们可以通过使用<code>partial()</code>来解决这个问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pt = (<span class="number">4</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>points.sort(key=partial(distance,pt))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>points</span><br><span class="line">[(<span class="number">3</span>, <span class="number">4</span>), (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">5</span>, <span class="number">6</span>), (<span class="number">7</span>, <span class="number">8</span>)]</span><br></pre></td></tr></table></figure>
<p>更进一步，<code>partial()</code> 通常被用来微调其他库函数所使用的回调函数的参数。 例如，下面是一段代码，使用 <code>multiprocessing</code> 来异步计算一个结果值， 然后这个值被传递给一个接受一个<code>result</code>值和一个可选<code>logging</code>参数的回调函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">output_result</span>(<span class="params">result, log=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> log <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        log.debug(<span class="string">&#x27;Got: %r&#x27;</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A sample function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> logging</span><br><span class="line">    <span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">    logging.basicConfig(level=logging.DEBUG)</span><br><span class="line">    log = logging.getLogger(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p = Pool()</span><br><span class="line">    p.apply_async(add, (<span class="number">3</span>, <span class="number">4</span>), callback=partial(output_result, log=log))</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br></pre></td></tr></table></figure>
<h3 id="类与对象"><a href="#类与对象" class="headerlink" title="类与对象"></a>类与对象</h3><h4 id="改变对象的字符串显示"><a href="#改变对象的字符串显示" class="headerlink" title="改变对象的字符串显示"></a>改变对象的字符串显示</h4><p>要改变一个实例的字符串表示，可重新定义它的<code>__str__()</code>和<code>__repr__()</code>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Pair(&#123;0.x!r&#125;, &#123;0.y!r&#125;)&#x27;</span>.<span class="built_in">format</span>(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;(&#123;0.x!s&#125;, &#123;0.y!s&#125;)&#x27;</span>.<span class="built_in">format</span>(self)</span><br></pre></td></tr></table></figure>
<p><code>__repr__()</code>方法返回一个实例的代码表示形式，通常用来重新构造这个实例。内置的<code>repr()</code>函数返回这个字符串，跟我们使用交互式解释器显示的值是一样的。<code>__str__()</code>方法将实例转换为一个字符串，使用<code>str()</code>或<code>print()</code>函数会输出这个字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Pair(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p</span><br><span class="line">Pair(<span class="number">3</span>, <span class="number">4</span>) <span class="comment"># __repr__() output</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(p)</span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>) <span class="comment"># __str__() output</span></span><br></pre></td></tr></table></figure>
<p><code>!r</code>格式化代码指明输出使用<code>__repr__()</code>来代替默认的<code>__str__()</code>。你还可以做如下的测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Pair(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;p is &#123;0!r&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">p <span class="keyword">is</span> Pair(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;p is &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">p <span class="keyword">is</span> (<span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>定义<code>__repr__()</code>和<code>__str__()</code>通常是很好的习惯，因为它能简化调试和实例输出。例如，如果仅仅只是打印输出或日志输出某个实例，那么程序员会看到实例更加详细与有用的信息。<br><code>__repr__()</code>生成的文本字符串标准做法是需要让<code>eval(repr(x)) == x</code>为真。如果实在不能这样子做，应该创建一个有用的文本表示，并使用&lt;和&gt;括起来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="built_in">open</span>(<span class="string">&#x27;file.dat&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f</span><br><span class="line">&lt;_io.TextIOWrapper name=<span class="string">&#x27;file.dat&#x27;</span> mode=<span class="string">&#x27;r&#x27;</span> encoding=<span class="string">&#x27;UTF-8&#x27;</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>如果<code>__str__()</code>没有被定义，那么就会使用<code>__repr__()</code>来代替输出。上面的<code>format()</code>方法的使用看上去很有趣，格式化代码<code>&#123;0.x&#125;</code>对应的是第1个参数的x属性。因此，在下面的函数中，0实际上指的就是<code>self</code>本身：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Pair(&#123;0.x!r&#125;, &#123;0.y!r&#125;)&#x27;</span>.<span class="built_in">format</span>(self)</span><br></pre></td></tr></table></figure>
<p>作为这种实现的一个替代，你也可以使用<code>%</code>操作符，就像下面这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Pair(%r, %r)&#x27;</span> % (self.x, self.y)</span><br></pre></td></tr></table></figure>
<h4 id="让对象支持上下文管理协议"><a href="#让对象支持上下文管理协议" class="headerlink" title="让对象支持上下文管理协议"></a>让对象支持上下文管理协议</h4><p>为了让一个对象兼容<code>with</code>语句，你需要实现<code>__enter()__</code>和<code>__exit__()</code>方法。例如，考虑如下的一个类，它能为我们创建一个网络连接：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket, AF_INET, SOCK_STREAM</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazyConnection</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address, family=AF_INET, <span class="built_in">type</span>=SOCK_STREAM</span>):</span><br><span class="line">        self.address = address</span><br><span class="line">        self.family = family</span><br><span class="line">        self.<span class="built_in">type</span> = <span class="built_in">type</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.sock <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Already connected&#x27;</span>)</span><br><span class="line">        self.sock = socket(self.family, self.<span class="built_in">type</span>)</span><br><span class="line">        self.sock.connect(self.address)</span><br><span class="line">        <span class="keyword">return</span> self.sock</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_ty, exc_val, tb</span>):</span><br><span class="line">        self.sock.close()</span><br><span class="line">        self.sock = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p>这个类的关键特点在于它表示了一个网络连接，但是初始化的时候并不会做任何事情(比如它并没有建立一个连接)。连接的建立和关闭是使用<code>with</code>语句自动完成的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">conn = LazyConnection((<span class="string">&#x27;www.python.org&#x27;</span>, <span class="number">80</span>))</span><br><span class="line"><span class="comment"># Connection closed</span></span><br><span class="line"><span class="keyword">with</span> conn <span class="keyword">as</span> s:</span><br><span class="line">    <span class="comment"># conn.__enter__() executes: connection open</span></span><br><span class="line">    s.send(<span class="string">b&#x27;GET /index.html HTTP/1.0\r\n&#x27;</span>)</span><br><span class="line">    s.send(<span class="string">b&#x27;Host: www.python.org\r\n&#x27;</span>)</span><br><span class="line">    s.send(<span class="string">b&#x27;\r\n&#x27;</span>)</span><br><span class="line">    resp = <span class="string">b&#x27;&#x27;</span>.join(<span class="built_in">iter</span>(partial(s.recv, <span class="number">8192</span>), <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line">    <span class="comment"># conn.__exit__() executes: connection closed</span></span><br></pre></td></tr></table></figure>
<p>编写上下文管理器的主要原理是你的代码会放到<code>with</code>语句块中执行。当出现<code>with</code>语句的时候，对象的<code>__enter__()</code>方法被触发，它返回的值(如果有的话)会被赋值给<code>as</code>声明的变量。然后，<code>with</code>语句块里面的代码开始执行。最后，<code>__exit__()</code>方法被触发进行清理工作。</p>
<p>不管<code>with</code>代码块中发生什么，上面的控制流都会执行完，就算代码块中发生了异常也是一样的。事实上，<code>__exit__()</code>方法的第三个参数包含了异常类型、异常值和追溯信息(如果有的话)。<code>__exit__()</code>方法能自己决定怎样利用这个异常信息，或者忽略它并返回一个None值。如果<code>__exit__()</code>返回<code>True</code>，那么异常会被清空，就好像什么都没发生一样，<code>with</code>语句后面的程序继续在正常执行。</p>
<p>如果你想要获得嵌套<code>with</code>语句的效果，代码需要如下修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket, AF_INET, SOCK_STREAM</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazyConnection</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address, family=AF_INET, <span class="built_in">type</span>=SOCK_STREAM</span>):</span><br><span class="line">        self.address = address</span><br><span class="line">        self.family = family</span><br><span class="line">        self.<span class="built_in">type</span> = <span class="built_in">type</span></span><br><span class="line">        self.connections = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        sock = socket(self.family, self.<span class="built_in">type</span>)</span><br><span class="line">        sock.connect(self.address)</span><br><span class="line">        self.connections.append(sock)</span><br><span class="line">        <span class="keyword">return</span> sock</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_ty, exc_val, tb</span>):</span><br><span class="line">        self.connections.pop().close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example use</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">conn = LazyConnection((<span class="string">&#x27;www.python.org&#x27;</span>, <span class="number">80</span>))</span><br><span class="line"><span class="keyword">with</span> conn <span class="keyword">as</span> s1:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">with</span> conn <span class="keyword">as</span> s2:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        <span class="comment"># s1 and s2 are independent sockets</span></span><br></pre></td></tr></table></figure>
<p>在第二个版本中，<code>LazyConnection</code>类可以被看做是某个连接工厂。在内部，一个列表被用来构造一个栈。每次<code>__enter__()</code>方法执行的时候，它复制创建一个新的连接并将其加入到栈里面。<code>__exit__()</code>方法简单的从栈中弹出最后一个连接并关闭它。这里稍微有点难理解，不过它能允许嵌套使用<code>with</code>语句创建多个连接。</p>
<p>在需要管理一些资源比如文件、网络连接和锁的编程环境中，使用上下文管理器是很普遍的。这些资源的一个主要特征是它们必须被手动的关闭或释放来确保程序的正确运行。例如，如果你请求了一个锁，那么你必须确保之后释放了它，否则就可能产生死锁。通过实现<code>__enter__()</code>和<code>__exit__()</code>方法并使用<code>with</code>语句可以很容易的避免这些问题，因为<code>__exit__()</code>方法可以让你无需担心这些了。</p>
<h4 id="创建大量对象时节省内存方法"><a href="#创建大量对象时节省内存方法" class="headerlink" title="创建大量对象时节省内存方法"></a>创建大量对象时节省内存方法</h4><p>对于主要是用来当成简单的数据结构的类而言，你可以通过给类添加<code>__slots__</code>属性来极大的减少实例所占的内存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>:</span><br><span class="line">    __slots__ = [<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;day&#x27;</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, year, month, day</span>):</span><br><span class="line">        self.year = year</span><br><span class="line">        self.month = month</span><br><span class="line">        self.day = day</span><br></pre></td></tr></table></figure>

<p>当你定义<code>__slots__</code>后，Python就会为实例使用一种更加紧凑的内部表示。实例通过一个很小的固定大小的数组来构建，而不是为每个实例定义一个字典，这跟元组或列表很类似。在<code>__slots__</code>中列出的属性名在内部被映射到这个数组的指定小标上。使用<code>slots</code>一个不好的地方就是我们不能再给实例添加新的属性了，只能使用在<code>__slots__</code>中定义的那些属性名。</p>
<h4 id="在类中封装属性名"><a href="#在类中封装属性名" class="headerlink" title="在类中封装属性名"></a>在类中封装属性名</h4><p><code>Python</code>程序员不去依赖语言特性去封装数据，而是通过遵循一定的属性和方法命名规约来达到这个效果。第一个约定是任何以单下划线<code>_</code>开头的名字都应该是内部实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._internal = <span class="number">0</span> <span class="comment"># An internal attribute</span></span><br><span class="line">        self.public = <span class="number">1</span> <span class="comment"># A public attribute</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">public_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        A public method</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_internal_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><code>Python</code>并不会真的阻止别人访问内部名称。但是如果你这么做肯定是不好的，可能会导致脆弱的代码。同时还要注意到，使用下划线开头的约定同样适用于模块名和模块级别函数。例如，如果你看到某个模块名以单下划线开头(比如<code>_socket</code>)，那它就是内部实现。类似的，模块级别函数比如<code>sys._getframe()</code>在使用的时候就得加倍小心了。</p>
<p>使用双下划线开始会导致访问名称变成其他形式。比如，在前面的类B中，私有属性会被分别重命名为<code>_B__private</code>和<code>_B__private_method</code>。这时候你可能会问这样重命名的目的是什么，答案就是继承——这种属性通过继承是无法被覆盖的。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">B</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.__private = <span class="number">1</span> <span class="comment"># Does not override B.__private</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Does not override B.__private_method()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__private_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>这里，私有名称<code>__private</code>和<code>__private_method</code>被重命名为<code>_C__private</code>和<code>_C__private_method</code>，这个跟父类B中的名称是完全不同的。</p>
<p>通常的，如果定义的变量与保留关键字冲突，那么可以单划线作为后缀。一般的以单划线开头定义变量即可，如果你清楚你的代码会涉及到子类，那么推荐是用双下划线方案。</p>
<h4 id="创建可管理的属性"><a href="#创建可管理的属性" class="headerlink" title="创建可管理的属性"></a>创建可管理的属性</h4><p>自定义某个属性的一种简单方法是将它定义为一个<code>property</code>。例如，下面的代码定义了一个<code>property</code>，增加对一个属性简单的类型检查：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first_name</span>):</span><br><span class="line">        self.first_name = first_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Getter function</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._first_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Setter function</span></span><br><span class="line"><span class="meta">    @first_name.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">first_name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">        self._first_name = value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Deleter function (optional)</span></span><br><span class="line"><span class="meta">    @first_name.deleter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;Can&#x27;t delete attribute&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>上述代码中有三个相关联的方法，这三个方法的名字都必须一样。第一个方法是一个<code>getter</code>函数，它使得<code>first_name</code>成为一个属性。其他两个方法给<code>first_name</code>属性添加了<code>setter</code>和<code>deleter</code>函数。需要强调的是只有在<code>first_name</code>属性被创建后，后面的两个装饰器<code>@first_name.setter</code>和<code>@first_name.deleter</code>才能被定义。</p>
<p><code>property</code>的一个关键特征是它看上去跟普通的<code>attribute</code>没什么两样，但是访问它的时候会自动触发<code>getter</code>、<code>setter</code>和<code>deleter</code>方法。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = Person(<span class="string">&#x27;Guido&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.first_name <span class="comment"># Calls the getter</span></span><br><span class="line"><span class="string">&#x27;Guido&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.first_name = <span class="number">42</span> <span class="comment"># Calls the setter</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    File <span class="string">&quot;prop.py&quot;</span>, line <span class="number">14</span>, <span class="keyword">in</span> first_name</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">TypeError: Expected a string</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> a.first_name</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: can<span class="string">&#x27;t delete attribute</span></span><br></pre></td></tr></table></figure>
<p>在实现一个<code>property</code>时候，底层数据(如果有的话)仍然需要存储在某个地方。因此，在get和set方法中，你会看到对<code>_first_name</code>属性的操作，这也是实际数据保存的地方。另外，你可能还会问为什么<code>__init__()</code>方法中设置了<code>self.first_name</code>而不是<code>self._first_name</code>。在这个例子中，我们创建一个<code>property</code>的目的就是在设置<code>attribute</code>的时候进行检查。因此，你可能想在初始化的时候也进行这种类型检查。通过设置<code>self.first_name</code>，自动调用<code>setter</code>方法，这个方法里面会进行参数的检查，否则就是直接访问<code>self._first_name</code>了。</p>
<p>还能在已存在的<code>get</code>和<code>set</code>方法基础上定义<code>property</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first_name</span>):</span><br><span class="line">        self.set_first_name(first_name)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Getter function</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._first_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Setter function</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_first_name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">        self._first_name = value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Deleter function (optional)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">del_first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;Can&#x27;t delete attribute&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Make a property from existing get/set methods</span></span><br><span class="line">    name = <span class="built_in">property</span>(get_first_name, set_first_name, del_first_name)</span><br></pre></td></tr></table></figure>
<h4 id="调用父类方法"><a href="#调用父类方法" class="headerlink" title="调用父类方法"></a>调用父类方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;A.spam&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;B.spam&#x27;</span>)</span><br><span class="line">        <span class="built_in">super</span>().spam()  <span class="comment"># Call parent spam()</span></span><br></pre></td></tr></table></figure>

<p><code>super()</code>函数的一个常见用法是在<code>__init__()</code>方法中确保父类被正确的初始化了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.x = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.y = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="定义接口或者抽象基类"><a href="#定义接口或者抽象基类" class="headerlink" title="定义接口或者抽象基类"></a>定义接口或者抽象基类</h4><p>使用<code>abs</code>模块可以很轻松的定义抽象基类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IStream</span>(metaclass=ABCMeta):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self, maxbytes=-<span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>抽象类的一个特点是它不能直接被实例化，比如你想像下面这样做是不行的:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = IStream() <span class="comment"># TypeError: Can&#x27;t instantiate abstract class</span></span><br><span class="line">                <span class="comment"># IStream with abstract methods read, write</span></span><br></pre></td></tr></table></figure>
<p>抽象类的目的就是让别的类继承它并实现特定的抽象方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SocketStream</span>(<span class="title class_ inherited__">IStream</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self, maxbytes=-<span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>抽象基类的一个主要用途是在代码中检查某些类是否为特定类型，实现了特定接口：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">serialize</span>(<span class="params">obj, stream</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(stream, IStream):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected an IStream&#x27;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>除了继承这种方式外，还可以通过注册方式来让某个类实现抽象基类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register the built-in I/O classes as supporting our interface</span></span><br><span class="line">IStream.register(io.IOBase)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Open a normal file and type check</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;foo.txt&#x27;</span>)</span><br><span class="line"><span class="built_in">isinstance</span>(f, IStream) <span class="comment"># Returns True</span></span><br></pre></td></tr></table></figure>
<p><code>@abstractmethod</code>还能注解静态方法、类方法和<code>properties</code>。你只需保证这个注解紧靠在函数定义前即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(metaclass=ABCMeta):</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @name.setter</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method1</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method2</span>():</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>标准库中有很多用到抽象基类的地方。<code>collections</code>模块定义了很多跟容器和迭代器(序列、映射、集合等)有关的抽象基类。<code>numbers</code>库定义了跟数字对象(整数、浮点数、有理数等)有关的基类。<code>io</code>库定义了很多跟<code>I/O</code>操作相关的基类。</p>
<p>你可以使用预定义的抽象类来执行更通用的类型检查，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x is a sequence</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.<span class="type">Sequence</span>):</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x is iterable</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.Iterable):</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x has a size</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.Sized):</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x is a mapping</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.Mapping):</span><br></pre></td></tr></table></figure>
<p>尽管<code>ABCs</code>可以让我们很方便的做类型检查，但是我们在代码中最好不要过多的使用它。因为<code>Python</code>的本质是一门动态编程语言，其目的就是给你更多灵活性，强制类型检查或让你代码变得更复杂，这样做无异于舍本求末。</p>
<h4 id="实现自定义容器"><a href="#实现自定义容器" class="headerlink" title="实现自定义容器"></a>实现自定义容器</h4><p><code>collections</code>定义了很多抽象基类，当你想自定义容器类的时候它们会非常有用。比如你想让你的类支持迭代，那就让你的类继承<code>collections.Iterable</code>即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(collections.Iterable):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>不过你需要实现<code>collections.Iterable</code>所有的抽象方法，否则会报错:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = A()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: Can<span class="string">&#x27;t instantiate abstract class A with abstract methods __iter__</span></span><br></pre></td></tr></table></figure>
<p><code>collections</code>中很多抽象类会为一些常见容器操作提供默认的实现，这样一来你只需要实现那些你最感兴趣的方法即可。假设你的类继承自<code>collections.MutableSequence</code>，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Items</span>(collections.MutableSequence):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, initial=<span class="literal">None</span></span>):</span><br><span class="line">        self._items = <span class="built_in">list</span>(initial) <span class="keyword">if</span> initial <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Required sequence methods</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Getting:&#x27;</span>, index)</span><br><span class="line">        <span class="keyword">return</span> self._items[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, index, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Setting:&#x27;</span>, index, value)</span><br><span class="line">        self._items[index] = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Deleting:&#x27;</span>, index)</span><br><span class="line">        <span class="keyword">del</span> self._items[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">self, index, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Inserting:&#x27;</span>, index, value)</span><br><span class="line">        self._items.insert(index, value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Len&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self._items)</span><br></pre></td></tr></table></figure>
<h4 id="在类中定义多个构造器"><a href="#在类中定义多个构造器" class="headerlink" title="在类中定义多个构造器"></a>在类中定义多个构造器</h4><p>为了实现多个构造器，你需要使用到类方法。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;方法一：使用类方法&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Primary constructor</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, year, month, day</span>):</span><br><span class="line">        self.year = year</span><br><span class="line">        self.month = month</span><br><span class="line">        self.day = day</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Alternate constructor</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">today</span>(<span class="params">cls</span>):</span><br><span class="line">        t = time.localtime()</span><br><span class="line">        <span class="keyword">return</span> cls(t.tm_year, t.tm_mon, t.tm_mday)</span><br></pre></td></tr></table></figure>
<p>直接调用类方法即可，下面是使用示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = Date(<span class="number">2012</span>, <span class="number">12</span>, <span class="number">21</span>) <span class="comment"># Primary</span></span><br><span class="line">b = Date.today() <span class="comment"># Alternate</span></span><br></pre></td></tr></table></figure>
<p>类方法的一个主要用途就是定义多个构造器。它接受一个<code>class</code>作为第一个参数<code>(cls)</code>。你应该注意到了这个类被用来创建并返回最终的实例。在继承时也能工作的很好：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewDate</span>(<span class="title class_ inherited__">Date</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">c = Date.today() <span class="comment"># Creates an instance of Date (cls=Date)</span></span><br><span class="line">d = NewDate.today() <span class="comment"># Creates an instance of NewDate (cls=NewDate)</span></span><br></pre></td></tr></table></figure>
<h4 id="创建不调用init方法的实例"><a href="#创建不调用init方法的实例" class="headerlink" title="创建不调用init方法的实例"></a>创建不调用init方法的实例</h4><p>可以通过<code>__new__()</code>方法创建一个未初始化的实例。例如考虑如下这个类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, year, month, day</span>):</span><br><span class="line">        self.year = year</span><br><span class="line">        self.month = month</span><br><span class="line">        self.day = day</span><br></pre></td></tr></table></figure>
<p>下面演示如何不调用<code>__init__()</code>方法来创建这个Date实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = Date.__new__(Date)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&lt;__main__.Date <span class="built_in">object</span> at <span class="number">0x1006716d0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.year</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;Date&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;year&#x27;</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>结果可以看到，这个<code>Date</code>实例的属性<code>year</code>还不存在，所以你需要手动初始化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">&#x27;year&#x27;</span>:<span class="number">2012</span>, <span class="string">&#x27;month&#x27;</span>:<span class="number">8</span>, <span class="string">&#x27;day&#x27;</span>:<span class="number">29</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key, value <span class="keyword">in</span> data.items():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">setattr</span>(d, key, value)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.year</span><br><span class="line"><span class="number">2012</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.month</span><br><span class="line"><span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="实现状态对象或者状态机"><a href="#实现状态对象或者状态机" class="headerlink" title="实现状态对象或者状态机"></a>实现状态对象或者状态机</h4><p>你想实现一个状态机或者是在不同状态下执行操作的对象，但是又不想在代码中出现太多的条件判断语句。那么如下是最好的实现方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Connection1</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;新方案——对每个状态定义一个类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.new_state(ClosedConnectionState)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_state</span>(<span class="params">self, newstate</span>):</span><br><span class="line">        self._state = newstate</span><br><span class="line">        <span class="comment"># Delegate to the state class</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.read(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.write(self, data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.<span class="built_in">open</span>(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.close(self)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Connection state base class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectionState</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">conn, data</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Implementation of different states</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClosedConnectionState</span>(<span class="title class_ inherited__">ConnectionState</span>):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Not open&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">conn, data</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Not open&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">conn</span>):</span><br><span class="line">        conn.new_state(OpenConnectionState)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Already closed&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenConnectionState</span>(<span class="title class_ inherited__">ConnectionState</span>):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;reading&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">conn, data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;writing&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Already open&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">conn</span>):</span><br><span class="line">        conn.new_state(ClosedConnectionState)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = Connection1()</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.<span class="built_in">open</span>()</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.read()</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.write(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.close()</span><br><span class="line"><span class="built_in">print</span>(c._state)<span class="comment">#### 通过字符串调用对象方法</span></span><br></pre></td></tr></table></figure>
<h4 id="让类支持比较操作"><a href="#让类支持比较操作" class="headerlink" title="让类支持比较操作"></a>让类支持比较操作</h4><p>Python类对每个比较操作都需要实现一个特殊方法来支持。例如为了支持&gt;&#x3D;操作符，你需要定义一个<code>__ge__()</code>方法。尽管定义一个方法没什么问题，但如果要你实现所有可能的比较方法那就有点烦人了。</p>
<p>装饰器<code>functools.total_ordering</code>就是用来简化这个处理的。使用它来装饰一个来，你只需定义一个<code>__eq__()</code>方法，外加其他方法<code>(__lt__, __le__, __gt__, or __ge__)</code>中的一个即可。然后装饰器会自动为你填充其它比较方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> total_ordering</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Room</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, length, width</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.length = length</span><br><span class="line">        self.width = width</span><br><span class="line">        self.square_feet = self.length * self.width</span><br><span class="line"></span><br><span class="line"><span class="meta">@total_ordering</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">House</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, style</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.style = style</span><br><span class="line">        self.rooms = <span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">living_space_footage</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(r.square_feet <span class="keyword">for</span> r <span class="keyword">in</span> self.rooms)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_room</span>(<span class="params">self, room</span>):</span><br><span class="line">        self.rooms.append(room)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;: &#123;&#125; square foot &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(self.name,</span><br><span class="line">                self.living_space_footage,</span><br><span class="line">                self.style)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.living_space_footage == other.living_space_footage</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__lt__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.living_space_footage &lt; other.living_space_footage</span><br></pre></td></tr></table></figure>
<p>这里我们只是给<code>House</code>类定义了两个方法：<code>__eq__()</code>和<code>__lt__()</code>，它就能支持所有的比较操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build a few houses, and add rooms to them</span></span><br><span class="line">h1 = House(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;Cape&#x27;</span>)</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Master Bedroom&#x27;</span>, <span class="number">14</span>, <span class="number">21</span>))</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Living Room&#x27;</span>, <span class="number">18</span>, <span class="number">20</span>))</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Kitchen&#x27;</span>, <span class="number">12</span>, <span class="number">16</span>))</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Office&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>))</span><br><span class="line">h2 = House(<span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;Ranch&#x27;</span>)</span><br><span class="line">h2.add_room(Room(<span class="string">&#x27;Master Bedroom&#x27;</span>, <span class="number">14</span>, <span class="number">21</span>))</span><br><span class="line">h2.add_room(Room(<span class="string">&#x27;Living Room&#x27;</span>, <span class="number">18</span>, <span class="number">20</span>))</span><br><span class="line">h2.add_room(Room(<span class="string">&#x27;Kitchen&#x27;</span>, <span class="number">12</span>, <span class="number">16</span>))</span><br><span class="line">h3 = House(<span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;Split&#x27;</span>)</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Master Bedroom&#x27;</span>, <span class="number">14</span>, <span class="number">21</span>))</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Living Room&#x27;</span>, <span class="number">18</span>, <span class="number">20</span>))</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Office&#x27;</span>, <span class="number">12</span>, <span class="number">16</span>))</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Kitchen&#x27;</span>, <span class="number">15</span>, <span class="number">17</span>))</span><br><span class="line">houses = [h1, h2, h3]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Is h1 bigger than h2?&#x27;</span>, h1 &gt; h2) <span class="comment"># prints True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Is h2 smaller than h3?&#x27;</span>, h2 &lt; h3) <span class="comment"># prints True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Is h2 greater than or equal to h1?&#x27;</span>, h2 &gt;= h1) <span class="comment"># Prints False</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Which one is biggest?&#x27;</span>, <span class="built_in">max</span>(houses)) <span class="comment"># Prints &#x27;h3: 1101-square-foot Split&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Which is smallest?&#x27;</span>, <span class="built_in">min</span>(houses)) <span class="comment"># Prints &#x27;h2: 846-square-foot Ranch&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建缓存实例"><a href="#创建缓存实例" class="headerlink" title="创建缓存实例"></a>创建缓存实例</h4><p>在创建一个类的对象时，如果之前使用同样参数创建过这个对象，你想返回它的缓存引用。为了达到这样的效果，你需要使用一个和类本身分开的工厂函数，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The class in question</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spam</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="comment"># Caching support</span></span><br><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line">_spam_cache = weakref.WeakValueDictionary()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> _spam_cache:</span><br><span class="line">        s = Spam(name)</span><br><span class="line">        _spam_cache[name] = s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = _spam_cache[name]</span><br><span class="line">    <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure>
<p>对于大部分程序而已，这里代码已经够用了。不过还是有一些更高级的实现值得了解下。首先是这里使用到了一个全局变量，并且工厂函数跟类放在一块。我们可以通过将缓存代码放到一个单独的缓存管理器中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CachedSpamManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._cache = weakref.WeakValueDictionary()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self._cache:</span><br><span class="line">            s = Spam(name)</span><br><span class="line">            self._cache[name] = s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = self._cache[name]</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear</span>(<span class="params">self</span>):</span><br><span class="line">            self._cache.clear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spam</span>:</span><br><span class="line">    manager = CachedSpamManager()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">name</span>):</span><br><span class="line">        <span class="keyword">return</span> Spam.manager.get_spam(name)</span><br></pre></td></tr></table></figure>
<p>但是这样暴露了类的实例化给用户，如果想阻止用户实例化该类的话，可以通过如下方法解决</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ------------------------最后的修正方案------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CachedSpamManager2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._cache = weakref.WeakValueDictionary()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self._cache:</span><br><span class="line">            temp = Spam3._new(name)  <span class="comment"># Modified creation</span></span><br><span class="line">            self._cache[name] = temp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp = self._cache[name]</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear</span>(<span class="params">self</span>):</span><br><span class="line">            self._cache.clear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spam3</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Can&#x27;t instantiate directly&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Alternate constructor</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_new</span>(<span class="params">cls, name</span>):</span><br><span class="line">        self = cls.__new__(cls)</span><br><span class="line">        self.name = name</span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="https://www.gitbook.com/book/lenkimo/byte-of-python-chinese-edition/details">A Byte of Python3</a><br>[2] <a target="_blank" rel="noopener" href="http://python3-cookbook.readthedocs.org/zh_CN/latest/c01/p08_calculating_with_dict.html">python3-cookbook</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/config-your-mac-development-environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/config-your-mac-development-environment/" class="post-title-link" itemprop="url">配置你的Mac开发环境</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-12 23:44:23" itemprop="dateCreated datePublished" datetime="2015-07-12T23:44:23+00:00">2015-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:26" itemprop="dateModified" datetime="2024-01-26T12:42:26+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/technology/" itemprop="url" rel="index"><span itemprop="name">technology</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>Mac</code>是目前大多数开发者们首选的开发机器，下面就让我们一起来配置你的Mac开发环境吧。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/config-your-mac-development-environment/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Python-implementation-string-similarity-edit-distance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python-implementation-string-similarity-edit-distance/" class="post-title-link" itemprop="url">Python实现字符串相似度-编辑距离</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-07 21:14:59" itemprop="dateCreated datePublished" datetime="2015-07-07T21:14:59+00:00">2015-07-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:21" itemprop="dateModified" datetime="2024-01-26T12:42:21+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithms/" itemprop="url" rel="index"><span itemprop="name">Algorithms</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="编辑距离"><a href="#编辑距离" class="headerlink" title="编辑距离"></a>编辑距离</h3><p>关于维基上的定义参见<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/%E7%B7%A8%E8%BC%AF%E8%B7%9D%E9%9B%A2">这里</a>。编辑距离，又称<code>Levenshtein</code>距离，是指两个字串之间，由一个转成另一个所需的最少编辑操作次数。通常许可的编辑操作包括:</p>
<ul>
<li>将一个字符替换成另一个字符</li>
<li>插入一个字符</li>
<li>删除一个字符</li>
</ul>
<p>例如将kitten一字转成sitting：</p>
<ul>
<li>sitten （k→s）</li>
<li>sittin （e→i）</li>
<li>sitting （→g）</li>
</ul>
<p>俄罗斯科学家<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Vladimir_Levenshtein"><code>Vladimir Levenshtein</code></a>在1965年提出了这个概念。</p>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><p>动态规划经常被用来作为这个问题的解决手段之一。伪代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">整数 Levenshtein距离(字符 str1[1..lenStr1], 字符 str2[1..lenStr2])</span><br><span class="line">   声明 int d[0..lenStr1, 0..lenStr2]</span><br><span class="line">   声明 int i, j, cost</span><br><span class="line"></span><br><span class="line">   for i = 由 0 至 lenStr1</span><br><span class="line">       d[i, 0] := i</span><br><span class="line">   for j = 由 0 至 lenStr2</span><br><span class="line">       d[0, j] := j</span><br><span class="line"></span><br><span class="line">   for i = 由 1 至 lenStr1</span><br><span class="line">       for j = 由 1 至 lenStr2</span><br><span class="line">           若 str1[i] = str2[j] 则 cost := 0</span><br><span class="line">                                否则 cost := 1</span><br><span class="line">           d[i, j] := 最小值(</span><br><span class="line">                                d[i-1, j  ] + 1,     // 刪除</span><br><span class="line">                                d[i  , j-1] + 1,     // 插入</span><br><span class="line">                                d[i-1, j-1] + cost   // 替换</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">   返回 d[lenStr1, lenStr2]</span><br></pre></td></tr></table></figure>
<h3 id="Python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Created on 2015/7/7  10:08</span></span><br><span class="line"><span class="string">使用动态规划算法实现编辑距离的计算</span></span><br><span class="line"><span class="string">@author: Wang Xu</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LevenshteinDistance</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">leDistance</span>(<span class="params">self, input_x, input_y</span>):</span><br><span class="line">        xlen = <span class="built_in">len</span>(input_x) + <span class="number">1</span>  <span class="comment"># 此处需要多开辟一个元素存储最后一轮的计算结果</span></span><br><span class="line">        ylen = <span class="built_in">len</span>(input_y) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        dp = np.zeros(shape=(xlen, ylen), dtype=<span class="built_in">int</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, xlen):</span><br><span class="line">            dp[i][<span class="number">0</span>] = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, ylen):</span><br><span class="line">            dp[<span class="number">0</span>][j] = j</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, xlen):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ylen):</span><br><span class="line">                <span class="keyword">if</span> input_x[i - <span class="number">1</span>] == input_y[j - <span class="number">1</span>]:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = <span class="number">1</span> + <span class="built_in">min</span>(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>], dp[i - <span class="number">1</span>][j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[xlen - <span class="number">1</span>][ylen - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ld = LevenshteinDistance()</span><br><span class="line">    <span class="built_in">print</span>(ld.leDistance(<span class="string">&#x27;瓦罐蹄膀饭&#x27;</span>, <span class="string">&#x27;瓦罐焖蹄饭&#x27;</span>))  <span class="comment"># Prints 2</span></span><br><span class="line">    <span class="built_in">print</span>(ld.leDistance(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;a&#x27;</span>))   <span class="comment"># Prints 1</span></span><br><span class="line">    <span class="built_in">print</span>(ld.leDistance(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;&#x27;</span>))   <span class="comment"># Prints 1</span></span><br><span class="line">    <span class="built_in">print</span>(ld.leDistance(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>))    <span class="comment"># Prints 0</span></span><br><span class="line">    <span class="built_in">print</span>(ld.leDistance(<span class="string">&#x27;杭椒小炒肉面&#x27;</span>, <span class="string">&#x27;外婆小肉面&#x27;</span>))  <span class="comment"># Prints 3</span></span><br><span class="line">    <span class="built_in">print</span>(ld.leDistance(<span class="string">&#x27;外婆小肉面&#x27;</span>, <span class="string">&#x27;杭椒小炒肉面&#x27;</span>))  <span class="comment"># Prints 3</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Python3-beginner-s-handbook-three/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python3-beginner-s-handbook-three/" class="post-title-link" itemprop="url">Python3入门手册之三</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-06 20:50:25" itemprop="dateCreated datePublished" datetime="2015-07-06T20:50:25+00:00">2015-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:28" itemprop="dateModified" datetime="2024-01-26T12:42:28+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>Version：Python 3.4.3 (v3.4.3:9b73f1c3e601, Feb 24 2015, 22:44:40) [MSC v.1600 64 bit (AMD64)] on win32</em></p>
<h3 id="文件与I-O"><a href="#文件与I-O" class="headerlink" title="文件与I&#x2F;O"></a>文件与I&#x2F;O</h3><h4 id="读写文本数据"><a href="#读写文本数据" class="headerlink" title="读写文本数据"></a>读写文本数据</h4><p>使用带有<code>rt</code>模式的<code>open()</code>函数读取文本文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.csv&#x27;</span>, mode=<span class="string">&#x27;rt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.csv&#x27;</span>, mode=<span class="string">&#x27;rt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>类似的，为了写入一个文本文件，使用带有<code>wt</code>模式的<code>open()</code>函数，如果之前文件内容存在则清除并覆盖掉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dest.csv&#x27;</span>, mode=<span class="string">&#x27;wt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;text1&#x27;</span>)  <span class="comment"># 注意该方式写入文件默认没有换行符，需手动添加</span></span><br><span class="line">    f.write(<span class="string">&#x27;text2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dest.csv&#x27;</span>, mode=<span class="string">&#x27;wt&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;text1&#x27;</span>, file=f)  <span class="comment"># 该方式写入文件默认换行，无需手动添加</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;text2&#x27;</span>, file=f)</span><br></pre></td></tr></table></figure>
<p>如果是在已存在文件中添加内容，使用模式为<code>at</code>的<code>open()</code>函数。<code>with</code>控制块结束时，文件会自动关闭。你也可以不使用<code>with</code>语句，但是这时候你就必须记得手动关闭文件。</p>
<p><strong>使用print输出元组</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">row = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(*row, sep=<span class="string">&#x27;,&#x27;</span>, end=<span class="string">&#x27;。&#x27;</span>) <span class="comment"># Prints a,b,c。</span></span><br></pre></td></tr></table></figure>
<h4 id="读写字节数据"><a href="#读写字节数据" class="headerlink" title="读写字节数据"></a>读写字节数据</h4><p>使用模式为<code>rb</code>或<code>wb</code>的<code>open()</code>函数来读取或写入二进制数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dest2.csv&#x27;</span>, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">b&#x27;HelloWorld!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dest2.csv&#x27;</span>, mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.read())</span><br></pre></td></tr></table></figure>
<p>在读取二进制数据的时候，字节字符串和文本字符串的语义差异可能会导致一个潜在的陷阱。特别需要注意的是，索引和迭代动作返回的是字节的值而不是字节字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Text string</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;H&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> t:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line">...</span><br><span class="line">H</span><br><span class="line">e</span><br><span class="line">l</span><br><span class="line">l</span><br><span class="line">o</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Byte string</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">b&#x27;Hello World&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b[<span class="number">0</span>]</span><br><span class="line"><span class="number">72</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> b:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line">...</span><br><span class="line"><span class="number">72</span></span><br><span class="line"><span class="number">101</span></span><br><span class="line"><span class="number">108</span></span><br><span class="line"><span class="number">108</span></span><br><span class="line"><span class="number">111</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="向不存在的文件中写入数据"><a href="#向不存在的文件中写入数据" class="headerlink" title="向不存在的文件中写入数据"></a>向不存在的文件中写入数据</h4><p>如果只允许向不存在的文件写入数据，可以在<code>open()</code>函数中使用<code>x</code>模式来代替<code>w</code>模式来解决这个问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dest2.csv&#x27;</span>, mode=<span class="string">&#x27;xt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;E:/workspaces/Python3/edu/shu/python/study/FileAndIO.py&quot;</span>, line <span class="number">33</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dest2.csv&#x27;</span>, mode=<span class="string">&#x27;xt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">FileExistsError: [Errno <span class="number">17</span>] File exists: <span class="string">&#x27;dest2.csv&#x27;</span></span><br></pre></td></tr></table></figure>
<p>由提示信息可知，当该文件在系统中已经存在的时候，是不允许继续向其中写入内容的。如果文件是二进制的，使用<code>xb</code>来代替<code>xt</code>。</p>
<h4 id="字符串的I-O操作"><a href="#字符串的I-O操作" class="headerlink" title="字符串的I&#x2F;O操作"></a>字符串的I&#x2F;O操作</h4><p>使用<code>io.StringIO()</code>和<code>io.BytesIO()</code>类来创建类文件对象操作字符串数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">s = io.StringIO()</span><br><span class="line">s.write(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\nthis is a test&#x27;</span>, file=s)</span><br><span class="line"><span class="comment"># 向控制台输出内容</span></span><br><span class="line"><span class="built_in">print</span>(s.getvalue())</span><br><span class="line"></span><br><span class="line">s = io.StringIO(<span class="string">&#x27;Hello World!\n&#x27;</span>)</span><br><span class="line"><span class="comment"># 先读取4个字符</span></span><br><span class="line"><span class="built_in">print</span>(s.read(<span class="number">4</span>))</span><br><span class="line"><span class="comment"># 读取剩下的字符</span></span><br><span class="line"><span class="built_in">print</span>(s.read())</span><br></pre></td></tr></table></figure>
<p><code>io.StringIO</code>只能用于文本。如果你要操作二进制数据，要使用<code>io.BytesIO</code>类来代替</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = io.BytesIO()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.write(<span class="string">b&#x27;binary data&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.getvalue()</span><br><span class="line"><span class="string">b&#x27;binary data&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="读写压缩文件"><a href="#读写压缩文件" class="headerlink" title="读写压缩文件"></a>读写压缩文件</h4><p><code>gzip</code>和<code>bz2</code>模块可以很容易的处理这些文件。两个模块都为<code>open()</code>函数提供了另外的实现来解决这个问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gzip compression</span></span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">with</span> gzip.<span class="built_in">open</span>(<span class="string">&#x27;somefile.gz&#x27;</span>, <span class="string">&#x27;rt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    text = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># bz2 compression</span></span><br><span class="line"><span class="keyword">import</span> bz2</span><br><span class="line"><span class="keyword">with</span> bz2.<span class="built_in">open</span>(<span class="string">&#x27;somefile.bz2&#x27;</span>, <span class="string">&#x27;rt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    text = f.read()</span><br></pre></td></tr></table></figure>
<p>类似的，为了写入压缩数据，可以这样做</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gzip compression</span></span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">with</span> gzip.<span class="built_in">open</span>(<span class="string">&#x27;somefile.gz&#x27;</span>, <span class="string">&#x27;wt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># bz2 compression</span></span><br><span class="line"><span class="keyword">import</span> bz2</span><br><span class="line"><span class="keyword">with</span> bz2.<span class="built_in">open</span>(<span class="string">&#x27;somefile.bz2&#x27;</span>, <span class="string">&#x27;wt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(text)</span><br></pre></td></tr></table></figure>
<p>大部分情况下读写压缩数据都是很简单的。但是要注意的是选择一个正确的文件模式是非常重要的。如果你不指定模式，那么默认的就是二进制模式，如果这时候程序想要接受的是文本数据，那么就会出错。<br>当写入压缩数据时，可以使用<code>compresslevel</code>这个可选的关键字参数来指定一个压缩级别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> gzip.<span class="built_in">open</span>(<span class="string">&#x27;somefile.gz&#x27;</span>, <span class="string">&#x27;wt&#x27;</span>, compresslevel=<span class="number">5</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(text)</span><br></pre></td></tr></table></figure>
<p>默认的等级是<code>9</code>，也是最高的压缩等级。等级越低性能越好，但是数据压缩程度也越低。</p>
<p>最后一点，<code>gzip.open()</code>和<code>bz2.open()</code>还有一个很少被知道的特性，它们可以作用在一个已存在并以二进制模式打开的文件上。比如，下面代码是可行的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;somefile.gz&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> gzip.<span class="built_in">open</span>(f, <span class="string">&#x27;rt&#x27;</span>) <span class="keyword">as</span> g:</span><br><span class="line">    text = g.read()</span><br></pre></td></tr></table></figure>
<p>这样就允许<code>gzip</code>和<code>bz2</code>模块可以工作在许多类文件对象上，比如套接字，管道和内存中文件等。</p>
<h4 id="读取二进制数据到可变缓冲区中"><a href="#读取二进制数据到可变缓冲区中" class="headerlink" title="读取二进制数据到可变缓冲区中"></a>读取二进制数据到可变缓冲区中</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_into_buffer</span>(<span class="params">filename</span>):</span><br><span class="line">    buf = <span class="built_in">bytearray</span>(os.path.getsize(filename))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.readinto(buf)</span><br><span class="line">    <span class="keyword">return</span> buf</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Write a sample file</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sample.bin&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    f.write(<span class="string">b&#x27;Hello World&#x27;</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>buf = read_into_buffer(<span class="string">&#x27;sample.bin&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>buf</span><br><span class="line"><span class="built_in">bytearray</span>(<span class="string">b&#x27;Hello World&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>buf[<span class="number">0</span>:<span class="number">5</span>] = <span class="string">b&#x27;Hallo&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>buf</span><br><span class="line"><span class="built_in">bytearray</span>(<span class="string">b&#x27;Hallo World&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;newsample.bin&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    f.write(buf)</span><br><span class="line">...</span><br><span class="line"><span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>文件对象的<code>readinto()</code>方法能被用来为预先分配内存的数组填充数据，甚至包括由<code>array</code>模块或<code>numpy</code>库创建的数组。和普通<code>read()</code>方法不同的是，<code>readinto()</code>填充已存在的缓冲区而不是为新对象重新分配内存再返回它们。因此，你可以使用它来避免大量的内存分配操作。比如，如果你读取一个由相同大小的记录组成的二进制文件时，你可以像下面这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">record_size = <span class="number">32</span> <span class="comment"># Size of each record (adjust value)</span></span><br><span class="line"></span><br><span class="line">buf = <span class="built_in">bytearray</span>(record_size)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;somefile&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = f.readinto(buf)</span><br><span class="line">        <span class="keyword">if</span> n &lt; record_size:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># Use the contents of buf</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<h4 id="文件路径名的操作"><a href="#文件路径名的操作" class="headerlink" title="文件路径名的操作"></a>文件路径名的操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>path = <span class="string">&#x27;/Users/beazley/Data/data.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Get the last component of the path</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.basename(path)</span><br><span class="line"><span class="string">&#x27;data.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Get the directory name</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.dirname(path)</span><br><span class="line"><span class="string">&#x27;/Users/beazley/Data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Join path components together</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.join(<span class="string">&#x27;tmp&#x27;</span>, <span class="string">&#x27;data&#x27;</span>, os.path.basename(path))</span><br><span class="line"><span class="string">&#x27;tmp/data/data.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Expand the user&#x27;s home directory</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>path = <span class="string">&#x27;~/Data/data.csv&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.expanduser(path)</span><br><span class="line"><span class="string">&#x27;/Users/beazley/Data/data.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Split the file extension</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.splitext(path)</span><br><span class="line">(<span class="string">&#x27;~/Data/data&#x27;</span>, <span class="string">&#x27;.csv&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>对于任何的文件名的操作，你都应该使用<code>os.path</code>模块，而不是使用标准字符串操作来构造自己的代码。特别是为了可移植性考虑的时候更应如此，因为<code>os.path</code>模块知道<code>Unix</code>和<code>Windows</code>系统之间的差异并且能够可靠地处理类似<code>Data/data.csv</code>和<code>Data\data.csv</code>这样的文件名。其次，你真的不应该浪费时间去重复造轮子。通常最好是直接使用已经为你准备好的功能。</p>
<p>使用如下方式测试文件的类型，如果测试的文件不存在的时候，结果都会返回<strong>False</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Is a regular file</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.isfile(<span class="string">&#x27;/etc/passwd&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Is a directory</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.isdir(<span class="string">&#x27;/etc/passwd&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Is a symbolic link</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.islink(<span class="string">&#x27;/usr/local/bin/python3&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Get the file linked to</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.realpath(<span class="string">&#x27;/usr/local/bin/python3&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;/usr/local/bin/python3.3&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如果你还想获取元数据(比如文件大小或者是修改日期)，也可以使用<code>os.path</code>模块来解决</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.getsize(<span class="string">&#x27;/etc/passwd&#x27;</span>)</span><br><span class="line"><span class="number">3669</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.getmtime(<span class="string">&#x27;/etc/passwd&#x27;</span>)</span><br><span class="line"><span class="number">1272478234.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> time</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.ctime(os.path.getmtime(<span class="string">&#x27;/etc/passwd&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;Wed Apr 28 13:10:34 2010&#x27;</span></span><br></pre></td></tr></table></figure>
<p>使用<code>os.listdir()</code>函数来获取某个目录中的文件列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">names = os.listdir(<span class="string">&#x27;somedir&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>获取目录中的列表是很容易的，但是其返回结果只是目录中实体名列表而已。如果你还想获取其他的元信息，比如文件大小，修改时间等等，你或许还需要使用到<code>os.path</code>模块中的函数或者<code>os.stat()</code>函数来收集数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example of getting a directory listing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">pyfiles = glob.glob(<span class="string">&#x27;*.py&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get file sizes and modification dates</span></span><br><span class="line">name_sz_date = [(name, os.path.getsize(name), os.path.getmtime(name))</span><br><span class="line">                <span class="keyword">for</span> name <span class="keyword">in</span> pyfiles]</span><br><span class="line"><span class="keyword">for</span> name, size, mtime <span class="keyword">in</span> name_sz_date:</span><br><span class="line">    <span class="built_in">print</span>(name, size, mtime)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Alternative: Get file metadata</span></span><br><span class="line">file_metadata = [(name, os.stat(name)) <span class="keyword">for</span> name <span class="keyword">in</span> pyfiles]</span><br><span class="line"><span class="keyword">for</span> name, meta <span class="keyword">in</span> file_metadata:</span><br><span class="line">    <span class="built_in">print</span>(name, meta.st_size, meta.st_mtime)</span><br></pre></td></tr></table></figure>
<h4 id="增加或改变已打开文件的编码"><a href="#增加或改变已打开文件的编码" class="headerlink" title="增加或改变已打开文件的编码"></a>增加或改变已打开文件的编码</h4><p>如果你想给一个以二进制模式打开的文件添加<code>Unicode</code>编码&#x2F;解码方式，可以使用<code>io.TextIOWrapper()</code>对象包装它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">u = urllib.request.urlopen(<span class="string">&#x27;http://www.python.org&#x27;</span>)</span><br><span class="line">f = io.TextIOWrapper(u, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">text = f.read()</span><br></pre></td></tr></table></figure>
<p>如果你想修改一个已经打开的文本模式的文件的编码方式，可以先使用<code>detach()</code>方法移除掉已存在的文本编码层，并使用新的编码方式代替。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.stdout.encoding</span><br><span class="line"><span class="string">&#x27;UTF-8&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.stdout = io.TextIOWrapper(sys.stdout.detach(), encoding=<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.stdout.encoding</span><br><span class="line"><span class="string">&#x27;latin-1</span></span><br></pre></td></tr></table></figure>
<p>在文本模式打开的文件中写入原始的字节数据，将字节数据直接写入文件的缓冲区即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.stdout.write(<span class="string">b&#x27;Hello\n&#x27;</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: must be <span class="built_in">str</span>, <span class="keyword">not</span> <span class="built_in">bytes</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.stdout.buffer.write(<span class="string">b&#x27;Hello\n&#x27;</span>)</span><br><span class="line">Hello</span><br><span class="line"><span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>类似的，能够通过读取文本文件的<code>buffer</code>属性来读取二进制数据。</p>
<h4 id="创建临时文件和文件夹"><a href="#创建临时文件和文件夹" class="headerlink" title="创建临时文件和文件夹"></a>创建临时文件和文件夹</h4><p><code>tempfile</code>模块中有很多的函数可以完成这任务。为了创建一个匿名的临时文件，可以使用<code>tempfile.TemporaryFile</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tempfile <span class="keyword">import</span> TemporaryFile</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> TemporaryFile(<span class="string">&#x27;w+t&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># Read/write to the file</span></span><br><span class="line">    f.write(<span class="string">&#x27;Hello World\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;Testing\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Seek back to beginning and read the data</span></span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Temporary file is destroyed</span></span><br></pre></td></tr></table></figure>
<p><code>TemporaryFile()</code>的第一个参数是文件模式，通常来讲文本模式使用<code>w+t</code>，二进制模式使用<code>w+b</code>。这个模式同时支持读和写操作，在这里是很有用的，因为当你关闭文件去改变模式的时候，文件实际上已经不存在了。<code>TemporaryFile()</code>另外还支持跟内置的<code>open()</code>函数一样的参数。</p>
<p>在大多数<code>Unix</code>系统上，通过<code>TemporaryFile()</code>创建的文件都是匿名的，甚至连目录都没有。如果你想打破这个限制，可以使用<code>NamedTemporaryFile()</code>来代替。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tempfile <span class="keyword">import</span> NamedTemporaryFile</span><br><span class="line"><span class="keyword">with</span> NamedTemporaryFile(<span class="string">&#x27;w+t&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;filename is:&#x27;</span>, f.name)</span><br><span class="line">    ...</span><br><span class="line"><span class="comment"># File automatically destroyed</span></span><br></pre></td></tr></table></figure>
<p>这里，被打开文件的<code>f.name</code>属性包含了该临时文件的文件名。当你需要将文件名传递给其他代码来打开这个文件的时候，这个就很有用了。和<code>TemporaryFile()</code>一样，结果文件关闭时会被自动删除掉。如果你不想这么做，可以传递一个关键字参数<code>delte=False</code>即可。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> NamedTemporaryFile(<span class="string">&#x27;w+t&#x27;</span>, delete=<span class="literal">False</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;filename is:&#x27;</span>, f.name)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>为了创建一个临时目录，可以使用<code>tempfile.TemporaryDirectory()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tempfile <span class="keyword">import</span> TemporaryDirectory</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> TemporaryDirectory() <span class="keyword">as</span> dirname:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;dirname is:&#x27;</span>, dirname)</span><br><span class="line">    <span class="comment"># Use the directory</span></span><br><span class="line">    ...</span><br><span class="line"><span class="comment"># Directory and all contents destroyed</span></span><br></pre></td></tr></table></figure>
<p><code>TemporaryFile()</code>、<code>NamedTemporaryFile()</code>和<code>TemporaryDirectory()</code>函数应该是处理临时文件目录的最简单的方式了，因为它们会自动处理所有的创建和清理步骤。在一个更低的级别，你可以使用<code>mkstemp()</code>和<code>mkdtemp()</code>来创建临时文件和目录。</p>
<h4 id="与串行端口的数据通信"><a href="#与串行端口的数据通信" class="headerlink" title="与串行端口的数据通信"></a>与串行端口的数据通信</h4><p>尽管你可以通过使用Python内置的I&#x2F;O模块来完成这个任务，但对于串行通信最好的选择是使用<a target="_blank" rel="noopener" href="http://pyserial.sourceforge.net/">pySerial</a>包。这个包的使用非常简单，先安装<code>pySerial</code>，使用类似下面这样的代码就能很容易的打开一个串行端口：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> serial</span><br><span class="line">ser = serial.Serial(<span class="string">&#x27;/dev/tty.usbmodem641&#x27;</span>, <span class="comment"># Device name varies</span></span><br><span class="line">                    baudrate=<span class="number">9600</span>,</span><br><span class="line">                    bytesize=<span class="number">8</span>,</span><br><span class="line">                    parity=<span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">                    stopbits=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>设备名对于不同的设备和操作系统是不一样的。比如，在<code>Windows</code>系统上，你可以使用0，1等表示的一个设备来打开通信端口<code>COM0</code>和<code>COM1</code>。一旦端口打开，那就可以使用<code>read()</code>，<code>readline()</code>和<code>write()</code>函数读写数据了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ser.write(<span class="string">b&#x27;G1 X50 Y50\r\n&#x27;</span>)</span><br><span class="line">resp = ser.readline()</span><br></pre></td></tr></table></figure>
<h4 id="序列化Python对象"><a href="#序列化Python对象" class="headerlink" title="序列化Python对象"></a>序列化Python对象</h4><p>对于序列化最普遍的做法就是使用<code>pickle</code>模块。为了将一个对象保存到一个文件中，可以这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">data = ... <span class="comment"># Some Python object</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;somefile&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">pickle.dump(data, f)</span><br></pre></td></tr></table></figure>
<p>为了将一个对象转储为一个字符串，可以使用<code>pickle.dumps()</code>：<br><code>s = pickle.dumps(data)</code><br>为了从字节流中恢复一个对象，使用<code>picle.load()</code>或<code>pickle.loads()</code>函数。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Restore from a file</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;somefile&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">data = pickle.load(f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Restore from a string</span></span><br><span class="line">data = pickle.loads(s)</span><br></pre></td></tr></table></figure>
<h3 id="数据编码和处理"><a href="#数据编码和处理" class="headerlink" title="数据编码和处理"></a>数据编码和处理</h3><h4 id="读写CSV数据"><a href="#读写CSV数据" class="headerlink" title="读写CSV数据"></a>读写CSV数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="comment"># 将CSV中的数据读入元组中，并允许使用列名如row.Symbol和row.Change（Symbol和Change是CSV文件中的列名）</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stock.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.reader(f)</span><br><span class="line">    headings = <span class="built_in">next</span>(f_csv)</span><br><span class="line">    Row = namedtuple(<span class="string">&#x27;Row&#x27;</span>, headings)</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> f_csv:</span><br><span class="line">        row = Row(*r)</span><br><span class="line">        <span class="comment"># Process row</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>另外一个选择就是将数据读取到一个字典序列中去。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.DictReader(f)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        <span class="comment"># process row</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>在这个版本中，你可以使用列名去访问每一行的数据了。比如，<code>row[&#39;Symbol&#39;]</code>或者<code>row[&#39;Change&#39;]</code>。</p>
<p>为了写入<code>CSV</code>数据，你仍然可以使用<code>CSV</code>模块，不过这时候先创建一个<code>writer</code>对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">headers = [<span class="string">&#x27;Symbol&#x27;</span>,<span class="string">&#x27;Price&#x27;</span>,<span class="string">&#x27;Date&#x27;</span>,<span class="string">&#x27;Time&#x27;</span>,<span class="string">&#x27;Change&#x27;</span>,<span class="string">&#x27;Volume&#x27;</span>]</span><br><span class="line">rows = [(<span class="string">&#x27;AA&#x27;</span>, <span class="number">39.48</span>, <span class="string">&#x27;6/11/2007&#x27;</span>, <span class="string">&#x27;9:36am&#x27;</span>, -<span class="number">0.18</span>, <span class="number">181800</span>),</span><br><span class="line">         (<span class="string">&#x27;AIG&#x27;</span>, <span class="number">71.38</span>, <span class="string">&#x27;6/11/2007&#x27;</span>, <span class="string">&#x27;9:36am&#x27;</span>, -<span class="number">0.15</span>, <span class="number">195500</span>),</span><br><span class="line">         (<span class="string">&#x27;AXP&#x27;</span>, <span class="number">62.58</span>, <span class="string">&#x27;6/11/2007&#x27;</span>, <span class="string">&#x27;9:36am&#x27;</span>, -<span class="number">0.46</span>, <span class="number">935000</span>),</span><br><span class="line">       ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.writer(f)</span><br><span class="line">    f_csv.writerow(headers)</span><br><span class="line">    f_csv.writerows(rows)</span><br></pre></td></tr></table></figure>
<p>如果你有一个字典序列的数据，可以像这样做</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">headers = [<span class="string">&#x27;Symbol&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>, <span class="string">&#x27;Date&#x27;</span>, <span class="string">&#x27;Time&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>, <span class="string">&#x27;Volume&#x27;</span>]</span><br><span class="line">rows = [&#123;<span class="string">&#x27;Symbol&#x27;</span>:<span class="string">&#x27;AA&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>:<span class="number">39.48</span>, <span class="string">&#x27;Date&#x27;</span>:<span class="string">&#x27;6/11/2007&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Time&#x27;</span>:<span class="string">&#x27;9:36am&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>:-<span class="number">0.18</span>, <span class="string">&#x27;Volume&#x27;</span>:<span class="number">181800</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;Symbol&#x27;</span>:<span class="string">&#x27;AIG&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>: <span class="number">71.38</span>, <span class="string">&#x27;Date&#x27;</span>:<span class="string">&#x27;6/11/2007&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Time&#x27;</span>:<span class="string">&#x27;9:36am&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>:-<span class="number">0.15</span>, <span class="string">&#x27;Volume&#x27;</span>: <span class="number">195500</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;Symbol&#x27;</span>:<span class="string">&#x27;AXP&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>: <span class="number">62.58</span>, <span class="string">&#x27;Date&#x27;</span>:<span class="string">&#x27;6/11/2007&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Time&#x27;</span>:<span class="string">&#x27;9:36am&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>:-<span class="number">0.46</span>, <span class="string">&#x27;Volume&#x27;</span>: <span class="number">935000</span>&#125;,</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.DictWriter(f, headers)</span><br><span class="line">    f_csv.writeheader()</span><br><span class="line">    f_csv.writerows(rows)</span><br></pre></td></tr></table></figure>
<h4 id="读写JSON数据"><a href="#读写JSON数据" class="headerlink" title="读写JSON数据"></a>读写JSON数据</h4><p><code>json</code>模块提供了一种很简单的方式来编码和解码JSON数据。其中两个主要的函数是<code>json.dumps()</code>和<code>json.loads()</code>，要比其他序列化函数库如<code>pickle</code>的接口少得多。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span> : <span class="string">&#x27;ACME&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;shares&#x27;</span> : <span class="number">100</span>,</span><br><span class="line">    <span class="string">&#x27;price&#x27;</span> : <span class="number">542.23</span></span><br><span class="line">&#125;</span><br><span class="line">json_str = json.dumps(data)</span><br></pre></td></tr></table></figure>
<p>将JSON编码的字符串转回一个Python数据结构<br><code>data = json.loads(json_str)</code><br>如果你要处理的是文件而不是字符串，你可以使用<code>json.dump()</code>和<code>json.load()</code>来编码和解码JSON数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Writing JSON data</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(data, f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reading data back</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br></pre></td></tr></table></figure>
<h4 id="解析简单的XML数据"><a href="#解析简单的XML数据" class="headerlink" title="解析简单的XML数据"></a>解析简单的XML数据</h4><p>可以使用<code>xml.etree.ElementTree</code>模块从简单的XML文档中提取数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="comment"># Download the RSS feed and parse it</span></span><br><span class="line">u = urlopen(<span class="string">&#x27;http://planet.python.org/rss20.xml&#x27;</span>)</span><br><span class="line">doc = parse(u)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract and output tags of interest</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> doc.iterfind(<span class="string">&#x27;channel/item&#x27;</span>):</span><br><span class="line">    title = item.findtext(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    date = item.findtext(<span class="string">&#x27;pubDate&#x27;</span>)</span><br><span class="line">    link = item.findtext(<span class="string">&#x27;link&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(title)</span><br><span class="line">    <span class="built_in">print</span>(date)</span><br><span class="line">    <span class="built_in">print</span>(link)</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p><code>xml.etree.ElementTree.parse()</code>函数解析整个XML文档并将其转换成一个文档对象。然后，你就能使用<code>find()</code>、<code>iterfind()</code>和<code>findtext()</code>等方法来搜索特定的XML元素了。这些函数的参数就是某个指定的标签名，例如<code>channel/item</code>或<code>title</code>。</p>
<p><code>ElementTree</code>模块中的每个元素有一些重要的属性和方法，在解析的时候非常有用。<code>tag</code>属性包含了标签的名字，<code>text</code>属性包含了内部的文本，而<code>get()</code>方法能获取属性值。</p>
<p>有一点要强调的是<code>xml.etree.ElementTree</code>并不是<code>XML</code>解析的唯一方法。对于更高级的应用程序，你需要考虑使用<code>lxml</code>。它使用了和<code>ElementTree</code>同样的编程接口，因此上面的例子同样也适用于<code>lxml</code>。你只需要将刚开始的<code>import</code>语句换成<code>from lxml.etree import parse</code>就行了。<code>lxml</code>完全遵循<code>XML</code>标准，并且速度也非常快，同时还支持验证，<code>XSLT</code>和<code>XPath</code>等特性。</p>
<h4 id="增量式解析大型XML文件"><a href="#增量式解析大型XML文件" class="headerlink" title="增量式解析大型XML文件"></a>增量式解析大型XML文件</h4><p>任何时候只要你遇到增量式的数据处理时，第一时间就应该想到迭代器和生成器。 下面是一个很简单的函数，只使用很少的内存就能增量式的处理一个大型XML文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> iterparse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_and_remove</span>(<span class="params">filename, path</span>):</span><br><span class="line">    path_parts = path.split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    doc = iterparse(filename, (<span class="string">&#x27;start&#x27;</span>, <span class="string">&#x27;end&#x27;</span>))</span><br><span class="line">    <span class="comment"># Skip the root element</span></span><br><span class="line">    <span class="built_in">next</span>(doc)</span><br><span class="line"></span><br><span class="line">    tag_stack = []</span><br><span class="line">    elem_stack = []</span><br><span class="line">    <span class="keyword">for</span> event, elem <span class="keyword">in</span> doc:</span><br><span class="line">        <span class="keyword">if</span> event == <span class="string">&#x27;start&#x27;</span>:</span><br><span class="line">            tag_stack.append(elem.tag)</span><br><span class="line">            elem_stack.append(/)</span><br><span class="line">        <span class="keyword">elif</span> event == <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> tag_stack == path_parts:</span><br><span class="line">                <span class="keyword">yield</span> elem</span><br><span class="line">                elem_stack[-<span class="number">2</span>].remove(elem)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                tag_stack.pop()</span><br><span class="line">                elem_stack.pop()</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><code>iterparse()</code>方法允许对<code>XML</code>文档进行增量操作。使用时，你需要提供文件名和一个包含下面一种或多种类型的事件列表：<code>start</code>,<code>end</code>,<code>start-ns</code>和<code>end-ns</code>。由<code>iterparse()</code>创建的迭代器会产生形如(event, elem)的元组，其中<code>event</code>是上述事件列表中的某一个，而<code>elem</code>是相应的XML元素。</p>
<p><code>start</code>事件在某个元素第一次被创建并且还没有被插入其他数据(如子元素)时被创建。而<code>end</code>事件在某个元素已经完成时被创建。尽管没有在例子中演示，<code>start-ns</code>和<code>end-ns</code>事件被用来处理<code>XML</code>文档命名空间的声明。</p>
<h4 id="将字典转换为XML"><a href="#将字典转换为XML" class="headerlink" title="将字典转换为XML"></a>将字典转换为XML</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> Element</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dict_to_xml</span>(<span class="params">tag, d</span>):</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Turn a simple dict of key/value pairs into XML</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">elem = Element(tag)</span><br><span class="line"><span class="keyword">for</span> key, val <span class="keyword">in</span> d.items():</span><br><span class="line">    child = Element(key)</span><br><span class="line">    child.text = <span class="built_in">str</span>(val)</span><br><span class="line">    elem.append(child)</span><br><span class="line"><span class="keyword">return</span> elem</span><br></pre></td></tr></table></figure>
<p>对于<code>I/O</code>操作，使用<code>xml.etree.ElementTree</code>中的<code>tostring()</code>函数很容易就能将它转换成一个字节字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> tostring</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tostring(e)</span><br><span class="line"><span class="string">b&#x27;&lt;stock&gt;&lt;price&gt;490.1&lt;/price&gt;&lt;shares&gt;100&lt;/shares&gt;&lt;name&gt;GOOG&lt;/name&gt;&lt;/stock&gt;&#x27;</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p><code>xml.sax.saxutils</code>中的<code>escape()</code>和<code>unescape()</code>函数提供对HTML实体的转换方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.sax.saxutils <span class="keyword">import</span> escape, unescape</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>escape(<span class="string">&#x27;&lt;spam&gt;&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&lt;spam&gt;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>unescape(_)</span><br><span class="line"><span class="string">&#x27;&lt;spam&gt;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="解析和修改XML"><a href="#解析和修改XML" class="headerlink" title="解析和修改XML"></a>解析和修改XML</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse, Element</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc = parse(<span class="string">&#x27;pred.xml&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root = doc.getroot()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root</span><br><span class="line">&lt;Element <span class="string">&#x27;stop&#x27;</span> at <span class="number">0x100770cb0</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Remove a few elements</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.remove(root.find(<span class="string">&#x27;sri&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.remove(root.find(<span class="string">&#x27;cr&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Insert a new element after &lt;nm&gt;...&lt;/nm&gt;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.getchildren().index(root.find(<span class="string">&#x27;nm&#x27;</span>))</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = Element(<span class="string">&#x27;spam&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.text = <span class="string">&#x27;This is a test&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>root.insert(<span class="number">2</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Write back to a file</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>doc.write(<span class="string">&#x27;newpred.xml&#x27;</span>, xml_declaration=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h4 id="编码和解码十六进制数"><a href="#编码和解码十六进制数" class="headerlink" title="编码和解码十六进制数"></a>编码和解码十六进制数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Initial byte string</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">b&#x27;hello&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Encode as hex</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> binascii</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h = binascii.b2a_hex(s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h</span><br><span class="line"><span class="string">b&#x27;68656c6c6f&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Decode back to bytes</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>binascii.a2b_hex(h)</span><br><span class="line"><span class="string">b&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>
<p>类似的功能同样可以在<code>base64</code>模块中找到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h = base64.b16encode(s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h</span><br><span class="line"><span class="string">b&#x27;68656C6C6F&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b16decode(h)</span><br><span class="line"><span class="string">b&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>
<p>大部分情况下，通过使用上述的函数来转换十六进制是很简单的。上面两种技术的主要不同在于大小写的处理。函数<code>base64.b16decode()</code>和<code>base64.b16encode()</code>只能操作大写形式的十六进制字母，而<code>binascii</code>模块中的函数大小写都能处理。<br>还有一点需要注意的是编码函数所产生的输出总是一个字节字符串。如果想强制以<code>Unicode</code>形式输出，你需要增加一个额外的界面步骤。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>h = base64.b16encode(s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(h)</span><br><span class="line"><span class="string">b&#x27;68656C6C6F&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(h.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">68656C6C6F</span><br></pre></td></tr></table></figure>
<p>在解码十六进制数时，函数<code>b16decode()</code>和<code>a2b_hex()</code>可以接受字节或<code>unicode</code>字符串。但是，<code>unicode</code>字符串必须仅仅只包含<code>ASCII</code>编码的十六进制数。</p>
<h4 id="编码解码Base64数据"><a href="#编码解码Base64数据" class="headerlink" title="编码解码Base64数据"></a>编码解码Base64数据</h4><p><code>base64</code>模块中有两个函数<code>b64encode()</code>and<code>b64decode()</code>可以帮你解决这个问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Some byte data</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">b&#x27;hello&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Encode as Base64</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = base64.b64encode(s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line"><span class="string">b&#x27;aGVsbG8=&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Decode from Base64</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64decode(a)</span><br><span class="line"><span class="string">b&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="读写二进制数组数据"><a href="#读写二进制数组数据" class="headerlink" title="读写二进制数组数据"></a>读写二进制数组数据</h4><p>可以使用<code>struct</code>模块处理二进制数据。下面是一段示例代码将一个Python元组列表写入一个二进制文件，并使用<code>struct</code>将每个元组编码为一个结构体。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> Struct</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_records</span>(<span class="params">records, <span class="built_in">format</span>, f</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Write a sequence of tuples to a binary file of structures.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    record_struct = Struct(<span class="built_in">format</span>)</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> records:</span><br><span class="line">        f.write(record_struct.pack(*r))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    records = [ (<span class="number">1</span>, <span class="number">2.3</span>, <span class="number">4.5</span>),</span><br><span class="line">                (<span class="number">6</span>, <span class="number">7.8</span>, <span class="number">9.0</span>),</span><br><span class="line">                (<span class="number">12</span>, <span class="number">13.4</span>, <span class="number">56.7</span>) ]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.b&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        write_records(records, <span class="string">&#x27;&lt;idd&#x27;</span>, f)</span><br></pre></td></tr></table></figure>
<p>如果你打算以块的形式增量读取文件，你可以这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> Struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_records</span>(<span class="params"><span class="built_in">format</span>, f</span>):</span><br><span class="line">    record_struct = Struct(<span class="built_in">format</span>)</span><br><span class="line">    chunks = <span class="built_in">iter</span>(<span class="keyword">lambda</span>: f.read(record_struct.size), <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (record_struct.unpack(chunk) <span class="keyword">for</span> chunk <span class="keyword">in</span> chunks)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.b&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> rec <span class="keyword">in</span> read_records(<span class="string">&#x27;&lt;idd&#x27;</span>, f):</span><br><span class="line">            <span class="comment"># Process rec</span></span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>
<p>如果你想将整个文件一次性读取到一个字节字符串中，然后在分片解析。那么你可以这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> Struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpack_records</span>(<span class="params"><span class="built_in">format</span>, data</span>):</span><br><span class="line">    record_struct = Struct(<span class="built_in">format</span>)</span><br><span class="line">    <span class="keyword">return</span> (record_struct.unpack_from(data, offset)</span><br><span class="line">            <span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), record_struct.size))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.b&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">for</span> rec <span class="keyword">in</span> unpack_records(<span class="string">&#x27;&lt;idd&#x27;</span>, data):</span><br><span class="line">        <span class="comment"># Process rec</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="https://www.gitbook.com/book/lenkimo/byte-of-python-chinese-edition/details">A Byte of Python3</a><br>[2] <a target="_blank" rel="noopener" href="http://python3-cookbook.readthedocs.org/zh_CN/latest/c01/p08_calculating_with_dict.html">python3-cookbook</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Python3-beginner-s-handbook-two/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python3-beginner-s-handbook-two/" class="post-title-link" itemprop="url">Python3入门手册之二</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-04 21:16:41" itemprop="dateCreated datePublished" datetime="2015-07-04T21:16:41+00:00">2015-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:19" itemprop="dateModified" datetime="2024-01-26T12:42:19+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>Version：Python 3.4.3 (v3.4.3:9b73f1c3e601, Feb 24 2015, 22:44:40) [MSC v.1600 64 bit (AMD64)] on win32</em></p>
<h3 id="数字日期和时间"><a href="#数字日期和时间" class="headerlink" title="数字日期和时间"></a>数字日期和时间</h3><h4 id="数字的四舍五入"><a href="#数字的四舍五入" class="headerlink" title="数字的四舍五入"></a>数字的四舍五入</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding: UTF-8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Created on 2015/7/3  23:01</span></span><br><span class="line"><span class="string">@author: &#x27;WX&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(<span class="number">1.23</span>, <span class="number">1</span>))  <span class="comment"># Prints 1.2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(<span class="number">1.27</span>, <span class="number">1</span>))  <span class="comment"># Prints 1.3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(-<span class="number">1.27</span>, <span class="number">1</span>))  <span class="comment"># Prints -1.3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(<span class="number">1.25361</span>, <span class="number">3</span>))  <span class="comment"># Prints 1.254</span></span><br><span class="line"><span class="comment"># 当一个值刚好在两个边界的中间的时候，round 函数返回离它最近的偶数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(<span class="number">1.25</span>, <span class="number">1</span>))  <span class="comment"># Prints 1.2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(<span class="number">1.35</span>, <span class="number">1</span>))  <span class="comment"># Prints 1.4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传给 round() 函数的 ndigits 参数可以是负数，这种情况下， 舍入运算会作用在十位、百位、千位等上面</span></span><br><span class="line">a = <span class="number">1627731</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(a, -<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(a, -<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">round</span>(a, -<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化浮点数，保留指定的小数点后保留位数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">format</span>(<span class="number">1.23456</span>, <span class="string">&#x27;0.2f&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="执行精确的浮点数运算"><a href="#执行精确的浮点数运算" class="headerlink" title="执行精确的浮点数运算"></a>执行精确的浮点数运算</h4><p>如果需要精确的浮点数计算，那么推荐使用<code>decimal</code>模块的<code>Decimal</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line">a = Decimal(<span class="string">&#x27;1.3&#x27;</span>)</span><br><span class="line">b = Decimal(<span class="string">&#x27;1.7&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a / b)</span><br><span class="line"></span><br><span class="line">a = Decimal(<span class="string">&#x27;4.2&#x27;</span>)</span><br><span class="line">b = Decimal(<span class="string">&#x27;2.1&#x27;</span>)</span><br><span class="line">c = a.__add__(b)</span><br><span class="line">d = a + b</span><br><span class="line"><span class="built_in">print</span>(c)  <span class="comment"># Prints 6.3</span></span><br><span class="line"><span class="built_in">print</span>(d)  <span class="comment"># Prints 6.3</span></span><br></pre></td></tr></table></figure>
<h4 id="无穷大与NaN"><a href="#无穷大与NaN" class="headerlink" title="无穷大与NaN"></a>无穷大与NaN</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line">b = <span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>)</span><br><span class="line">c = <span class="built_in">float</span>(<span class="string">&#x27;nan&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)  <span class="comment"># Prints inf</span></span><br><span class="line"><span class="built_in">print</span>(b)  <span class="comment"># Prints -inf</span></span><br><span class="line"><span class="built_in">print</span>(c)  <span class="comment"># Prints nan</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># 可以使用如下方式测试这些值的存在，测试一个NaN值的唯一安全的方法就是使用math.isnan()</span></span><br><span class="line"><span class="built_in">print</span>(math.isinf(a))  <span class="comment"># Prints True</span></span><br><span class="line"><span class="built_in">print</span>(math.isnan(c))  <span class="comment"># Prints True</span></span><br></pre></td></tr></table></figure>
<h4 id="分数运算"><a href="#分数运算" class="headerlink" title="分数运算"></a>分数运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fractions模块可以被用来执行包含分数的数学运算</span></span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"></span><br><span class="line">a = Fraction(<span class="number">5</span>, <span class="number">4</span>)</span><br><span class="line">b = Fraction(<span class="number">7</span>, <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(a + b)  <span class="comment"># Prints 27/16</span></span><br><span class="line">c = a * b</span><br><span class="line"><span class="built_in">print</span>(c)  <span class="comment"># Prints 35/64</span></span><br><span class="line"><span class="built_in">print</span>(c.numerator)  <span class="comment"># 获取分子</span></span><br><span class="line"><span class="built_in">print</span>(c.denominator)  <span class="comment"># 获取分母</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">float</span>(c))  <span class="comment"># 强转成float类型</span></span><br><span class="line">d = <span class="number">3.75</span></span><br><span class="line">e = Fraction(*d.as_integer_ratio())  <span class="comment"># 强转float类型到分数类型</span></span><br><span class="line"><span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>
<h4 id="大型数组运算"><a href="#大型数组运算" class="headerlink" title="大型数组运算"></a>大型数组运算</h4><p>涉及到数组的重量级运算操作，可以使用<code>NumPy</code>库。<code>NumPy</code>的一个主要特征是它会给Python提供一个数组对象，相比标准的Python列表而言更适合用来做数学运算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Python lists</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x * <span class="number">2</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x + <span class="number">10</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: can only concatenate <span class="built_in">list</span> (<span class="keyword">not</span> <span class="string">&quot;int&quot;</span>) to <span class="built_in">list</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x + y</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Numpy arrays</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ay = np.array([<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax * <span class="number">2</span></span><br><span class="line">array([<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax + <span class="number">10</span></span><br><span class="line">array([<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax + ay</span><br><span class="line">array([ <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax * ay</span><br><span class="line">array([ <span class="number">5</span>, <span class="number">12</span>, <span class="number">21</span>, <span class="number">32</span>])</span><br></pre></td></tr></table></figure>
<p><code>NumPy</code>还为数组操作提供了大量的通用函数，这些函数可以作为<code>math</code>模块中类似函数的替代</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.sqrt(ax)</span><br><span class="line">array([ <span class="number">1.</span> , <span class="number">1.41421356</span>, <span class="number">1.73205081</span>, <span class="number">2.</span> ])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.cos(ax)</span><br><span class="line">array([ <span class="number">0.54030231</span>, -<span class="number">0.41614684</span>, -<span class="number">0.9899925</span> , -<span class="number">0.65364362</span>])</span><br></pre></td></tr></table></figure>
<p>使用<code>NumPy</code>构造一个二维数组的例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>grid = np.zeros(shape=(<span class="number">10000</span>,<span class="number">10000</span>), dtype=<span class="built_in">float</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>grid</span><br><span class="line">    array([[ <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, ..., <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">    [ <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, ..., <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">    [ <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, ..., <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">    ...,</span><br><span class="line">    [ <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, ..., <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">    [ <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, ..., <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">    [ <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, ..., <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]])</span><br></pre></td></tr></table></figure>
<p>对于<code>NumPy</code>构造的数组，如何选择行和列呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>], [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">[ <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">[ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Select row 1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>]</span><br><span class="line">array([<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Select column 1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[:,<span class="number">1</span>]</span><br><span class="line">array([ <span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Select a subregion and change it</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>:<span class="number">3</span>, <span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">array([[ <span class="number">6</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">11</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>:<span class="number">3</span>, <span class="number">1</span>:<span class="number">3</span>] += <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">        [ <span class="number">5</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">8</span>],</span><br><span class="line">        [ <span class="number">9</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">12</span>]])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Broadcast a row vector across an operation on all rows</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a + [<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>]</span><br><span class="line">array([[<span class="number">101</span>, <span class="number">103</span>, <span class="number">105</span>, <span class="number">107</span>],</span><br><span class="line">        [<span class="number">105</span>, <span class="number">117</span>, <span class="number">119</span>, <span class="number">111</span>],</span><br><span class="line">        [<span class="number">109</span>, <span class="number">121</span>, <span class="number">123</span>, <span class="number">115</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">        [ <span class="number">5</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">8</span>],</span><br><span class="line">        [ <span class="number">9</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">12</span>]])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Conditional assignment on an array</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.where(a &lt; <span class="number">10</span>, a, <span class="number">10</span>)</span><br><span class="line">array([[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">        [ <span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">8</span>],</span><br><span class="line">        [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>]])</span><br></pre></td></tr></table></figure>
<p>通常我们导入<code>NumPy</code>模块的时候会使用语句<code>import numpy as np</code>。这样的话你就不用再你的程序里面一遍遍的敲入<code>numpy</code>，只需要输入<code>np</code>就行了，节省了不少时间。</p>
<h4 id="基本的日期与时间转换"><a href="#基本的日期与时间转换" class="headerlink" title="基本的日期与时间转换"></a>基本的日期与时间转换</h4><p>为了执行不同时间单位的转换和计算，请使用<code>datetime</code>模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = timedelta(days=<span class="number">2</span>, hours=<span class="number">6</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = timedelta(hours=<span class="number">4.5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = a + b</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.days</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.seconds</span><br><span class="line"><span class="number">37800</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.seconds / <span class="number">3600</span></span><br><span class="line"><span class="number">10.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.total_seconds() / <span class="number">3600</span></span><br><span class="line"><span class="number">58.5</span></span><br></pre></td></tr></table></figure>
<p>如果你想表示指定的日期和时间，先创建一个<code>datetime</code>实例然后使用标准的数学运算来操作它们</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = datetime(<span class="number">2012</span>, <span class="number">9</span>, <span class="number">23</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(a + timedelta(days=<span class="number">10</span>))</span><br><span class="line"><span class="number">2012</span>-<span class="number">10</span>-03 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = datetime(<span class="number">2012</span>, <span class="number">12</span>, <span class="number">21</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = b - a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.days</span><br><span class="line"><span class="number">89</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.today()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(now)</span><br><span class="line"><span class="number">2012</span>-<span class="number">12</span>-<span class="number">21</span> <span class="number">14</span>:<span class="number">54</span>:<span class="number">43.094063</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(now + timedelta(minutes=<span class="number">10</span>))</span><br><span class="line"><span class="number">2012</span>-<span class="number">12</span>-<span class="number">21</span> <span class="number">15</span>:04:<span class="number">43.094063</span></span><br></pre></td></tr></table></figure>
<p>对大多数基本的日期和时间处理问题，<code>datetime</code>模块以及足够了。 如果你需要执行更加复杂的日期操作，比如处理时区，模糊时间范围，节假日计算等等， 可以考虑使用<code>dateutil</code>模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = datetime(<span class="number">2012</span>, <span class="number">9</span>, <span class="number">23</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a + timedelta(months=<span class="number">1</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">&#x27;months&#x27;</span> <span class="keyword">is</span> an invalid keyword argument <span class="keyword">for</span> this function</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dateutil.relativedelta <span class="keyword">import</span> relativedelta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a + relativedelta(months=+<span class="number">1</span>)</span><br><span class="line">datetime.datetime(<span class="number">2012</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a + relativedelta(months=+<span class="number">4</span>)</span><br><span class="line">datetime.datetime(<span class="number">2013</span>, <span class="number">1</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Time between two dates</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = datetime(<span class="number">2012</span>, <span class="number">12</span>, <span class="number">21</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = b - a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">datetime.timedelta(<span class="number">89</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = relativedelta(b, a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">relativedelta(months=+<span class="number">2</span>, days=+<span class="number">28</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.months</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.days</span><br><span class="line"><span class="number">28</span></span><br></pre></td></tr></table></figure>
<h4 id="字符串转换为日期"><a href="#字符串转换为日期" class="headerlink" title="字符串转换为日期"></a>字符串转换为日期</h4><p>使用Python的标准模块<code>datetime</code>可以很容易的解决这个问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;2012-09-20&#x27;</span></span><br><span class="line">y = datetime.strptime(text, <span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(y)  <span class="comment"># Prints 2012-09-20 00:00:00</span></span><br><span class="line">z = datetime.now()</span><br><span class="line"><span class="built_in">print</span>(z)  <span class="comment"># Prints 2015-07-04 15:49:17.419612</span></span><br><span class="line">diff = z - y</span><br><span class="line"><span class="built_in">print</span>(diff)  <span class="comment"># Prints 1017 days, 15:49:17.419612</span></span><br></pre></td></tr></table></figure>
<p><code>datetime.strptime()</code>方法支持很多的格式化代码，比如<code>%Y</code>代表4位数年份，<code>%m</code>代表两位数月份。还有一点值得注意的是这些格式化占位符也可以反过来使用，将日期输出为指定的格式字符串形式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>z</span><br><span class="line">datetime.datetime(<span class="number">2012</span>, <span class="number">9</span>, <span class="number">23</span>, <span class="number">21</span>, <span class="number">37</span>, <span class="number">4</span>, <span class="number">177393</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nice_z = datetime.strftime(z, <span class="string">&#x27;%A %B %d, %Y&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nice_z</span><br><span class="line"><span class="string">&#x27;Sunday September 23, 2012&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="结合时区的日期操作"><a href="#结合时区的日期操作" class="headerlink" title="结合时区的日期操作"></a>结合时区的日期操作</h4><p>对几乎所有涉及到时区的问题，你都应该使用<code>pytz</code>模块。这个包提供了<code>Olson</code>时区数据库，它是时区信息的事实上的标准，在很多语言和操作系统里面都可以找到。<code>pytz</code>模块一个主要用途是将<code>datetime</code>库创建的简单日期对象本地化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> pytz <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line">d = datetime(<span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">30</span>, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(d)  <span class="comment"># Prints 2015-01-01 09:30:00</span></span><br><span class="line"><span class="comment"># central = timezone(&#x27;Asia/Shanghai&#x27;)</span></span><br><span class="line"><span class="comment"># Localize the date for Chicago</span></span><br><span class="line">central = timezone(<span class="string">&#x27;US/Central&#x27;</span>)</span><br><span class="line">loc_d = central.localize(d)</span><br><span class="line"><span class="built_in">print</span>(loc_d)  <span class="comment"># Prints 2015-01-01 09:30:00-06:00</span></span><br></pre></td></tr></table></figure>
<p>一旦日期被本地化了， 它就可以转换为其他时区的时间了。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bang_d = loc_d.astimezone(timezone(<span class="string">&#x27;Asia/Shanghai&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(bang_d)  <span class="comment"># Prints 2015-01-01 23:30:00+08:00</span></span><br></pre></td></tr></table></figure>
<p>当涉及到时区操作的时候，有个问题就是我们如何得到时区的名称。比如，在这个例子中，我们如何知道<code>“Asia/Shanghai”</code>就是中国对应的时区名呢？为了查找，可以使用<code>ISO3166</code>国家代码作为关键字去查阅字典<code>pytz.country_timezones</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Urumqi  乌鲁木齐（新疆首府）</span></span><br><span class="line"><span class="built_in">print</span>(pytz.country_timezones[<span class="string">&#x27;CN&#x27;</span>])  <span class="comment"># Prints [&#x27;Asia/Shanghai&#x27;, &#x27;Asia/Urumqi&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="迭代器与生成器"><a href="#迭代器与生成器" class="headerlink" title="迭代器与生成器"></a>迭代器与生成器</h3><h4 id="代理迭代"><a href="#代理迭代" class="headerlink" title="代理迭代"></a>代理迭代</h4><p>Python的迭代器协议需要<code>__iter__()</code>方法返回一个实现了<code>__next__()</code>方法的迭代器对象。如果你只是迭代遍历其他容器的内容，你无须担心底层是怎样实现的。你所要做的只是传递迭代请求既可。这里的<code>iter()</code>函数的使用简化了代码，<code>iter(s)</code>只是简单的通过调用<code>s.__iter__()</code>方法来返回对应的迭代器对象，就跟<code>len(s)</code>会调用<code>s.__len__()</code>原理是一样的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding: UTF-8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Created on 2015/7/4  18:33</span></span><br><span class="line"><span class="string">@author: &#x27;WX&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        self._value = value</span><br><span class="line">        self._children = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Node(&#123;!r&#125;)&#x27;</span>.<span class="built_in">format</span>(self._value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_child</span>(<span class="params">self, node</span>):</span><br><span class="line">        self._children.append(node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(self._children)</span><br><span class="line"><span class="comment">#Example</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    root = Node(<span class="number">0</span>)</span><br><span class="line">    child1 = Node(<span class="number">1</span>)</span><br><span class="line">    child2 = Node(<span class="number">2</span>)</span><br><span class="line">    root.add_child(child1)</span><br><span class="line">    root.add_child(child2)</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> root:</span><br><span class="line">        <span class="built_in">print</span>(ch)</span><br></pre></td></tr></table></figure>
<h4 id="反向迭代"><a href="#反向迭代" class="headerlink" title="反向迭代"></a>反向迭代</h4><p>反向迭代仅仅当对象的大小可预先确定或者对象实现了<code>__reversed__()</code>的特殊方法时才能生效。如果两者都不符合，那你必须先将对象转换为一个列表才行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">reversed</span>(a):</span><br><span class="line">    <span class="built_in">print</span>(x, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="comment"># Print a file backwards</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;test.csv&#x27;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">list</span>(f)):</span><br><span class="line">    <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>要注意的是如果可迭代对象元素很多的话，将其预先转换为一个列表要消耗大量的内存。这时候需要在定义的类上实现<code>__reversed__()</code>方法来实现反向迭代</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Countdown</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start</span>):</span><br><span class="line">        self.start = start</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Forward iterator</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        n = self.start</span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">yield</span> n</span><br><span class="line">            n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Reverse iterator</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reversed__</span>(<span class="params">self</span>):</span><br><span class="line">        n = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> n &lt;= self.start:</span><br><span class="line">            <span class="keyword">yield</span> n</span><br><span class="line">            n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> rr <span class="keyword">in</span> <span class="built_in">reversed</span>(Countdown(<span class="number">30</span>)):</span><br><span class="line">    <span class="built_in">print</span>(rr)</span><br><span class="line"><span class="keyword">for</span> rr <span class="keyword">in</span> Countdown(<span class="number">30</span>):</span><br><span class="line">    <span class="built_in">print</span>(rr)</span><br></pre></td></tr></table></figure>
<p>定义一个反向迭代器可以使得代码非常的高效，因为它不再需要将数据填充到一个列表中然后再去反向迭代这个列表。</p>
<h4 id="迭代器切片"><a href="#迭代器切片" class="headerlink" title="迭代器切片"></a>迭代器切片</h4><p>函数<code>itertools.islice()</code>正好适用于在迭代器和生成器上做切片操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">count</span>(<span class="params">n</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> n</span><br><span class="line"><span class="meta">... </span>        n += <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = count(<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c[<span class="number">10</span>:<span class="number">20</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">&#x27;generator&#x27;</span> <span class="built_in">object</span> <span class="keyword">is</span> <span class="keyword">not</span> subscriptable</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Now using islice()</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> itertools</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> itertools.islice(c, <span class="number">10</span>, <span class="number">20</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)</span><br><span class="line">...</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="number">15</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">17</span></span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">19</span></span><br></pre></td></tr></table></figure>
<p>函数<code>islice()</code>返回一个可以生成指定元素的迭代器，它通过遍历并丢弃直到切片开始索引位置的所有元素。然后才开始一个个的返回元素，并直到切片结束索引位置。这里要着重强调的一点是<code>islice()</code>会消耗掉传入的迭代器中的数据。必须考虑到迭代器是不可逆的这个事实。所以如果你需要之后再次访问这个迭代器的话，那你就得先将它里面的数据放入一个列表中。</p>
<h4 id="跳过可迭代对象的开始部分"><a href="#跳过可迭代对象的开始部分" class="headerlink" title="跳过可迭代对象的开始部分"></a>跳过可迭代对象的开始部分</h4><p>为了演示，假定你在读取一个开始部分是几行注释的源文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">...</span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># User Database</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that this file is consulted directly only when the system is running</span></span><br><span class="line"><span class="comment"># in single-user mode. At other times, this information is provided by</span></span><br><span class="line"><span class="comment"># Open Directory.</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">##</span></span><br><span class="line">nobody:*:-<span class="number">2</span>:-<span class="number">2</span>:Unprivileged User:/var/empty:/usr/<span class="built_in">bin</span>/false</span><br><span class="line">root:*:<span class="number">0</span>:<span class="number">0</span>:System Administrator:/var/root:/<span class="built_in">bin</span>/sh</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>如果你想跳过开始部分的注释行的话，可以这样做</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> dropwhile</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> line <span class="keyword">in</span> dropwhile(<span class="keyword">lambda</span> line: line.startswith(<span class="string">&#x27;#&#x27;</span>), f):</span><br><span class="line"><span class="meta">... </span>        <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">nobody:*:-<span class="number">2</span>:-<span class="number">2</span>:Unprivileged User:/var/empty:/usr/<span class="built_in">bin</span>/false</span><br><span class="line">root:*:<span class="number">0</span>:<span class="number">0</span>:System Administrator:/var/root:/<span class="built_in">bin</span>/sh</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="排列组合的迭代"><a href="#排列组合的迭代" class="headerlink" title="排列组合的迭代"></a>排列组合的迭代</h4><p><code>itertools</code>模块提供了三个函数来解决这类问题。其中一个是<code>itertools.permutations()</code>，它接受一个集合并产生一个元组序列，每个元组由集合中所有元素的一个可能排列组成。也就是说通过打乱集合中元素排列顺序生成一个元组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>items = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> p <span class="keyword">in</span> permutations(items):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(p)</span><br><span class="line">...</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>如果你想得到指定长度的所有排列，你可以传递一个可选的长度参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> p <span class="keyword">in</span> permutations(items, <span class="number">2</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(p)</span><br><span class="line">...</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>使用<code>itertools.combinations()</code>可得到输入集合中元素的所有的组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> combinations(items, <span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line">...</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> combinations(items, <span class="number">2</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line">...</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> combinations(items, <span class="number">1</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line">...</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>,)</span><br><span class="line">(<span class="string">&#x27;c&#x27;</span>,)</span><br></pre></td></tr></table></figure>
<p>对于<code>combinations()</code>来讲，元素的顺序已经不重要了。也就是说，组合<code>(&#39;a&#39;, &#39;b&#39;)</code>跟<code>(&#39;b&#39;, &#39;a&#39;)</code>其实是一样的(最终只会输出其中一个)。</p>
<p>在计算组合的时候，一旦元素被选取就会从候选中剔除掉(比如如果元素’a’已经被选取了，那么接下来就不会再考虑它了)。而函数<code>itertools.combinations_with_replacement()</code>允许同一个元素被选择多次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> combinations_with_replacement(items, <span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line">...</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="序列上索引值迭代"><a href="#序列上索引值迭代" class="headerlink" title="序列上索引值迭代"></a>序列上索引值迭代</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> idx, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(my_list):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(idx, val)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> a</span><br><span class="line"><span class="number">1</span> b</span><br><span class="line"><span class="number">2</span> c</span><br></pre></td></tr></table></figure>
<p>为了按传统行号输出(行号从1开始)，你可以传递一个开始参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_list = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> idx, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(my_list, <span class="number">1</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(idx, val)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> a</span><br><span class="line"><span class="number">2</span> b</span><br><span class="line"><span class="number">3</span> c</span><br></pre></td></tr></table></figure>
<p><code>enumerate()</code>对于跟踪某些值在列表中出现的位置是很有用的。 所以，如果你想将一个文件中出现的单词映射到它出现的行号上去，可以很容易的利用<code>enumerate()</code>来完成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">word_summary = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;myfile.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(lines):</span><br><span class="line">    <span class="comment"># Create a list of words in current line</span></span><br><span class="line">    words = [w.strip().lower() <span class="keyword">for</span> w <span class="keyword">in</span> line.split()]</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">        word_summary[word].append(idx)</span><br></pre></td></tr></table></figure>
<p>如果你处理完文件后打印 <code>word_summary</code>，会发现它是一个字典(准确来讲是一个<code>defaultdict</code>)，对于每个单词有一个<code>key</code>，每个<code>key</code>对应的值是一个由这个单词出现的行号组成的列表。如果某个单词在一行中出现过两次，那么这个行号也会出现两次，同时也可以作为文本的一个简单统计。</p>
<p><code>enumerate()</code>函数返回的是一个<code>enumerate</code>对象实例，它是一个迭代器，返回连续的包含一个计数和一个值的元组，元组中的值通过在传入序列上调用<code>next()</code>返回。</p>
<p>还有一点可能并不很重要，但是也值得注意，有时候当你在一个已经解压后的元组序列上使用<code>enumerate()</code>函数时很容易调入陷阱。你得像下面正确的方式这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data = [ (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">5</span>, <span class="number">6</span>), (<span class="number">7</span>, <span class="number">8</span>) ]</span><br><span class="line"><span class="comment"># Correct!</span></span><br><span class="line"><span class="keyword">for</span> n, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">    ...</span><br><span class="line"><span class="comment"># Error!</span></span><br><span class="line"><span class="keyword">for</span> n, x, y <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h4 id="同时迭代多个序列"><a href="#同时迭代多个序列" class="headerlink" title="同时迭代多个序列"></a>同时迭代多个序列</h4><p>为了同时迭代多个序列，使用<code>zip()</code>函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>xpts = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">7</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ypts = [<span class="number">101</span>, <span class="number">78</span>, <span class="number">37</span>, <span class="number">15</span>, <span class="number">62</span>, <span class="number">99</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(xpts, ypts):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x,y)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> <span class="number">101</span></span><br><span class="line"><span class="number">5</span> <span class="number">78</span></span><br><span class="line"><span class="number">4</span> <span class="number">37</span></span><br><span class="line"><span class="number">2</span> <span class="number">15</span></span><br><span class="line"><span class="number">10</span> <span class="number">62</span></span><br><span class="line"><span class="number">7</span> <span class="number">99</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p><code>zip(a, b)</code>会生成一个可返回元组<code>(x, y)</code>的迭代器，其中<code>x</code>来自<code>a</code>，<code>y</code>来自<code>b</code>。一旦其中某个序列到底结尾，迭代宣告结束。因此迭代长度跟参数中最短序列长度一致。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [<span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">zip</span>(a,b):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(i)</span><br><span class="line">...</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;y&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>如果这个不是你想要的效果，那么还可以使用<code>itertools.zip_longest()</code>函数来代替。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> zip_longest(a,b):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(i)</span><br><span class="line">...</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">(<span class="literal">None</span>, <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> zip_longest(a, b, fillvalue=<span class="number">0</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(i)</span><br><span class="line">...</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="string">&#x27;z&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>最后强调一点就是，<code>zip()</code>会创建一个迭代器来作为结果返回。如果你需要将结对的值存储在列表中，要使用<code>list()</code>函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">zip</span>(a, b)</span><br><span class="line">&lt;<span class="built_in">zip</span> <span class="built_in">object</span> at <span class="number">0x1007001b8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">zip</span>(a, b))</span><br><span class="line">[(<span class="number">1</span>, <span class="number">10</span>), (<span class="number">2</span>, <span class="number">11</span>), (<span class="number">3</span>, <span class="number">12</span>)]</span><br></pre></td></tr></table></figure>
<h4 id="不同集合上元素的迭代"><a href="#不同集合上元素的迭代" class="headerlink" title="不同集合上元素的迭代"></a>不同集合上元素的迭代</h4><p>当可迭代对象类型不一样的时候<code>chain()</code>同样可以很好的工作，它接受一个可迭代对象列表作为输入，并返回一个迭代器，有效的屏蔽掉在多个容器中迭代细节。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> chain(a, b):</span><br><span class="line"><span class="meta">... </span><span class="built_in">print</span>(x)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">x</span><br><span class="line">y</span><br><span class="line">z</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="展开嵌套的序列"><a href="#展开嵌套的序列" class="headerlink" title="展开嵌套的序列"></a>展开嵌套的序列</h4><p>可以写一个包含<code>yield from</code>语句的递归生成器来轻松解决这个问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flatten</span>(<span class="params">items, ignore_types=(<span class="params"><span class="built_in">str</span>, <span class="built_in">bytes</span></span>)</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(x, Iterable) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(x, ignore_types):</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> flatten(x)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">yield</span> x</span><br><span class="line"></span><br><span class="line">items = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>], <span class="number">7</span>], <span class="number">8</span>]</span><br><span class="line"><span class="comment"># Produces 1 2 3 4 5 6 7 8</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flatten(items):</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>
<p>额外的参数<code>ignore_types</code>和检测语句<code>isinstance(x,ignore_types)</code>用来将字符串和字节排除在可迭代对象外，防止将它们再展开成单个的字符。这样的话字符串数组就能最终返回我们所期望的结果了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>items = [<span class="string">&#x27;Dave&#x27;</span>, <span class="string">&#x27;Paula&#x27;</span>, [<span class="string">&#x27;Thomas&#x27;</span>, <span class="string">&#x27;Lewis&#x27;</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> flatten(items):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x)</span><br><span class="line">...</span><br><span class="line">Dave</span><br><span class="line">Paula</span><br><span class="line">Thomas</span><br><span class="line">Lewis</span><br></pre></td></tr></table></figure>
<h4 id="顺序迭代合并后的排序迭代对象"><a href="#顺序迭代合并后的排序迭代对象" class="headerlink" title="顺序迭代合并后的排序迭代对象"></a>顺序迭代合并后的排序迭代对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> heapq</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [<span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> heapq.merge(a, b):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">11</span></span><br></pre></td></tr></table></figure>
<p><code>heapq.merge</code>可迭代特性意味着它不会立马读取所有序列。这就意味着你可以在非常长的序列中使用它，而不会有太大的开销。比如，下面是一个例子来演示如何合并两个排序文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sorted_file_1&#x27;</span>, <span class="string">&#x27;rt&#x27;</span>) <span class="keyword">as</span> file1, \</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;sorted_file_2&#x27;</span>, <span class="string">&#x27;rt&#x27;</span>) <span class="keyword">as</span> file2, \</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;merged_file&#x27;</span>, <span class="string">&#x27;wt&#x27;</span>) <span class="keyword">as</span> outf:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> heapq.merge(file1, file2):</span><br><span class="line">        outf.write(line)</span><br></pre></td></tr></table></figure>
<p>有一点要强调的是<code>heapq.merge()</code>需要所有输入序列必须是排过序的。特别的，它并不会预先读取所有数据到堆栈中或者预先排序，也不会对输入做任何的排序检测。它仅仅是检查所有序列的开始部分并返回最小的那个，这个过程一直会持续直到所有输入序列中的元素都被遍历完。</p>
<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="https://www.gitbook.com/book/lenkimo/byte-of-python-chinese-edition/details">A Byte of Python3</a><br>[2] <a target="_blank" rel="noopener" href="http://python3-cookbook.readthedocs.org/zh_CN/latest/c01/p08_calculating_with_dict.html">python3-cookbook</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Python-implementation-of-the-longest-common-subsequences/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python-implementation-of-the-longest-common-subsequences/" class="post-title-link" itemprop="url">Python实现最长公共子序列-Longest Common Subsequences</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-03 22:34:40" itemprop="dateCreated datePublished" datetime="2015-07-03T22:34:40+00:00">2015-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:23" itemprop="dateModified" datetime="2024-01-26T12:42:23+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithms/" itemprop="url" rel="index"><span itemprop="name">Algorithms</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>一个数列<strong>S</strong>，如果分别是两个或多个已知数列的子序列，且是所有符合此条件序列中最长的，则<strong>S</strong>称为已知序列的最长公共子序列。例如序列<code>X=ABCBDAB</code>，<code>Y=BDCABA</code>。序列<code>BCA</code>是X和Y的一个公共子序列，但是不是X和Y的最长公共子序列，子序列<code>BCBA</code>是X和Y的一个LCS。</p>
<h3 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h3><p>对于一般性的LCS问题（即任意数量的序列）是属于<code>NP-hard</code>。但当序列的数量确定时，问题可以使用动态规划（Dynamic Programming）在多项式时间解决。</p>
<h3 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h3><p>动态规划的一个计算最长公共子序列的方法如下，以两个序列$X&#x3D;\langle x_1,x_2,…,x_m \rangle$、$Y&#x3D;\langle y_1,y_2,…,y_n \rangle$为例子，LCS(X,Y)表示X和Y的一个最长公共子序列：<br>如果$x_m &#x3D; y_n$，则$LCS(X,Y) &#x3D; x_m + LCS(x_{m-1},y_{n-1})$<br>如果$x_m !&#x3D; y_n$，则$LCS(X,Y) &#x3D; max \lbrace LCS(x_{m-1},Y)，LCS(X,y_{n-1}) \rbrace$</p>
<p>为了找到最长的LCS，我们定义<code>dp[i][j]</code>记录LCS的长度，如果X的长度为0或者Y的长度为0，那么LCS&#x3D;0，即<code>dp[i][j]=0</code>，用i和j分别表示到序列X和序列Y的长度，状态转移方程如下:</p>
<p>$$i&#x3D;0||j&#x3D;0，dp[i][j] &#x3D; 0$$</p>
<p>$$X[i] &#x3D; Y[j]，dp[i][j] &#x3D; dp[i-1][j-1] + 1$$</p>
<p>$$X[i] !&#x3D; Y[j]，dp[i][j] &#x3D; max \lbrace dp[i-1][j]，dp[i][j-1] \rbrace$$</p>
<h3 id="Python实现LCS"><a href="#Python实现LCS" class="headerlink" title="Python实现LCS"></a>Python实现LCS</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Longest Common Subsequences</span></span><br><span class="line"><span class="string">Created on 2015/7/2  15:11</span></span><br><span class="line"><span class="string">@author: Wang Xu</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCS</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lcs_base</span>(<span class="params">self, input_x, input_y</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(input_x) == <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">len</span>(input_y) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            a = input_x[<span class="number">0</span>]</span><br><span class="line">            b = input_y[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> a == b:</span><br><span class="line">                <span class="keyword">return</span> self.lcs_base(input_x[<span class="number">1</span>:], input_y[<span class="number">1</span>:]) + a</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># get the max one</span></span><br><span class="line">                <span class="keyword">return</span> self.getMax(self.lcs_base(input_x[<span class="number">1</span>:], input_y), self.lcs_base(input_x, input_y[<span class="number">1</span>:]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct a list by the input string</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getList</span>(<span class="params">self, inputStr</span>):</span><br><span class="line">        listRes = <span class="built_in">list</span>()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(inputStr) != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(inputStr)):</span><br><span class="line">                listRes.append(inputStr[i])</span><br><span class="line">        <span class="keyword">return</span> listRes</span><br><span class="line"></span><br><span class="line">    <span class="comment"># return the max one between a and b, equivalently return the longest one</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getMax</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(a) &gt;= <span class="built_in">len</span>(b):</span><br><span class="line">            <span class="keyword">return</span> a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    lcs = LCS()</span><br><span class="line">    l1 = lcs.getList(<span class="string">&#x27;我的大中国&#x27;</span>)</span><br><span class="line">    l2 = lcs.getList(<span class="string">&#x27;大中国我的&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    l3 = lcs.lcs_base(l1, l2)</span><br><span class="line">    <span class="built_in">print</span>(l3[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    l3 = lcs.lcs_base(l2, l1)</span><br><span class="line">    <span class="built_in">print</span>(l3[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    l1 = <span class="string">&#x27;1233433236676&#x27;</span></span><br><span class="line">    l2 = <span class="string">&#x27;98723765655423&#x27;</span></span><br><span class="line">    l3 = lcs.lcs_base(l1, l2)</span><br><span class="line">    <span class="built_in">print</span>(l3[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    l1 = <span class="string">&#x27;123s212346我的大中国啊33z&#x27;</span></span><br><span class="line">    l2 = <span class="string">&#x27;33z的大中国&#x27;</span></span><br><span class="line">    l3 = lcs.lcs_base(l1, l2)</span><br><span class="line">    <span class="built_in">print</span>(l3[::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p>该算法的空间、时间复杂度均为$O(n^{2})$，经过优化后，空间复杂度可为$O(n)$。</p>
<h3 id="LCS变体-最长公共子串"><a href="#LCS变体-最长公共子串" class="headerlink" title="LCS变体-最长公共子串"></a>LCS变体-最长公共子串</h3><p>最长公共子串与最长公共子序列稍有区别，不过也算是<code>LCS</code>的一个变体，在<code>LCS</code>中，子序列是不必要求连续的，而子串则是“连续”的。<br>题：给定两个字符串<code>X</code>，<code>Y</code>，求二者最长的公共子串，例如<code>X=[aaaba]</code>，<code>Y=[ababaa]</code>。二者的最长公共子串为<code>[aba]</code>，长度为3。</p>
<h4 id="基本算法"><a href="#基本算法" class="headerlink" title="基本算法"></a>基本算法</h4><p>将X的每个子串与Y的每个子串做对比，求出最长公共子串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Created on 2015/7/2  16:13</span></span><br><span class="line"><span class="string">@author: Wang Xu</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 使用基本算法获取最长公共子串（连续），最长公共子序列可以是非连续的</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getcomlen</span>(<span class="params">firststr, secondstr</span>):</span><br><span class="line">    comlen = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> firststr <span class="keyword">and</span> secondstr:</span><br><span class="line">        <span class="keyword">if</span> firststr[<span class="number">0</span>] == secondstr[<span class="number">0</span>]:</span><br><span class="line">            comlen += <span class="number">1</span></span><br><span class="line">            firststr = firststr[<span class="number">1</span>:]</span><br><span class="line">            secondstr = secondstr[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> comlen</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lcs_base</span>(<span class="params">input_x, input_y</span>):</span><br><span class="line">    max_common_len = <span class="number">0</span></span><br><span class="line">    common_index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> xtemp <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(input_x)):</span><br><span class="line">        <span class="keyword">for</span> ytemp <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(input_y)):</span><br><span class="line">            com_temp = getcomlen(input_x[xtemp: <span class="built_in">len</span>(input_x)], input_y[ytemp: <span class="built_in">len</span>(input_y)])</span><br><span class="line">            <span class="keyword">if</span> com_temp &gt; max_common_len:</span><br><span class="line">                max_common_len = com_temp</span><br><span class="line">                common_index = xtemp</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;公共子串的长度是：%s&#x27;</span> % max_common_len)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;最长公共子串是：%s&#x27;</span> % input_x[common_index:common_index + max_common_len])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    lcs_base(<span class="string">&#x27;d11zabcdeabdcdbbcd&#x27;</span>, <span class="string">&#x27;bbcd11yabcdefaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">OutPut:</span></span><br><span class="line"><span class="string">公共子串的长度是：5</span></span><br><span class="line"><span class="string">最长公共子串是：abcde</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="DP算法"><a href="#DP算法" class="headerlink" title="DP算法"></a>DP算法</h4><p>使用动态规划来解最长公共子串问题，可以考虑如何将<code>arr[0,...,i]</code>的问题转化为求解<code>arr[0,...,i-1]</code>的问题，此处考虑使用<code>dp[i][j]</code>表示以<code>X[i]</code>和<code>Y[j]</code>结尾的最长公共子串的长度，因为要求子串连续，所以对于<code>X[i]</code>和<code>Y[j]</code>来讲，它们要么与之前的公共子串构成新的公共子串；要么就是不构成公共子串；状态转移方程为</p>
<p>$$X[i] &#x3D; Y[j]，dp[i][j] &#x3D; dp[i-1][j-1] + 1$$</p>
<p>$$X[i] !&#x3D; Y[j]，dp[i][j] &#x3D; 0$$</p>
<p>对于初始化，<code>i=0</code>或者<code>j=0</code>，如果<code>X[i] == Y[j]</code>，<code>dp[i][j] = 1</code>；否则<code>dp[i][j] = 0</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LCS3</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lcs_dp</span>(<span class="params">self, input_x, input_y</span>):</span><br><span class="line">        <span class="comment"># input_y as column, input_x as row</span></span><br><span class="line">        dp = [([<span class="number">0</span>] * <span class="built_in">len</span>(input_y)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(input_x))]</span><br><span class="line">        maxlen = maxindex = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(input_x)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(input_y)):</span><br><span class="line">                <span class="keyword">if</span> input_x[i] == input_y[j]:</span><br><span class="line">                    <span class="keyword">if</span> i!=<span class="number">0</span> <span class="keyword">and</span> j!=<span class="number">0</span>:</span><br><span class="line">                        dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">or</span> j == <span class="number">0</span>:</span><br><span class="line">                        dp[i][j] = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> dp[i][j] &gt; maxlen:</span><br><span class="line">                        maxlen = dp[i][j]</span><br><span class="line">                        maxindex = i + <span class="number">1</span> - maxlen</span><br><span class="line">                        <span class="comment"># print(&#x27;最长公共子串的长度是:%s&#x27; % maxlen)</span></span><br><span class="line">                        <span class="comment"># print(&#x27;最长公共子串是:%s&#x27; % input_x[maxindex:maxindex + maxlen])</span></span><br><span class="line">        <span class="keyword">return</span> input_x[maxindex:maxindex + maxlen]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    lcs3 = LCS3()</span><br><span class="line">    <span class="built_in">print</span>(lcs3.lcs_dp(<span class="string">&#x27;我是美abc国中defg国中间人&#x27;</span>, <span class="string">&#x27;abdde我是美中国中国中国人&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(lcs3.lcs_dp(<span class="string">&#x27;cabdec&#x27;</span>,<span class="string">&#x27;cbdec&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://www.ahathinking.com/archives/115.html">http://www.ahathinking.com/archives/115.html</a><br>[2] <a target="_blank" rel="noopener" href="http://dsqiu.iteye.com/blog/1701541">http://dsqiu.iteye.com/blog/1701541</a><br>[3] <a target="_blank" rel="noopener" href="http://www.ahathinking.com/archives/122.html">http://www.ahathinking.com/archives/122.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/Python3-beginner-s-handbook-one/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python3-beginner-s-handbook-one/" class="post-title-link" itemprop="url">Python3入门手册之一</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-02 21:41:03" itemprop="dateCreated datePublished" datetime="2015-07-02T21:41:03+00:00">2015-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-26 12:42:20" itemprop="dateModified" datetime="2024-01-26T12:42:20+00:00">2024-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>Version：Python 3.4.3 (v3.4.3:9b73f1c3e601, Feb 24 2015, 22:44:40) [MSC v.1600 64 bit (AMD64)] on win32</em></p>
<p><strong>There are two ways of constructing a software design: one way is to make it so simple that there are obviously no deficiences; the other is to make it so complicated that there are no obvious deficiences.</strong><br>—- C.A.R.Hoare</p>
<p><strong>Success in life is a matter not so much of talent and opportunity as of concentration and perseverance</strong><br>—- C.W.Wendte</p>
<h3 id="选择Python的原因"><a href="#选择Python的原因" class="headerlink" title="选择Python的原因"></a>选择Python的原因</h3><ul>
<li>简单易学，功能强大，具有高效的高层数据结构，支持面向对象编程</li>
<li>解释性语言，可扩展性，可嵌入性，丰富的库</li>
</ul>
<h3 id="选择一个编辑器"><a href="#选择一个编辑器" class="headerlink" title="选择一个编辑器"></a>选择一个编辑器</h3><p>工欲善其事必先利其器，所以选择编辑器首当其冲。</p>
<ul>
<li>IDLE：Python自带，极简利器，支持语法高亮</li>
<li>Vim&#x2F;Emacs：<code>Linux/FreeBSD</code>平台上的开发利器，二者择其一</li>
<li>PyCharm：号称最智能的Python编辑器，的确是的，但是略微复杂</li>
</ul>
<h3 id="数据结构和算法"><a href="#数据结构和算法" class="headerlink" title="数据结构和算法"></a>数据结构和算法</h3><h4 id="解压序列赋值给多个变量"><a href="#解压序列赋值给多个变量" class="headerlink" title="解压序列赋值给多个变量"></a>解压序列赋值给多个变量</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 变量的数量需要和序列元素的数量一致</span></span><br><span class="line">data = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br><span class="line">a, b, c, d = data</span><br><span class="line"><span class="built_in">print</span>(a, b, c, d)</span><br><span class="line"></span><br><span class="line">data = [<span class="string">&#x27;ACME&#x27;</span>, <span class="number">50</span>, <span class="number">91.1</span>, (<span class="number">2012</span>, <span class="number">12</span>, <span class="number">21</span>)]</span><br><span class="line">name, shares, price, (year, month, day) = data</span><br><span class="line"><span class="built_in">print</span>(year, month, day)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压一部分，其他值丢弃</span></span><br><span class="line">data = [<span class="string">&#x27;ACME&#x27;</span>, <span class="number">50</span>, <span class="number">91.1</span>, (<span class="number">2012</span>, <span class="number">12</span>, <span class="number">21</span>)]</span><br><span class="line">_, shares, price, _ = data</span><br><span class="line"><span class="built_in">print</span>(shares, price)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只取第一个和最后一个，中间的所有元素用通配符接收</span></span><br><span class="line">record = (<span class="string">&#x27;Dave&#x27;</span>, <span class="string">&#x27;dave@example.com&#x27;</span>, <span class="string">&#x27;773-555-1212&#x27;</span>, <span class="string">&#x27;847-555-1212&#x27;</span>)</span><br><span class="line">name, *_, phone = record</span><br><span class="line"><span class="built_in">print</span>(name, phone)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">OutPut:</span></span><br><span class="line"><span class="string">a b c d</span></span><br><span class="line"><span class="string">2012 12 21</span></span><br><span class="line"><span class="string">50 91.1</span></span><br><span class="line"><span class="string">Dave 847-555-1212</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="查找最大或最小的N个元素"><a href="#查找最大或最小的N个元素" class="headerlink" title="查找最大或最小的N个元素"></a>查找最大或最小的N个元素</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">23</span>, <span class="number">7</span>, -<span class="number">4</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">37</span>, <span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(heapq.nlargest(<span class="number">3</span>, nums))  <span class="comment"># Prints [42, 37, 23]</span></span><br><span class="line"><span class="built_in">print</span>(heapq.nsmallest(<span class="number">3</span>, nums))  <span class="comment"># Prints [-4, 1, 2]</span></span><br><span class="line"><span class="comment"># heapify会先将集合数据进行堆排序后放入一个列表中</span></span><br><span class="line"><span class="comment"># heappop会先将第一个元素弹出来，然后用下一个最小的元素来取代被弹出元素</span></span><br><span class="line">heapq.heapify(nums)</span><br><span class="line"><span class="built_in">print</span>(heapq.heappop(nums))  <span class="comment"># Prints -4</span></span><br><span class="line"><span class="built_in">print</span>(heapq.heappop(nums))  <span class="comment"># Prints 1</span></span><br><span class="line"><span class="built_in">print</span>(heapq.heappop(nums))  <span class="comment"># Prints 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面代码在对每个元素进行对比的时候，会以price的值进行比较。</span></span><br><span class="line">portfolio = [</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;IBM&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">91.1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;AAPL&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">50</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">543.22</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;FB&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">21.09</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;HPQ&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">35</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">31.75</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;YHOO&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">45</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">16.35</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;ACME&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">115.65</span>&#125;</span><br><span class="line">]</span><br><span class="line">cheap = heapq.nsmallest(<span class="number">3</span>, portfolio, key=<span class="keyword">lambda</span> s: s[<span class="string">&#x27;price&#x27;</span>])</span><br><span class="line">expensive = heapq.nlargest(<span class="number">3</span>, portfolio, key=<span class="keyword">lambda</span> s: s[<span class="string">&#x27;price&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(cheap)</span><br><span class="line"><span class="built_in">print</span>(expensive)</span><br></pre></td></tr></table></figure>
<h4 id="字典操作相关"><a href="#字典操作相关" class="headerlink" title="字典操作相关"></a>字典操作相关</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 求字典中值的最小值、最大值</span></span><br><span class="line">prices = &#123;</span><br><span class="line">    <span class="string">&#x27;ACME&#x27;</span>: <span class="number">45.23</span>,</span><br><span class="line">    <span class="string">&#x27;AAPL&#x27;</span>: <span class="number">612.78</span>,</span><br><span class="line">    <span class="string">&#x27;IBM&#x27;</span>: <span class="number">205.55</span>,</span><br><span class="line">    <span class="string">&#x27;HPQ&#x27;</span>: <span class="number">37.20</span>,</span><br><span class="line">    <span class="string">&#x27;FB&#x27;</span>: <span class="number">10.75</span></span><br><span class="line">&#125;</span><br><span class="line">min_price = <span class="built_in">min</span>(<span class="built_in">zip</span>(prices.values(), prices.keys()))</span><br><span class="line"><span class="comment"># min_price is (10.75, &#x27;FB&#x27;)</span></span><br><span class="line">max_price = <span class="built_in">max</span>(<span class="built_in">zip</span>(prices.values(), prices.keys()))</span><br><span class="line"><span class="comment"># max_price is (612.78, &#x27;AAPL&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以使用sorted()和zip()函数来排列字典数据</span></span><br><span class="line">prices_sorted = <span class="built_in">sorted</span>(<span class="built_in">zip</span>(prices.values(), prices.keys()))</span><br><span class="line"><span class="comment"># prices_sorted is [(10.75, &#x27;FB&#x27;), (37.2, &#x27;HPQ&#x27;),</span></span><br><span class="line"><span class="comment">#                   (45.23, &#x27;ACME&#x27;), (205.55, &#x27;IBM&#x27;),</span></span><br><span class="line"><span class="comment">#                   (612.78, &#x27;AAPL&#x27;)]</span></span><br><span class="line"><span class="comment"># 执行这些计算的时候，需要注意的是zip()函数创建的是一个只能访问一次的迭代器。 比如，下面的代码就会产生错误：</span></span><br><span class="line">prices_and_names = <span class="built_in">zip</span>(prices.values(), prices.keys())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">min</span>(prices_and_names))  <span class="comment"># OK</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(prices_and_names))  <span class="comment"># ValueError: max() arg is an empty sequence</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要注意的是在计算操作中使用到了(值，键)对。当多个实体拥有相同的值的时候，键会决定返回结果。 比如，在执行min()和max()操作的时候，如果恰巧最小或最大值有重复的，那么拥有最小或最大键的实体会返回：</span></span><br><span class="line">prices = &#123;<span class="string">&#x27;AAA&#x27;</span>: <span class="number">45.23</span>, <span class="string">&#x27;ZZZ&#x27;</span>: <span class="number">45.23</span>&#125;</span><br><span class="line"><span class="built_in">min</span>(<span class="built_in">zip</span>(prices.values(), prices.keys()))</span><br><span class="line"><span class="comment"># OutPut:(45.23, &#x27;AAA&#x27;)</span></span><br><span class="line"><span class="built_in">max</span>(<span class="built_in">zip</span>(prices.values(), prices.keys()))</span><br><span class="line"><span class="comment"># OutPut:(45.23, &#x27;ZZZ&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找两字典的相同点</span></span><br><span class="line">a = &#123;</span><br><span class="line">    <span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b = &#123;</span><br><span class="line">    <span class="string">&#x27;w&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">&#x27;x&#x27;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&#x27;y&#x27;</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Find keys in common</span></span><br><span class="line">a.keys() &amp; b.keys()  <span class="comment"># &#123; &#x27;x&#x27;, &#x27;y&#x27; &#125;</span></span><br><span class="line"><span class="comment"># Find keys in a that are not in b</span></span><br><span class="line">a.keys() - b.keys()  <span class="comment"># &#123; &#x27;z&#x27; &#125;</span></span><br><span class="line"><span class="comment"># Find (key,value) pairs in common</span></span><br><span class="line">a.items() &amp; b.items()  <span class="comment"># &#123; (&#x27;y&#x27;, 2) &#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="序列中出现次数最多的元素"><a href="#序列中出现次数最多的元素" class="headerlink" title="序列中出现次数最多的元素"></a>序列中出现次数最多的元素</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">words = [</span><br><span class="line">    <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;into&#x27;</span>, <span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;into&#x27;</span>, <span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;around&#x27;</span>, <span class="string">&#x27;the&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&quot;don&#x27;t&quot;</span>, <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;around&#x27;</span>, <span class="string">&#x27;the&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&#x27;look&#x27;</span>, <span class="string">&#x27;into&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;my&#x27;</span>, <span class="string">&#x27;eyes&#x27;</span>, <span class="string">&quot;you&#x27;re&quot;</span>, <span class="string">&#x27;under&#x27;</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">word_counts = Counter(words)</span><br><span class="line"><span class="comment"># 出现频率最高的3个单词</span></span><br><span class="line">top_three = word_counts.most_common(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(top_three)</span><br><span class="line"><span class="comment"># Outputs [(&#x27;eyes&#x27;, 8), (&#x27;the&#x27;, 5), (&#x27;look&#x27;, 4)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Counter 对象可以接受任意的 hashable 序列对象。 在底层实现上，一个 Counter 对象就是一个字典，将元素映射到它出现的次数上</span></span><br><span class="line"><span class="built_in">print</span>(word_counts[<span class="string">&#x27;not&#x27;</span>])  <span class="comment"># Prints 1</span></span><br><span class="line"><span class="built_in">print</span>(word_counts[<span class="string">&#x27;eyes&#x27;</span>])  <span class="comment"># Prints 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意，对于Counter对象可以直接进行数学运算操作</span></span><br><span class="line">test = Counter([<span class="string">&#x27;addone&#x27;</span>])</span><br><span class="line">word_counts = word_counts + test</span><br><span class="line"><span class="built_in">print</span>(word_counts)</span><br><span class="line">word_counts = word_counts - test</span><br><span class="line"><span class="built_in">print</span>(word_counts)</span><br></pre></td></tr></table></figure>

<h4 id="通过某个关键字排序一个字典列表"><a href="#通过某个关键字排序一个字典列表" class="headerlink" title="通过某个关键字排序一个字典列表"></a>通过某个关键字排序一个字典列表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过某个关键字排序一个字典列表</span></span><br><span class="line">rows = [</span><br><span class="line">    &#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Brian&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1003</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;David&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Beazley&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1002</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Cleese&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1001</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Big&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1004</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 根据任意的字典字段来排序输入结果行是很容易实现的，代码示例：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"></span><br><span class="line">rows_by_fname = <span class="built_in">sorted</span>(rows, key=itemgetter(<span class="string">&#x27;fname&#x27;</span>))</span><br><span class="line">rows_by_uid = <span class="built_in">sorted</span>(rows, key=itemgetter(<span class="string">&#x27;uid&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(rows_by_fname)</span><br><span class="line"><span class="built_in">print</span>(rows_by_uid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序不支持原生比较的对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, userId</span>):</span><br><span class="line">        self.userId = userId</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;User(&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(self.userId)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> attrgetter</span><br><span class="line"></span><br><span class="line">users = [User(<span class="number">23</span>), User(<span class="number">28</span>), User(<span class="number">26</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sorted</span>(users, key=attrgetter(<span class="string">&#x27;userId&#x27;</span>)))</span><br></pre></td></tr></table></figure>
<h4 id="通过某个字段将记录分组"><a href="#通过某个字段将记录分组" class="headerlink" title="通过某个字段将记录分组"></a>通过某个字段将记录分组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">rows = [</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5412 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5148 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5800 E 58TH&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;2122 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/03/2012&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5645 N RAVENSWOOD&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1060 W ADDISON&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;4801 N BROADWAY&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1039 W GRANVILLE&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 现在假设你想在按date分组后的数据块上进行迭代。为了这样做，你首先需要按照指定的字段(这里就是date)排序， 然后调用 itertools.groupby() 函数：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> groupby</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sort by the desired field first</span></span><br><span class="line">rows.sort(key=itemgetter(<span class="string">&#x27;date&#x27;</span>))</span><br><span class="line"><span class="comment"># Iterate in groups</span></span><br><span class="line"><span class="keyword">for</span> date, items <span class="keyword">in</span> groupby(rows, key=itemgetter(<span class="string">&#x27;date&#x27;</span>)):</span><br><span class="line">    <span class="built_in">print</span>(date)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> items:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span>, i)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">OutPut:</span></span><br><span class="line"><span class="string">07/01/2012</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/01/2012&#x27;, &#x27;address&#x27;: &#x27;5412 N CLARK&#x27;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/01/2012&#x27;, &#x27;address&#x27;: &#x27;4801 N BROADWAY&#x27;&#125;</span></span><br><span class="line"><span class="string">07/02/2012</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/02/2012&#x27;, &#x27;address&#x27;: &#x27;5800 E 58TH&#x27;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/02/2012&#x27;, &#x27;address&#x27;: &#x27;5645 N RAVENSWOOD&#x27;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/02/2012&#x27;, &#x27;address&#x27;: &#x27;1060 W ADDISON&#x27;&#125;</span></span><br><span class="line"><span class="string">07/03/2012</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/03/2012&#x27;, &#x27;address&#x27;: &#x27;2122 N CLARK&#x27;&#125;</span></span><br><span class="line"><span class="string">07/04/2012</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/04/2012&#x27;, &#x27;address&#x27;: &#x27;5148 N CLARK&#x27;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#x27;date&#x27;: &#x27;07/04/2012&#x27;, &#x27;address&#x27;: &#x27;1039 W GRANVILLE&#x27;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="过滤序列元素"><a href="#过滤序列元素" class="headerlink" title="过滤序列元素"></a>过滤序列元素</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">values = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;-3&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>, <span class="string">&#x27;5&#x27;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_int</span>(<span class="params">val</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x = <span class="built_in">int</span>(val)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">ivals = <span class="built_in">list</span>(<span class="built_in">filter</span>(is_int, values))</span><br><span class="line"><span class="built_in">print</span>(ivals)</span><br><span class="line"><span class="comment"># Outputs [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;-3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;]</span></span><br></pre></td></tr></table></figure>
<h4 id="转换并同时计算数据"><a href="#转换并同时计算数据" class="headerlink" title="转换并同时计算数据"></a>转换并同时计算数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Determine if any .py files exist in a directory</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">files = os.listdir(<span class="string">&#x27;dirname&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">any</span>(name.endswith(<span class="string">&#x27;.py&#x27;</span>) <span class="keyword">for</span> name <span class="keyword">in</span> files):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;There be python!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Sorry, no python.&#x27;</span>)</span><br><span class="line"><span class="comment"># Output a tuple as CSV</span></span><br><span class="line">s = (<span class="string">&#x27;ACME&#x27;</span>, <span class="number">50</span>, <span class="number">123.45</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> s)) <span class="comment"># Prints ACME,50,123.45</span></span><br><span class="line"><span class="comment"># Data reduction across fields of a data structure</span></span><br><span class="line">portfolio = [</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;GOOG&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">50</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;YHOO&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">75</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;AOL&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">20</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;SCOX&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">65</span>&#125;</span><br><span class="line">]</span><br><span class="line">min_shares = <span class="built_in">min</span>(s[<span class="string">&#x27;shares&#x27;</span>] <span class="keyword">for</span> s <span class="keyword">in</span> portfolio)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Original: Returns 20</span></span><br><span class="line">min_shares = <span class="built_in">min</span>(s[<span class="string">&#x27;shares&#x27;</span>] <span class="keyword">for</span> s <span class="keyword">in</span> portfolio)</span><br><span class="line"><span class="comment"># Alternative: Returns &#123;&#x27;name&#x27;: &#x27;AOL&#x27;, &#x27;shares&#x27;: 20&#125;</span></span><br><span class="line">min_shares = <span class="built_in">min</span>(portfolio, key=<span class="keyword">lambda</span> s: s[<span class="string">&#x27;shares&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h4 id="合并多个字典或映射"><a href="#合并多个字典或映射" class="headerlink" title="合并多个字典或映射"></a>合并多个字典或映射</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span> &#125;</span><br><span class="line">b = &#123;<span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">4</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> ChainMap</span><br><span class="line">c = ChainMap(a,b)</span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;x&#x27;</span>]) <span class="comment"># Outputs 1 (from a)</span></span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;y&#x27;</span>]) <span class="comment"># Outputs 2 (from b)</span></span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;z&#x27;</span>]) <span class="comment"># Outputs 3 (from a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ChianMap使用原来的字典，它自己不创建新的字典。所以它并不会产生上面所说的结果，比如：</span></span><br><span class="line"></span><br><span class="line">a[<span class="string">&#x27;x&#x27;</span>] = <span class="number">42</span></span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;x&#x27;</span>]) <span class="comment"># Outputs 42 (from a)</span></span><br></pre></td></tr></table></figure>
<h3 id="字符串和文本"><a href="#字符串和文本" class="headerlink" title="字符串和文本"></a>字符串和文本</h3><h4 id="使用多个界定符分割字符串"><a href="#使用多个界定符分割字符串" class="headerlink" title="使用多个界定符分割字符串"></a>使用多个界定符分割字符串</h4><p><code>string</code>对象的<code>split()</code>方法只适应于非常简单的字符串分割情形，它并不允许有多个分隔符或者是分隔符周围不确定的空格。当你需要更加灵活的切割字符串的时候，最好使用<code>re.split()</code>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">line = <span class="string">&#x27;abcd efg; hijk , lmn&#x27;</span></span><br><span class="line">res = re.split(<span class="string">r&#x27;[;,\s]\s*&#x27;</span>, line)</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># Prints [&#x27;abcd&#x27;, &#x27;efg&#x27;, &#x27;hijk&#x27;, &#x27;&#x27;, &#x27;lmn&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>函数<code>re.split()</code>是非常实用的，因为它允许你为分隔符指定多个正则模式。比如，在上面的例子中，分隔符可以是逗号(,)，分号(;)或者是空格，并且后面紧跟着任意个的空格。只要这个模式被找到，那么匹配的分隔符两边的实体都会被当成是结果中的元素返回。 返回结果为一个字段列表，这个跟<code>str.split()</code>返回值类型是一样的。<br>当你使用<code>re.split()</code>函数时候，需要特别注意的是正则表达式中是否包含一个括号捕获分组。如果使用了捕获分组，那么被匹配的文本也将出现在结果列表中。比如，观察一下这段代码运行后的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fields = re.split(<span class="string">r&#x27;(;|,|\s)\s*&#x27;</span>, line)</span><br><span class="line"><span class="built_in">print</span>(fields) <span class="comment"># Prints [&#x27;abcd&#x27;, &#x27; &#x27;, &#x27;efg&#x27;, &#x27;;&#x27;, &#x27;hijk&#x27;, &#x27; &#x27;, &#x27;&#x27;, &#x27;,&#x27;, &#x27;lmn&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>如果你不想保留分割字符串到结果列表中去，但仍然需要使用到括号来分组正则表达式的话，确保你的分组是非捕获分组，形如<code>(?:...)</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = re.split(<span class="string">r&#x27;(?:,|;|\s)\s*&#x27;</span>, line)</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># Prints [&#x27;abcd&#x27;, &#x27;efg&#x27;, &#x27;hijk&#x27;, &#x27;&#x27;, &#x27;lmn&#x27;]</span></span><br></pre></td></tr></table></figure>
<h4 id="字符串匹配"><a href="#字符串匹配" class="headerlink" title="字符串匹配"></a>字符串匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查多种匹配可能，需要将所有的匹配项放入到一个元组中，然后传给startswith()或者endswith()方法</span></span><br><span class="line">strs = <span class="built_in">list</span>()</span><br><span class="line">strs.append(<span class="string">&#x27;a.txt&#x27;</span>)</span><br><span class="line">strs.append(<span class="string">&#x27;b.doc&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strs:</span><br><span class="line">    <span class="comment"># startswith方法类似</span></span><br><span class="line">    <span class="keyword">if</span> s.endswith((<span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.doc&#x27;</span>)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(s))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请注意，该方法必须接收一个元组作为输入参数，如果你有一个list或者set类型的选择项，需要先调用tuple()将其转换为元组类型</span></span><br><span class="line">choices = [<span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.doc&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strs:</span><br><span class="line">    <span class="keyword">if</span> s.endswith(<span class="built_in">tuple</span>(choices)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(s))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fnmatch和fnmatchcase的使用</span></span><br><span class="line"><span class="keyword">from</span> fnmatch <span class="keyword">import</span> fnmatch, fnmatchcase</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fnmatch(<span class="string">&#x27;foo.txt&#x27;</span>, <span class="string">&#x27;*.TXT&#x27;</span>))  <span class="comment"># On OS X (Mac) Prints False</span></span><br><span class="line"><span class="built_in">print</span>(fnmatch(<span class="string">&#x27;foo.txt&#x27;</span>, <span class="string">&#x27;*.TXT&#x27;</span>))  <span class="comment"># On Windows Prints True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 完全使用你的模式大小写进行匹配</span></span><br><span class="line"><span class="built_in">print</span>(fnmatchcase(<span class="string">&#x27;foo.txt&#x27;</span>, <span class="string">&#x27;*.TXT&#x27;</span>))  <span class="comment"># Prints False</span></span><br></pre></td></tr></table></figure>
<h4 id="字符串搜索和替换"><a href="#字符串搜索和替换" class="headerlink" title="字符串搜索和替换"></a>字符串搜索和替换</h4><p>一个替换回调函数的参数是一个<code>match</code>对象，也就是<code>match()</code>或者<code>find()</code>返回的对象。使用<code>group()</code>方法来提取特定的匹配部分。回调函数最后返回替换字符串。如果除了替换后的结果外，你还想知道有多少替换发生了，可以使用<code>re.subn()</code>来代替。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用re模块进行匹配和搜索</span></span><br><span class="line">text = <span class="string">&#x27;Today is 11/27/2012. PyCon starts 3/13/2013.&#x27;</span></span><br><span class="line">datepat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d+)/(\d+)/(\d+)&#x27;</span>)</span><br><span class="line">list_match = datepat.findall(text)  <span class="comment"># findall方法返回的是所有匹配的列表</span></span><br><span class="line"><span class="built_in">print</span>(list_match)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> datepat.finditer(text):  <span class="comment"># finditer方法返回的是迭代器</span></span><br><span class="line">    <span class="built_in">print</span>(m.groups())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意点，在正则的开头字母‘r’是指定不去解析反斜杠</span></span><br><span class="line"><span class="comment"># r&#x27;(\d+)/(\d+)/(\d+)&#x27; 相当于 &#x27;(\\d+)/(\\d+)/(\\d+)&#x27;</span></span><br><span class="line">m = datepat.<span class="keyword">match</span>(<span class="string">&#x27;11/27/2012&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(m.group(<span class="number">0</span>))  <span class="comment"># Prints 11/27/2012</span></span><br><span class="line"><span class="built_in">print</span>(m.group(<span class="number">1</span>))  <span class="comment"># Prints 11</span></span><br><span class="line"><span class="built_in">print</span>(m.group(<span class="number">2</span>))  <span class="comment"># Prints 27</span></span><br><span class="line"><span class="built_in">print</span>(m.group(<span class="number">3</span>))  <span class="comment"># Prints 2012</span></span><br><span class="line"></span><br><span class="line">newtext, n = datepat.subn(<span class="string">r&#x27;\3-\1-\2&#x27;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(newtext)  <span class="comment"># Prints Today is 2012-11-27. PyCon starts 2013-3-13.</span></span><br><span class="line"><span class="built_in">print</span>(n)  <span class="comment"># Prints 2</span></span><br></pre></td></tr></table></figure>

<p>为了在文本操作时忽略大小写，你需要在使用re模块的时候给这些操作提供<code>re.IGNORECASE</code>标志参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;UPPER PYTHON, lower python, Mixed Python&#x27;</span></span><br><span class="line">re.findall(<span class="string">&#x27;python&#x27;</span>, text, flags=re.IGNORECASE) <span class="comment"># [&#x27;PYTHON&#x27;, &#x27;python&#x27;, &#x27;Python&#x27;]</span></span><br><span class="line">re.sub(<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;snake&#x27;</span>, text, flags=re.IGNORECASE) <span class="comment"># &#x27;UPPER snake, lower snake, Mixed snake&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="最短匹配模式"><a href="#最短匹配模式" class="headerlink" title="最短匹配模式"></a>最短匹配模式</h4><p>在这个例子中，模式<code>r&#39;\&quot;(.*)\&quot;&#39;</code>的意图是匹配被双引号包含的文本。但是在正则表达式中*操作符是贪婪的，因此匹配操作会查找最长的可能匹配。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">str_pat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\&quot;(.*)\&quot;&#x27;</span>)</span><br><span class="line">text = <span class="string">&#x27;Computer says &quot;no.&quot; Phone says &quot;yes.&quot;&#x27;</span></span><br><span class="line">str_pat.findall(text)  <span class="comment"># [&#x27;no.&quot; Phone says &quot;yes.&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果希望获取最短匹配的结果，需要添加&#x27;?&#x27;</span></span><br><span class="line">str_pat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\&quot;(.*?)\&quot;&#x27;</span>)</span><br><span class="line">str_pat.findall(text)  <span class="comment"># [&#x27;no.&#x27;, &#x27;yes.&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>这样就使得匹配变成非贪婪模式，从而得到最短的匹配，也就是我们想要的结果。</p>
<h4 id="多行匹配模式"><a href="#多行匹配模式" class="headerlink" title="多行匹配模式"></a>多行匹配模式</h4><p>这个问题很典型的出现在当你用点(.)去匹配任意字符的时候，忘记了点(.)不能匹配换行符的事实。为了修正这个问题，你可以修改模式字符串，增加对换行的支持。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;&#x27;&#x27;/* this is a</span></span><br><span class="line"><span class="string">multiline comment */</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">comment = re.<span class="built_in">compile</span>(<span class="string">r&#x27;/\*((?:.|\n)*?)\*/&#x27;</span>)</span><br><span class="line">com = comment.findall(text)</span><br><span class="line"><span class="built_in">print</span>(com)  <span class="comment"># Prints [&#x27; this is a\nmultiline comment &#x27;]</span></span><br></pre></td></tr></table></figure>
<p>在这个模式中，<code>(?:.|\n)</code> 指定了一个非捕获组(也就是它定义了一个仅仅用来做匹配，而不能通过单独捕获或者编号的组)。<br><code>re.compile()</code>函数接受一个标志参数叫 <code>re.DOTALL</code>，在这里非常有用。它可以让正则表达式中的.匹配包括换行符在内的任意字符。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">comment = re.<span class="built_in">compile</span>(<span class="string">r&#x27;/\*(.*?)\*/&#x27;</span>, re.DOTALL)</span><br><span class="line">com = comment.findall(text)</span><br><span class="line"><span class="built_in">print</span>(com)  <span class="comment"># Prints [&#x27; this is a\nmultiline comment &#x27;]</span></span><br></pre></td></tr></table></figure>
<h4 id="删除字符串中不需要的字符"><a href="#删除字符串中不需要的字符" class="headerlink" title="删除字符串中不需要的字符"></a>删除字符串中不需要的字符</h4><p><code>strip()</code>方法能用于删除开始或结尾的字符。<code>lstrip()</code>和<code>rstrip()</code>分别从左和从右执行删除操作。默认情况下，这些方法会去除空白字符，但是你也可以指定其他字符。<br>如果你想处理中间的空格，那么你需要求助其他技术。比如使用<code>replace()</code>方法或者是用正则表达式替换。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">s = <span class="string">&#x27;Hello        World!&#x27;</span></span><br><span class="line">m = re.sub(<span class="string">&#x27;\s+&#x27;</span>, <span class="string">&#x27; &#x27;</span>, s)</span><br><span class="line"><span class="built_in">print</span>(m) <span class="comment"># Prints Hello World!</span></span><br></pre></td></tr></table></figure>
<h4 id="字符串对齐"><a href="#字符串对齐" class="headerlink" title="字符串对齐"></a>字符串对齐</h4><p>对于基本的字符串对齐操作，可以使用字符串的<code>ljust()</code>,<code>rjust()</code>和<code>center()</code>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line">text = text.ljust(<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(text)  <span class="comment"># Hello World!</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(text))  <span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line">text = text.rjust(<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(text)  <span class="comment">#      Hello World!</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(text))  <span class="comment"># 20</span></span><br></pre></td></tr></table></figure>
<p>所有这些方法都能接受一个可选的填充字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(text.rjust(<span class="number">20</span>, <span class="string">&#x27;=&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(text.center(<span class="number">20</span>, <span class="string">&#x27;*&#x27;</span>))</span><br><span class="line"><span class="comment"># 当格式化多个值的时候，这些格式代码也可以被用在 format() 方法中</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#123;:+&gt;10s&#125; &#123;:-&gt;10s&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;World&#x27;</span>)) <span class="comment"># Prints +++++Hello -----World</span></span><br></pre></td></tr></table></figure>
<h4 id="字符串中插入变量"><a href="#字符串中插入变量" class="headerlink" title="字符串中插入变量"></a>字符串中插入变量</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;&#123;name&#125; has &#123;n&#125; messages.&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.<span class="built_in">format</span>(name=<span class="string">&#x27;Guido&#x27;</span>, n=<span class="number">37</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果要被替换的变量能在变量域中找到，那么你可以结合使用format_map()和vars() 。就像下面这样：</span></span><br><span class="line">s = <span class="string">&#x27;&#123;name&#125; has &#123;n&#125; messages.&#x27;</span></span><br><span class="line">name = <span class="string">&#x27;Guido&#x27;</span></span><br><span class="line">n = <span class="number">37</span></span><br><span class="line"><span class="built_in">print</span>(s.format_map(<span class="built_in">vars</span>()))</span><br></pre></td></tr></table></figure>
<h4 id="以指定列宽格式化字符串"><a href="#以指定列宽格式化字符串" class="headerlink" title="以指定列宽格式化字符串"></a>以指定列宽格式化字符串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> textwrap</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(textwrap.fill(s, <span class="number">70</span>))</span><br><span class="line">Look into my eyes, look into my eyes, the eyes, the eyes, the eyes,</span><br><span class="line"><span class="keyword">not</span> around the eyes, don<span class="string">&#x27;t look around the eyes, look into my eyes,</span></span><br><span class="line"><span class="string">you&#x27;</span>re under.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(textwrap.fill(s, <span class="number">40</span>))</span><br><span class="line">Look into my eyes, look into my eyes,</span><br><span class="line">the eyes, the eyes, the eyes, <span class="keyword">not</span> around</span><br><span class="line">the eyes, don<span class="string">&#x27;t look around the eyes,</span></span><br><span class="line"><span class="string">look into my eyes, you&#x27;</span>re under.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(textwrap.fill(s, <span class="number">40</span>, initial_indent=<span class="string">&#x27;    &#x27;</span>))</span><br><span class="line">    Look into my eyes, look into my</span><br><span class="line">eyes, the eyes, the eyes, the eyes, <span class="keyword">not</span></span><br><span class="line">around the eyes, don<span class="string">&#x27;t look around the</span></span><br><span class="line"><span class="string">eyes, look into my eyes, you&#x27;</span>re under.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(textwrap.fill(s, <span class="number">40</span>, subsequent_indent=<span class="string">&#x27;    &#x27;</span>))</span><br><span class="line">Look into my eyes, look into my eyes,</span><br><span class="line">    the eyes, the eyes, the eyes, <span class="keyword">not</span></span><br><span class="line">    around the eyes, don<span class="string">&#x27;t look around</span></span><br><span class="line"><span class="string">    the eyes, look into my eyes, you&#x27;</span>re</span><br><span class="line">    under.</span><br></pre></td></tr></table></figure>
<h4 id="在字符串中处理html和xml"><a href="#在字符串中处理html和xml" class="headerlink" title="在字符串中处理html和xml"></a>在字符串中处理html和xml</h4><p>如果你想替换文本字符串中的<code>‘&lt;’</code>或者<code>‘&gt;’</code>，使用html.escape()函数可以很容易的完成。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&#x27;Elements are written as &quot;&lt;tag&gt;text&lt;/tag&gt;&quot;.&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> html</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(s)</span><br><span class="line">Elements are written <span class="keyword">as</span> <span class="string">&quot;&lt;tag&gt;text&lt;/tag&gt;&quot;</span>.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(html.escape(s))</span><br><span class="line">Elements are written <span class="keyword">as</span> <span class="string">&quot;&lt;tag&gt;text&lt;/tag&gt;&quot;</span>.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Disable escaping of quotes</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(html.escape(s, quote=<span class="literal">False</span>))</span><br><span class="line">Elements are written <span class="keyword">as</span> <span class="string">&quot;&lt;tag&gt;text&lt;/tag&gt;&quot;</span>.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>如果你接收到了一些含有编码值的原始文本，需要手动去做替换，通常你只需要使用<code>HTML</code>或者<code>XML</code>解析器的一些相关工具函数&#x2F;方法即可。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&#x27;Spicy &quot;Jalapeño&quot;.&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> html.parser <span class="keyword">import</span> HTMLParser</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = HTMLParser()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.unescape(s)</span><br><span class="line"><span class="string">&#x27;Spicy &quot;Jalapeño&quot;.&#x27;</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="string">&#x27;The prompt is &gt;&gt;&gt;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> xml.sax.saxutils <span class="keyword">import</span> unescape</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>unescape(t)</span><br><span class="line"><span class="string">&#x27;The prompt is &gt;&gt;&gt;&#x27;</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="字节字符串上的字符串操作"><a href="#字节字符串上的字符串操作" class="headerlink" title="字节字符串上的字符串操作"></a>字节字符串上的字符串操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = <span class="string">b&#x27;Hello World&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line"><span class="string">b&#x27;Hello&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.startswith(<span class="string">b&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.split()</span><br><span class="line">[<span class="string">b&#x27;Hello&#x27;</span>, <span class="string">b&#x27;World&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.replace(<span class="string">b&#x27;Hello&#x27;</span>, <span class="string">b&#x27;Hello Cruel&#x27;</span>)</span><br><span class="line"><span class="string">b&#x27;Hello Cruel World&#x27;</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>这些操作同样也适用于字节数组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = <span class="built_in">bytearray</span>(<span class="string">b&#x27;Hello World&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line"><span class="built_in">bytearray</span>(<span class="string">b&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.startswith(<span class="string">b&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.split()</span><br><span class="line">[<span class="built_in">bytearray</span>(<span class="string">b&#x27;Hello&#x27;</span>), <span class="built_in">bytearray</span>(<span class="string">b&#x27;World&#x27;</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.replace(<span class="string">b&#x27;Hello&#x27;</span>, <span class="string">b&#x27;Hello Cruel&#x27;</span>)</span><br><span class="line"><span class="built_in">bytearray</span>(<span class="string">b&#x27;Hello Cruel World&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>大多数情况下，在文本字符串上的操作均可用于字节字符串。然而，这里也有一些需要注意的不同点。首先，字节字符串的索引操作返回整数而不是单独字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&#x27;Hello World&#x27;</span> <span class="comment"># Text string</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;H&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;e&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">b&#x27;Hello World&#x27;</span> <span class="comment"># Byte string</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b[<span class="number">0</span>]</span><br><span class="line"><span class="number">72</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b[<span class="number">1</span>]</span><br><span class="line"><span class="number">101</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>第二点，字节字符串不会提供一个美观的字符串表示，也不能很好的打印出来，除非它们先被解码为一个文本字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">b&#x27;Hello World&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(s)</span><br><span class="line"><span class="string">b&#x27;Hello World&#x27;</span> <span class="comment"># Observe b&#x27;...&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(s.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">Hello World</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="https://www.gitbook.com/book/lenkimo/byte-of-python-chinese-edition/details">A Byte of Python3</a><br>[2] <a target="_blank" rel="noopener" href="http://python3-cookbook.readthedocs.org/zh_CN/latest/c01/p08_calculating_with_dict.html">python3-cookbook</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/48/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/48/">48</a><span class="page-number current">49</span><a class="page-number" href="/page/50/">50</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/">56</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/50/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DJY</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
