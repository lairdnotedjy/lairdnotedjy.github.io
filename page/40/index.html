<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2426182848439341"
     crossorigin="anonymous"></script>

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.sovdating.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Hello dev">
<meta property="og:type" content="website">
<meta property="og:title" content="Sovdating Linux">
<meta property="og:url" content="https://www.sovdating.com/page/40/index.html">
<meta property="og:site_name" content="Sovdating Linux">
<meta property="og:description" content="Hello dev">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="DJY">
<meta property="article:tag" content="golang python linux ubuntu centos rust">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.sovdating.com/page/40/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/40/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Sovdating Linux</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Sovdating Linux</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">some code for program</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">DJY</p>
  <div class="site-description" itemprop="description">Hello dev</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">469</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">82</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">330</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/10/01/github.io%20%E5%8D%9A%E5%AE%A2%E5%BB%BA%E7%AB%8B%EF%BC%88github%20pages%EF%BC%89&%20hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/10/01/github.io%20%E5%8D%9A%E5%AE%A2%E5%BB%BA%E7%AB%8B%EF%BC%88github%20pages%EF%BC%89&%20hexo/" class="post-title-link" itemprop="url">github.io 博客建立（github pages）& hexo</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-10-01 00:00:00" itemprop="dateCreated datePublished" datetime="2015-10-01T00:00:00+08:00">2015-10-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:16:43" itemprop="dateModified" datetime="2024-01-24T10:16:43+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>基于github pages支持，建立静态博客。使用静态博客工具hexo<br>依赖工具 node,git</p>
<h2 id="github的独立二级域名开通方法："><a href="#github的独立二级域名开通方法：" class="headerlink" title="github的独立二级域名开通方法："></a>github的独立二级域名开通方法：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://pages.github.com/</span><br><span class="line">http://jingyan.baidu.com/article/ed2a5d1f3732cb09f7be1745.html</span><br></pre></td></tr></table></figure>


<h2 id="hexo-完整部署过程："><a href="#hexo-完整部署过程：" class="headerlink" title="hexo 完整部署过程："></a>hexo 完整部署过程：</h2><p><code>hexo你的博客</code><br><a target="_blank" rel="noopener" href="http://www.tuicool.com/articles/AfQnQjy/">http://www.tuicool.com/articles/AfQnQjy/</a></p>
<p><code>如何搭建一个独立博客——简明Github Pages与Hexo教程</code><br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/05289a4bc8b2">http://www.jianshu.com/p/05289a4bc8b2</a></p>
<p><code>史上最详细“截图”搭建Hexo博客并部署到Github_百度经验</code><br><a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/d8072ac47aca0fec95cefd2d.html">http://jingyan.baidu.com/article/d8072ac47aca0fec95cefd2d.html</a></p>
<p><code>hexo | 逝去的记忆 </code><br><a target="_blank" rel="noopener" href="http://www.coolpython.cn/category/hexo/">http://www.coolpython.cn/category/hexo/</a></p>
<p><code>使用Hexo搭建博客</code><br><a target="_blank" rel="noopener" href="https://blog.lmintlcx.com/post/blog-with-hexo.html">https://blog.lmintlcx.com/post/blog-with-hexo.html</a></p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-cli -g #npm安装hexo-cli</span><br><span class="line">$ hexo init blog #hexo初始化,命名blog</span><br><span class="line">$ cd blog #进入目录</span><br><span class="line">$ npm install #安装依赖模块</span><br><span class="line">$ hexo server #开启预览(http://localhost:4000,Press Ctrl+C to stop)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ hexo generate #生成静态页面</span><br><span class="line">$ hexo server #开启预览(http://localhost:4000,Press Ctrl+C to stop)</span><br><span class="line">$ hexo deploy #发布github(依赖_config.yml中deploy-github配置)</span><br></pre></td></tr></table></figure>
<hr>
<p>输出在：hexo\public\  里面内容可以手动拷贝出来,使用git客户端工具上传到<youname>.github.io项目里面就ok了。<br>其它教程多见配置ssh（适合脱离git客户端使用）</p>
<h3 id="命令上传到github"><a href="#命令上传到github" class="headerlink" title="命令上传到github"></a>命令上传到github</h3><p><code>配置SSH keys</code><br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/05289a4bc8b2">http://www.jianshu.com/p/05289a4bc8b2</a></p>
<blockquote>
<p>安装Git - 打开Git Bash Here窗口<br>设置用户名邮箱<br>git config –global user.name “liuxiang”<br>git config –global user.email “<a href="mailto:&#108;&#105;&#x75;&#x78;&#105;&#97;&#110;&#x67;&#46;&#49;&#50;&#x32;&#55;&#x40;&#x71;&#x71;&#46;&#x63;&#111;&#x6d;&#46;&#x63;&#111;&#109;">&#108;&#105;&#x75;&#x78;&#105;&#97;&#110;&#x67;&#46;&#49;&#50;&#x32;&#55;&#x40;&#x71;&#x71;&#46;&#x63;&#111;&#x6d;&#46;&#x63;&#111;&#109;</a>“</p>
</blockquote>
<p>SSH keys</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$   ssh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ssh-keygen -t rsa -C &quot;邮件地址@youremail.com&quot;</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/Users/your_user_directory/.ssh/id_rsa):&lt;回车就好&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Enter passphrase (empty for no passphrase):&lt;输入加密串&gt;  (不建议输入密码,hexo提交默认是无密码)</span><br><span class="line">Enter same passphrase again:&lt;再次输入加密串&gt;</span><br></pre></td></tr></table></figure>


<p>效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &quot;liuxiang.1227@qq.com&quot;</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/c/Users/Administrator/.ssh/id_rsa):</span><br><span class="line">/c/Users/Administrator/.ssh/id_rsa already exists.</span><br><span class="line">Overwrite (y/n)? y</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /c/Users/Administrator/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /c/Users/Administrator/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:GDZ/8mEe4W9vL+re3ZI0S16zSgWgAB23/lvQVi+BEi4 liuxiang.1227@qq.com</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|     .oo....     |</span><br><span class="line">|       .o.o...   |</span><br><span class="line">|      + Eo+ .... |</span><br><span class="line">|     . =.o o. o..|</span><br><span class="line">|      . S.*. o...|</span><br><span class="line">|         *.+o =o.|</span><br><span class="line">|          o.o* =o|</span><br><span class="line">|           .+oBo.|</span><br><span class="line">|           ++++++|</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>


<blockquote>
<p>添加SSH Key到GitHub<br>在本机设置SSH Key之后，需要添加到GitHub上，以完成SSH链接的设置。</p>
</blockquote>
<blockquote>
<p>1、打开本地C:\Documents and Settings\Administrator.ssh\id_rsa.pub文件。此文件里面内容为刚才生成人密钥。如果看不到这个文件，你需要设置显示隐藏文件。准确的复制这个文件的内容，才能保证设置的成功。</p>
</blockquote>
<blockquote>
<p>2、登陆github系统。点击右上角的 Account Settings—&gt;SSH Public keys —&gt; add another public keys</p>
</blockquote>
<blockquote>
<p>3、把你本地生成的密钥复制到里面（key文本框中）， 点击 add key 就ok了</p>
</blockquote>
<blockquote>
<p>测试</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -T git@github.com</span><br><span class="line">Hi liuxiang! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure>


<h3 id="扩展能力"><a href="#扩展能力" class="headerlink" title="扩展能力"></a>扩展能力</h3><p>RSS      <code>npm install hexo-generator-feed</code><br>sitemap     <code>npm install hexo-generator-sitemap</code></p>
<h3 id="fancybox"><a href="#fancybox" class="headerlink" title="fancybox"></a>fancybox</h3><p>可能有人对这个 Reading 页面中图片的 fancybox 效果感兴趣，这个是怎么做的呢。<br>很简单，只需要在你的文章*.md文件的头上添加 photos 项即可，然后一行行添加你要展示的照片：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">layout: photo</span><br><span class="line">title: 我的阅历</span><br><span class="line">date: 2085-01-16 07:33:44</span><br><span class="line">tags: [hexo]</span><br><span class="line">photos:</span><br><span class="line">- http://bruce.u.qiniudn.com/2013/11/27/reading/photos-0.jpg</span><br><span class="line">- http://bruce.u.qiniudn.com/2013/11/27/reading/photos-1.jpg</span><br></pre></td></tr></table></figure></p>
<h3 id="主题推荐："><a href="#主题推荐：" class="headerlink" title="主题推荐："></a>主题推荐：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.zhihu.com/question/24422335</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2015/10/01/github.io%20%E5%8D%9A%E5%AE%A2%E5%BB%BA%E7%AB%8B%EF%BC%88github%20pages%EF%BC%89&%20hexo/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/09/29/2016-campus-recruitment-of-baidu-programming-problem-resolution-software-development/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/09/29/2016-campus-recruitment-of-baidu-programming-problem-resolution-software-development/" class="post-title-link" itemprop="url">百度2016校园招聘之编程题解析-软件研发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-09-29 19:20:41" itemprop="dateCreated datePublished" datetime="2015-09-29T19:20:41+08:00">2015-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithms/" itemprop="url" rel="index"><span itemprop="name">Algorithms</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="比大小"><a href="#比大小" class="headerlink" title="比大小"></a>比大小</h3><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/compare_sizes_baidu_examination_1.png"></p>
<p><strong>解题思路</strong>：解此题需要使用到**<a target="_blank" rel="noopener" href="http://baike.baidu.com/link?url=Xx0gZYn3QJ1ykJdRvLp9HxOUBLs-J57DqebWUtjSNnoWj78xEhZeWKnCfXkhYgGMEdJ5Xz7QEwwUrIqLE7KX6a">康托展开</a>**，康托展开的公式如下</p>
<p>$$X&#x3D;a_n*(n-1)!+a_{n-1}*(n-2)!+\cdot\cdot\cdot+a_i*(i-1)!+\cdot\cdot\cdot+a_2*(2-1)!+a_1*(1-1)!$$</p>
<p>公式看不懂没关系，下面以一个例子来讲解公式的使用！</p>
<p>例如：有一个数组<code>S=[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]</code>，它的其中之一个排列是<code>S1=[&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;a&quot;]</code>，现在欲把<code>S1</code>映射成<code>X</code>，需要怎么做呢？按如下步骤走起</p>
<p>$$X&#x3D;a_4*3!+a_3*2!+a_2*1!+a_1*0!$$</p>
<ol>
<li>首先计算n，n等于数组S的长度，n&#x3D;4</li>
<li>再来计算a4&#x3D;”b”这个元素在数组<code>[&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;a&quot;]</code>中是第几大的元素。”a”是第0大的元素，”b”是第1大的元素，”c”是第2大的元素，”d”是第3大的元素，所以a4&#x3D;1</li>
<li>同样a3&#x3D;”c”这个元素在数组<code>[&quot;c&quot;,&quot;d&quot;,&quot;a&quot;]</code>中是第几大的元素。”a”是第0大的元素，”c”是第1大的元素，”d”是第2大的元素，所以a3&#x3D;1</li>
<li>a2&#x3D;”d”这个元素在数组<code>[&quot;d&quot;,&quot;a&quot;]</code>中是第几大的元素。”a”是第0大的元素，”d”是第1大的元素，所以a2&#x3D;1</li>
<li>a1&#x3D;”a”这个元素在数组<code>[&quot;a&quot;]</code>中是第几大的元素。”a”是第0大的元素，所以a1&#x3D;0</li>
<li>所以<code>X(S1)=1\*3!+1\*2!+1\*1!+0\*0!=9</code></li>
<li>注意所有的计算都是按照从0开始的，如果[“a”,”b”,”c”,”d”]算为第1个的话，那么将<code>X(S1)+1</code>即为最后的结果</li>
</ol>
<p><strong>Java算法实现</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/9/29 16:16</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:Main</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Description:本题需要用到康托展开，其公式为 X=an*(n-1)!+an-1*(n-2)!+...+ai*(i-1)!+...+a2*1!+a1*0!</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="comment">//    3</span></span><br><span class="line">    <span class="comment">//    abcdefghijkl</span></span><br><span class="line">    <span class="comment">//    hgebkflacdji</span></span><br><span class="line">    <span class="comment">//    gfkedhjblcia</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">charLength</span> <span class="operator">=</span> <span class="number">12</span>;<span class="comment">//定义字符序列的长度</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNextInt()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            String lines[] = <span class="keyword">new</span> <span class="title class_">String</span>[n];</span><br><span class="line">            <span class="type">int</span> res[] = <span class="keyword">new</span> <span class="title class_">int</span>[n];<span class="comment">//存储结果的数组</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                lines[i] = scanner.next();</span><br><span class="line">                res[i] = calculate(lines[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> s : res) &#123;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算某个字符序列的位次</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(String line)</span> &#123;</span><br><span class="line">        Set&lt;Character&gt; s = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;Character&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : line.toCharArray()) &#123;</span><br><span class="line">            s.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//存储每一个字符在该序列中是第几大的元素，然后将其值存储到counts数组中</span></span><br><span class="line">        <span class="type">int</span> counts[] = <span class="keyword">new</span> <span class="title class_">int</span>[s.size()];</span><br><span class="line">        <span class="type">char</span>[] chars = line.toCharArray();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">            Iterator&lt;Character&gt; iterator = s.iterator();</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            Character next;</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                next = iterator.next();</span><br><span class="line">                <span class="keyword">if</span> (next == chars[i]) &#123;</span><br><span class="line">                    counts[i] = temp;</span><br><span class="line">                    s.remove(next);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    temp++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; counts.length; i++) &#123;</span><br><span class="line">            sum = sum + counts[i] * factorial(charLength - i - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算阶乘的函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">factorial</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="拓展一下-求其逆过程"><a href="#拓展一下-求其逆过程" class="headerlink" title="拓展一下-求其逆过程"></a>拓展一下-求其逆过程</h3><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/compare_sizes_baidu_examination_1_expand.png"></p>
<p><strong>解题思路</strong>：使用康托逆展开，辗转相除得到的值为这个字符是第几大，这样取出对应位置的字符，然后利用后面的字符覆盖该字符即可，防止取到重复的字符。取模得到余数之后，重复上述过程。<br>例如：已知<code>S=[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]</code>，那么当输入10的时候，或者说X(S1)&#x3D;9的时候能否推出<code>S1=[&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;a&quot;]</code>呢？</p>
<p>由</p>
<p>$$X(S1)&#x3D;a_4*3!+a_3*2!+a_2*1!+a_1*0!&#x3D;9$$</p>
<p>所以问题变成由9能否唯一地映射出一组a4、a3、a2、a1？首先如果不考虑ai的范围，那么有如下：</p>
<p>$$1*3!+1*2!+1*1!+0*0!&#x3D;9$$</p>
<p>$$0*3!+4*2!+1*1!+0*0!&#x3D;9$$</p>
<p>$$0*3!+3*2!+3*1!+0*0!&#x3D;9$$</p>
<p>$$0*3!+2*2!+5*1!+0*0!&#x3D;9$$</p>
<p>……，但是每一个ai其实是有取值范围的，首先要知道ai表示的含义，其代表在当前剩余的序列中ai是处于第几大的位置，那么满足<code>0&lt;=ai&lt;=i</code>，同时a1必然为0，因为最后始终剩余一个元素。所以上式中只有第一个满足条件，那么a4&#x3D;1，a3&#x3D;1，a2&#x3D;1，a1&#x3D;1。推导出<code>S1=[&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;a&quot;]</code>。</p>
<p><strong>Java算法实现</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/9/29 16:16</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:Main</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Description:本题需要用到康托展开，其公式为 X=an*(n-1)!+an-1*(n-2)!+...+ai*(i-1)!+...+a2*1!+a1*0!</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainExpand</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">charLength</span> <span class="operator">=</span> <span class="number">12</span>;<span class="comment">//定义字符序列的长度</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNextInt()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">int</span> lines[] = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">            String res[] = <span class="keyword">new</span> <span class="title class_">String</span>[n];<span class="comment">//存储结果的数组</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                lines[i] = scanner.nextInt();</span><br><span class="line">                res[i] = calculate(lines[i] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (String s : res) &#123;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算某个字符序列的位次</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">calculate</span><span class="params">(<span class="type">int</span> line)</span> &#123;</span><br><span class="line">        <span class="type">char</span> alpha[] = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>&#125;;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> charLength - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> line / factorial(i);</span><br><span class="line">            line = line % factorial(i);</span><br><span class="line">            sb.append(String.valueOf(alpha[temp]));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> temp; j &lt; alpha.length - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                alpha[j] = alpha[j + <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算阶乘的函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">factorial</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断字符串是否出现"><a href="#判断字符串是否出现" class="headerlink" title="判断字符串是否出现"></a>判断字符串是否出现</h3><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/character_appear_or_not_baidu_examination_2.png"><br><strong>解题思路</strong>：</p>
<ol>
<li>将字符串a存储在一个map集合中，以每个字符的ASCII码作为key，以其出现的次数作为value，记为aMap</li>
<li>遍历字符串b，对于b中的每一个字符，如果aMap的key中含有该字符的ASCII码，如果该key对应的value&gt;1，那么将value值减1</li>
<li>否则value&#x3D;1的话，那么将该键值对从aMap中移除</li>
<li>在判断aMap的key是否包含b中的某个字符的时候，只要有一次不包含，那么就说明没有都出现</li>
<li>否则的话，表示b中的字符在a中都出现过</li>
</ol>
<p><strong>Java算法实现</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/9/28 20:05</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:test</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Description:TODO</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//以某个字符的ASCII码作为key，以其出现的次数作为value</span></span><br><span class="line">        Map&lt;Integer, Integer&gt; aMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (input.hasNextLine()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> input.nextLine();</span><br><span class="line">            <span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> input.nextLine();</span><br><span class="line">            <span class="type">char</span>[] chars = a.toCharArray();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">char</span> c : chars) &#123;</span><br><span class="line">                <span class="keyword">if</span> (aMap.keySet().contains((<span class="type">int</span>) c)) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> aMap.get((<span class="type">int</span>) c);</span><br><span class="line">                    aMap.put((<span class="type">int</span>) c, (temp + <span class="number">1</span>));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    aMap.put((<span class="type">int</span>) c, <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">char</span>[] chars1 = b.toCharArray();</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">char</span> c : chars1) &#123;</span><br><span class="line">                <span class="keyword">if</span> (aMap.keySet().contains((<span class="type">int</span>) c)) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> aMap.get((<span class="type">int</span>) c);</span><br><span class="line">                    <span class="keyword">if</span> (temp == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">//说明只有一个</span></span><br><span class="line">                        aMap.remove((<span class="type">int</span>) c);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//说明多过于一个</span></span><br><span class="line">                        aMap.put((<span class="type">int</span>) c, (temp - <span class="number">1</span>));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    flag = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                System.out.println(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            aMap.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="组合概率"><a href="#组合概率" class="headerlink" title="组合概率"></a>组合概率</h3><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/combinative_probability_baidu_examination_3.png"><br><strong>解题思路</strong>：<br>需要递推公式，然后用动态规划求解。</p>
<p><strong>Java算法实现</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/9/28 20:30</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:Test3</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Description:动态规划求解</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main3</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">DecimalFormat</span> <span class="variable">dec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;0.0000&quot;</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="type">double</span> v[][];<span class="comment">//表示取i个数时和为j的概率</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (input.hasNextInt()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> input.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> input.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> input.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> input.nextInt();</span><br><span class="line">            v = <span class="keyword">new</span> <span class="title class_">double</span>[n + <span class="number">1</span>][x + <span class="number">1</span>];</span><br><span class="line">            <span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> b - a + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> a; i &lt;= b; i++) &#123;</span><br><span class="line">                v[<span class="number">1</span>][i] = <span class="number">1.0</span> / sum;<span class="comment">//取1个数和为i的概率</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;<span class="comment">//对n个数进行迭代</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> a; j &lt;= b; j++) &#123;<span class="comment">//</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">1</span>; k &lt;= x; k++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (k &gt;= j) &#123;</span><br><span class="line"><span class="comment">//                            print(v);</span></span><br><span class="line"><span class="comment">//                            System.out.println();</span></span><br><span class="line">                            v[i][k] = v[i][k] + v[i - <span class="number">1</span>][k - j] / sum;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//输出取n个数和为x的概率</span></span><br><span class="line">            System.out.println(dec.format(v[n][x]));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">double</span>[][] v)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; v.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; v[i].length; j++) &#123;</span><br><span class="line">                System.out.print(v[i][j] + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://www.jeepshoe.org/416642954.htm">http://www.jeepshoe.org/416642954.htm</a><br>[2] <a target="_blank" rel="noopener" href="http://www.cnblogs.com/sunus/p/4536082.html">http://www.cnblogs.com/sunus/p/4536082.html</a></p>
<p><strong>算法如有疏漏或不妥之处，还望不吝赐教！</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/09/26/An-Automatic-Annotation-Method-for-Emergency-Text-Corpus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/09/26/An-Automatic-Annotation-Method-for-Emergency-Text-Corpus/" class="post-title-link" itemprop="url">一种面向突发事件的文本语料自动标注方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-09-26 21:34:28" itemprop="dateCreated datePublished" datetime="2015-09-26T21:34:28+08:00">2015-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithms/" itemprop="url" rel="index"><span itemprop="name">Algorithms</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="自序"><a href="#自序" class="headerlink" title="自序"></a>自序</h3><p>人生天地间，若白驹之过隙，忽然而已。无奈诸多俗务缠身，难得清闲。一直都是忙忙碌碌，然而碌碌无为，只顾埋头前行，偶有机会驻足回首，实乃吾之大幸。</p>
<p>因为我的父母是地地道道、兀兀穷年的农民，我这一路摸爬滚打全靠自己不断摸索总结。在人生的道路上，我一直很感谢能给我人生上面指导的人，而技术上面的指导却不是我迫切需要的，技术可以通过Google获得，然而人生的经验却只有过来人才能予以传授。不过我还是信奉我那句话，有变化就有机遇，一定要勇于拥抱变化。</p>
<p>我一直自认为是一个简简单单、没有心机、毫无城府、专心搬砖的人，所以坐下来细细思索，发现没有其它东西以飨读者，唯有一点点技术心得值得予以分享。下面就介绍一下在研究生期间所做的一点点工作。</p>
<h3 id="CEC简介"><a href="#CEC简介" class="headerlink" title="CEC简介"></a>CEC简介</h3><h4 id="CEC语料库"><a href="#CEC语料库" class="headerlink" title="CEC语料库"></a>CEC语料库</h4><p><code>Chinese Emergency Corpus</code>简称<code>CEC</code>，中文名称为<code>中文突发事件语料库</code>，是根据上海大学刘宗田教授所提出的<a target="_blank" rel="noopener" href="http://www.jsjkx.com/jsjkx/ch/reader/view_abstract.aspx?file_no=091146&flag=1">《面向事件的本体研究》</a>由人工标注所构建完成，目前整个语料库在重新进行了编码转换、XML格式化、错误修复之后托管在GitHub上了，<a target="_blank" rel="noopener" href="https://github.com/shijiebei2009/CEC-Corpus">地址点我</a>。</p>
<h4 id="事件的定义是什么"><a href="#事件的定义是什么" class="headerlink" title="事件的定义是什么"></a>事件的定义是什么</h4><p><code>事件</code>指在某个特定的时间和环境下发生的、由若干角色参与、表现出若干动作特征的一件事情。形式上，事件可表示为<code>e</code>，定义为一个六元组：<code>e ::= (A, O, T, P, S, L)</code>其中，事件六元组中的元素称为事件要素，分别表示动作（Action）、对象（Object）、时间（Time）、地点（Place）、状态（Status）、语言表现（Language Expressions）。</p>
<ul>
<li>A(动作)：A表示事件所包含的动作或动作序列的集合，在文本中，动作通常是作为识别一个事件的触发词</li>
<li>O(对象)：O表示一个事件中的对象集合，包括事件中所有的参与者和涉及到的对象。对象可分别是动作的施动者(主体)和受动者(客体)</li>
<li>T(时间)：T表示事件发生的时刻或时间段，时间分为绝对时间和相对时间，两类时间都可以通过计算转换成形如[t1,t2]的序偶表示，以此描述事件的开始、发展和结束时间，当开始时间和结束时间一样时，表示事件发生在瞬间</li>
<li>P(地点)：表示事件发生的地点；例如：在小池塘里游泳, 场所：小池塘, 场所特征：水中</li>
<li>S(状态)：表示事件发生过程中对象的状态集合，由事件发生的前置条件、后置结果集合组成。前置条件指为进行该事件, 各要素应当或可能满足的约束条件, 它们可以是事件发生的触发条件;中间断言指事件发生过程的中间状态各要素满足的条件;事件发生后,事件各要素将引起变化或者各要素状态的变迁, 这些变化和变迁后的结果, 将成为事件的后置条件。</li>
<li>L(语言表现)：事件的语言表现规律, 包括核心词集合、核心词表现、核心词搭配等。核心词是事件在句子中常用的标志性词汇。核心词表现则为在句子中各要素的表示与核心词之间的位置关系。核心词搭配是指核心词与其他词汇的固有的搭配。可以为事件附上不同语言种类的表现, 例如中文、英文、法文等等。</li>
</ul>
<p>在事件的六个要素中，前五个要素是事件的内在要素。</p>
<h4 id="CEC如何构建"><a href="#CEC如何构建" class="headerlink" title="CEC如何构建"></a>CEC如何构建</h4><p>事件本体是以<strong>“事件”</strong>为认知单元，研究事件的组成以及事件之间的关系，并对事件进行归纳和概括，形成事件类，进而构建事件本体模型。研究本体，必然要先构建语料库，所以在互联网上选取了突发事件语料来进行语料的事件标注，突发事件的分类体系，包括三个层次：一级4个大类（自然灾害类N、事故灾难类A、公共卫生事件P、社会安全事件S），二级33个子类，三级94个小类。我们标注的CEC语料库主要包括五类：地震、火灾、交通事故、恐怖袭击、食物中毒。合计332篇。</p>
<h4 id="CEC标注标签规范"><a href="#CEC标注标签规范" class="headerlink" title="CEC标注标签规范"></a>CEC标注标签规范</h4><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/xml_schema_of_cec_annotation.png"></p>
<h4 id="CEC标注样例"><a href="#CEC标注样例" class="headerlink" title="CEC标注样例"></a>CEC标注样例</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Title</span>&gt;</span>成都网友称震感强烈 女同事当即哭泣<span class="tag">&lt;/<span class="name">Title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ReportTime</span> <span class="attr">type</span>=<span class="string">&quot;absTime&quot;</span>&gt;</span>2008年05月12日16:15<span class="tag">&lt;/<span class="name">ReportTime</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Content</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Paragraph</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Sentence</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Event</span> <span class="attr">eid</span>=<span class="string">&quot;e1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Time</span> <span class="attr">type</span>=<span class="string">&quot;relTime&quot;</span> <span class="attr">tid</span>=<span class="string">&quot;t1&quot;</span>&gt;</span>5月12日14时28分<span class="tag">&lt;/<span class="name">Time</span>&gt;</span>，</span><br><span class="line">        <span class="tag">&lt;<span class="name">Location</span> <span class="attr">lid</span>=<span class="string">&quot;l1&quot;</span>&gt;</span>四川<span class="tag">&lt;/<span class="name">Location</span>&gt;</span>发生7.8级</span><br><span class="line">        <span class="tag">&lt;<span class="name">Denoter</span> <span class="attr">type</span>=<span class="string">&quot;emergency&quot;</span> <span class="attr">did</span>=<span class="string">&quot;d1&quot;</span>&gt;</span>地震<span class="tag">&lt;/<span class="name">Denoter</span>&gt;</span>。</span><br><span class="line">      <span class="tag">&lt;/<span class="name">Event</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Sentence</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Sentence</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Event</span> <span class="attr">eid</span>=<span class="string">&quot;e2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Time</span> <span class="attr">type</span>=<span class="string">&quot;relTime&quot;</span> <span class="attr">tid</span>=<span class="string">&quot;t2&quot;</span>&gt;</span>15时50分<span class="tag">&lt;/<span class="name">Time</span>&gt;</span>，新民网</span><br><span class="line">        <span class="tag">&lt;<span class="name">Participant</span> <span class="attr">sid</span>=<span class="string">&quot;s1&quot;</span>&gt;</span>记者<span class="tag">&lt;/<span class="name">Participant</span>&gt;</span>网上</span><br><span class="line">        <span class="tag">&lt;<span class="name">Denoter</span> <span class="attr">type</span>=<span class="string">&quot;action&quot;</span> <span class="attr">did</span>=<span class="string">&quot;d2&quot;</span>&gt;</span>连线<span class="tag">&lt;/<span class="name">Denoter</span>&gt;</span>成都网友</span><br><span class="line">        <span class="tag">&lt;<span class="name">Participant</span> <span class="attr">oid</span>=<span class="string">&quot;o2&quot;</span>&gt;</span>姚先生<span class="tag">&lt;/<span class="name">Participant</span>&gt;</span>。</span><br><span class="line">      <span class="tag">&lt;/<span class="name">Event</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Sentence</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Paragraph</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">eRelation</span> <span class="attr">relType</span>=<span class="string">&quot;Causal&quot;</span> <span class="attr">cause_eid</span>=<span class="string">&quot;e1&quot;</span> <span class="attr">effect_eid</span>=<span class="string">&quot;e5&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="LTP（Language-Technology-Platform）平台云简介"><a href="#LTP（Language-Technology-Platform）平台云简介" class="headerlink" title="LTP（Language Technology Platform）平台云简介"></a>LTP（Language Technology Platform）平台云简介</h3><p>语言技术平台（Language Technology Platform，LTP）是哈工大社会计算与信息检索研究中心历时十年研制的一整套开放中文自然语言处理系统。LTP制定了基于XML的语言处理结果表示，并在此基础上提供了一整套自底向上的丰富、高效、高精度的中文自然语言处理模块（包括词法、句法、语义等5项中文处理核心技术，在多次国内外技术评测中获得优异成绩，特别是获得CoNLL 2009国际句法和语义分析联合评测的第一名），应用程序接口，可视化工具，以及能够以网络服务使用的语言技术云。学术版LTP已共享给500多家研究机构免费使用，百度、腾讯、华为、金山等企业付费使用LTP商业版本。2010年，LTP荣获行业最高奖–“钱伟长中文信息处理科学技术一等奖”。</p>
<p>语言技术平台的总体结构如下所示</p>
<p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/ltp_framework.png"></p>
<p>若想进一步了解，请<a target="_blank" rel="noopener" href="http://www.ltp-cloud.com/intro/">点我</a>进入LTP官网进行查看。</p>
<h3 id="我的工作-用机器进行标注"><a href="#我的工作-用机器进行标注" class="headerlink" title="我的工作-用机器进行标注"></a>我的工作-用机器进行标注</h3><p>在我们构建CEC的过程中全部由人工进行标注，先用网络爬虫从网络上爬取突发事件类的新闻报道，之后人工对事件的要素进行识别，然后添加对应的标签以及属性等。此过程费时费力，而且由于不同的人有不同的判断，易造成标注过程中的标准不一致，进而为整个语料库带来一些歧义性的标注内容，所以应该由机器进行初步的标注，人工在机器标注的基础之上进行深入细致的分析，修正等。</p>
<p><strong>效果图</strong></p>
<p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/automatic_annotation.gif"></p>
<h3 id="如何实现"><a href="#如何实现" class="headerlink" title="如何实现"></a>如何实现</h3><h4 id="挖掘事件要素规则"><a href="#挖掘事件要素规则" class="headerlink" title="挖掘事件要素规则"></a>挖掘事件要素规则</h4><p>借助于人工构建的CEC语料库，使用LTP对CEC语料库中的原文本（未标注的文本）进行词性标注、命名实体识别、语义角色标注等一系列基础性工作，之后与CEC语料库进行对比，抽取出事件的每个要素所对应的词性、语义角色等，这样可以获取到大量的有序的词性集合以及语义角色集合，既然词性和语义角色标注都是有序的，那么很自然的想到利用序列模式挖掘算法对词性集合、语义角色集合进行频繁项集挖掘，我采用的是韩家炜于2004年提出的PrefixSpan序列模式挖掘算法，有兴趣的可以去读读他的论文，地址<a target="_blank" rel="noopener" href="https://www.cs.sfu.ca/~jpei/publications/spg.pdf">点我</a>。</p>
<h4 id="构建触发词表"><a href="#构建触发词表" class="headerlink" title="构建触发词表"></a>构建触发词表</h4><p>根据触发词类型的不同，分别抽取出每一种类型的触发词构建成触发词表。在CEC语料库中触发词共有七种，分别是：突发事件(emergency) 、移动事件(movement)、声明类事件(statement)、原子动作事件(action) 、操作事件(operation) 、状态改变事件(stateChange)、感知事件(perception)。</p>
<h4 id="使用同义词词林（扩展版）扩充触发词表"><a href="#使用同义词词林（扩展版）扩充触发词表" class="headerlink" title="使用同义词词林（扩展版）扩充触发词表"></a>使用同义词词林（扩展版）扩充触发词表</h4><p>首先要知道为什么需要扩充触发词表？既然触发词表由CEC中抽取所得，限于CEC规模有限，触发词表的数量亦必然有限，那么需要使用同义词词林对其进行扩充，在扩充的过程中，并不是将与某个触发词是同义词的所有义项全部扩充进触发词表，而是有一定的阈值，对于满足一定阈值的同义词项才认为均是合法的，予以扩充。</p>
<h4 id="用户自定义事件要素词典"><a href="#用户自定义事件要素词典" class="headerlink" title="用户自定义事件要素词典"></a>用户自定义事件要素词典</h4><p>同样的，我们不禁要问一下，为什么需要用户自定义要素词典呢？同样是限于CEC规模，挖掘的要素识别规则必然有限，亦不能涵盖大量未知的情况，所以需要人工定义事件要素词典，并且该词典可以采用倒序排列，按照文本串的长度由长到短排序，这样机器识别要素的时候，可以防止过分切分事件要素，类似于切词里面的正向最大切分。</p>
<p>本算法有一定的领域局限性，目前仅限于突发事件类的新闻报道，且准确率有待进一步提高，此为后话。有关实现的具体细节，请参考我的论文：《一种面向突发事件的文本语料自动标注方法》</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/09/23/2016-campus-recruitment-of-mushroom-street-programming-problem-resolution-technology/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/09/23/2016-campus-recruitment-of-mushroom-street-programming-problem-resolution-technology/" class="post-title-link" itemprop="url">蘑菇街2016校园招聘之编程题解析-技术类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-09-23 22:56:30" itemprop="dateCreated datePublished" datetime="2015-09-23T22:56:30+08:00">2015-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithms/" itemprop="url" rel="index"><span itemprop="name">Algorithms</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="回文串"><a href="#回文串" class="headerlink" title="回文串"></a>回文串</h4><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/palindrome_mogujie_1.png" alt="NO1" title="NO1"></p>
<p>解题思路：既然通过添加一个字母可以变为回文串，那么通过删除与添加的字母相对位置的字符，应该亦为回文串。</p>
<p>例如：</p>
<ul>
<li><p>‘abcb’在末尾添加’a’ –&gt; ‘abcba’为回文串<br>‘abcb’删除与想要添加的字符’a’对应位置的字符 –&gt; ‘bcb’亦为回文串</p>
</li>
<li><p>‘aabbaab’在头部添加’b’ –&gt; ‘baabbaab’为回文串<br>‘aabbaab’删除与想要添加的字符’b’对应位置的字符 –&gt; ‘aabbaa’亦为回文串</p>
</li>
</ul>
<p>Java算法实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/9/23 13:35</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:Main</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * Description:给定一个串，通过添加一个字母将其变成“回文串”</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y</span> <span class="operator">=</span> <span class="string">&quot;YES&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">N</span> <span class="operator">=</span> <span class="string">&quot;NO&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">isPalindrome</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(input)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Y;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> input.length();</span><br><span class="line">        <span class="comment">//题目说明不超过10个字符，那么超过的话，直接返回NO</span></span><br><span class="line">        <span class="keyword">if</span> (length &gt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> N;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(input);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            sb.deleteCharAt(i);</span><br><span class="line">            <span class="type">String</span> <span class="variable">temp</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">            <span class="keyword">if</span> (sb.reverse().toString().equals(temp)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Y;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sb = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(input);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> N;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">cin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        String input;</span><br><span class="line">        <span class="keyword">while</span> (cin.hasNext()) &#123;</span><br><span class="line">            input = cin.next();</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">Main</span>().isPalindrome(input));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="聊天"><a href="#聊天" class="headerlink" title="聊天"></a>聊天</h4><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/chat_mogujie_2.png" alt="NO2" title="NO2"></p>
<p>解题思路：</p>
<ol>
<li>小蘑的时间假设为<code>[a，b]</code>，小菇的时间假设是<code>[c+t，d+t]</code>，小菇起床的时间是<code>t∈[l，r]</code></li>
<li>那么当<code>&quot;a &lt; b &lt; (c+t) &lt; (d+t)&quot;</code>或者<code>&quot;(c+t) &lt; (d+t) &lt; a &lt; b&quot;</code>的情况时，小蘑和小菇无法聊天，由题目条件已知<code>&quot;a &lt; b&quot;</code>和<code>&quot;c &lt; d&quot;</code>，那么推出<code>&quot;(c+t) &lt; (d+t)&quot;</code></li>
<li>所以仅仅当<code>&quot;b &lt; (c+t)&quot;</code>或者<code>&quot;(d+t) &lt; a&quot;</code>时无法聊天，其余情况都是可以聊天的</li>
</ol>
<p>Java算法实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/9/23 13:35</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:Main2</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * Description:求小菇合适的起床时间，有一个非常奇葩的问题，在牛客网上测试，如果main中写</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * Scanner cin = new Scanner(System.in);</span></span><br><span class="line"><span class="comment"> * while (cin.hasNextInt()) &#123;&#125;//正确</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> * 写</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * while(true)&#123;&#125;//报错</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isLegal</span><span class="params">(<span class="type">int</span> num, <span class="type">boolean</span> flag)</span> &#123;</span><br><span class="line"><span class="comment">//        flag为true标识判断[1,50]，flag为false标识判断[0,1000]</span></span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(<span class="number">1</span> &lt;= num &amp;&amp; num &lt;= <span class="number">50</span>)) &#123;</span><br><span class="line"><span class="comment">//                System.out.println(&quot;数据非法&quot;);</span></span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(<span class="number">0</span> &lt;= num &amp;&amp; num &lt;= <span class="number">1000</span>)) &#123;</span><br><span class="line"><span class="comment">//                System.out.println(&quot;数据非法&quot;);</span></span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">cin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (cin.hasNextInt()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>, q = <span class="number">0</span>, l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">            p = cin.nextInt();</span><br><span class="line">            isLegal(p, <span class="literal">true</span>);</span><br><span class="line">            q = cin.nextInt();</span><br><span class="line">            isLegal(q, <span class="literal">true</span>);</span><br><span class="line">            l = cin.nextInt();</span><br><span class="line">            isLegal(l, <span class="literal">false</span>);</span><br><span class="line">            r = cin.nextInt();</span><br><span class="line">            isLegal(r, <span class="literal">false</span>);</span><br><span class="line">            <span class="type">int</span>[] time_A_B = <span class="keyword">new</span> <span class="title class_">int</span>[p * <span class="number">2</span>];<span class="comment">//标识小蘑的时间</span></span><br><span class="line">            <span class="type">int</span>[] time_C_D = <span class="keyword">new</span> <span class="title class_">int</span>[q * <span class="number">2</span>];<span class="comment">//标识小菇的时间</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; time_A_B.length; i++) &#123;</span><br><span class="line"><span class="comment">//            接收p行的数据，每一行数据是一个时间对</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> cin.nextInt();</span><br><span class="line">                isLegal(temp, <span class="literal">false</span>);</span><br><span class="line">                time_A_B[i] = temp;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; time_C_D.length; i++) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> cin.nextInt();</span><br><span class="line">                isLegal(temp, <span class="literal">false</span>);</span><br><span class="line">                time_C_D[i] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//标识小菇能有多少个合适的起床时间</span></span><br><span class="line">            begin:</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> l; t &lt;= r; t++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; time_A_B.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; time_C_D.length; j += <span class="number">2</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!(time_C_D[j] + t &gt; time_A_B[i + <span class="number">1</span>] || time_C_D[j + <span class="number">1</span>] + t &lt; time_A_B[i])) &#123;</span><br><span class="line">                            count++;</span><br><span class="line">                            <span class="keyword">continue</span> begin;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="搬圆桌"><a href="#搬圆桌" class="headerlink" title="搬圆桌"></a>搬圆桌</h4><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/move_table_mogujie_3.png" alt="NO3" title="NO3"></p>
<p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/move_table_mogujie_3_analysis.jpg"></p>
<p>解题思路：</p>
<ol>
<li><code>length = sqrt((x1-x2)^2+(y1-y2)^2)</code>先计算两个圆心点之间的距离</li>
<li>参考上图，以<code>(2 0 0 0 4)</code>作为输入数据进行说明，当两个圆心点之间的距离<code>lenght&lt;(2*r+1)</code>的时候，我们是不能够沿着两个圆心之间的连线进行移动的，而由两点之间直线最短，可知，沿两圆心的连线进行移动是最短的距离，换句话说，旋转一次移动的最长距离就是<code>2*r</code>，而在旋转之前需要先移动一步，所以阈值设为<code>2*r+1</code></li>
<li>那么当<code>lenght&lt;(2*r+1)</code>的时候，我们该如何进行旋转呢？正确的做法是以<code>(x1,y1)</code>为圆心<code>r</code>为半径作圆，与以<code>(x,y)</code>为圆心的圆的交叉点就是支点，固定此点旋转即可</li>
<li>根据以上的分析，再以<code>(2 0 0 0 5)</code>作为输入数据进行说明，当<code>length&gt;=(2*r+1)</code>，那么<code>length</code>中有几个<code>(2*r+1)</code>，我们就需要走几步，如果相除不为整数，那么加1即可</li>
</ol>
<p>Java算法实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/9/23 16:54</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:Main3</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * Description:求圆桌移动到目标位置的步数</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">cin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (cin.hasNextInt()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> cin.nextInt();</span><br><span class="line">            <span class="keyword">if</span> (r &lt; <span class="number">1</span> || r &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> cin.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> cin.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x1</span> <span class="operator">=</span> cin.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y1</span> <span class="operator">=</span> cin.nextInt();</span><br><span class="line">            <span class="keyword">if</span> (x &lt; -<span class="number">100000</span> || x &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (y &lt; -<span class="number">100000</span> || y &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (x1 &lt; -<span class="number">100000</span> || x1 &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (y1 &lt; -<span class="number">100000</span> || y1 &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">double</span> <span class="variable">length</span> <span class="operator">=</span> Math.sqrt(Math.pow(x - x1, <span class="number">2</span>) + Math.pow(y - y1, <span class="number">2</span>));</span><br><span class="line">            <span class="type">int</span> count;</span><br><span class="line">            <span class="comment">//向上取整之后强转为int型即可</span></span><br><span class="line">            count = (<span class="type">int</span>) Math.ceil(length / (<span class="number">2</span> * r + <span class="number">1</span>));</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>本文代码均在牛客网在线OJ测试通过。算法如有疏漏或不妥之处，还望不吝赐教！</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/09/03/those-common-svn-and-git-commands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/09/03/those-common-svn-and-git-commands/" class="post-title-link" itemprop="url">那些常用的svn和git命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-09-03 22:51:37" itemprop="dateCreated datePublished" datetime="2015-09-03T22:51:37+08:00">2015-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:14:31" itemprop="dateModified" datetime="2024-01-24T10:14:31+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/technology/" itemprop="url" rel="index"><span itemprop="name">technology</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>版本管理基本上是多人协作开发中必不可少的工具，常用的版本管理工具有：svn和git。虽然都有可视化的工具帮助我们使用这些工具，然而当你用上命令行之后，我想你会选择抛弃这些可视化工具。下面是我整理的一些常用的svn和git命令。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2015/09/03/those-common-svn-and-git-commands/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/08/29/Selenium-simulated-user-login-alipay-account-query-transaction-details/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/08/29/Selenium-simulated-user-login-alipay-account-query-transaction-details/" class="post-title-link" itemprop="url">使用Selenium模拟用户登录支付宝账户查询交易详情</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-08-29 21:39:00" itemprop="dateCreated datePublished" datetime="2015-08-29T21:39:00+08:00">2015-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Selenium简介"><a href="#Selenium简介" class="headerlink" title="Selenium简介"></a>Selenium简介</h3><p><code>Selenium</code>是一个用于Web应用程序测试的工具。<code>Selenium</code>测试直接运行在浏览器中，就像真正的用户在操作一样。支持的浏览器包括IE、Mozilla Firefox、Chrome等。这个工具的主要功能包括：测试与浏览器的兼容性——测试你的应用程序看是否能够很好得工作在不同浏览器和操作系统之上。测试系统功能——创建回归测试检验软件功能和用户需求。支持自动录制动作和自动生成<code>.Net</code>、<code>Java</code>、<code>Perl</code>等不同语言的测试脚本。<code>Selenium</code>是<code>ThoughtWorks</code>专门为Web应用程序编写的一个验收测试工具。</p>
<h3 id="Selenium的优势"><a href="#Selenium的优势" class="headerlink" title="Selenium的优势"></a>Selenium的优势</h3><p>据<code>Selenium</code>主页所说，与其他测试工具相比，使用<code>Selenium</code>的最大好处是：<code>Selenium</code>测试直接在浏览器中运行，就像真实用户所做的一样。<code>Selenium</code>测试可以在<code>Windows</code>、<code>Linux</code>和<code>Macintosh</code>上的<code>Internet Explorer</code>、<code>Mozilla</code>和<code>Firefox</code>中运行。其他测试工具都不能覆盖如此多的平台。使用<code>Selenium</code>和在浏览器中运行测试还有很多其他好处。下面是主要的两大好处：</p>
<ul>
<li>通过编写模仿用户操作的<code>Selenium</code>测试脚本，可以从终端用户的角度来测试应用程序</li>
<li>通过在不同浏览器中运行测试，更容易发现浏览器的不兼容性</li>
</ul>
<p><code>Selenium</code>的核心，也称<code>browser bot</code>，是用<code>JavaScript</code>编写的。这使得测试脚本可以在受支持的浏览器中运行。<code>browser bot</code>负责执行从测试脚本接收到的命令，测试脚本要么是用<code>HTML</code>的表布局编写的，要么是使用一种受支持的编程语言编写的。</p>
<h3 id="Selenium-WebDriver"><a href="#Selenium-WebDriver" class="headerlink" title="Selenium-WebDriver"></a>Selenium-WebDriver</h3><p><code>Selenium-WebDriver</code>支持如下浏览器，在所有支持这些浏览器的操作系统中能都运行良好。</p>
<ul>
<li>Google Chrome 12.0.712.0+</li>
<li>Internet Explorer 6, 7, 8, 9 - 32 and 64-bit where applicable</li>
<li>Firefox 3.0, 3.5, 3.6, 4.0, 5.0, 6, 7</li>
<li>Opera 11.5+</li>
<li>HtmlUnit 2.9</li>
<li>Android – 2.3+ for phones and tablets (devices &amp; emulators)</li>
<li>iOS 3+ for phones (devices &amp; emulators) and 3.2+ for tablets (devices &amp; emulators)</li>
</ul>
<h3 id="Selenium开发环境"><a href="#Selenium开发环境" class="headerlink" title="Selenium开发环境"></a>Selenium开发环境</h3><p>如欲使用Java语言，那么JDK的环境是必备的。使用<code>Selenium</code>来驱动浏览器，那么必须要有<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1o6quY5G">浏览器驱动包</a>，同样还需要<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1o6vKGh8">Selenium的Jar包</a>，点击下载即可。</p>
<h3 id="Selenium启动浏览器"><a href="#Selenium启动浏览器" class="headerlink" title="Selenium启动浏览器"></a>Selenium启动浏览器</h3><h4 id="启动Firefox"><a href="#启动Firefox" class="headerlink" title="启动Firefox"></a>启动Firefox</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//后一个参数是Firefox的安装路径</span></span><br><span class="line">System.setProperty(<span class="string">&quot;webdriver.firefox.bin&quot;</span>, <span class="string">&quot;C:/Program Files (x86)/Mozilla Firefox/firefox.exe&quot;</span>);</span><br><span class="line"><span class="type">WebDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FirefoxDriver</span>();</span><br><span class="line">driver.get(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="启动Chrome"><a href="#启动Chrome" class="headerlink" title="启动Chrome"></a>启动Chrome</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//后一个参数是Chrome浏览器的驱动，需要下载</span></span><br><span class="line">System.setProperty(<span class="string">&quot;webdriver.chrome.driver&quot;</span>, <span class="string">&quot;D:/chromedriver.exe&quot;</span>);</span><br><span class="line"><span class="type">WebDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChromeDriver</span>();</span><br><span class="line">driver.get(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="启动IE"><a href="#启动IE" class="headerlink" title="启动IE"></a>启动IE</h4><p>作为开发人员，建议您应该远离IE，虽然我不太愿意提供IE的启动方式给您！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">&quot;webdriver.ie.driver&quot;</span>, <span class="string">&quot;D:/IEDriverServer.exe&quot;</span>);</span><br><span class="line"><span class="type">WebDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InternetExplorerDriver</span>();</span><br><span class="line">driver.get(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="常见问题的处理方法"><a href="#常见问题的处理方法" class="headerlink" title="常见问题的处理方法"></a>常见问题的处理方法</h3><blockquote>
<p>How to select any element from the web element with “display: none” attribute using Selenium ?<br>特别是在处理因为<code>&lt;select&gt;</code>标签中带有<code>style=&#39;display:none&#39;</code>而无法设置option的情况时很有效！</p>
</blockquote>
<p>方法：</p>
<blockquote>
<p>Use execute_script() to set the display property of that element and then use the Selenium Select for selecting a required value.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JavascriptExecutor</span> <span class="variable">js</span> <span class="operator">=</span> (JavascriptExecutor) driver;<span class="comment">//将driver对象强转成JavascriptExecutor</span></span><br><span class="line">js.executeScript(<span class="string">&quot;document.getElementById(&#x27;J-select-range&#x27;).style.display=&#x27;inline&#x27;;&quot;</span>);<span class="comment">//修改display的值，也可以修改为display=&#x27;list-item&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Element is not currently visible and may not be manipulated</p>
</blockquote>
<p>一般这种错误是因为父元素有<code>style=&#39;display:none&#39;</code>属性或者是页面还没有加载完全，最简单的就是使用<code>Thread.sleep(1000);</code>休息一秒之后再操作。当然也可以使用until方法直到其出现再对其进行操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WebDriverWait</span> <span class="variable">wait</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebDriverWait</span>(driver, <span class="number">300</span>);</span><br><span class="line"><span class="type">WebElement</span> <span class="variable">selectElement</span> <span class="operator">=</span> wait.until(ExpectedConditions.visibilityOfElementLocated(By.id(<span class="string">&quot;formLevel:levels_input&quot;</span>)));</span><br><span class="line"><span class="type">Select</span> <span class="variable">select</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Select</span>(selectElement);</span><br><span class="line">select.selectByVisibleText(<span class="string">&quot;SECURITY&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="模拟用户登录支付宝查询交易信息的程序"><a href="#模拟用户登录支付宝查询交易信息的程序" class="headerlink" title="模拟用户登录支付宝查询交易信息的程序"></a>模拟用户登录支付宝查询交易信息的程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.openqa.selenium.By;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.JavascriptExecutor;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebElement;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.chrome.ChromeDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.support.ui.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注意此流程适应于旧版支付宝，新版支付宝页面未测试</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu 2015/8/29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeleniumAlipay</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> WebDriver driver;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    定义自己的休眠方法，精简代码量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">long</span> time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(time);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    登录操作，负责将界面跳转到交易记录界面</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//        启动火狐浏览器</span></span><br><span class="line"><span class="comment">//        System.setProperty(&quot;webdriver.firefox.bin&quot;, &quot;C:/Program Files (x86)/Mozilla Firefox/firefox.exe&quot;);</span></span><br><span class="line"><span class="comment">//        WebDriver driver = new FirefoxDriver();</span></span><br><span class="line"><span class="comment">//        启动Chrome浏览器</span></span><br><span class="line">        System.setProperty(<span class="string">&quot;webdriver.chrome.driver&quot;</span>, <span class="string">&quot;D:/chromedriver.exe&quot;</span>);</span><br><span class="line">        driver = <span class="keyword">new</span> <span class="title class_">ChromeDriver</span>();</span><br><span class="line"><span class="comment">//        获取登录页面</span></span><br><span class="line">        driver.get(<span class="string">&quot;https://auth.alipay.com/login/index.htm?goto=https%3A%2F%2Fwww.alipay.com%2F&quot;</span>);</span><br><span class="line"><span class="comment">//        获取用户名输入框</span></span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;J-input-user&quot;</span>)).clear();</span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;J-input-user&quot;</span>)).sendKeys(<span class="string">&quot;支付宝账户&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        休息500ms，否则，速度太快，会将密码内容填充到用户名输入框中</span></span><br><span class="line">        sleep(<span class="number">500</span>);</span><br><span class="line"><span class="comment">//        获取密码输入框</span></span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;password_rsainput&quot;</span>)).clear();</span><br><span class="line">        driver.findElement(By.id(<span class="string">&quot;password_rsainput&quot;</span>)).sendKeys(<span class="string">&quot;密码&quot;</span>);</span><br><span class="line"><span class="comment">//        休息8秒等待用户输入验证码</span></span><br><span class="line">        sleep(<span class="number">8000</span>);</span><br><span class="line"><span class="comment">//        当前URL 0 ：https://authsu18.alipay.com/login/certCheck.htm?goto=https%3A%2F%2Fwww.alipay.com%2F</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 0 ：&quot;</span> + driver.getCurrentUrl());</span><br><span class="line">        driver.get(<span class="string">&quot;https://www.alipay.com/&quot;</span>);</span><br><span class="line"><span class="comment">//        点击个人用户登录</span></span><br><span class="line">        driver.findElement(By.className(<span class="string">&quot;personal-login&quot;</span>)).click();</span><br><span class="line"><span class="comment">//        当前URL 1 ：https://www.alipay.com/</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 1 ：&quot;</span> + driver.getCurrentUrl());</span><br><span class="line">        sleep(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">myAlipay</span> <span class="operator">=</span> driver.findElement(By.className(<span class="string">&quot;am-button-innerNav,button-myalipay&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;myAlipay isSelected ：&quot;</span> + myAlipay.isSelected());<span class="comment">//false</span></span><br><span class="line">        System.out.println(<span class="string">&quot;myAlipay isEnabled ：&quot;</span> + myAlipay.isEnabled());<span class="comment">//true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;myAlipay isDisplayed ：&quot;</span> + myAlipay.isDisplayed());<span class="comment">//true</span></span><br><span class="line"><span class="comment">//        点击进入我的支付宝按钮</span></span><br><span class="line">        driver.findElement(By.className(<span class="string">&quot;am-button-innerNav,button-myalipay&quot;</span>)).click();</span><br><span class="line"><span class="comment">//        当前URL 2 ：https://my.alipay.com/portal/i.htm</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 2 ：&quot;</span> + driver.getCurrentUrl());</span><br><span class="line"><span class="comment">//        boolean selected1 = driver.findElement(By.className(&quot;fn-ml10&quot;)).isSelected();</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;收支明细是否选中：&quot; + selected1);</span></span><br><span class="line"><span class="comment">//        org.openqa.selenium.NoSuchElementException: no such keyword: Element was not in a form, so could not submit.</span></span><br><span class="line"><span class="comment">//        driver.findElement(By.className(&quot;fn-ml10&quot;)).submit();//跳转收支明细</span></span><br><span class="line"><span class="comment">//        Exception in thread &quot;main&quot; org.openqa.selenium.WebDriverException: unknown error: Element is not clickable at point</span></span><br><span class="line"><span class="comment">//        driver.findElement(By.xpath(&quot;//*[@id=\&quot;J-trend-consume\&quot;]/div/div[1]/div/a[1]&quot;)).click();</span></span><br><span class="line"><span class="comment">//        driver.findElement(By.className(&quot;fn-ml10&quot;)).click();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        无反应，看样子一直不会让你点的了</span></span><br><span class="line"><span class="comment">//        WebDriverWait webDriverWait = new WebDriverWait(driver, 3);</span></span><br><span class="line"><span class="comment">//        webDriverWait.until(ExpectedConditions.elementToBeClickable(By.xpath(&quot;//*[@id=\&quot;J-trend-consume\&quot;]/div/div[1]/div/a[1]&quot;)));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        跳转到收支明细界面</span></span><br><span class="line"><span class="comment">//        driver.get(&quot;https://xlab.alipay.com/consume/record/items.htm&quot;);</span></span><br><span class="line">        <span class="comment">//跳转到交易记录界面</span></span><br><span class="line">        driver.get(<span class="string">&quot;https://consumeprod.alipay.com/record/index.htm&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">currentUrl</span> <span class="operator">=</span> driver.getCurrentUrl();</span><br><span class="line"><span class="comment">//        当前URL 3 ：https://consumeprod.alipay.com/record/advanced.htm</span></span><br><span class="line">        System.out.println(<span class="string">&quot;当前URL 3 ：&quot;</span> + currentUrl);</span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        login();</span><br><span class="line">        <span class="type">String</span> <span class="variable">oppositeUser</span> <span class="operator">=</span> getOppositeUser(<span class="string">&quot;20150826110500100010740029003925&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交易方对方信息：&quot;</span> + oppositeUser);</span><br><span class="line">        oppositeUser = getOppositeUser(<span class="string">&quot;20150720110500100010740025980311&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交易方对方信息：&quot;</span> + oppositeUser);</span><br><span class="line">        oppositeUser = getOppositeUser(<span class="string">&quot;2015081521001004740064396260&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交易方对方信息：&quot;</span> + oppositeUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    获取交易对方信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getOppositeUser</span><span class="params">(String transactionNo)</span> &#123;</span><br><span class="line">        <span class="comment">//获取关键字对应的下拉框</span></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">keywordInput</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;J-keyword&quot;</span>));</span><br><span class="line">        keywordInput.clear();</span><br><span class="line">        keywordInput.sendKeys(transactionNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">keywordSelect</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;keyword&quot;</span>));</span><br><span class="line">        List&lt;WebElement&gt; options = keywordSelect.findElements(By.tagName(<span class="string">&quot;option&quot;</span>));</span><br><span class="line">        <span class="comment">//until方法表示直到可点再点</span></span><br><span class="line"><span class="comment">//        WebElement selectElement = wait.until(ExpectedConditions</span></span><br><span class="line"><span class="comment">//                .visibilityOfElementLocated(By.id(&quot;keyword&quot;)));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        需要执行JavaScript语句，所以强转driver</span></span><br><span class="line">        <span class="type">JavascriptExecutor</span> <span class="variable">js</span> <span class="operator">=</span> (JavascriptExecutor) driver;</span><br><span class="line"><span class="comment">//        也可以这么用setAttribute(&quot;style&quot;,&quot;&quot;);</span></span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;keyword&#x27;).style.display=&#x27;list-item&#x27;;&quot;</span>);</span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;keyword&#x27;).removeAttribute(&#x27;smartracker&#x27;);&quot;</span>);</span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;keyword&#x27;).options[1].selected = true;&quot;</span>);</span><br><span class="line">        js.executeScript(<span class="string">&quot;document.getElementById(&#x27;J-select-range&#x27;).style.display=&#x27;list-item&#x27;;&quot;</span>);</span><br><span class="line"><span class="comment">//        设置交易时间选项</span></span><br><span class="line">        <span class="type">Select</span> <span class="variable">selectTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Select</span>(driver.findElement(By.id(<span class="string">&quot;J-select-range&quot;</span>)));</span><br><span class="line">        selectTime.selectByIndex(<span class="number">3</span>);<span class="comment">//选中的是最近三个月</span></span><br><span class="line">        System.out.println(<span class="string">&quot;selectTime.isMultiple() : &quot;</span> + selectTime.isMultiple());</span><br><span class="line"><span class="comment">//        设置关键字选项</span></span><br><span class="line">        <span class="type">Select</span> <span class="variable">selectKeyword</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Select</span>(driver.findElement(By.id(<span class="string">&quot;keyword&quot;</span>)));</span><br><span class="line">        <span class="comment">//        selectKeyword.selectByValue(&quot;bizInNo&quot;);//此处的value填写&lt;option&gt;标签中的value值</span></span><br><span class="line">        selectKeyword.selectByIndex(<span class="number">1</span>);<span class="comment">//选中的是交易号</span></span><br><span class="line">        System.out.println(<span class="string">&quot;selectKeyword.isMultiple() : &quot;</span> + selectKeyword.isMultiple());</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">queryButton</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;J-set-query-form&quot;</span>));<span class="comment">//拿到搜索按钮</span></span><br><span class="line"><span class="comment">//        点击搜索按钮</span></span><br><span class="line">        queryButton.submit();</span><br><span class="line"></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">tr</span> <span class="operator">=</span> driver.findElement(By.id(<span class="string">&quot;J-item-1&quot;</span>));<span class="comment">//先获取tr</span></span><br><span class="line">        <span class="type">WebElement</span> <span class="variable">td</span> <span class="operator">=</span> tr.findElement(By.xpath(<span class="string">&quot;//*[@id=\&quot;J-item-1\&quot;]/td[5]/p[1]&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> td.getText();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/automatic_query_alipay_treasure_transaction_information.gif"></p>
<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://baike.baidu.com/subview/478050/6464537.htm">http://baike.baidu.com/subview/478050/6464537.htm</a><br>[2] <a target="_blank" rel="noopener" href="http://blog.csdn.net/wanglha/article/details/39755613">http://blog.csdn.net/wanglha/article/details/39755613</a><br>[3] <a target="_blank" rel="noopener" href="http://webdriver.blog.51cto.com/10517592/1673920">http://webdriver.blog.51cto.com/10517592/1673920</a><br>[4] <a target="_blank" rel="noopener" href="http://blog.csdn.net/pf20050904/article/details/20052485">http://blog.csdn.net/pf20050904/article/details/20052485</a><br>[5] <a target="_blank" rel="noopener" href="http://www.open-open.com/doc/view/9f52277e5d9c4dd3b851ae54011e733a">http://www.open-open.com/doc/view/9f52277e5d9c4dd3b851ae54011e733a</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/08/04/Based-on-the-extended-version-of-synonyms-Cilin-word-similarity-computing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/08/04/Based-on-the-extended-version-of-synonyms-Cilin-word-similarity-computing/" class="post-title-link" itemprop="url">基于同义词词林扩展版的词语相似度计算</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-08-04 22:06:36" itemprop="dateCreated datePublished" datetime="2015-08-04T22:06:36+08:00">2015-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Algorithms/" itemprop="url" rel="index"><span itemprop="name">Algorithms</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="词语相似度计算"><a href="#词语相似度计算" class="headerlink" title="词语相似度计算"></a>词语相似度计算</h4><p>词义相似度计算在很多领域中都有广泛的应用，例如信息检索、信息抽取、文本分类、词义排歧、基于实例的机器翻译等等。国内目前主要是使用知网和同义词词林来进行词语的相似度计算。</p>
<p>本文主要是根据《基于同义词词林的词语相似度计算方法–田久乐》论文中所提出的分层算法实现相似度计算，程序采用Java语言编写。</p>
<h4 id="同义词词林扩展版"><a href="#同义词词林扩展版" class="headerlink" title="同义词词林扩展版"></a>同义词词林扩展版</h4><p>《同义词词林》是梅家驹等人于1983年编纂而成，这本词典中不仅包括了一个词语的同义词，也包含了一定数量的同类词，即广义的相关词。《同义词词林扩展版》是由哈尔滨工业大学信息检索实验室所重新修订所得。该版收录词语近7万条，全部按意义进行编排，是一部同义类词典。</p>
<p>同义词词林按照树状的层次结构把所有收录的词条组织到一起，把词汇分成大、中、小三类，大类有12个，中类有97个，小类有1400个。每个小类里都有很多的词，这些词又根据词义的远近和相关性分成了若干个词群（段落）。每个段落中的词语又进一步分成了若干个行，同一行的词语要么词义相同，要么词义有很强的相关性。</p>
<p>《同义词词林》提供了5层编码，第1级用大写英文字母表示；第2级用小写英文字母表示；第3级用二位十进制整数表示；第4级用大写英文字母表示；第5级用二位十进制整数表示。例如：<br>Cb30A01&#x3D; 这里 这边 此地 此间 此处 此<br>Cb30A02# 该地 该镇 该乡 该站 该区 该市 该村<br>Cb30A03@ 这方</p>
<p>分层及编码表如下所示<br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/tongyici_cilin_structure.jpg"><br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/tongyici_cilin_encode.jpg"></p>
<p>由于第5级有的行是同义词，有的行是相关词，有的行只有一个词，分类结果需要特别说明，可以分出具体的3种情况。使用特殊符号对这3种情况进行区别对待，所以第8位的标记有3种，分别是“&#x3D;”代表“相等”、“同义”；“#”代表“不等”、“同类”，属于相关词语；“@”代表“自我封闭”、“独立”，它在词典中既没有同义词，也没有相关词。</p>
<p>在对文本内容进行相似度计算中，采用该论文中给出的计算公式，两个义项的相似度用<code>Sim</code>表示<br>若两个义项不在同一棵树上，<code>Sim(A,B)=f</code><br>若两个义项在同一棵树上：<br>若在第2层分支，系数为a <code>Sim(A,B)=1*a*cos*(n*π/180)((n-k+1)/n)</code><br>若在第3层分支，系数为b <code>Sim(A,B)=1*1*b*cos*(n*π/180)((n-k+1)/n)</code><br>若在第4层分支，系数为c <code>Sim(A,B)=1*1*1*c×cos*(n*π/180)((n-k+1)/n)</code><br>若在第5层分支，系数为d <code>Sim(A,B)=1*1*1*1*d*cos*(n*π/180)((n-k+1)/n)</code></p>
<p>当编码相同，而只有末尾是“#”时，那么认为其相似度为e。<br>例如<code>Ad02B04# 非洲人 亚洲人</code>  则其相似度为e。</p>
<p>其中n是分支层的节点分支总数，k是两个分支间的距离。<br>如：人 <code>Aa01A01=</code> 和 少儿 <code>Ab04B01=</code><br>以A开头的子分支只有14个，分别是<code>Aa...，Ab...，Ac... ——— An...</code>，而不是以A开头的所有结点的个数，所以<code>n=14</code>；在第2层分支上，人的编码是<code>a</code>，少儿的编码是<code>b</code>，a和b之间差1，所以<code>k=1</code>。</p>
<p>该文献中给出的参数值为<code>a=0.65</code>，<code>b=0.8</code>，<code>c=0.9</code>，<code>d=0.96</code>，<code>e=0.5</code>，<code>f=0.1</code>。</p>
<h4 id="Java代码实现"><a href="#Java代码实现" class="headerlink" title="Java代码实现"></a>Java代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.codepub.algorithms.similarity.cilin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Preconditions;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.PI;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.cos;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created with IntelliJ IDEA. 2015/8/2 21:54</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ClassName:WordSimilarity 同义词词林扩展版计算词语相似度</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Description:&lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &quot;=&quot; 代表 相等 同义 &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &quot;#&quot; 代表 不等 同类 属于相关词语 &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &quot;@&quot; 代表 自我封闭 独立 它在词典中既没有同义词, 也没有相关词 &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Wang Xu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="comment">//注意使用Log4j2的注解，那么在pom中必须引入2.x版本的log4j，如果使用Log4j注解，pom中引入1.x版本的log4j</span></span><br><span class="line"><span class="comment">//相应的配置文件也要一致，2.x版本配置文件为log4j2.xml，1.x版本配置文件为log4j.xml</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordSimilarity</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * when we use Lombok&#x27;s Annotation, such as <span class="doctag">@Log</span>4j</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Log</span>4j &lt;br/&gt;</span></span><br><span class="line"><span class="comment">     * public class LogExample &#123;</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * will generate:</span></span><br><span class="line"><span class="comment">     * public class LogExample &#123;</span></span><br><span class="line"><span class="comment">     * private static final org.apache.logging.log4j.Logger log = org.apache.logging.log4j.Logger.getLogger(LogExample.class);</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//定义一些常数先</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0.65</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0.8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0.9</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">0.96</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">e</span> <span class="operator">=</span> <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">f</span> <span class="operator">=</span> <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">degrees</span> <span class="operator">=</span> <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//存放的是以词为key，以该词的编码为values的List集合，其中一个词可能会有多个编码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, ArrayList&lt;String&gt;&gt; wordsEncode = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, ArrayList&lt;String&gt;&gt;();</span><br><span class="line">    <span class="comment">//存放的是以编码为key，以该编码多对应的词为values的List集合，其中一个编码可能会有多个词</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, ArrayList&lt;String&gt;&gt; encodeWords = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, ArrayList&lt;String&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取同义词词林并将其注入wordsEncode和encodeWords</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readCiLin</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> WordSimilarity.class.getClass().getResourceAsStream(<span class="string">&quot;/cilin.txt&quot;</span>);</span><br><span class="line">        List&lt;String&gt; contents = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            contents = IOUtils.readLines(input);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String content : contents) &#123;</span><br><span class="line">                content = Preconditions.checkNotNull(content);</span><br><span class="line">                String[] strsArr = content.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                String[] strs = Preconditions.checkNotNull(strsArr);</span><br><span class="line">                <span class="type">String</span> <span class="variable">encode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> strs.length;</span><br><span class="line">                <span class="keyword">if</span> (length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                    encode = strs[<span class="number">0</span>];<span class="comment">//获取编码</span></span><br><span class="line">                &#125;</span><br><span class="line">                ArrayList&lt;String&gt; encodeWords_values = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">                    encodeWords_values.add(strs[i]);</span><br><span class="line">                &#125;</span><br><span class="line">                encodeWords.put(encode, encodeWords_values);<span class="comment">//以编码为key，其后所有值为value</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> strs[i];</span><br><span class="line">                    <span class="keyword">if</span> (wordsEncode.containsKey(strs[i])) &#123;</span><br><span class="line">                        ArrayList&lt;String&gt; values = wordsEncode.get(key);</span><br><span class="line">                        values.add(encode);</span><br><span class="line">                        <span class="comment">//重新放置回去</span></span><br><span class="line">                        wordsEncode.put(key, values);<span class="comment">//以某个value为key，其可能的所有编码为value</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        ArrayList&lt;String&gt; temp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">                        temp.add(encode);</span><br><span class="line">                        wordsEncode.put(key, temp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.err.println(<span class="string">&quot;load dictionary failed！&quot;</span>);</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对外暴露的接口，返回两个词的相似度的计算结果</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> word1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> word2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 相似度值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">getSimilarity</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">        <span class="comment">//在计算时候再加载，实现懒加载</span></span><br><span class="line">        readCiLin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果比较词没有出现在同义词词林中，则相似度为0</span></span><br><span class="line">        <span class="keyword">if</span> (!wordsEncode.containsKey(word1) || !wordsEncode.containsKey(word2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取第一个词的编码</span></span><br><span class="line">        ArrayList&lt;String&gt; encode1 = getEncode(word1);</span><br><span class="line">        <span class="comment">//获取第二个词的编码</span></span><br><span class="line">        ArrayList&lt;String&gt; encode2 = getEncode(word2);</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> <span class="variable">maxValue</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//最终的计算结果值，取所有相似度里面结果最大的那个</span></span><br><span class="line">        <span class="keyword">for</span> (String e1 : encode1) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String e2 : encode2) &#123;</span><br><span class="line">                log.info(e1);</span><br><span class="line">                log.info(e2);</span><br><span class="line">                <span class="type">String</span> <span class="variable">commonStr</span> <span class="operator">=</span> getCommonStr(e1, e2);</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> StringUtils.length(commonStr);</span><br><span class="line">                <span class="type">double</span> <span class="variable">k</span> <span class="operator">=</span> getK(e1, e2);</span><br><span class="line">                <span class="type">double</span> <span class="variable">n</span> <span class="operator">=</span> getN(commonStr);</span><br><span class="line">                log.info(<span class="string">&quot;k--&gt;&quot;</span> + k);</span><br><span class="line">                log.info(<span class="string">&quot;n--&gt;&quot;</span> + n);</span><br><span class="line">                log.info(<span class="string">&quot;encode length--&gt;&quot;</span> + length);</span><br><span class="line">                <span class="type">double</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="comment">//如果有一个以“@”那么表示自我封闭，肯定不在一棵树上，直接返回f</span></span><br><span class="line">                <span class="keyword">if</span> (e1.endsWith(<span class="string">&quot;@&quot;</span>) || e2.endsWith(<span class="string">&quot;@&quot;</span>) || <span class="number">0</span> == length) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (f &gt; maxValue) &#123;</span><br><span class="line">                        maxValue = f;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">1</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第二层上计算</span></span><br><span class="line">                    res = a * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">2</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第三层上计算</span></span><br><span class="line">                    res = b * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">4</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第四层上计算</span></span><br><span class="line">                    res = c * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">5</span> == length) &#123;</span><br><span class="line">                    <span class="comment">//说明在第五层上计算</span></span><br><span class="line">                    res = d * cos(n * PI / degrees) * ((n - k + <span class="number">1</span>) / n);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//注意不存在前面七个字符相同，而结尾不同的情况，所以这个分支一定是8个字符都相同，那么只需比较结尾即可</span></span><br><span class="line">                    <span class="keyword">if</span> (e1.endsWith(<span class="string">&quot;=&quot;</span>) &amp;&amp; e2.endsWith(<span class="string">&quot;=&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">//说明两个完全相同</span></span><br><span class="line">                        res = <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e1.endsWith(<span class="string">&quot;#&quot;</span>) &amp;&amp; e2.endsWith(<span class="string">&quot;#&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">//只有结尾不同，说明结尾是“#”</span></span><br><span class="line">                        res = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                log.info(<span class="string">&quot;res: &quot;</span> + res);</span><br><span class="line">                <span class="keyword">if</span> (res &gt; maxValue) &#123;</span><br><span class="line">                    maxValue = res;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断一个词在同义词词林中是否是自我封闭的，是否是独立的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isIndependent</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        Iterator&lt;String&gt; iter = wordsEncode.keySet().iterator();</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> iter.next();</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(key, source)) &#123;</span><br><span class="line">                ArrayList&lt;String&gt; values = wordsEncode.get(key);</span><br><span class="line">                <span class="keyword">for</span> (String value : values) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (value.endsWith(<span class="string">&quot;@&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据word的内容，返回其对应的编码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> word</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">getEncode</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> wordsEncode.get(word);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算N的值，N表示所在分支层分支数，如：人 Aa01A01= 和 少儿 Ab04B01=，以A开头的子分支只有14个</span></span><br><span class="line"><span class="comment">     * 这一点在论文中说的非常不清晰，所以以国人的文章进行编码真是痛苦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encodeHead 输入两个字符串的公共开头</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 经过计算之后得到N的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getN</span><span class="params">(String encodeHead)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> StringUtils.length(encodeHead);</span><br><span class="line">        <span class="keyword">switch</span> (length) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">4</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                <span class="keyword">return</span> getCount(encodeHead, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">(String encodeHead, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">        Iterator&lt;String&gt; iter = encodeWords.keySet().iterator();</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">curr</span> <span class="operator">=</span> iter.next();</span><br><span class="line">            <span class="keyword">if</span> (curr.startsWith(encodeHead)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">temp</span> <span class="operator">=</span> curr.substring(<span class="number">0</span>, end);</span><br><span class="line">                <span class="keyword">if</span> (res.contains(temp)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    res.add(temp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode1 第一个编码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode2 第二个编码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 这两个编码对应的分支间的距离，用k表示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getK</span><span class="params">(String encode1, String encode2)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">temp1</span> <span class="operator">=</span> encode1.substring(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">temp2</span> <span class="operator">=</span> encode2.substring(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(temp1.charAt(<span class="number">0</span>) - temp2.charAt(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(temp1.charAt(<span class="number">0</span>) - temp2.charAt(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(Integer.valueOf(temp1) - Integer.valueOf(temp2));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(temp1, temp2)) &#123;</span><br><span class="line">            temp1 = encode1.substring(<span class="number">5</span>, <span class="number">7</span>);</span><br><span class="line">            temp2 = encode2.substring(<span class="number">5</span>, <span class="number">7</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(temp1.charAt(<span class="number">0</span>) - temp2.charAt(<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(Integer.valueOf(temp1) - Integer.valueOf(temp2));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取编码的公共部分字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> String <span class="title function_">getCommonStr</span><span class="params">(String encode1, String encode2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> StringUtils.length(encode1);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (encode1.charAt(i) == encode2.charAt(i)) &#123;</span><br><span class="line">                sb.append(encode1.charAt(i));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sbLen</span> <span class="operator">=</span> StringUtils.length(sb);</span><br><span class="line">        <span class="comment">//注意第三层和第五层均有两个字符，所以长度不可能出现3和6的情况</span></span><br><span class="line">        <span class="keyword">if</span> (sbLen == <span class="number">3</span> || sbLen == <span class="number">6</span>) &#123;</span><br><span class="line">            sb.deleteCharAt(sbLen - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> String.valueOf(sb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetN</span><span class="params">()</span> &#123;</span><br><span class="line">        readCiLin();</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getN(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetK</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> getK(<span class="string">&quot;Aa01A01=&quot;</span>, <span class="string">&quot;Aa01A01=&quot;</span>);</span><br><span class="line">        System.out.println(k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCommonStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">commonStr</span> <span class="operator">=</span> getCommonStr(<span class="string">&quot;Aa01A01=&quot;</span>, <span class="string">&quot;Aa01A03=&quot;</span>);</span><br><span class="line">        System.out.println(commonStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetSimilarity</span><span class="params">()</span> &#123;</span><br><span class="line">        readCiLin();</span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;国民&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;国民:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;群众&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;群众:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;党群&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;党群:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;良民&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;良民:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;同志&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;同志:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;成年人&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;成年人:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;市民&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;市民:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;亲属&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;亲属:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;志愿者&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;志愿者:&quot;</span> + similarity);</span><br><span class="line">        similarity = getSimilarity(<span class="string">&quot;人民&quot;</span>, <span class="string">&quot;先锋&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;人民--&quot;</span> + <span class="string">&quot;先锋:&quot;</span> + similarity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetSimilarity2</span><span class="params">()</span> &#123;</span><br><span class="line">        readCiLin();</span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> getSimilarity(<span class="string">&quot;非洲人&quot;</span>, <span class="string">&quot;亚洲人&quot;</span>);</span><br><span class="line">        System.out.println(similarity);</span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity1</span> <span class="operator">=</span> getSimilarity(<span class="string">&quot;骄傲&quot;</span>, <span class="string">&quot;仔细&quot;</span>);</span><br><span class="line">        System.out.println(similarity1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明，词语相似度是个数值，一般取值范围在[0，1]之间，在原论文中，使用cos函数计算主要是将值归一化到[0，1]之间，可以将cos函数看作是一个调节因子。</p>
<p>testGetSimilarity的测试结果如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">人民--国民:<span class="number">1.0</span></span><br><span class="line">人民--群众:<span class="number">0.9576614882494312</span></span><br><span class="line">人民--党群:<span class="number">0.8978076452338418</span></span><br><span class="line">人民--良民:<span class="number">0.7182461161870735</span></span><br><span class="line">人民--同志:<span class="number">0.6630145969121822</span></span><br><span class="line">人民--成年人:<span class="number">0.6306922220793977</span></span><br><span class="line">人民--市民:<span class="number">0.5405933332109123</span></span><br><span class="line">人民--亲属:<span class="number">0.36039555547394153</span></span><br><span class="line">人民--志愿者:<span class="number">0.22524722217121346</span></span><br><span class="line">人民--先锋:<span class="number">0.18019777773697077</span></span><br></pre></td></tr></table></figure>

<p>本文使用的是同义词词林的扩展版，而原论文使用的是同义词词林，由于两者存在微小差距，所以本文计算结果与论文中的计算结果存在稍许误差，如果算法没错，这是可以理解的！</p>
<p>以上仅为个人理解，如若发现错误，欢迎大家积极留言指正！</p>
<p>代码已经推送到GitHub上了，地址<a target="_blank" rel="noopener" href="https://github.com/shijiebei2009/Algorithms/blob/master/src%2Fmain%2Fjava%2Fcn%2Fcodepub%2Falgorithms%2Fsimilarity%2Fcilin%2FWordSimilarity.java">点我</a>。注意在文章末尾所注的参考资料中的链接里面的计算方法在求n的时候存在错误，希望莫要受其误导！</p>
<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="http://www.cnblogs.com/einyboy/archive/2012/09/09/2677265.html">http://www.cnblogs.com/einyboy/archive/2012/09/09/2677265.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/07/30/Lombok-development-guidelines/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/07/30/Lombok-development-guidelines/" class="post-title-link" itemprop="url">Lombok开发指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-30 21:33:11" itemprop="dateCreated datePublished" datetime="2015-07-30T21:33:11+08:00">2015-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Lombok简介"><a href="#Lombok简介" class="headerlink" title="Lombok简介"></a>Lombok简介</h2><p><code>Lombok</code>是一款好用顺手的工具，就像<code>Google Guava</code>一样，在此予以强烈推荐，每一个Java工程师都应该使用它。Lombok是一种Java™实用工具，可用来帮助开发人员消除Java的冗长代码，尤其是对于简单的Java对象（POJO）。它通过注释实现这一目的。通过在开发环境中实现Lombok，开发人员可以节省构建诸如<code>hashCode()</code>和<code>equals()</code>这样的方法以及以往用来分类各种<code>accessor</code>和<code>mutator</code>的大量时间。</p>
<p>Lombok官网地址：<a target="_blank" rel="noopener" href="https://projectlombok.org/">https://projectlombok.org/</a> 里面还提供了一个简短的学习视频。</p>
<h2 id="安装Lombok"><a href="#安装Lombok" class="headerlink" title="安装Lombok"></a>安装Lombok</h2><h3 id="Eclipse安装Lombok"><a href="#Eclipse安装Lombok" class="headerlink" title="Eclipse安装Lombok"></a>Eclipse安装Lombok</h3><h4 id="双击Jar安装"><a href="#双击Jar安装" class="headerlink" title="双击Jar安装"></a>双击Jar安装</h4><p>首先下载Jar包，下载地址：<a target="_blank" rel="noopener" href="http://projectlombok.org/download.html">http://projectlombok.org/download.html</a><br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/eclipse_lombok.png"><br>注意如果eclipse没有安装到默认目录，那么需要点击Specify选择eclipse.exe所在的路径，然后Install即可完成安装。</p>
<p>在新建项目之后，使用Lombok如果程序还报错，那么点击eclipse菜单的Project选项的clean，清理一下即可。</p>
<h4 id="Eclipse手动安装Lombok步骤"><a href="#Eclipse手动安装Lombok步骤" class="headerlink" title="Eclipse手动安装Lombok步骤"></a>Eclipse手动安装Lombok步骤</h4><ul>
<li>将<strong>lombok.jar</strong>复制到<strong>myeclipse.ini&#x2F;eclipse.ini</strong>所在的文件夹目录下</li>
<li>打开<strong>eclipse.ini&#x2F;myeclipse.ini</strong>，在最后面插入以下两行并保存：<br><strong>-Xbootclasspath&#x2F;a:lombok.jar</strong><br><strong>-javaagent:lombok.jar</strong></li>
<li>重启<strong>eclipse&#x2F;myeclipse</strong></li>
</ul>
<p>最后需要注意的是，在使用<code>lombok</code>注解的时候记得要导入<code>lombok.jar</code>包到工程，如果使用的是<code>Maven Project</code>，要在<code>pom.xml</code>中添加依赖，并设置<code>Maven</code>为自动导入，参见IntelliJ部分。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="IntelliJ安装Lombok"><a href="#IntelliJ安装Lombok" class="headerlink" title="IntelliJ安装Lombok"></a>IntelliJ安装Lombok</h3><h4 id="通过IntelliJ的插件中心安装"><a href="#通过IntelliJ的插件中心安装" class="headerlink" title="通过IntelliJ的插件中心安装"></a>通过IntelliJ的插件中心安装</h4><p><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_plugin_lombok.png"><br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_lombok.png"><br>注意一点，在IntelliJ中如果创建的是Maven项目，那么在pom.xml文件中添加依赖后，需要设置Maven为自动导入。<br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_maven_auto_import.png"></p>
<h4 id="IntelliJ手动安装Lombok"><a href="#IntelliJ手动安装Lombok" class="headerlink" title="IntelliJ手动安装Lombok"></a>IntelliJ手动安装Lombok</h4><p>如果不想通过IntelliJ的插件中心安装的话，也可以手动安装，详细步骤参见Github上的说明：<a target="_blank" rel="noopener" href="https://github.com/mplushnikov/lombok-intellij-plugin">https://github.com/mplushnikov/lombok-intellij-plugin</a></p>
<p>简单点说手动安装步骤如下：<br>Download the <a target="_blank" rel="noopener" href="https://github.com/mplushnikov/lombok-intellij-plugin/releases/tag/releasebuild_0.11">latest release</a> and install it manually using Preferences &gt; Plugins &gt; Install plugin from disk…</p>
<h2 id="Lombok用法"><a href="#Lombok用法" class="headerlink" title="Lombok用法"></a>Lombok用法</h2><h3 id="Lombok注解说明"><a href="#Lombok注解说明" class="headerlink" title="Lombok注解说明"></a>Lombok注解说明</h3><ul>
<li><code>val</code>：用在局部变量前面，相当于将变量声明为final</li>
<li><code>@NonNull</code>：给方法参数增加这个注解会自动在方法内对该参数进行是否为空的校验，如果为空，则抛出NPE（NullPointerException）</li>
<li><code>@Cleanup</code>：自动管理资源，用在局部变量之前，在当前变量范围内即将执行完毕退出之前会自动清理资源，自动生成try-finally这样的代码来关闭流</li>
<li><code>@Getter/@Setter</code>：用在属性上，再也不用自己手写setter和getter方法了，还可以指定访问范围</li>
<li><code>@ToString</code>：用在类上，可以自动覆写toString方法，当然还可以加其他参数，例如@ToString(exclude&#x3D;”id”)排除id属性，或者@ToString(callSuper&#x3D;true, includeFieldNames&#x3D;true)调用父类的toString方法，包含所有属性</li>
<li><code>@EqualsAndHashCode</code>：用在类上，自动生成equals方法和hashCode方法</li>
<li><code>@NoArgsConstructor, @RequiredArgsConstructor and @AllArgsConstructor</code>：用在类上，自动生成无参构造和使用所有参数的构造函数以及把所有@NonNull属性作为参数的构造函数，如果指定staticName &#x3D; “of”参数，同时还会生成一个返回类对象的静态工厂方法，比使用构造函数方便很多</li>
<li><code>@Data</code>：注解在类上，相当于同时使用了<code>@ToString</code>、<code>@EqualsAndHashCode</code>、<code>@Getter</code>、<code>@Setter</code>和<code>@RequiredArgsConstrutor</code>这些注解，对于<code>POJO类</code>十分有用</li>
<li><code>@Value</code>：用在类上，是@Data的不可变形式，相当于为属性添加final声明，只提供getter方法，而不提供setter方法</li>
<li><code>@Builder</code>：用在类、构造器、方法上，为你提供复杂的builder APIs，让你可以像如下方式一样调用<code>Person.builder().name(&quot;Adam Savage&quot;).city(&quot;San Francisco&quot;).job(&quot;Mythbusters&quot;).job(&quot;Unchained Reaction&quot;).build();</code>更多说明参考<a target="_blank" rel="noopener" href="https://projectlombok.org/features/Builder.html">Builder</a></li>
<li><code>@SneakyThrows</code>：自动抛受检异常，而无需显式在方法上使用throws语句</li>
<li><code>@Synchronized</code>：用在方法上，将方法声明为同步的，并自动加锁，而锁对象是一个私有的属性<code>$lock</code>或<code>$LOCK</code>，而java中的synchronized关键字锁对象是this，锁在this或者自己的类对象上存在副作用，就是你不能阻止非受控代码去锁this或者类对象，这可能会导致竞争条件或者其它线程错误</li>
<li><code>@Getter(lazy=true)</code>：可以替代经典的Double Check Lock样板代码</li>
<li><code>@Log</code>：根据不同的注解生成不同类型的log对象，但是实例名称都是log，有六种可选实现类<ul>
<li><code>@CommonsLog</code> Creates log &#x3D; org.apache.commons.logging.LogFactory.getLog(LogExample.class);</li>
<li><code>@Log</code> Creates log &#x3D; java.util.logging.Logger.getLogger(LogExample.class.getName());</li>
<li><code>@Log4j</code> Creates log &#x3D; org.apache.log4j.Logger.getLogger(LogExample.class);</li>
<li><code>@Log4j2</code> Creates log &#x3D; org.apache.logging.log4j.LogManager.getLogger(LogExample.class);</li>
<li><code>@Slf4j</code> Creates log &#x3D; org.slf4j.LoggerFactory.getLogger(LogExample.class);</li>
<li><code>@XSlf4j</code> Creates log &#x3D; org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class);</li>
</ul>
</li>
</ul>
<h3 id="Lombok使用示例"><a href="#Lombok使用示例" class="headerlink" title="Lombok使用示例"></a>Lombok使用示例</h3><ul>
<li>val示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">val</span> <span class="variable">sets</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">    <span class="type">val</span> <span class="variable">lists</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">    <span class="type">val</span> <span class="variable">maps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">    <span class="comment">//=&gt;相当于如下</span></span><br><span class="line">    <span class="keyword">final</span> Set&lt;String&gt; sets2 = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> List&lt;String&gt; lists2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> Map&lt;String, String&gt; maps2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@NonNull示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notNullExample</span><span class="params">(<span class="meta">@NonNull</span> String string)</span> &#123;</span><br><span class="line">    string.length();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=&gt;相当于</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notNullExample</span><span class="params">(String string)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (string != <span class="literal">null</span>) &#123;</span><br><span class="line">        string.length();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;null&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Cleanup示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="meta">@Cleanup</span> <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(args[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//=&gt;相当于</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        inputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(args[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Getter&#x2F;@Setter示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter(AccessLevel.PUBLIC)</span></span><br><span class="line"><span class="meta">@Getter(AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"><span class="keyword">private</span> String shap;</span><br></pre></td></tr></table></figure></li>
<li>@ToString示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString(exclude = &quot;id&quot;, callSuper = true, includeFieldNames = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//输出LombokDemo(super=LombokDemo@48524010, name=null, age=0)</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">LombokDemo</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@EqualsAndHashCode示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(exclude = &#123;&quot;id&quot;, &quot;shape&quot;&#125;, callSuper = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String shap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@NoArgsConstructor, @RequiredArgsConstructor and @AllArgsConstructor示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor(staticName = &quot;of&quot;)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String shap;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LombokDemo</span>(<span class="number">1</span>, <span class="string">&quot;circle&quot;</span>);</span><br><span class="line">        <span class="comment">//使用静态工厂方法</span></span><br><span class="line">        LombokDemo.of(<span class="number">2</span>, <span class="string">&quot;circle&quot;</span>);</span><br><span class="line">        <span class="comment">//无参构造</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LombokDemo</span>();</span><br><span class="line">        <span class="comment">//包含所有参数</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LombokDemo</span>(<span class="number">1</span>, <span class="string">&quot;circle&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Data示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menu</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String shopId;</span><br><span class="line">    <span class="keyword">private</span> String skuMenuId;</span><br><span class="line">    <span class="keyword">private</span> String skuName;</span><br><span class="line">    <span class="keyword">private</span> String normalizeSkuName;</span><br><span class="line">    <span class="keyword">private</span> String dishMenuId;</span><br><span class="line">    <span class="keyword">private</span> String dishName;</span><br><span class="line">    <span class="keyword">private</span> String dishNum;</span><br><span class="line">    <span class="comment">//默认阈值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">thresHold</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//新阈值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">newThresHold</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//总得分</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">totalScore</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在IntelliJ中按下Ctrl+F12就可以看到Lombok已经为我们自动生成了一系列的方法。<br><img src="https://raw.githubusercontent.com/shijiebei2009/img/master/blog/intellij_lombok_java_demo.jpg"></li>
<li>@Value示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LombokDemo</span> &#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String shap;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="comment">//相当于</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Builder示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="meta">@Singular</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; occupations;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BuilderExample</span> <span class="variable">test</span> <span class="operator">=</span> BuilderExample.builder().age(<span class="number">11</span>).name(<span class="string">&quot;test&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@SneakyThrows示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="meta">@SneakyThrows()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedEncodingException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//相当于</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedEncodingException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Synchronized示例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedDemo</span> &#123;</span><br><span class="line">    <span class="meta">@Synchronized</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//相当于</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">$LOCK</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> ($LOCK) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>@Getter(lazy &#x3D; true)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetterLazyExample</span> &#123;</span><br><span class="line">    <span class="meta">@Getter(lazy = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span>[] cached = expensive();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span>[] expensive() &#123;</span><br><span class="line">        <span class="type">double</span>[] result = <span class="keyword">new</span> <span class="title class_">double</span>[<span class="number">1000000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">            result[i] = Math.asin(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
相当于如下所示<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetterLazyExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicReference&lt;java.lang.Object&gt; cached = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span>[] getCached() &#123;</span><br><span class="line">        java.lang.<span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">this</span>.cached.get();</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>.cached) &#123;</span><br><span class="line">                value = <span class="built_in">this</span>.cached.get();</span><br><span class="line">                <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">double</span>[] actualValue = expensive();</span><br><span class="line">                    value = actualValue == <span class="literal">null</span> ? <span class="built_in">this</span>.cached : actualValue;</span><br><span class="line">                    <span class="built_in">this</span>.cached.set(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>[]) (value == <span class="built_in">this</span>.cached ? <span class="literal">null</span> : value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span>[] expensive() &#123;</span><br><span class="line">        <span class="type">double</span>[] result = <span class="keyword">new</span> <span class="title class_">double</span>[<span class="number">1000000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">            result[i] = Math.asin(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/07/13/Python3-beginner-s-handbook-four/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/07/13/Python3-beginner-s-handbook-four/" class="post-title-link" itemprop="url">Python3入门手册之四</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-13 23:02:03" itemprop="dateCreated datePublished" datetime="2015-07-13T23:02:03+08:00">2015-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:24:42" itemprop="dateModified" datetime="2024-01-24T10:24:42+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming-Notes/" itemprop="url" rel="index"><span itemprop="name">Programming Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>Version：Python 3.4.3 (v3.4.3:9b73f1c3e601, Feb 24 2015, 22:44:40) [MSC v.1600 64 bit (AMD64)] on win32</em></p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="可接受任意数量参数的函数"><a href="#可接受任意数量参数的函数" class="headerlink" title="可接受任意数量参数的函数"></a>可接受任意数量参数的函数</h4><p>为了能让一个函数接受任意数量的位置参数，可以使用一个<code>*参数</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">avg</span>(<span class="params">first, *rest</span>):</span><br><span class="line">    <span class="keyword">return</span> (first + <span class="built_in">sum</span>(rest)) / (<span class="number">1</span> + <span class="built_in">len</span>(rest))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample use</span></span><br><span class="line">avg(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># 1.5</span></span><br><span class="line">avg(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) <span class="comment"># 2.5</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>rest</code>是由所有其他位置参数组成的元组。然后我们在代码中把它当成了一个序列来进行后续的计算。</p>
<p>使用一个以<code>**开头的参数</code>来表示接受任意数量的关键字参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_element</span>(<span class="params">name, value, **attrs</span>):</span><br><span class="line">    keyvals = [<span class="string">&#x27; %s=&quot;%s&quot;&#x27;</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> attrs.items()]</span><br><span class="line">    attr_str = <span class="string">&#x27;&#x27;</span>.join(keyvals)</span><br><span class="line">    element = <span class="string">&#x27;&lt;&#123;name&#125;&#123;attrs&#125;&gt;&#123;value&#125;&lt;/&#123;name&#125;&gt;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        name=name,</span><br><span class="line">        attrs=attr_str,</span><br><span class="line">        value=html.escape(value))</span><br><span class="line">    <span class="keyword">return</span> element</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="comment"># Creates &#x27;&lt;item size=&quot;large&quot; quantity=&quot;6&quot;&gt;Albatross&lt;/item&gt;&#x27;</span></span><br><span class="line">res = make_element(<span class="string">&#x27;item&#x27;</span>, <span class="string">&#x27;Albatross&#x27;</span>, size=<span class="string">&#x27;large&#x27;</span>, quantity=<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creates &#x27;&lt;p&gt;&lt;spam&gt;&lt;/p&gt;&#x27;</span></span><br><span class="line">res = make_element(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;&lt;spam&gt;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>
<p>在这里，<code>attrs</code>是一个包含所有被传入进来的关键字参数的字典。</p>
<p>如果你还希望某个函数能同时接受任意数量的位置参数和关键字参数，可以同时使用<code>*和**</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">anyargs</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(args)  <span class="comment"># A tuple  Prints (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;)</span></span><br><span class="line">    <span class="built_in">print</span>(kwargs)  <span class="comment"># A dict  Prints&#123;&#x27;key1&#x27;: &#x27;1&#x27;, &#x27;key2&#x27;: &#x27;2&#x27;&#125;</span></span><br><span class="line">anyargs(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, key1=<span class="string">&#x27;1&#x27;</span>, key2=<span class="string">&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>使用这个函数时，所有位置参数会被放到<code>args元组</code>中，所有关键字参数会被放到<code>字典kwargs</code>中。<br>一个<code>*参数</code>只能出现在函数定义中最后一个位置参数后面，而 <code>**参数</code>只能出现在最后一个参数。 有一点要注意的是，在<code>*参数</code>后面仍然可以定义其他参数。</p>
<h4 id="只接受关键字参数的函数"><a href="#只接受关键字参数的函数" class="headerlink" title="只接受关键字参数的函数"></a>只接受关键字参数的函数</h4><p>利用这种技术，我们还能在接受任意多个位置参数的函数中指定关键字参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mininum</span>(<span class="params">*values, clip=<span class="literal">None</span></span>):</span><br><span class="line">    m = <span class="built_in">min</span>(values)</span><br><span class="line">    <span class="keyword">if</span> clip <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        m = clip <span class="keyword">if</span> clip &gt; m <span class="keyword">else</span> m</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">minimum(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, -<span class="number">5</span>, <span class="number">10</span>) <span class="comment"># Returns -5</span></span><br><span class="line">minimum(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, -<span class="number">5</span>, <span class="number">10</span>, clip=<span class="number">0</span>) <span class="comment"># Returns 0&lt;/pre&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="返回多个值的函数"><a href="#返回多个值的函数" class="headerlink" title="返回多个值的函数"></a>返回多个值的函数</h4><p>为了能返回多个值，函数直接return一个元组就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">myfun</span>():</span><br><span class="line"><span class="meta">... </span><span class="keyword">return</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, c = myfun()</span><br><span class="line">````</span><br><span class="line">尽管`myfun()`看上去返回了多个值，实际上是先创建了一个元组然后返回的。这个语法看上去比较奇怪，实际上我们使用的是逗号来生成一个元组，而不是用括号。</span><br><span class="line">```python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = (<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># With parentheses</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">1</span>, <span class="number">2</span> <span class="comment"># Without parentheses</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h4 id="定义有默认参数的函数"><a href="#定义有默认参数的函数" class="headerlink" title="定义有默认参数的函数"></a>定义有默认参数的函数</h4><p>定义一个有可选参数的函数是非常简单的，直接在函数定义中给参数指定一个默认值，并放到参数列表最后就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=<span class="number">42</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b)</span><br><span class="line"></span><br><span class="line">spam(<span class="number">1</span>) <span class="comment"># Ok. a=1, b=42</span></span><br><span class="line">spam(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># Ok. a=1, b=2</span></span><br></pre></td></tr></table></figure>
<p>如果默认参数是一个可修改的容器比如一个列表、集合或者字典，可以使用None作为默认值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Using a list as a default value</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> b <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        b = []</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>有一点是值得注意的，默认参数的值仅仅在函数定义的时候赋值一次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">42</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=x</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(a, b)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam(<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">42</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">23</span> <span class="comment"># Has no effect</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam(<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">42</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>注意到当我们改变<code>x</code>的值的时候对默认参数值并没有影响，这是因为在函数定义的时候就已经确定了它的默认值了。</p>
<p>其次，默认参数的值应该是不可变的对象，比如<code>None、True、False、</code>数字或字符串。 特别的，千万不要像下面这样写代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=[]</span>): <span class="comment"># NO!</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>如果你这么做了，当默认值在其他地方被修改后你将会遇到各种麻烦。这些修改会影响到下次调用这个函数时的默认值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=[]</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(b)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> b</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = spam(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x.append(<span class="number">99</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x.append(<span class="string">&#x27;Yow!&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line">[<span class="number">99</span>, <span class="string">&#x27;Yow!&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam(<span class="number">1</span>) <span class="comment"># Modified list gets returned!</span></span><br><span class="line">[<span class="number">99</span>, <span class="string">&#x27;Yow!&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>这种结果应该不是你想要的。为了避免这种情况的发生，最好是将默认值设为<code>None</code>， 然后在函数里面检查它，前面的例子就是这样做的。</p>
<p>在测试<code>None</code>值时使用<code>is</code>操作符是很重要的，也是这种方案的关键点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> b: <span class="comment"># NO! Use &#x27;b is None&#x27; instead</span></span><br><span class="line">        b = []</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="定义匿名或内联函数"><a href="#定义匿名或内联函数" class="headerlink" title="定义匿名或内联函数"></a>定义匿名或内联函数</h4><p>当一些函数很简单，仅仅只是计算一个表达式的值的时候，就可以使用<code>lambda</code>表达式来代替了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>add = <span class="keyword">lambda</span> x, y: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>lambda</code>表达式典型的使用场景是排序或数据<code>reduce</code>等：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>names = [<span class="string">&#x27;David Beazley&#x27;</span>, <span class="string">&#x27;Brian Jones&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>        <span class="string">&#x27;Raymond Hettinger&#x27;</span>, <span class="string">&#x27;Ned Batchelder&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>(names, key=<span class="keyword">lambda</span> name: name.split()[-<span class="number">1</span>].lower())</span><br><span class="line">[<span class="string">&#x27;Ned Batchelder&#x27;</span>, <span class="string">&#x27;David Beazley&#x27;</span>, <span class="string">&#x27;Raymond Hettinger&#x27;</span>, <span class="string">&#x27;Brian Jones&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>有一点要注意的是，<code>lambda</code>表达式中的变量x是自由变量，在运行时绑定值，而不是定义时就绑定，这跟函数的默认值参数定义是不同的。而如果你想让某个匿名函数在定义时就捕获到值，可以将那个参数值定义成默认参数即可，类似如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="keyword">lambda</span> y, x=x: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="keyword">lambda</span> y, x=x: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a(<span class="number">10</span>)</span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>如果你不设定为默认参数的话，运行如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="keyword">lambda</span> y: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="keyword">lambda</span> y: x + y</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<p><strong>Notes</strong><br>在这里列出来的问题是新手很容易犯的错误，有些新手可能会不恰当的<code>lambda</code>表达式。 比如，通过在一个循环或列表推导中创建一个<code>lambda</code>表达式列表，并期望函数能在定义时就记住每次的迭代值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>funcs = [<span class="keyword">lambda</span> x: x+n <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> f <span class="keyword">in</span> funcs:</span><br><span class="line"><span class="meta">... </span><span class="built_in">print</span>(f(<span class="number">0</span>))</span><br><span class="line">...</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>但是实际效果是运行是n的值为迭代的最后一个值。现在我们用另一种方式修改一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>funcs = [<span class="keyword">lambda</span> x, n=n: x+n <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> f <span class="keyword">in</span> funcs:</span><br><span class="line"><span class="meta">... </span><span class="built_in">print</span>(f(<span class="number">0</span>))</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>通过使用函数默认值参数形式，<code>lambda</code>函数在定义时就能绑定到值。</p>
<h4 id="减少可调用对象的参数个数"><a href="#减少可调用对象的参数个数" class="headerlink" title="减少可调用对象的参数个数"></a>减少可调用对象的参数个数</h4><p>如果需要减少某个函数的参数个数，你可以使用<code>functools.partial()</code>。<code>partial()</code>允许你给一个或多个参数设置固定的值，减少接下来被调用时的参数个数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">a, b, c, d</span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b, c, d)</span><br><span class="line">spam(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  <span class="comment"># Prints 1 2 3 4</span></span><br><span class="line">s1 = partial(spam, <span class="number">1</span>)  <span class="comment"># a = 1</span></span><br><span class="line">s1(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br><span class="line">s2 = partial(spam, <span class="number">3</span>, <span class="number">4</span>, d=<span class="number">12</span>)  <span class="comment"># a=3,b=4,d=12</span></span><br><span class="line">s2(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以看出<code>partial()</code>固定某些参数并返回一个新的<code>callable</code>对象。这个新的<code>callable</code>接受未赋值的参数，然后跟之前已经赋值过的参数合并起来，最后将所有参数传递给原始函数。</p>
<p>假设你有一个点的列表来表示<code>(x,y)</code>坐标元组。你可以使用下面的函数来计算两点之间的距离：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">points = [ (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">5</span>, <span class="number">6</span>), (<span class="number">7</span>, <span class="number">8</span>) ]</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">distance</span>(<span class="params">p1, p2</span>):</span><br><span class="line">    x1, y1 = p1</span><br><span class="line">    x2, y2 = p2</span><br><span class="line">    <span class="keyword">return</span> math.hypot(x2 - x1, y2 - y1)</span><br></pre></td></tr></table></figure>
<p>现在假设你想以某个点为基点，根据点和基点之间的距离来排序所有的这些点。列表的<code>sort()</code>方法接受一个关键字参数来自定义排序逻辑，但是它只能接受一个单个参数的函数(<code>distance()</code>很明显是不符合条件的)。现在我们可以通过使用<code>partial()</code>来解决这个问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pt = (<span class="number">4</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>points.sort(key=partial(distance,pt))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>points</span><br><span class="line">[(<span class="number">3</span>, <span class="number">4</span>), (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">5</span>, <span class="number">6</span>), (<span class="number">7</span>, <span class="number">8</span>)]</span><br></pre></td></tr></table></figure>
<p>更进一步，<code>partial()</code> 通常被用来微调其他库函数所使用的回调函数的参数。 例如，下面是一段代码，使用 <code>multiprocessing</code> 来异步计算一个结果值， 然后这个值被传递给一个接受一个<code>result</code>值和一个可选<code>logging</code>参数的回调函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">output_result</span>(<span class="params">result, log=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> log <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        log.debug(<span class="string">&#x27;Got: %r&#x27;</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A sample function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> logging</span><br><span class="line">    <span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">    logging.basicConfig(level=logging.DEBUG)</span><br><span class="line">    log = logging.getLogger(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p = Pool()</span><br><span class="line">    p.apply_async(add, (<span class="number">3</span>, <span class="number">4</span>), callback=partial(output_result, log=log))</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br></pre></td></tr></table></figure>
<h3 id="类与对象"><a href="#类与对象" class="headerlink" title="类与对象"></a>类与对象</h3><h4 id="改变对象的字符串显示"><a href="#改变对象的字符串显示" class="headerlink" title="改变对象的字符串显示"></a>改变对象的字符串显示</h4><p>要改变一个实例的字符串表示，可重新定义它的<code>__str__()</code>和<code>__repr__()</code>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Pair(&#123;0.x!r&#125;, &#123;0.y!r&#125;)&#x27;</span>.<span class="built_in">format</span>(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;(&#123;0.x!s&#125;, &#123;0.y!s&#125;)&#x27;</span>.<span class="built_in">format</span>(self)</span><br></pre></td></tr></table></figure>
<p><code>__repr__()</code>方法返回一个实例的代码表示形式，通常用来重新构造这个实例。内置的<code>repr()</code>函数返回这个字符串，跟我们使用交互式解释器显示的值是一样的。<code>__str__()</code>方法将实例转换为一个字符串，使用<code>str()</code>或<code>print()</code>函数会输出这个字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Pair(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p</span><br><span class="line">Pair(<span class="number">3</span>, <span class="number">4</span>) <span class="comment"># __repr__() output</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(p)</span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>) <span class="comment"># __str__() output</span></span><br></pre></td></tr></table></figure>
<p><code>!r</code>格式化代码指明输出使用<code>__repr__()</code>来代替默认的<code>__str__()</code>。你还可以做如下的测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Pair(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;p is &#123;0!r&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">p <span class="keyword">is</span> Pair(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;p is &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">p <span class="keyword">is</span> (<span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>定义<code>__repr__()</code>和<code>__str__()</code>通常是很好的习惯，因为它能简化调试和实例输出。例如，如果仅仅只是打印输出或日志输出某个实例，那么程序员会看到实例更加详细与有用的信息。<br><code>__repr__()</code>生成的文本字符串标准做法是需要让<code>eval(repr(x)) == x</code>为真。如果实在不能这样子做，应该创建一个有用的文本表示，并使用&lt;和&gt;括起来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="built_in">open</span>(<span class="string">&#x27;file.dat&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f</span><br><span class="line">&lt;_io.TextIOWrapper name=<span class="string">&#x27;file.dat&#x27;</span> mode=<span class="string">&#x27;r&#x27;</span> encoding=<span class="string">&#x27;UTF-8&#x27;</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>如果<code>__str__()</code>没有被定义，那么就会使用<code>__repr__()</code>来代替输出。上面的<code>format()</code>方法的使用看上去很有趣，格式化代码<code>&#123;0.x&#125;</code>对应的是第1个参数的x属性。因此，在下面的函数中，0实际上指的就是<code>self</code>本身：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Pair(&#123;0.x!r&#125;, &#123;0.y!r&#125;)&#x27;</span>.<span class="built_in">format</span>(self)</span><br></pre></td></tr></table></figure>
<p>作为这种实现的一个替代，你也可以使用<code>%</code>操作符，就像下面这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Pair(%r, %r)&#x27;</span> % (self.x, self.y)</span><br></pre></td></tr></table></figure>
<h4 id="让对象支持上下文管理协议"><a href="#让对象支持上下文管理协议" class="headerlink" title="让对象支持上下文管理协议"></a>让对象支持上下文管理协议</h4><p>为了让一个对象兼容<code>with</code>语句，你需要实现<code>__enter()__</code>和<code>__exit__()</code>方法。例如，考虑如下的一个类，它能为我们创建一个网络连接：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket, AF_INET, SOCK_STREAM</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazyConnection</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address, family=AF_INET, <span class="built_in">type</span>=SOCK_STREAM</span>):</span><br><span class="line">        self.address = address</span><br><span class="line">        self.family = family</span><br><span class="line">        self.<span class="built_in">type</span> = <span class="built_in">type</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.sock <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Already connected&#x27;</span>)</span><br><span class="line">        self.sock = socket(self.family, self.<span class="built_in">type</span>)</span><br><span class="line">        self.sock.connect(self.address)</span><br><span class="line">        <span class="keyword">return</span> self.sock</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_ty, exc_val, tb</span>):</span><br><span class="line">        self.sock.close()</span><br><span class="line">        self.sock = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p>这个类的关键特点在于它表示了一个网络连接，但是初始化的时候并不会做任何事情(比如它并没有建立一个连接)。连接的建立和关闭是使用<code>with</code>语句自动完成的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">conn = LazyConnection((<span class="string">&#x27;www.python.org&#x27;</span>, <span class="number">80</span>))</span><br><span class="line"><span class="comment"># Connection closed</span></span><br><span class="line"><span class="keyword">with</span> conn <span class="keyword">as</span> s:</span><br><span class="line">    <span class="comment"># conn.__enter__() executes: connection open</span></span><br><span class="line">    s.send(<span class="string">b&#x27;GET /index.html HTTP/1.0\r\n&#x27;</span>)</span><br><span class="line">    s.send(<span class="string">b&#x27;Host: www.python.org\r\n&#x27;</span>)</span><br><span class="line">    s.send(<span class="string">b&#x27;\r\n&#x27;</span>)</span><br><span class="line">    resp = <span class="string">b&#x27;&#x27;</span>.join(<span class="built_in">iter</span>(partial(s.recv, <span class="number">8192</span>), <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line">    <span class="comment"># conn.__exit__() executes: connection closed</span></span><br></pre></td></tr></table></figure>
<p>编写上下文管理器的主要原理是你的代码会放到<code>with</code>语句块中执行。当出现<code>with</code>语句的时候，对象的<code>__enter__()</code>方法被触发，它返回的值(如果有的话)会被赋值给<code>as</code>声明的变量。然后，<code>with</code>语句块里面的代码开始执行。最后，<code>__exit__()</code>方法被触发进行清理工作。</p>
<p>不管<code>with</code>代码块中发生什么，上面的控制流都会执行完，就算代码块中发生了异常也是一样的。事实上，<code>__exit__()</code>方法的第三个参数包含了异常类型、异常值和追溯信息(如果有的话)。<code>__exit__()</code>方法能自己决定怎样利用这个异常信息，或者忽略它并返回一个None值。如果<code>__exit__()</code>返回<code>True</code>，那么异常会被清空，就好像什么都没发生一样，<code>with</code>语句后面的程序继续在正常执行。</p>
<p>如果你想要获得嵌套<code>with</code>语句的效果，代码需要如下修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket, AF_INET, SOCK_STREAM</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LazyConnection</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address, family=AF_INET, <span class="built_in">type</span>=SOCK_STREAM</span>):</span><br><span class="line">        self.address = address</span><br><span class="line">        self.family = family</span><br><span class="line">        self.<span class="built_in">type</span> = <span class="built_in">type</span></span><br><span class="line">        self.connections = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        sock = socket(self.family, self.<span class="built_in">type</span>)</span><br><span class="line">        sock.connect(self.address)</span><br><span class="line">        self.connections.append(sock)</span><br><span class="line">        <span class="keyword">return</span> sock</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_ty, exc_val, tb</span>):</span><br><span class="line">        self.connections.pop().close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example use</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">conn = LazyConnection((<span class="string">&#x27;www.python.org&#x27;</span>, <span class="number">80</span>))</span><br><span class="line"><span class="keyword">with</span> conn <span class="keyword">as</span> s1:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">with</span> conn <span class="keyword">as</span> s2:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        <span class="comment"># s1 and s2 are independent sockets</span></span><br></pre></td></tr></table></figure>
<p>在第二个版本中，<code>LazyConnection</code>类可以被看做是某个连接工厂。在内部，一个列表被用来构造一个栈。每次<code>__enter__()</code>方法执行的时候，它复制创建一个新的连接并将其加入到栈里面。<code>__exit__()</code>方法简单的从栈中弹出最后一个连接并关闭它。这里稍微有点难理解，不过它能允许嵌套使用<code>with</code>语句创建多个连接。</p>
<p>在需要管理一些资源比如文件、网络连接和锁的编程环境中，使用上下文管理器是很普遍的。这些资源的一个主要特征是它们必须被手动的关闭或释放来确保程序的正确运行。例如，如果你请求了一个锁，那么你必须确保之后释放了它，否则就可能产生死锁。通过实现<code>__enter__()</code>和<code>__exit__()</code>方法并使用<code>with</code>语句可以很容易的避免这些问题，因为<code>__exit__()</code>方法可以让你无需担心这些了。</p>
<h4 id="创建大量对象时节省内存方法"><a href="#创建大量对象时节省内存方法" class="headerlink" title="创建大量对象时节省内存方法"></a>创建大量对象时节省内存方法</h4><p>对于主要是用来当成简单的数据结构的类而言，你可以通过给类添加<code>__slots__</code>属性来极大的减少实例所占的内存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>:</span><br><span class="line">    __slots__ = [<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;day&#x27;</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, year, month, day</span>):</span><br><span class="line">        self.year = year</span><br><span class="line">        self.month = month</span><br><span class="line">        self.day = day</span><br></pre></td></tr></table></figure>

<p>当你定义<code>__slots__</code>后，Python就会为实例使用一种更加紧凑的内部表示。实例通过一个很小的固定大小的数组来构建，而不是为每个实例定义一个字典，这跟元组或列表很类似。在<code>__slots__</code>中列出的属性名在内部被映射到这个数组的指定小标上。使用<code>slots</code>一个不好的地方就是我们不能再给实例添加新的属性了，只能使用在<code>__slots__</code>中定义的那些属性名。</p>
<h4 id="在类中封装属性名"><a href="#在类中封装属性名" class="headerlink" title="在类中封装属性名"></a>在类中封装属性名</h4><p><code>Python</code>程序员不去依赖语言特性去封装数据，而是通过遵循一定的属性和方法命名规约来达到这个效果。第一个约定是任何以单下划线<code>_</code>开头的名字都应该是内部实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._internal = <span class="number">0</span> <span class="comment"># An internal attribute</span></span><br><span class="line">        self.public = <span class="number">1</span> <span class="comment"># A public attribute</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">public_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        A public method</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_internal_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><code>Python</code>并不会真的阻止别人访问内部名称。但是如果你这么做肯定是不好的，可能会导致脆弱的代码。同时还要注意到，使用下划线开头的约定同样适用于模块名和模块级别函数。例如，如果你看到某个模块名以单下划线开头(比如<code>_socket</code>)，那它就是内部实现。类似的，模块级别函数比如<code>sys._getframe()</code>在使用的时候就得加倍小心了。</p>
<p>使用双下划线开始会导致访问名称变成其他形式。比如，在前面的类B中，私有属性会被分别重命名为<code>_B__private</code>和<code>_B__private_method</code>。这时候你可能会问这样重命名的目的是什么，答案就是继承——这种属性通过继承是无法被覆盖的。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">B</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.__private = <span class="number">1</span> <span class="comment"># Does not override B.__private</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Does not override B.__private_method()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__private_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>这里，私有名称<code>__private</code>和<code>__private_method</code>被重命名为<code>_C__private</code>和<code>_C__private_method</code>，这个跟父类B中的名称是完全不同的。</p>
<p>通常的，如果定义的变量与保留关键字冲突，那么可以单划线作为后缀。一般的以单划线开头定义变量即可，如果你清楚你的代码会涉及到子类，那么推荐是用双下划线方案。</p>
<h4 id="创建可管理的属性"><a href="#创建可管理的属性" class="headerlink" title="创建可管理的属性"></a>创建可管理的属性</h4><p>自定义某个属性的一种简单方法是将它定义为一个<code>property</code>。例如，下面的代码定义了一个<code>property</code>，增加对一个属性简单的类型检查：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first_name</span>):</span><br><span class="line">        self.first_name = first_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Getter function</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._first_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Setter function</span></span><br><span class="line"><span class="meta">    @first_name.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">first_name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">        self._first_name = value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Deleter function (optional)</span></span><br><span class="line"><span class="meta">    @first_name.deleter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;Can&#x27;t delete attribute&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>上述代码中有三个相关联的方法，这三个方法的名字都必须一样。第一个方法是一个<code>getter</code>函数，它使得<code>first_name</code>成为一个属性。其他两个方法给<code>first_name</code>属性添加了<code>setter</code>和<code>deleter</code>函数。需要强调的是只有在<code>first_name</code>属性被创建后，后面的两个装饰器<code>@first_name.setter</code>和<code>@first_name.deleter</code>才能被定义。</p>
<p><code>property</code>的一个关键特征是它看上去跟普通的<code>attribute</code>没什么两样，但是访问它的时候会自动触发<code>getter</code>、<code>setter</code>和<code>deleter</code>方法。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = Person(<span class="string">&#x27;Guido&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.first_name <span class="comment"># Calls the getter</span></span><br><span class="line"><span class="string">&#x27;Guido&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.first_name = <span class="number">42</span> <span class="comment"># Calls the setter</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    File <span class="string">&quot;prop.py&quot;</span>, line <span class="number">14</span>, <span class="keyword">in</span> first_name</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">TypeError: Expected a string</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> a.first_name</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: can<span class="string">&#x27;t delete attribute</span></span><br></pre></td></tr></table></figure>
<p>在实现一个<code>property</code>时候，底层数据(如果有的话)仍然需要存储在某个地方。因此，在get和set方法中，你会看到对<code>_first_name</code>属性的操作，这也是实际数据保存的地方。另外，你可能还会问为什么<code>__init__()</code>方法中设置了<code>self.first_name</code>而不是<code>self._first_name</code>。在这个例子中，我们创建一个<code>property</code>的目的就是在设置<code>attribute</code>的时候进行检查。因此，你可能想在初始化的时候也进行这种类型检查。通过设置<code>self.first_name</code>，自动调用<code>setter</code>方法，这个方法里面会进行参数的检查，否则就是直接访问<code>self._first_name</code>了。</p>
<p>还能在已存在的<code>get</code>和<code>set</code>方法基础上定义<code>property</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first_name</span>):</span><br><span class="line">        self.set_first_name(first_name)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Getter function</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._first_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Setter function</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_first_name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">        self._first_name = value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Deleter function (optional)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">del_first_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;Can&#x27;t delete attribute&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Make a property from existing get/set methods</span></span><br><span class="line">    name = <span class="built_in">property</span>(get_first_name, set_first_name, del_first_name)</span><br></pre></td></tr></table></figure>
<h4 id="调用父类方法"><a href="#调用父类方法" class="headerlink" title="调用父类方法"></a>调用父类方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;A.spam&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spam</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;B.spam&#x27;</span>)</span><br><span class="line">        <span class="built_in">super</span>().spam()  <span class="comment"># Call parent spam()</span></span><br></pre></td></tr></table></figure>

<p><code>super()</code>函数的一个常见用法是在<code>__init__()</code>方法中确保父类被正确的初始化了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.x = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.y = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="定义接口或者抽象基类"><a href="#定义接口或者抽象基类" class="headerlink" title="定义接口或者抽象基类"></a>定义接口或者抽象基类</h4><p>使用<code>abs</code>模块可以很轻松的定义抽象基类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IStream</span>(metaclass=ABCMeta):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self, maxbytes=-<span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>抽象类的一个特点是它不能直接被实例化，比如你想像下面这样做是不行的:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = IStream() <span class="comment"># TypeError: Can&#x27;t instantiate abstract class</span></span><br><span class="line">                <span class="comment"># IStream with abstract methods read, write</span></span><br></pre></td></tr></table></figure>
<p>抽象类的目的就是让别的类继承它并实现特定的抽象方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SocketStream</span>(<span class="title class_ inherited__">IStream</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self, maxbytes=-<span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>抽象基类的一个主要用途是在代码中检查某些类是否为特定类型，实现了特定接口：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">serialize</span>(<span class="params">obj, stream</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(stream, IStream):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected an IStream&#x27;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>除了继承这种方式外，还可以通过注册方式来让某个类实现抽象基类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register the built-in I/O classes as supporting our interface</span></span><br><span class="line">IStream.register(io.IOBase)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Open a normal file and type check</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;foo.txt&#x27;</span>)</span><br><span class="line"><span class="built_in">isinstance</span>(f, IStream) <span class="comment"># Returns True</span></span><br></pre></td></tr></table></figure>
<p><code>@abstractmethod</code>还能注解静态方法、类方法和<code>properties</code>。你只需保证这个注解紧靠在函数定义前即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(metaclass=ABCMeta):</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @name.setter</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method1</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method2</span>():</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>标准库中有很多用到抽象基类的地方。<code>collections</code>模块定义了很多跟容器和迭代器(序列、映射、集合等)有关的抽象基类。<code>numbers</code>库定义了跟数字对象(整数、浮点数、有理数等)有关的基类。<code>io</code>库定义了很多跟<code>I/O</code>操作相关的基类。</p>
<p>你可以使用预定义的抽象类来执行更通用的类型检查，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x is a sequence</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.<span class="type">Sequence</span>):</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x is iterable</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.Iterable):</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x has a size</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.Sized):</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if x is a mapping</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(x, collections.Mapping):</span><br></pre></td></tr></table></figure>
<p>尽管<code>ABCs</code>可以让我们很方便的做类型检查，但是我们在代码中最好不要过多的使用它。因为<code>Python</code>的本质是一门动态编程语言，其目的就是给你更多灵活性，强制类型检查或让你代码变得更复杂，这样做无异于舍本求末。</p>
<h4 id="实现自定义容器"><a href="#实现自定义容器" class="headerlink" title="实现自定义容器"></a>实现自定义容器</h4><p><code>collections</code>定义了很多抽象基类，当你想自定义容器类的时候它们会非常有用。比如你想让你的类支持迭代，那就让你的类继承<code>collections.Iterable</code>即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(collections.Iterable):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>不过你需要实现<code>collections.Iterable</code>所有的抽象方法，否则会报错:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = A()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: Can<span class="string">&#x27;t instantiate abstract class A with abstract methods __iter__</span></span><br></pre></td></tr></table></figure>
<p><code>collections</code>中很多抽象类会为一些常见容器操作提供默认的实现，这样一来你只需要实现那些你最感兴趣的方法即可。假设你的类继承自<code>collections.MutableSequence</code>，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Items</span>(collections.MutableSequence):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, initial=<span class="literal">None</span></span>):</span><br><span class="line">        self._items = <span class="built_in">list</span>(initial) <span class="keyword">if</span> initial <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Required sequence methods</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Getting:&#x27;</span>, index)</span><br><span class="line">        <span class="keyword">return</span> self._items[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, index, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Setting:&#x27;</span>, index, value)</span><br><span class="line">        self._items[index] = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Deleting:&#x27;</span>, index)</span><br><span class="line">        <span class="keyword">del</span> self._items[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">self, index, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Inserting:&#x27;</span>, index, value)</span><br><span class="line">        self._items.insert(index, value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Len&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self._items)</span><br></pre></td></tr></table></figure>
<h4 id="在类中定义多个构造器"><a href="#在类中定义多个构造器" class="headerlink" title="在类中定义多个构造器"></a>在类中定义多个构造器</h4><p>为了实现多个构造器，你需要使用到类方法。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;方法一：使用类方法&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Primary constructor</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, year, month, day</span>):</span><br><span class="line">        self.year = year</span><br><span class="line">        self.month = month</span><br><span class="line">        self.day = day</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Alternate constructor</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">today</span>(<span class="params">cls</span>):</span><br><span class="line">        t = time.localtime()</span><br><span class="line">        <span class="keyword">return</span> cls(t.tm_year, t.tm_mon, t.tm_mday)</span><br></pre></td></tr></table></figure>
<p>直接调用类方法即可，下面是使用示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = Date(<span class="number">2012</span>, <span class="number">12</span>, <span class="number">21</span>) <span class="comment"># Primary</span></span><br><span class="line">b = Date.today() <span class="comment"># Alternate</span></span><br></pre></td></tr></table></figure>
<p>类方法的一个主要用途就是定义多个构造器。它接受一个<code>class</code>作为第一个参数<code>(cls)</code>。你应该注意到了这个类被用来创建并返回最终的实例。在继承时也能工作的很好：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewDate</span>(<span class="title class_ inherited__">Date</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">c = Date.today() <span class="comment"># Creates an instance of Date (cls=Date)</span></span><br><span class="line">d = NewDate.today() <span class="comment"># Creates an instance of NewDate (cls=NewDate)</span></span><br></pre></td></tr></table></figure>
<h4 id="创建不调用init方法的实例"><a href="#创建不调用init方法的实例" class="headerlink" title="创建不调用init方法的实例"></a>创建不调用init方法的实例</h4><p>可以通过<code>__new__()</code>方法创建一个未初始化的实例。例如考虑如下这个类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, year, month, day</span>):</span><br><span class="line">        self.year = year</span><br><span class="line">        self.month = month</span><br><span class="line">        self.day = day</span><br></pre></td></tr></table></figure>
<p>下面演示如何不调用<code>__init__()</code>方法来创建这个Date实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = Date.__new__(Date)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&lt;__main__.Date <span class="built_in">object</span> at <span class="number">0x1006716d0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.year</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;Date&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;year&#x27;</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>结果可以看到，这个<code>Date</code>实例的属性<code>year</code>还不存在，所以你需要手动初始化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">&#x27;year&#x27;</span>:<span class="number">2012</span>, <span class="string">&#x27;month&#x27;</span>:<span class="number">8</span>, <span class="string">&#x27;day&#x27;</span>:<span class="number">29</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key, value <span class="keyword">in</span> data.items():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">setattr</span>(d, key, value)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.year</span><br><span class="line"><span class="number">2012</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.month</span><br><span class="line"><span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="实现状态对象或者状态机"><a href="#实现状态对象或者状态机" class="headerlink" title="实现状态对象或者状态机"></a>实现状态对象或者状态机</h4><p>你想实现一个状态机或者是在不同状态下执行操作的对象，但是又不想在代码中出现太多的条件判断语句。那么如下是最好的实现方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Connection1</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;新方案——对每个状态定义一个类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.new_state(ClosedConnectionState)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_state</span>(<span class="params">self, newstate</span>):</span><br><span class="line">        self._state = newstate</span><br><span class="line">        <span class="comment"># Delegate to the state class</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.read(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.write(self, data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.<span class="built_in">open</span>(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._state.close(self)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Connection state base class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectionState</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">conn, data</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Implementation of different states</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClosedConnectionState</span>(<span class="title class_ inherited__">ConnectionState</span>):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Not open&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">conn, data</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Not open&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">conn</span>):</span><br><span class="line">        conn.new_state(OpenConnectionState)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Already closed&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenConnectionState</span>(<span class="title class_ inherited__">ConnectionState</span>):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;reading&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">conn, data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;writing&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open</span>(<span class="params">conn</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Already open&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">conn</span>):</span><br><span class="line">        conn.new_state(ClosedConnectionState)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = Connection1()</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.<span class="built_in">open</span>()</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.read()</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.write(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(c._state)</span><br><span class="line">c.close()</span><br><span class="line"><span class="built_in">print</span>(c._state)<span class="comment">#### 通过字符串调用对象方法</span></span><br></pre></td></tr></table></figure>
<h4 id="让类支持比较操作"><a href="#让类支持比较操作" class="headerlink" title="让类支持比较操作"></a>让类支持比较操作</h4><p>Python类对每个比较操作都需要实现一个特殊方法来支持。例如为了支持&gt;&#x3D;操作符，你需要定义一个<code>__ge__()</code>方法。尽管定义一个方法没什么问题，但如果要你实现所有可能的比较方法那就有点烦人了。</p>
<p>装饰器<code>functools.total_ordering</code>就是用来简化这个处理的。使用它来装饰一个来，你只需定义一个<code>__eq__()</code>方法，外加其他方法<code>(__lt__, __le__, __gt__, or __ge__)</code>中的一个即可。然后装饰器会自动为你填充其它比较方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> total_ordering</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Room</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, length, width</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.length = length</span><br><span class="line">        self.width = width</span><br><span class="line">        self.square_feet = self.length * self.width</span><br><span class="line"></span><br><span class="line"><span class="meta">@total_ordering</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">House</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, style</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.style = style</span><br><span class="line">        self.rooms = <span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">living_space_footage</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(r.square_feet <span class="keyword">for</span> r <span class="keyword">in</span> self.rooms)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_room</span>(<span class="params">self, room</span>):</span><br><span class="line">        self.rooms.append(room)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;: &#123;&#125; square foot &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(self.name,</span><br><span class="line">                self.living_space_footage,</span><br><span class="line">                self.style)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.living_space_footage == other.living_space_footage</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__lt__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.living_space_footage &lt; other.living_space_footage</span><br></pre></td></tr></table></figure>
<p>这里我们只是给<code>House</code>类定义了两个方法：<code>__eq__()</code>和<code>__lt__()</code>，它就能支持所有的比较操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build a few houses, and add rooms to them</span></span><br><span class="line">h1 = House(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;Cape&#x27;</span>)</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Master Bedroom&#x27;</span>, <span class="number">14</span>, <span class="number">21</span>))</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Living Room&#x27;</span>, <span class="number">18</span>, <span class="number">20</span>))</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Kitchen&#x27;</span>, <span class="number">12</span>, <span class="number">16</span>))</span><br><span class="line">h1.add_room(Room(<span class="string">&#x27;Office&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>))</span><br><span class="line">h2 = House(<span class="string">&#x27;h2&#x27;</span>, <span class="string">&#x27;Ranch&#x27;</span>)</span><br><span class="line">h2.add_room(Room(<span class="string">&#x27;Master Bedroom&#x27;</span>, <span class="number">14</span>, <span class="number">21</span>))</span><br><span class="line">h2.add_room(Room(<span class="string">&#x27;Living Room&#x27;</span>, <span class="number">18</span>, <span class="number">20</span>))</span><br><span class="line">h2.add_room(Room(<span class="string">&#x27;Kitchen&#x27;</span>, <span class="number">12</span>, <span class="number">16</span>))</span><br><span class="line">h3 = House(<span class="string">&#x27;h3&#x27;</span>, <span class="string">&#x27;Split&#x27;</span>)</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Master Bedroom&#x27;</span>, <span class="number">14</span>, <span class="number">21</span>))</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Living Room&#x27;</span>, <span class="number">18</span>, <span class="number">20</span>))</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Office&#x27;</span>, <span class="number">12</span>, <span class="number">16</span>))</span><br><span class="line">h3.add_room(Room(<span class="string">&#x27;Kitchen&#x27;</span>, <span class="number">15</span>, <span class="number">17</span>))</span><br><span class="line">houses = [h1, h2, h3]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Is h1 bigger than h2?&#x27;</span>, h1 &gt; h2) <span class="comment"># prints True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Is h2 smaller than h3?&#x27;</span>, h2 &lt; h3) <span class="comment"># prints True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Is h2 greater than or equal to h1?&#x27;</span>, h2 &gt;= h1) <span class="comment"># Prints False</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Which one is biggest?&#x27;</span>, <span class="built_in">max</span>(houses)) <span class="comment"># Prints &#x27;h3: 1101-square-foot Split&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Which is smallest?&#x27;</span>, <span class="built_in">min</span>(houses)) <span class="comment"># Prints &#x27;h2: 846-square-foot Ranch&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建缓存实例"><a href="#创建缓存实例" class="headerlink" title="创建缓存实例"></a>创建缓存实例</h4><p>在创建一个类的对象时，如果之前使用同样参数创建过这个对象，你想返回它的缓存引用。为了达到这样的效果，你需要使用一个和类本身分开的工厂函数，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The class in question</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spam</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="comment"># Caching support</span></span><br><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line">_spam_cache = weakref.WeakValueDictionary()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> _spam_cache:</span><br><span class="line">        s = Spam(name)</span><br><span class="line">        _spam_cache[name] = s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = _spam_cache[name]</span><br><span class="line">    <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure>
<p>对于大部分程序而已，这里代码已经够用了。不过还是有一些更高级的实现值得了解下。首先是这里使用到了一个全局变量，并且工厂函数跟类放在一块。我们可以通过将缓存代码放到一个单独的缓存管理器中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CachedSpamManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._cache = weakref.WeakValueDictionary()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self._cache:</span><br><span class="line">            s = Spam(name)</span><br><span class="line">            self._cache[name] = s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = self._cache[name]</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear</span>(<span class="params">self</span>):</span><br><span class="line">            self._cache.clear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spam</span>:</span><br><span class="line">    manager = CachedSpamManager()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">name</span>):</span><br><span class="line">        <span class="keyword">return</span> Spam.manager.get_spam(name)</span><br></pre></td></tr></table></figure>
<p>但是这样暴露了类的实例化给用户，如果想阻止用户实例化该类的话，可以通过如下方法解决</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ------------------------最后的修正方案------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CachedSpamManager2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._cache = weakref.WeakValueDictionary()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_spam</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self._cache:</span><br><span class="line">            temp = Spam3._new(name)  <span class="comment"># Modified creation</span></span><br><span class="line">            self._cache[name] = temp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp = self._cache[name]</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear</span>(<span class="params">self</span>):</span><br><span class="line">            self._cache.clear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spam3</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Can&#x27;t instantiate directly&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Alternate constructor</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_new</span>(<span class="params">cls, name</span>):</span><br><span class="line">        self = cls.__new__(cls)</span><br><span class="line">        self.name = name</span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>

<p><strong>参考文献</strong><br>[1] <a target="_blank" rel="noopener" href="https://www.gitbook.com/book/lenkimo/byte-of-python-chinese-edition/details">A Byte of Python3</a><br>[2] <a target="_blank" rel="noopener" href="http://python3-cookbook.readthedocs.org/zh_CN/latest/c01/p08_calculating_with_dict.html">python3-cookbook</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.sovdating.com/2015/07/12/config-your-mac-development-environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DJY">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sovdating Linux">
      <meta itemprop="description" content="Hello dev">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Sovdating Linux">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/07/12/config-your-mac-development-environment/" class="post-title-link" itemprop="url">配置你的Mac开发环境</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-07-12 23:44:23" itemprop="dateCreated datePublished" datetime="2015-07-12T23:44:23+08:00">2015-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-24 10:14:31" itemprop="dateModified" datetime="2024-01-24T10:14:31+08:00">2024-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/technology/" itemprop="url" rel="index"><span itemprop="name">technology</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>Mac</code>是目前大多数开发者们首选的开发机器，下面就让我们一起来配置你的Mac开发环境吧。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2015/07/12/config-your-mac-development-environment/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/39/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/39/">39</a><span class="page-number current">40</span><a class="page-number" href="/page/41/">41</a><span class="space">&hellip;</span><a class="page-number" href="/page/47/">47</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/41/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">DJY</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
